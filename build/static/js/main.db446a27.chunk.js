(this.webpackJsonpchat_client=this.webpackJsonpchat_client||[]).push([[0],{147:function(e,t){},150:function(e,t,a){},151:function(e,t,a){},152:function(e,t,a){},153:function(e,t,a){},154:function(e,t,a){},157:function(e,t,a){},158:function(e,t,a){},159:function(e,t,a){},160:function(e,t,a){},161:function(e,t,a){},162:function(e,t,a){},163:function(e,t,a){},164:function(e,t,a){},165:function(e,t,a){},168:function(e,t,a){},169:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),s=a(21),i=a.n(s),c=a(7),o=a.n(c),u=a(44),l=a(10),h=a(1),d=a.n(h),m=a(9),p=a(24),f=a(30),g=a(3),v=a(4),y=a(5),b=a(6),E=a(43),k=a.n(E),C=function(e){Object(y.a)(a,e);var t=Object(b.a)(a);function a(){return Object(g.a)(this,a),t.apply(this,arguments)}return Object(v.a)(a,[{key:"render",value:function(){return r.a.createElement("small",{className:"alert alert-danger p-1 message d-block"},this.props.children)}}]),a}(n.Component),w=a(19),N=a.n(w);function O(){N.a.fn.extend({pwToggle:function(){this.prepend(N()("<i>").addClass("fas fa-eye-slash psw-toggle-icon").css({position:"absolute",right:"20px",top:"11px",color:"#666",cursor:"pointer",width:"16px",height:"16px"}).hover((function(){N()(this).css("color","#666")}),(function(){N()(this).css("color","#000")}))),this.css({position:"relative"});var e=this.get(0).children[0],t=this.get(0).children[1];e.addEventListener("click",(function(){"password"===t.type?(e.classList.remove("fa-eye-slash"),e.classList.add("fa-eye"),t.type="text"):(e.classList.remove("fa-eye"),e.classList.add("fa-eye-slash"),t.type="password")}))}})}var j=Object(n.createContext)();var S=function(e){Object(y.a)(a,e);var t=Object(b.a)(a);function a(e){var n;return Object(g.a)(this,a),(n=t.call(this,e)).changeHandler=function(e){var t=e.target.name,a=e.target.value;n.setState(Object(f.a)({},t,a))},n.submitHandler=function(e){e.preventDefault();var t,a,r={username:{presence:!0,length:{minimum:3,tooShort:"has to be at least 3 characters long",maximum:30,tooLong:"can only be 30 characters long"},format:{pattern:new RegExp(/^\w\w*$/),message:"not valid"}},password:{presence:!0,length:{minimum:8,tooShort:"has to be at least 8 characters long",maximum:30,tooLong:"can only be 30 characters long"}}},s=k()({username:n.state.username,password:n.state.password},r);"undefined"!=typeof s?(t="undefined"!=typeof s.username?s.username[0]:"",a="undefined"!=typeof s.password?s.password[0]:"",n.setState({valid:!1,uNameErr:t,pwErr:a})):(n.setState({valid:!0,uNameErr:"",pwErr:""}),n.login(n.state.username,n.state.password).then((function(e){e.success||(void 0!==e.username&&n.setState({valid:!1,uNameErr:e.username}),void 0!==e.password&&n.setState({valid:!1,pwErr:e.password}))})))},n.uNameErr=function(){if(""!==n.state.uNameErr)return d.a.createElement(C,null,n.state.uNameErr)},n.pwErr=function(){if(""!==n.state.pwErr)return d.a.createElement(C,null,n.state.pwErr)},n.login=function(){var e=Object(l.a)(o.a.mark((function e(t,a){var r,s,i;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,r={method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({username:t,password:a})},e.next=4,fetch("/auth/login",r);case 4:if(!(s=e.sent).ok){e.next=13;break}return e.next=8,s.json();case 8:return(i=e.sent).success&&(n.dispatch.setUserSelf(i.uid,t),n.setAuthContext&&n.setAuthContext({username:t,uid:i.uid}),n.props.history.push("/chat")),e.abrupt("return",i);case 13:return e.abrupt("return",null);case 14:e.next=19;break;case 16:return e.prev=16,e.t0=e.catch(0),e.abrupt("return",null);case 19:case"end":return e.stop()}}),e,null,[[0,16]])})));return function(t,a){return e.apply(this,arguments)}}(),n.state={uNameErr:"",username:"",pwErr:"",password:"",valid:!1,redirect:!1},O(),n}return Object(v.a)(a,[{key:"render",value:function(){var e=this;return d.a.createElement(j.Consumer,null,(function(t){t.authTokens;var a=t.setAuthTokens;return e.setAuthContext=a,d.a.createElement("div",{className:"h-100",style:{display:"flex"}},d.a.createElement("div",{className:"col-sm-12 my-auto"},d.a.createElement("div",{className:"container border rounded p-3",style:{maxWidth:"800px"}},d.a.createElement("h1",null,"Login"),d.a.createElement("form",{onSubmit:e.submitHandler},d.a.createElement("div",{className:"form-group"},d.a.createElement("label",{htmlFor:"username"},"Benutzername:"),e.uNameErr(),d.a.createElement("input",{type:"text",name:"username",className:"form-control",placeholder:"Benutzernamen eingeben",onChange:e.changeHandler})),d.a.createElement("div",{className:"form-group"},d.a.createElement("label",{htmlFor:"password"},"Passwort:"),e.pwErr(),d.a.createElement("div",{id:"psw-group"},d.a.createElement("input",{type:"password",name:"password",className:"form-control",placeholder:"Passwort eingeben",onChange:e.changeHandler}))),d.a.createElement("div",{className:"form-group"},"haben Sie noch keinen Account? ",d.a.createElement(m.b,{to:"/register"},"Jetzt registrieren")),d.a.createElement("input",{type:"submit",className:"btn btn-primary",value:"Login"})))))}))}},{key:"componentDidMount",value:function(){N()("#psw-group").pwToggle()}}]),a}(h.Component),T=Object(p.j)(S),x=function(e){Object(y.a)(a,e);var t=Object(b.a)(a);function a(e){var n;return Object(g.a)(this,a),(n=t.call(this,e)).changeHandler=function(e){var t=e.target.name,a=e.target.value;n.setState(Object(f.a)({},t,a))},n.submitHandler=function(e){e.preventDefault();var t,a,r,s={username:{presence:!0,length:{minimum:3,tooShort:"has to be at least 3 characters long",maximum:30,tooLong:"can only be 30 characters long"},format:{pattern:new RegExp(/^\w\w*$/),message:"not valid"}},password:{presence:!0,length:{minimum:8,tooShort:"has to be at least 8 characters long",maximum:30,tooLong:"can only be 30 characters long"}},passwordRepeat:{presence:!0,equality:"password",length:{minimum:8,tooShort:"has to be at least 8 characters long",maximum:30,tooLong:"can only be 30 characters long"}}},i=k()({username:n.state.username,password:n.state.password,passwordRepeat:n.state.pwRepeat},s);"undefined"!=typeof i?(t="undefined"!=typeof i.username?i.username[0]:"",a="undefined"!=typeof i.password?i.password[0]:"",r="undefined"!=typeof i.passwordRepeat?i.passwordRepeat[0]:"",n.setState({valid:!1,uNameErr:t,pwErr:a,pwRepeatErr:r})):(n.setState({valid:!0,uNameErr:"",pwErr:"",pwRepeatErr:""}),n.register(n.state.username,n.state.password).then((function(e){e.success||void 0!==e.username&&n.setState({valid:!1,uNameErr:e.username})})))},n.uNameErr=function(){if(""!==n.state.uNameErr)return d.a.createElement(C,null,n.state.uNameErr)},n.pwErr=function(){if(""!==n.state.pwErr)return d.a.createElement(C,null,n.state.pwErr)},n.pwRepeatErr=function(){if(""!==n.state.pwRepeatErr)return d.a.createElement(C,null,n.state.pwRepeatErr)},n.register=function(){var e=Object(l.a)(o.a.mark((function e(t,a){var r,s,i;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,r={method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({username:t,password:a})},e.next=4,fetch("/auth/register",r);case 4:if(!(s=e.sent).ok){e.next=13;break}return e.next=8,s.json();case 8:return(i=e.sent).success&&(n.dispatch.setUserSelf(i.uid,t),n.setAuthContext&&n.setAuthContext({username:t,uid:i.uid}),n.props.history.push("/chat")),e.abrupt("return",i);case 13:return e.abrupt("return",null);case 14:e.next=19;break;case 16:return e.prev=16,e.t0=e.catch(0),e.abrupt("return",null);case 19:case"end":return e.stop()}}),e,null,[[0,16]])})));return function(t,a){return e.apply(this,arguments)}}(),n.state={uNameErr:"",username:"",pwErr:"",password:"",pwRepeatErr:"",pwRepeat:"",valid:!1,redirect:!1},O(),n}return Object(v.a)(a,[{key:"render",value:function(){var e=this;return d.a.createElement(j.Consumer,null,(function(t){t.authTokens;var a=t.setAuthTokens;return e.setAuthContext=a,d.a.createElement("div",{className:"h-100",style:{display:"flex"}},d.a.createElement("div",{className:"col-sm-12 my-auto"},d.a.createElement("div",{className:"container border rounded p-3",style:{maxWidth:"800px"}},d.a.createElement("h1",null,"Registrieren"),d.a.createElement("form",{onSubmit:e.submitHandler},d.a.createElement("div",{className:"form-group"},d.a.createElement("label",{htmlFor:"username"},"Benutzername:"),e.uNameErr(),d.a.createElement("input",{type:"text",name:"username",className:"form-control",placeholder:"Benutzernamen eingeben",onChange:e.changeHandler})),d.a.createElement("div",{className:"form-group"},d.a.createElement("label",{htmlFor:"password"},"Passwort:"),e.pwErr(),d.a.createElement("div",{id:"psw-group"},d.a.createElement("input",{type:"password",name:"password",className:"form-control",placeholder:"Passwort eingeben",onChange:e.changeHandler}))),d.a.createElement("div",{className:"form-group"},d.a.createElement("label",{htmlFor:"password"},"Passwort wiederholen:"),e.pwRepeatErr(),d.a.createElement("div",{id:"psw-group-repeat"},d.a.createElement("input",{type:"password",name:"pwRepeat",className:"form-control",placeholder:"Passwort eingeben",onChange:e.changeHandler}))),d.a.createElement("input",{type:"submit",className:"btn btn-primary",value:"Registrieren"})))))}))}},{key:"componentDidMount",value:function(){N()("#psw-group-repeat, #psw-group").pwToggle()}}]),a}(h.Component),M=Object(p.j)(x),_=a(92);var U=function(e){var t=e.component,a=Object(_.a)(e,["component"]),s=Object(n.useContext)(j).authTokens;return r.a.createElement(p.b,Object.assign({},a,{render:function(e){return s?s.loading?null:r.a.createElement(t,e):r.a.createElement(p.a,{to:{pathname:"/login",state:{referer:e.location}}})}}))},D=a(88),I=a.n(D),L={names:{aqua:"#00ffff",black:"#000000",blue:"#0000ff",brown:"#a52a2a",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgrey:"#a9a9a9",darkgreen:"#006400",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkviolet:"#9400d3",fuchsia:"#ff00ff",gold:"#ffd700",green:"#008000",indigo:"#4b0082",khaki:"#f0e68c",lightblue:"#add8e6",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightpink:"#ffb6c1",lime:"#00ff00",magenta:"#ff00ff",maroon:"#800000",navy:"#000080",olive:"#808000",orange:"#ffa500",pink:"#ffc0cb",purple:"#800080",violet:"#800080",red:"#ff0000",silver:"#c0c0c0"},random:function(){var e,t=0;for(var a in this.names)Math.random()<1/++t&&(e=a);return e}},R=L,A=a(91),B=function(e){Object(y.a)(a,e);var t=Object(b.a)(a);function a(){return Object(g.a)(this,a),t.apply(this,arguments)}return Object(v.a)(a,[{key:"getIndex",value:function(e){for(var t=0,a=this.length-1;t<=a;){var n=Math.floor((t+a)/2);if(this[n].key===e)return n;this[n].key<e?t=n+1:a=n-1}return-1}},{key:"getNearestKey",value:function(e){var t;for(++e;-1===(t=this.getIndex(--e));)if(0===e)return-1;return t}},{key:"get",value:function(e){var t=this.getIndex(e);if(-1!==t)return this[t].value}},{key:"add",value:function(e,t){-1===this.getIndex(e)&&this.splice(this.getNearestKey(e)+1,0,{key:e,value:t})}},{key:"remove",value:function(e){var t=this.getIndex(e);-1!==t&&this.splice(t,1)}}]),a}(Object(A.a)(Array)),G=0,H=1,V=2,F=3,P=4,W=5,z=6;function J(){return(J=Object(l.a)(o.a.mark((function e(t){var a,n,r,s;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(-1===ne.users.getIndex(t)){e.next=10;break}if(0===ne.users.get(t).normalChat){e.next=5;break}return e.abrupt("return",G);case 5:return a=ne.users.get(t),ne.temporaryChat.createNew(t,a.username),e.abrupt("return",V);case 8:e.next=41;break;case 10:if(!ne.temporaryChat.doesExist(t)){e.next=14;break}return e.abrupt("return",V);case 14:return e.prev=14,n={method:"GET",headers:{Accept:"application/json"}},e.next=18,fetch("/user/"+t,n);case 18:if(!(r=e.sent).ok){e.next=35;break}return e.next=22,r.json();case 22:if(!(s=e.sent).userExists||s.blocked){e.next=28;break}return ne.temporaryChat.createNew(t,s.username),e.abrupt("return",V);case 28:if(s.userExists){e.next=32;break}return e.abrupt("return",F);case 32:return e.abrupt("return",P);case 33:e.next=36;break;case 35:return e.abrupt("return",z);case 36:e.next=41;break;case 38:return e.prev=38,e.t0=e.catch(14),e.abrupt("return",z);case 41:case"end":return e.stop()}}),e,null,[[14,38]])})))).apply(this,arguments)}var Y=function(){function e(t,a){Object(g.a)(this,e),this._normalChat=0,this._groupChats=new B,this.uid=t,this.username=a,this.color=R.random()}return Object(v.a)(e,[{key:"addGroupChat",value:function(e){this.groupChats.add(e,e)}},{key:"removeGroupChat",value:function(e){this.groupChats.remove(e)}},{key:"uid",get:function(){return this._uid},set:function(e){this._uid=e}},{key:"username",get:function(){return this._username},set:function(e){this._username=e}},{key:"color",get:function(){return this._color},set:function(e){this._color=e}},{key:"normalChat",get:function(){return this._normalChat},set:function(e){this._normalChat=e}},{key:"groupChats",get:function(){return this._groupChats},set:function(e){this._groupChats=e}}]),e}();var q=function(){function e(t,a,n,r){var s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new Date(Date.now());Object(g.a)(this,e),this.mid=t,this.content=a,this.uid=n,this.date=s,this.chat=r}return Object(v.a)(e,[{key:"getMessageObject",value:function(e){var t={content:this.content,mDateString:this.getMessageViewDateString(),dateString:this.getDateString(),date:this.date,bySelf:this.uid===ne.userSelf.uid};return e&&(t.userTop=this.getUserTop()),t}},{key:"getUserTop",value:function(){if(this.uid===ne.userSelf.uid)return{uid:this.uid,username:"Du:",color:ne.userSelf.color};var e=ne.users.get(this.uid);return{uid:this.uid,username:e.username+":",color:e.color}}},{key:"getChatViewDateString",value:function(){return this.isDateToday()?"heute "+this.getTimeString():this.isDateYesterday()?"gestern":this.getDateString()}},{key:"getChatViewMsgString",value:function(){var e=this.content;return e.length>18&&(e=e.substr(0,18)+"..."),this.uid===ne.userSelf.uid?"Du: ".concat(e):"normalchat"===this.chat.type?this.content:"".concat(ne.users.get(this.uid).username,": ").concat(e)}},{key:"getMessageViewDateString",value:function(){return this.isDateToday()?this.getTimeString():this.isDateYesterday()?"gestern "+this.getTimeString():this.getDateString()+" "+this.getTimeString()}},{key:"isDateToday",value:function(){var e=new Date(Date.now());return this.date.getDate()===e.getDate()&&this.date.getMonth()===e.getMonth()&&this.date.getFullYear()===e.getFullYear()}},{key:"isDateYesterday",value:function(){var e=new Date(Date.now());return this.date.getDate()===e.getDate()-1&&this.date.getMonth()===e.getMonth()&&this.date.getFullYear()===e.getFullYear()}},{key:"getDateString",value:function(){var e,t=this.date.getDate();e=t<10?"0"+t:t;var a,n=this.date.getMonth();a=n+1<10?"0"+(n+1):n+1;var r=this.date.getFullYear();return"".concat(e,".").concat(a,".").concat(r)}},{key:"getTimeString",value:function(){var e,t=this.date.getHours();e=t<10?"0"+t:t;var a,n=this.date.getMinutes();return a=n<10?"0"+n:n,"".concat(e,":").concat(a)}},{key:"isDifferentDay",value:function(e){return this.date.getDay()!==e.getDay()||this.date.getMonth()!==e.getMonth()||this.date.getFullYear()!==e.getFullYear()}},{key:"mid",get:function(){return this._mid},set:function(e){this._mid=e}},{key:"content",get:function(){return this._content},set:function(e){this._content=e}},{key:"uid",get:function(){return this._uid},set:function(e){this._uid=e}},{key:"date",get:function(){return this._date},set:function(e){this._date=e}},{key:"chat",get:function(){return this._chat},set:function(e){this._chat=e}}]),e}(),$=function(){function e(){Object(g.a)(this,e),this.events=new Map}return Object(v.a)(e,[{key:"on",value:function(e,t){this.events.has(e)?this.events.get(e).push(t):this.events.set(e,[t])}},{key:"rm",value:function(e,t){if(this.events.has(e))for(var a=this.events.get(e),n=0;n<a.length;n++)a[n]===t&&a.splice(n,1)}},{key:"trigger",value:function(e){if(this.events.has(e)){for(var t=arguments.length,a=new Array(t>1?t-1:0),n=1;n<t;n++)a[n-1]=arguments[n];for(var r=0;r<this.events.get(e).length;r++){var s;(s=this.events.get(e))[r].apply(s,a)}}}},{key:"events",get:function(){return this._events},set:function(e){this._events=e}}]),e}(),K=function(){function e(t,a,n){Object(g.a)(this,e),this._messages=new B,this._event=new $,this._unreadMessages=0,this._reachedTopMessages=!1,this.type=t,this.id=a,this.chatName=n}return Object(v.a)(e,[{key:"loadMessages",value:function(){var e=Object(l.a)(o.a.mark((function e(t){var a,n,r,s,i,c,u,l,h,d,m=this;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.reachedTopMessages){e.next=17;break}return a=function(){var e=m.getLastMessage();return null!==e?e.mid:-1},n={method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({chatType:this.type,chatId:this.id,lastMsgId:a(),num:t})},e.next=5,fetch("/message/load",n);case 5:if(!(r=e.sent).ok){e.next=16;break}return e.next=9,r.json();case 9:for(s=e.sent,this.reachedTopMessages="reached top"===s.status,i=s.messages,c=new Array(i.length),u=this.showUserInfoMessage(),l=i.length-1;l>=0;l--)h=i[l],d=new q(h.mid,h.content,h.uid,this,new Date(h.date)),this.messages.add(h.mid,d),c[l]=d.getMessageObject(u);return e.abrupt("return",c);case 16:throw new Error;case 17:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getLastMessage",value:function(){return 0!==this.messages.length?this.messages[0].value:null}},{key:"getFirstMessage",value:function(){return 0!==this.messages.length?this.messages[this.messages.length-1].value:null}},{key:"getMessages",value:function(){for(var e=this.showUserInfoMessage(),t=new Array(this.messages.length),a=0;a<this.messages.length;a++){var n=this.messages[a].value;t[a]=n.getMessageObject(e)}return t}},{key:"addMessage",value:function(e,t,a){var n=new q(a,t,e,this,new Date(Date.now()));this.messages.add(a,n),Object(h.getDispatch)().newMsg(this,this.unreadMessages,n.getMessageObject(this.showUserInfoMessage()))}},{key:"showUserInfoMessage",value:function(){return"groupChat"===this.type}},{key:"getChatObject",value:function(){return{type:this.type,id:this.id,chatName:this.chatName,latestMessage:this.getLatestMessageObject(),unreadMessages:0}}},{key:"getLatestMessageObject",value:function(){if(0===this.messages.length)return null;var e=this.getFirstMessage();return{msgString:e.getChatViewMsgString(),dateString:e.getChatViewDateString(),date:e.date}}},{key:"type",get:function(){return this._type},set:function(e){this._type=e}},{key:"id",get:function(){return this._id},set:function(e){this._id=e}},{key:"messages",get:function(){return this._messages},set:function(e){this._messages=e}},{key:"chatName",get:function(){return this._chatName},set:function(e){this._chatName=e}},{key:"event",get:function(){return this._event},set:function(e){this._event=e}},{key:"unreadMessages",get:function(){return this._unreadMessages},set:function(e){this._unreadMessages=e}},{key:"reachedTopMessages",get:function(){return this._reachedTopMessages},set:function(e){this._reachedTopMessages=e}}]),e}(),Z=function(e){Object(y.a)(a,e);var t=Object(b.a)(a);function a(e,n,r){var s;return Object(g.a)(this,a),(s=t.call(this,"normalChat",e,n))._isTyping=!1,s.otherUser=r,s}return Object(v.a)(a,[{key:"getUsersTyping",value:function(){if(this.isTyping){var e=ne.users.get(this.otherUser);return[{uid:e.uid,username:e.username}]}return[]}},{key:"getLatestUserTyping",value:function(){if(this.isTyping){var e=ne.users.get(this.otherUser);return{uid:e.uid,username:e.username}}return null}},{key:"startedTyping",value:function(e){e===this.otherUser&&(this.isTyping=!0,this.event.trigger("typeState changed"))}},{key:"stoppedTyping",value:function(e){e===this.otherUser&&(this.isTyping=!1,this.event.trigger("typeState changed"))}},{key:"otherUser",get:function(){return this._otherUser},set:function(e){this._otherUser=e}},{key:"isTyping",get:function(){return this._isTyping},set:function(e){this._isTyping=e}}]),a}(K),Q=function(e){Object(y.a)(a,e);var t=Object(b.a)(a);function a(e,n,r){var s;return Object(g.a)(this,a),(s=t.call(this,"groupChat",e,n))._users=[],s._usersTyping=[],s.users=r,s}return Object(v.a)(a,[{key:"getUsersTyping",value:function(){if(this.usersTyping.length>0){for(var e=[],t=0;t<this.usersTyping.length;t++){var a=ne.users.get(this.usersTyping[t]);e.push({uid:a.uid,username:a.username})}return e}return[]}},{key:"getLatestUserTyping",value:function(){if(this.usersTyping.length>0){var e=ne.users.get(this.usersTyping[this.usersTyping.length-1]);return{uid:e.uid,username:e.username}}return null}},{key:"startedTyping",value:function(e){this.isMember(e)&&(this.isTyping(e)||(this.usersTyping.push(e),this.event.trigger("typeState changed")))}},{key:"stoppedTyping",value:function(e){this.isMember(e)&&this.isTyping(e)&&(this.usersTyping.splice(this.getIndexOfTyping(e),1),this.event.trigger("typeState changed"))}},{key:"isMember",value:function(e){return e!==ne.userSelf.uid&&this.users.find((function(t){return t===e}))}},{key:"isTyping",value:function(e){return this.usersTyping.find((function(t){return t===e}))}},{key:"getIndexOfTyping",value:function(e){return this.usersTyping.findIndex((function(t){return t===e}))}},{key:"users",get:function(){return this._users},set:function(e){this._users=e}},{key:"usersTyping",get:function(){return this._usersTyping},set:function(e){this._usersTyping=e}}]),a}(K),X=function(){function e(){Object(g.a)(this,e),this._isShown=!1}return Object(v.a)(e,[{key:"createNew",value:function(e,t){this.chatNow=new Z(0,t,e)}},{key:"doesExist",value:function(e){return void 0!==this.chatNow&&this.chatNow.otherUser===e}},{key:"show",value:function(){this.isShown=!0,Object(h.getDispatch)().showTempChat(this.chatNow)}},{key:"update",value:function(){Object(h.getDispatch)().updateTempChat(this.chatNow)}},{key:"hide",value:function(){this.isShown=!1,Object(h.getDispatch)().hideTempChat()}},{key:"createNewNormalChat",value:function(){var e=Object(l.a)(o.a.mark((function e(t){var a=this;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){var r=a.chatNow.otherUser,s=a.chatNow.chatName;ne.socket.emit("new normalChat",{uid:r,username:s,message:t},(function(n){-1===ne.users.getIndex(r)&&ne.users.add(r,new Y(r,s,n.online));var i=ne.users.get(r);i.online=n.online;var c=new Z(n.ncid,s,r);i.normalChat=c.id,ne.chats.normal.add(n.ncid,c),c.messages.add(n.mid,new q(n.mid,t,ne.userSelf.uid,c,new Date(Date.now()))),Object(h.getDispatch)().addChat(c),Object(h.getDispatch)().selectChat(c),a.hide(),e(!0)}))})));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"isShown",get:function(){return this._isShown},set:function(e){this._isShown=e}},{key:"chatNow",get:function(){return this._chatNow},set:function(e){this._chatNow=e}}]),e}(),ee=function(){function e(){Object(g.a)(this,e),this._users=new B,this._chats={normal:new B,group:new B},this._event=new $,this._finishedLoading=!1,this._temporaryChat=new X,this._initCalled=!1}return Object(v.a)(e,[{key:"destruct",value:function(){this.socket&&(this.socket.removeAllListeners(),this.socket.disconnect()),this.initCalled=!1}},{key:"init",value:function(){var e=Object(l.a)(o.a.mark((function e(){var t,a,n,r=this;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=Object(h.getGlobal)().userSelf,a=t.uid,n=t.username,this.userSelf=new Y(a,n),this.userInfo={uid:a,username:n},this.initCalled=!0,this.userSelf=new Y(a,n),this.userInfo={uid:a,username:n},this.socket=I.a.connect("/",{secure:!0}),this.socket.emit("auth",a,n),this.socket.on("initialized",(function(){r.initChats()})),this.socket.on("chat message",(function(e){var t=r.getChat(e.type,e.id);if(null!==t){var a=r.isCurrentChat(t.type,t.id);t.addMessage(e.uid,e.content,e.mid),t.hasNewMsg=!a,t.unreadMessages++,r.event.trigger("new message",e.type,e.id)}})),this.socket.on("started typing",(function(e){r.getChat(e.type,e.id).startedTyping(e.uid)})),this.socket.on("stopped typing",(function(e){r.getChat(e.type,e.id).stoppedTyping(e.uid)})),this.socket.on("users-noChat",(function(e){te.event.trigger("users-noChat",e)})),this.socket.on("new chat",(function(e){r.addNewChat(e)})),this.socket.on("disconnect",(function(){setTimeout((function(){Object(h.getDispatch)().deleteUserSelf(),Object(h.getDispatch)().resetGlobal(),ae(),alert("Verbindung verloren! Seite wird neu geladen"),location.reload()}),1e3)}));case 15:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"initChats",value:function(){var e=Object(l.a)(o.a.mark((function e(){var t,a,n,r;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={method:"GET",headers:{Accept:"application/json"}},e.next=3,fetch("/chats",t);case 3:if(200!==(a=e.sent).status){e.next=9;break}return e.next=7,a.json();case 7:for(n=e.sent,r=0;r<n.length;r++)"normalChat"===n[r].type?this.addNewNormalChat(n[r]):"groupChat"===n[r].type&&this.addNewGroupChat(n[r]);case 9:this.finishedLoading=!0,this.event.trigger("chats loaded",this.getChatArraySortedByDate());case 11:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getChatArraySortedByDate",value:function(){function e(e){var t=e.latestMessage;return null!==t?t.date.getTime():new Date(0).getTime()}function t(t,a){for(var n=a,r=a+1;r<t.length;r++)e(t[n])<e(t[r])&&(n=r);return n}function a(e,t,a){var n=e[t];e[t]=e[a],e[a]=n}function n(e){for(var n=function(e){for(var t=new Array(e.length),a=0;a<e.length;a++){var n=e[a].value;t[a]=n.getChatObject()}return t}(e),r=0;r<n.length-1;r++){a(n,r,t(n,r))}return n}return function(t,a){for(var n=new Array(t.length+a.length),r=0,s=0,i=0;i<n.length;i++)s<a.length?r<t.length&&e(t[r])>e(a[s])?(n[i]=t[r],r++):(n[i]=a[s],s++):(n[i]=t[r],r++);return n}(n(this.chats.normal),n(this.chats.group))}},{key:"isCurrentChat",value:function(e,t){var a=Object(h.getGlobal)().currentChat;return a.type===e&&a.id===t}},{key:"getChat",value:function(e,t){return"normalChat"===e?this.chats.normal.get(t):"tempChat"===e?this.temporaryChat.chatNow:"groupChat"===e?this.chats.group.get(t):void 0}},{key:"addNewChat",value:function(e){var t;"normalChat"===e.type?t=this.addNewNormalChat(e):"groupChat"===e.type&&(t=this.addNewGroupChat(e)),t.unreadMessages=1,Object(h.getDispatch)().addChat(t)}},{key:"addNewNormalChat",value:function(e){var t;-1===this.users.getIndex(e.members[0].uid)?(t=new Y(e.members[0].uid,e.members[0].username),this.users.add(t.uid,t)):t=this.users.get(e.members[0].uid);var a=new Z(e.id,e.chatName,t.uid);t.normalChat=a.id;var n=e.firstMessage;return n.empty||a.messages.add(n.mid,new q(n.mid,n.content,n.uid,a,new Date(n.date))),this.chats.normal.add(e.id,a),a}},{key:"addNewGroupChat",value:function(e){for(var t=[],a=0;a<e.members.length;a++){var n=e.members[a],r=void 0;-1===this.users.getIndex(n.uid)?(r=new Y(n.uid,n.username),this.users.add(r.uid,r)):r=this.users.get(n.uid),t.push(r.uid),r.addGroupChat(e.id)}var s=new Q(e.id,e.chatName,t),i=e.firstMessage;return i.empty||s.messages.add(i.mid,new q(i.mid,i.content,i.uid,s,new Date(i.date))),this.chats.group.add(e.id,s),s}},{key:"socket",get:function(){return this._socket},set:function(e){this._socket=e}},{key:"userSelf",get:function(){return this._userSelf},set:function(e){this._userSelf=e}},{key:"users",get:function(){return this._users},set:function(e){this._users=e}},{key:"chats",get:function(){return this._chats},set:function(e){this._chats=e}},{key:"event",get:function(){return this._event},set:function(e){this._event=e}},{key:"finishedLoading",get:function(){return this._finishedLoading},set:function(e){this._finishedLoading=e}},{key:"temporaryChat",get:function(){return this._temporaryChat},set:function(e){this._temporaryChat=e}},{key:"initCalled",get:function(){return this._initCalled},set:function(e){this._initCalled=e}}]),e}(),te=new ee;function ae(){te.destruct(),te=new ee}var ne=te,re=992,se=768,ie=991,ce=767,oe=320,ue=425,le=function(){return{width:window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,height:window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight}},he=le(),de={width:he.width,height:he.height},me=function(e){Object(y.a)(a,e);var t=Object(b.a)(a);function a(){var e;Object(g.a)(this,a);for(var n=arguments.length,s=new Array(n),i=0;i<n;i++)s[i]=arguments[i];return(e=t.call.apply(t,[this].concat(s))).state=de,e.render=function(){var t=e.props,a=t.children,n=t.displayIn,s=e.state,i=s.width,c=s.height,o=e.shouldRender(n,i,c);return r.a.createElement(r.a.Fragment,null,o?a:null)},e.handleResize=function(){var t=le(),a=t.width,n=t.height;e.setState({width:a,height:n})},e.shouldRender=function(e,t,a){return-1!==e.indexOf("Laptop")&&t>=re||(-1!==e.indexOf("Tablet")&&t<=ie&&t>=se||(-1!==e.indexOf("Mobile")&&t<=ce||(-1!==e.indexOf("MobilePortrait")&&t<=ce&&a>=ue||!!(-1!==e.indexOf("MobileLandScape")&&t<=ce&&a<=oe))))},e}return Object(v.a)(a,[{key:"componentDidMount",value:function(){window.addEventListener("resize",this.handleResize,!1)}},{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this.handleResize,!1)}}]),a}(r.a.PureComponent),pe=function(e){Object(y.a)(a,e);var t=Object(b.a)(a);function a(){return Object(g.a)(this,a),t.apply(this,arguments)}return Object(v.a)(a,[{key:"componentDidMount",value:function(){"function"===typeof this.props.didMount&&this.props.didMount()}},{key:"componentDidUpdate",value:function(e,t,a){"function"===typeof this.props.didUpdate&&this.props.didUpdate()}},{key:"render",value:function(){return this.props.children?this.props.children:null}}]),a}(n.Component),fe=(a(150),0),ge=1,ve=2,ye=function(e){Object(y.a)(a,e);var t=Object(b.a)(a);function a(){return Object(g.a)(this,a),t.apply(this,arguments)}return Object(v.a)(a,[{key:"render",value:function(){var e=this,t=this.props.location.pathname;return d.a.createElement(pe,null,d.a.createElement(me,{displayIn:["Mobile"]},d.a.createElement("div",{className:"float-left left"},d.a.createElement("i",{id:"btnBackToChatList",className:"fas fa-arrow-left fa-2x d-block d-md-none",onClick:function(){e.props.history.goBack()}}),e.global.newMessages>0?d.a.createElement("div",{className:"btnBack-number"},e.global.newMessages):null)),function(){switch(e.global.infoHeaderCenter){case ge:return d.a.createElement(Ee,null,d.a.createElement("h3",{id:"chat-info-name"},e.global.ihcData.name),d.a.createElement(m.b,{to:t+"/userInfo/"+e.global.ihcData.uid},d.a.createElement("i",{className:"fas fa-info-circle fa-2x","data-toggle":"tooltip",title:"chat info"})));case ve:return d.a.createElement(Ee,null,d.a.createElement("h3",{id:"chat-info-name"},e.global.ihcData.name),d.a.createElement(m.b,{to:"/chat/groupInfo/"+e.global.ihcData.gcid},d.a.createElement("i",{className:"fas fa-info-circle fa-2x","data-toggle":"tooltip",title:"chat info"})));default:return d.a.createElement(me,{displayIn:["Laptop","Tablet"]},d.a.createElement("h3",{className:"pt-2 pl-2"},"chat"))}}())}}]),a}(h.Component),be=Object(p.j)(ye);function Ee(e){return d.a.createElement("div",{id:"chat-info",className:"center pt-2"},e.children)}a(151);var ke=function(e){Object(y.a)(a,e);var t=Object(b.a)(a);function a(e){var n;return Object(g.a)(this,a),(n=t.call(this,e)).clickCheckBox=function(e){n.state.checkBoxClicked?e.stopPropagation():setTimeout((function(){n.setState((function(e){return{checkBoxClicked:!0}}))}),20)},n.clickDocument=function(e){n.state.checkBoxClicked&&n.changeChecked(e)},n.changeChecked=function(e){n.setState((function(e){return{checkBoxClicked:!e.checkBoxClicked}}))},n.logout=function(){fetch("/auth/logout",{method:"GET",headers:{Accept:"application/json"}}).then((function(){n.deleteAuthTokens&&n.deleteAuthTokens()})).catch()},n.state={checkBoxClicked:!1},n}return Object(v.a)(a,[{key:"render",value:function(){var e=this,t=this.props.location.pathname;return d.a.createElement(j.Consumer,null,(function(a){a.authTokens,a.setAuthTokens;var n=a.deleteAuthTokens;return e.deleteAuthTokens=n,d.a.createElement("div",{className:"c-header"},d.a.createElement(be,null),d.a.createElement("div",{id:"top-right",className:"right",onClick:e.clickCheckBox},d.a.createElement("div",{className:"right-l"}),d.a.createElement("input",{type:"checkbox",id:"btnControlTopRight",className:"btnControl",checked:e.state.checkBoxClicked,onChange:e.changeChecked}),d.a.createElement("label",{htmlFor:"btnControlTopRight"},d.a.createElement("div",{className:"right-c"},d.a.createElement("div",{className:"d-only-when-small"},d.a.createElement("i",{id:"user-info",className:"fas fa-user fa-2x user-icon","data-toggle":"tooltip",title:"Benutzer-Info"})),d.a.createElement("div",{className:"d-only-when-big top-2right"},d.a.createElement(m.b,{to:t+"/userInfo/"+e.global.userSelf.uid},d.a.createElement("h4",{id:"username",className:"p-2 username","data-toggle":"tooltip",title:"Benutzer-Info"},e.global.userSelf.username)),d.a.createElement("div",{className:"float-right"},d.a.createElement(m.b,{to:t+"/settings"},d.a.createElement("i",{className:"fas fa-user-cog fa-2x","data-toggle":"tooltip",title:"Einstellungen"})),"\xa0",d.a.createElement("i",{id:"user-logout",className:"fas fa-sign-out-alt fa-2x logout","data-toggle":"tooltip",title:"logout",onClick:e.logout})))))))}))}},{key:"componentDidMount",value:function(){N()('[data-toggle="tooltip"]').tooltip(),document.addEventListener("click",this.clickDocument,!1)}},{key:"componentWillUnmount",value:function(){document.removeEventListener("click",this.clickDocument,!1)}}]),a}(h.Component),Ce=Object(p.j)(ke),we=(a(152),function(e){Object(y.a)(a,e);var t=Object(b.a)(a);function a(){var e;Object(g.a)(this,a);for(var n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return(e=t.call.apply(t,[this].concat(r))).searchChanged=function(t){e.props.onSearch(t.target.value)},e}return Object(v.a)(a,[{key:"render",value:function(){var e=this.props.location.pathname;return r.a.createElement("div",{className:"chatSearchBox"},r.a.createElement("div",{className:"chat-select-form"},r.a.createElement("input",{type:"text",name:"chat-search",className:"chat-search",placeholder:"Chat suchen",onChange:this.searchChanged}),r.a.createElement(m.b,{to:e+"/newChat"},r.a.createElement("button",{id:"btn-newChat",className:"btn-newChat"},r.a.createElement("i",{className:"fas fa-plus fa-lg"})))))}}]),a}(n.Component)),Ne=Object(p.j)(we),Oe=function(e){Object(y.a)(a,e);var t=Object(b.a)(a);function a(e){var n;return Object(g.a)(this,a),(n=t.call(this,e)).isSelected=function(){return n.props.id===n.global.currentChat.id&&n.props.type===n.global.currentChat.type},n.typeStateChanged=function(){var e="",t=ne.getChat(n.props.type,n.props.id).getLatestUserTyping();null!==t&&(e=t.username+" schreibt..."),n.setState({typeMsg:e})},n.state={lastMsg:void 0,typeMsg:""},n}return Object(v.a)(a,[{key:"render",value:function(){var e=this,t=function(){return e.props.latestMessage?d.a.createElement("span",null,e.props.latestMessage.msgString):d.a.createElement("span",null,"Noch keine Nachrichten vorhanden")},a=function(){return e.props.latestMessage?d.a.createElement("div",{className:"lastMsg-date"},e.props.latestMessage.dateString):null};return d.a.createElement("li",{className:this.isSelected()?"selected ":""},d.a.createElement(m.b,{to:"normalChat"===e.props.type?"/chat/user/"+ne.getChat("normalChat",e.props.id).otherUser:"groupChat"===e.props.type?"/chat/group/"+e.props.id:"tempChat"===e.props.type?"/chat/user/"+ne.temporaryChat.chatNow.otherUser:void 0},d.a.createElement("div",{className:"w-100"},d.a.createElement("strong",null,this.props.name),0===e.props.unreadMessages?null:d.a.createElement("div",{className:"newMsg-number"},e.props.unreadMessages)),""===e.state.typeMsg?d.a.createElement("div",{className:"w-100 lastMsg"},t(),a()):d.a.createElement("div",{className:"w-100 typeMsg"},e.state.typeMsg)))}},{key:"componentDidMount",value:function(){ne.getChat(this.props.type,this.props.id).event.on("typeState changed",this.typeStateChanged)}},{key:"componentDidUpdate",value:function(e,t,a){e.type===this.props.type&&e.id===this.props.id||(ne.getChat(e.type,e.id).event.rm("typeState changed",this.typeStateChanged),ne.getChat(this.props.type,this.props.id).event.on("typeState changed",this.typeStateChanged),this.setState({typeMsg:""}))}},{key:"componentWillUnmount",value:function(){ne.getChat(this.props.type,this.props.id).event.rm("typeState changed",this.typeStateChanged)}}]),a}(h.Component),je=(a(153),function(e){Object(y.a)(a,e);var t=Object(b.a)(a);function a(e){var n;return Object(g.a)(this,a),(n=t.call(this,e)).state={searchValue:""},n}return Object(v.a)(a,[{key:"render",value:function(){var e=this,t=this.props.paddingTop||"1rem",a=0;return d.a.createElement("div",{style:{paddingTop:t,height:"100%"}},d.a.createElement("div",{className:"chat-c-list"},d.a.createElement(Ne,{onSearch:function(t){e.setState({searchValue:t})}}),d.a.createElement("ul",{className:"chat-list"},e.global.tempChat?d.a.createElement(Oe,{key:-1,id:0,type:"tempChat",name:e.global.tempChat.chatName,unreadMessages:0,latestMessage:null}):null,this.global.chats.map((function(t,n){return t.chatName.includes(e.state.searchValue)?(a++,d.a.createElement(Oe,{key:n,id:t.id,type:t.type,name:t.chatName,unreadMessages:t.unreadMessages,latestMessage:t.latestMessage})):null}))),0===a?d.a.createElement("span",null,"Nichts gefunden"):null))}}]),a}(h.Component));a(154);function Se(e){return r.a.createElement("div",{className:"loader-init"},r.a.createElement("div",{className:"col-sm-12 my-auto"},r.a.createElement("div",{className:"init-container border rounded"},r.a.createElement("div",{className:"spinner-border text-secondary",style:{width:"15rem",height:"15rem",borderWidth:"0.5rem"},role:"status"},r.a.createElement("span",{className:"sr-only"},"Loading...")),r.a.createElement("div",{className:"loader-text"},e.msg))))}var Te=a(36),xe=a(42),Me=(a(155),a(89)),_e=(a(157),function(e){Object(y.a)(a,e);var t=Object(b.a)(a);function a(e){var n;return Object(g.a)(this,a),(n=t.call(this,e))._userTyping=!1,n._typeEventEmitted=!1,n.onTyping=function(e){n.setState({message:e.target.value}),n.handleTypeMessage()},n.handleTypeMessage=function(){n.isTempChat||(n.userTyping&&clearTimeout(n.typeTimeout),n.userTyping=!0,n.typeEventEmitted||(n.typeEventEmitted=!0,ne.socket.emit("started typing")),n.typeTimeout=setTimeout((function(){n.userTyping=!1,n.typeEventEmitted&&(n.typeEventEmitted=!1,ne.socket.emit("stopped typing"))}),1e3))},n.onSubmit=function(e){if(e.preventDefault(),""!==n.state.message){var t=n.state.message;if(n.setState({message:""}),n.isTempChat){var a=n.props.location.pathname;ne.temporaryChat.createNewNormalChat(t).then((function(e){e&&(n.props.history.replace("/chat"),n.props.history.replace(a))}))}else n.sendMessage(t).then((function(e){ne.getChat(n.props.chatType,n.props.chatId).addMessage(ne.userSelf.uid,t,e)})).catch((function(e){}))}},n.sendMessage=function(){var e=Object(l.a)(o.a.mark((function e(t){var a,n,r;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a={method:"PUT",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({msg:t})},e.next=3,fetch("/message",a);case 3:if(!(n=e.sent).ok){e.next=9;break}return e.next=7,n.json();case 7:return r=e.sent,e.abrupt("return",r.mid);case 9:return e.abrupt("return",new Error);case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),n.onEmojiInput=function(e){n.setState({message:n.state.message+e.native}),n.handleTypeMessage()},n.toggleEmoji=function(e){n.setState((function(e){return{showEmoji:!e.showEmoji}}))},n.state={message:"",showEmoji:!1},n}return Object(v.a)(a,[{key:"render",value:function(){return r.a.createElement(pe,null,r.a.createElement("form",{onSubmit:this.onSubmit,className:"msg-form"},r.a.createElement("div",{className:"message-input"},r.a.createElement("input",{autoComplete:"off",placeholder:"Nachricht:",value:this.state.message,onChange:this.onTyping}),r.a.createElement("i",{className:"far fa-smile fa-2x emoji-toggle",onClick:this.toggleEmoji})),r.a.createElement("button",{className:"btn-submit",type:"submit"},r.a.createElement("i",{className:"far fa-paper-plane fa-2x","data-toggle":"tooltip",title:"send message"}))),this.state.showEmoji?r.a.createElement("div",{style:{position:"absolute",bottom:"60px",right:"50px",width:"350px",height:"425px"}},r.a.createElement(Me.a,{onSelect:this.onEmojiInput})):null)}},{key:"componentDidMount",value:function(){this.isTempChat="tempChat"===this.props.chatType}},{key:"componentDidUpdate",value:function(e,t,a){this.isTempChat="tempChat"===this.props.chatType}},{key:"userTyping",get:function(){return this._userTyping},set:function(e){this._userTyping=e}},{key:"typeEventEmitted",get:function(){return this._typeEventEmitted},set:function(e){this._typeEventEmitted=e}},{key:"typeTimeout",get:function(){return this._typeTimeout},set:function(e){this._typeTimeout=e}},{key:"isTempChat",get:function(){return this._isTempChat},set:function(e){this._isTempChat=e}}]),a}(n.Component)),Ue=Object(p.j)(_e),De=(a(158),function(e){Object(y.a)(a,e);var t=Object(b.a)(a);function a(){return Object(g.a)(this,a),t.apply(this,arguments)}return Object(v.a)(a,[{key:"render",value:function(){var e=this.props.msg;return r.a.createElement("div",{className:"p-2 border rounded "+(e.bySelf?"float-right ":"float-left ")+"msg-container-other msg-container"},e.userTop?r.a.createElement("div",{className:"w-100"},r.a.createElement("strong",{className:"msg-container-header"},r.a.createElement("span",{style:{color:R.names[e.userTop.color]}},e.userTop.username))):null,r.a.createElement("div",{className:"w-100 msg-container-content"},r.a.createElement("p",{className:"mb-0"},e.content)),r.a.createElement("div",{className:"w-100 msg-date-outer"},r.a.createElement("div",{className:"msg-date"},e.mDateString)))}}]),a}(n.Component)),Ie=(a(159),function(e){Object(y.a)(a,e);var t=Object(b.a)(a);function a(e){var n;return Object(g.a)(this,a),(n=t.call(this,e))._isMounted=!1,n.scrollHandler=function(e){n.setState({scrollToBottom:n.getScrollToBottom()}),0===n.messagesNode.scrollTop&&n.loadMessages()},n.setScrollToBottom=function(e){n.messagesNode.scrollTop=n.messagesNode.scrollHeight-n.messagesNode.offsetHeight-e},n.getScrollToBottom=function(){return n.messagesNode.scrollHeight-n.messagesNode.offsetHeight-n.messagesNode.scrollTop},n.assignMessagesRef=function(e){n.messages=e},n.loadMessages=function(){var e=ne.getChat(n.global.currentChat.type,n.global.currentChat.id);e.reachedTopMessages||n.setState({msgLoading:!0}),e.loadMessages(10).then((function(e){n.dispatch.addLoadedMessages(e),n.setState((function(e){return{msgLoading:!1}})),n.setScrollToBottom(n.state.scrollToBottom)})).catch((function(e){return n.setState({msgLoading:!1})}))},n.chatChanged=function(){0===n.messagesNode.scrollTop&&n.loadMessages()},n.assignMessagesRef=n.assignMessagesRef.bind(Object(xe.a)(n)),n.state={msgLoading:!1,scrollToBottom:0,messages:[],typeMessages:[]},n}return Object(v.a)(a,[{key:"componentDidMount",value:function(){this.messagesNode=i.a.findDOMNode(this.messages),this.chatChanged(),this.isMounted=!0}},{key:"componentDidUpdate",value:function(e,t,a){e.chatType===this.props.chatType&&e.chatId===this.props.chatId||(this.setScrollToBottom(0),this.chatChanged()),0===this.state.scrollToBottom&&(this.setScrollToBottom(0),this.global.currentChat.newMessages>0&&this.setGlobal((function(e){return{currentChat:Object(Te.a)({},e.currentChat,{newMessages:0})}})))}},{key:"render",value:function(){var e=this,t=new Date(0);return d.a.createElement("div",{className:"chat-container"},d.a.createElement("div",{className:"messages",onScroll:this.scrollHandler,ref:this.assignMessagesRef},e.state.msgLoading?d.a.createElement("div",{className:"messageLoader-top"},d.a.createElement("div",{className:"spinner-border text-secondary",role:"status"},d.a.createElement("span",{className:"sr-only"},"Loading..."))):null,this.global.currentChat.messages.map((function(e,a){return d.a.createElement("div",{key:a},function(e){return a=e.date,n=t,a.getDay()!==n.getDay()||a.getMonth()!==n.getMonth()||a.getFullYear()!==n.getFullYear()?(t=e.date,d.a.createElement("div",{className:"date-container"},d.a.createElement("div",null,e.dateString))):(t=e.date,null);var a,n}(e),d.a.createElement(De,{msg:e}))})),0===e.global.currentChat.messages.length?d.a.createElement("div",{className:"alert alert-primary",role:"alert"},"Noch keine Nachrichten vorhanden"):null,e.isMounted&&e.getScrollToBottom()>10?d.a.createElement("div",{id:"messages-bottom",className:"messages-bottom",onClick:function(){e.setState({scrollToBottom:0})}},d.a.createElement("div",{id:"btnToBottom",className:"chevron-down"},d.a.createElement("i",{className:"fas fa-chevron-down fa-2x"})),e.global.currentChat.newMessages>0?d.a.createElement("div",{id:"scroll-down-number",className:"number"},e.global.currentChat.newMessages):null):null),d.a.createElement(Ue,{chatType:this.props.chatType,chatId:this.props.chatId}))}},{key:"componentWillUnmount",value:function(){this.isMounted=!1}},{key:"isMounted",get:function(){return this._isMounted},set:function(e){this._isMounted=e}},{key:"messages",get:function(){return this._messages},set:function(e){this._messages=e}},{key:"messagesNode",get:function(){return this._messagesNode},set:function(e){this._messagesNode=e}}]),a}(h.Component)),Le=function(e){Object(y.a)(a,e);var t=Object(b.a)(a);function a(){return Object(g.a)(this,a),t.apply(this,arguments)}return Object(v.a)(a,[{key:"render",value:function(){return r.a.createElement("div",{className:"chat-container"},r.a.createElement("div",{className:"messages"},r.a.createElement("div",{className:"alert alert-primary",role:"alert"},"Noch keine Nachrichten vorhanden")),r.a.createElement(Ue,{chatType:"tempChat",chatId:0}))}},{key:"componentDidMount",value:function(){ne.temporaryChat.show()}},{key:"componentDidUpdate",value:function(e,t,a){ne.temporaryChat.update()}},{key:"componentWillUnmount",value:function(){ne.temporaryChat.hide()}}]),a}(n.Component),Re=function(e){Object(y.a)(a,e);var t=Object(b.a)(a);function a(e){var n;return Object(g.a)(this,a),(n=t.call(this,e)).userChanged=function(){var e=parseInt(n.props.uid);if(n.global.userSelf.uid===e)n.setState({error:W,loaded:!0});else{var t=function(){(function(e){return J.apply(this,arguments)})(e).then((function(t){t===G?(n.setState({error:t}),n.setGlobal({infoHeaderCenter:ge,ihcData:{name:ne.users.get(e).username,uid:e}}).then(),n.selectNormalChat(e)):t===V?(n.setState({error:t}),n.setGlobal({infoHeaderCenter:ge,ihcData:{name:ne.temporaryChat.chatNow.chatName,uid:e}}).then(),n.selectTempChat()):n.setState({error:z}),n.setState({loaded:!0})})).catch((function(e){return n.setState({error:z})}))};ne.finishedLoading?t():ne.event.on("chats loaded",(function(){t()})),n.setState({uid:parseInt(n.props.uid)})}},n.state={uid:0,loaded:!1,error:G},n}return Object(v.a)(a,[{key:"render",value:function(){var e=this;return d.a.createElement("div",{className:"h-100"},function(){if(!e.state.loaded)return d.a.createElement(Se,{msg:"Chat wird geladen"})}(),e.state.error===H?d.a.createElement("div",null,d.a.createElement("h2",null,"ung\xfcltige Addresse")):e.state.error===W?d.a.createElement("div",null,d.a.createElement("h2",null,"Du kannst dir selbst nicht schreiben")):e.state.loaded?e.state.error===G?d.a.createElement(Ie,{chatType:e.global.currentChat.type,chatId:e.global.currentChat.id}):e.state.error===V?d.a.createElement(Le,null):e.state.error===P?d.a.createElement("div",null,d.a.createElement("h2",null,"Dieser User hat dich blockiert")):d.a.createElement("div",null,d.a.createElement("h2",null,"Dieser User existiert nicht")):void 0)}},{key:"componentDidMount",value:function(){this.userChanged()}},{key:"componentDidUpdate",value:function(e,t,a){e.uid!==this.props.uid&&(isNaN(this.props.uid)?this.setState({error:H}):this.userChanged())}},{key:"selectTempChat",value:function(){this.dispatch.showTempChat()}},{key:"selectNormalChat",value:function(e){if(-1===ne.users.getIndex(e))this.setState({error:F});else{var t=ne.users.get(e).normalChat,a=ne.getChat("normalChat",t);this.dispatch.selectChat(a)}}},{key:"componentWillUnmount",value:function(){this.setGlobal({infoHeaderCenter:fe,ihcData:null}).then()}}]),a}(h.Component),Ae=(a(160),function(e){Object(y.a)(a,e);var t=Object(b.a)(a);function a(e){var n;return Object(g.a)(this,a),(n=t.call(this,e)).loadChatInfo=function(){(function(){var e=Object(l.a)(o.a.mark((function e(){var t,a,r;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={method:"GET",headers:{Accept:"application/json"}},e.next=3,fetch("/group/"+n.props.gcid+"/",t);case 3:if(!(a=e.sent).ok){e.next=9;break}return e.next=7,a.json();case 7:r=e.sent,n.setState({data:r});case 9:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}})()().then((function(e){n.setState({loaded:!0,error:!1})})).catch((function(e){n.setState({loaded:!0,error:!0})}))},n.state={error:!1,loaded:!1,data:null},n}return Object(v.a)(a,[{key:"componentDidMount",value:function(){this.loadChatInfo()}},{key:"componentDidUpdate",value:function(e,t,a){e.gcid!==this.props.gcid&&this.loadChatInfo()}},{key:"render",value:function(){var e=this.props.location.pathname;if(this.state.error)return r.a.createElement("div",{className:"alert alert-danger",role:"alert"},"Ein Fehler ist aufgetreten!");if(!this.state.loaded)return r.a.createElement(Se,{msg:"info wird geladen"});var t=ne.userSelf.uid;return r.a.createElement("div",{className:"groupChatInfo"},r.a.createElement("h1",null,this.state.data.name),r.a.createElement("h4",null,this.state.data.users.length," Mitglieder:"),r.a.createElement("ul",{className:"userList"},this.state.data.users.map((function(a,n){return r.a.createElement("li",{key:n},r.a.createElement(m.b,{to:e+"/userInfo/"+a.uid},t===a.uid?r.a.createElement("span",null,"Du"):a.username,1===a.isAdmin?r.a.createElement("div",{className:"user-admin"},"Admin"):null))}))))}}]),a}(n.Component)),Be=Object(p.j)(Ae),Ge=0,He=1,Ve=2,Fe=3,Pe=4,We=0,ze=1,Je=function(e){Object(y.a)(a,e);var t=Object(b.a)(a);function a(e){var n;return Object(g.a)(this,a),(n=t.call(this,e)).groupChatExists=function(){var e=Object(l.a)(o.a.mark((function e(t){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(-1===ne.chats.group.getIndex(t)){e.next=4;break}return e.abrupt("return",Ge);case 4:return e.abrupt("return",Ve);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),n.chatChanged=function(){if(isNaN(n.props.gcid))n.setState({error:He,loaded:!0});else{var e=function(){var e=parseInt(n.props.gcid);n.groupChatExists(e).then((function(t){t===Ge?(n.selectGroupChat(e),n.setState({loaded:!0,error:Ge,gcid:e}),n.setGlobal({infoHeaderCenter:ve,ihcData:{name:ne.chats.group.get(e).chatName,gcid:e}}).then()):n.setState({loaded:!0,error:t})})).catch()};ne.finishedLoading?e():ne.event.on("chats loaded",(function(){e()}))}},n.state={gcid:0,loaded:!1,error:Ge},n}return Object(v.a)(a,[{key:"selectGroupChat",value:function(e){if(-1===ne.chats.group.getIndex(e))this.setState({error:Ve});else{var t=ne.chats.group.get(e);this.dispatch.selectChat(t)}}},{key:"componentDidMount",value:function(){this.chatChanged()}},{key:"componentDidUpdate",value:function(e,t,a){e.gcid!==this.props.gcid&&this.chatChanged()}},{key:"componentWillUnmount",value:function(){this.setGlobal({infoHeaderCenter:fe,ihcData:null}).then()}},{key:"render",value:function(){var e=this;return d.a.createElement("div",{className:"h-100"},function(){if(!e.state.loaded)return d.a.createElement(Se,{msg:"Chat wird geladen"})}(),function(){if(e.state.error===He)return d.a.createElement("div",null,d.a.createElement("h2",null,"ung\xfcltige Addresse"));if(e.state.loaded)switch(e.state.error){case Ge:switch(e.props.tab){case We:return d.a.createElement(Ie,{chatType:e.global.currentChat.type,chatId:e.global.currentChat.id});case ze:return d.a.createElement(Be,{gcid:e.state.gcid});default:return null}case Fe:return d.a.createElement("div",null,d.a.createElement("h2",null,"Du bist nicht Mitglied in diesem chat jetzt beitreten"));case Pe:return d.a.createElement("div",null,d.a.createElement("h2",null,"Du bist nicht dazu berechtigt diesen chat anzusehen"));case Ve:return d.a.createElement("div",null,d.a.createElement("h2",null,"Dieser Chat existiert nicht"));default:return null}}())}}]),a}(h.Component),Ye=(a(161),function(e){Object(y.a)(a,e);var t=Object(b.a)(a);function a(){return Object(g.a)(this,a),t.apply(this,arguments)}return Object(v.a)(a,[{key:"render",value:function(){var e=this;return r.a.createElement("div",{className:"modal-outer",onClick:function(){e.props.history.goBack()}},r.a.createElement("div",{className:"h-100",style:{display:"flex"}},r.a.createElement("div",{className:"modal-inner",onClick:function(e){e.stopPropagation()}},r.a.createElement("div",{className:"btn-close",onClick:function(){e.props.history.goBack()}},"\xd7"),this.props.children)))}}]),a}(n.Component)),qe=Object(p.j)(Ye);function $e(e){return r.a.createElement("div",{className:"m-header"},e.children)}function Ke(e){return r.a.createElement("div",{className:"m-main"},e.children)}var Ze=function(e){Object(y.a)(a,e);var t=Object(b.a)(a);function a(){var e;Object(g.a)(this,a);for(var n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return(e=t.call.apply(t,[this].concat(r))).elementClicked=function(t){ne.temporaryChat.createNew(e.props.uid,e.props.username)},e}return Object(v.a)(a,[{key:"render",value:function(){return r.a.createElement("li",null,r.a.createElement(m.b,{to:"/chat/user/"+this.props.uid,onClick:this.elementClicked,replace:!0},this.props.username))}}]),a}(n.Component),Qe=Object(p.j)(Ze),Xe=(a(162),0),et=1,tt=function(e){Object(y.a)(a,e);var t=Object(b.a)(a);function a(e){var n;return Object(g.a)(this,a),(n=t.call(this,e))._numAlreadyLoaded=0,n.showOptions=function(e){clearTimeout(n.clickedOutsideTimer),n.setState({showOptions:!0})},n.clickedOutsideOptions=function(){n.clickedOutsideTimer=setTimeout(n.hideOptions,100)},n.hideOptions=function(){n.setState({showOptions:!1})},n.newGroupClick=function(e){clearTimeout(n.clickedOutsideTimer),n.props.setCurrentTab(mt.newGroup)},n.joinGroupClick=function(e){clearTimeout(n.clickedOutsideTimer),n.props.setCurrentTab(mt.chooseGroup)},n.searchChanged=function(e){var t=e.target.value;n.setState({searchValue:t,searchValid:!0}),n.numAlreadyLoaded=0,n.reachedBottom=!1,n.requestSearchResult(t).then((function(e){}))},n.requestSearchResult=function(){var e=Object(l.a)(o.a.mark((function e(t){var a,r,s,i;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,a={method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({search:t,limit:10,start:n.numAlreadyLoaded})},e.next=4,fetch("/user/noChat",a);case 4:if(!(r=e.sent).ok){e.next=13;break}return e.next=8,r.json();case 8:0===(s=e.sent).length&&0===n.numAlreadyLoaded?n.setState({searchResult:[]}):0===s.length?n.reachedBottom=!0:(i=n.getScrollToBottom(),0===n.numAlreadyLoaded?n.setState({searchResult:s}):n.setState((function(e){return{searchResult:e.searchResult.concat(s)}})),n.numAlreadyLoaded+=s.length,0===i&&n.requestSearchResult(t)),n.setState({error:Xe}),e.next=14;break;case 13:n.setState({error:et});case 14:e.next=19;break;case 16:e.prev=16,e.t0=e.catch(0),n.setState({error:et});case 19:case"end":return e.stop()}}),e,null,[[0,16]])})));return function(t){return e.apply(this,arguments)}}(),n.assignListRef=function(e){n.listRef=e},n.setScrollToBottom=function(e){n.listNode.scrollTop=n.listNode.scrollHeight-n.listNode.offsetHeight-e},n.getScrollToBottom=function(){return null!==n.listNode?n.listNode.scrollHeight-n.listNode.offsetHeight-n.listNode.scrollTop:0},n.state={error:Xe,showOptions:!1,searchValue:"",searchValid:!0,searchResult:[],showLoaderBottom:!1},n}return Object(v.a)(a,[{key:"render",value:function(){var e=this;return r.a.createElement(pe,null,r.a.createElement("div",{className:"user-top"},r.a.createElement("div",{className:"searchUser"},r.a.createElement("input",{type:"text",name:"newChat-searchUser",className:"form-control",placeholder:"Benutzer suchen",onChange:this.searchChanged})),r.a.createElement("div",{className:"user-more"},r.a.createElement("i",{className:"fas fa-ellipsis-h fa-2x",onClick:this.showOptions}),e.state.showOptions?r.a.createElement("div",{className:"options"},r.a.createElement("ul",{ref:e.assignListRef},r.a.createElement("li",{onClick:e.newGroupClick},"neue Gruppe"),r.a.createElement("li",{onClick:e.joinGroupClick},"einer Gruppe beitreten"))):null)),e.state.error===et?r.a.createElement("div",{className:"alert alert-danger",role:"alert"},"Ein Fehler ist aufgetreten!"):e.state.searchValid?e.state.searchResult.length>0?r.a.createElement(pe,null,r.a.createElement("h5",null,"Ergebnisse:"),r.a.createElement("ul",{className:"searchUser-list result-list"},e.state.searchResult.map((function(t,a){return r.a.createElement(Qe,{key:a,uid:t.uid,username:t.username,hide:e.props.hide})})))):r.a.createElement("ul",{className:"result-list"},r.a.createElement("div",{className:"alert alert-warning",role:"alert"},"Nichts gefunden!")):r.a.createElement("div",{className:"alert alert-danger",role:"alert"},"Ihre Suche enth\xe4lt ung\xfcltige Zeichen!"))}},{key:"componentDidMount",value:function(){this.listNode=i.a.findDOMNode(this.listRef),document.body.addEventListener("click",this.clickedOutsideOptions),this.numAlreadyLoaded=0,this.reachedBottom=!1,this.requestSearchResult("").then((function(e){}))}},{key:"componentDidUpdate",value:function(e,t,a){this.listNode=i.a.findDOMNode(this.listRef)}},{key:"componentWillUnmount",value:function(){clearTimeout(this.clickedOutsideTimer),document.body.removeEventListener("click",this.clickedOutsideOptions)}},{key:"clickedOutsideTimer",get:function(){return this._clickedOutsideTimer},set:function(e){this._clickedOutsideTimer=e}},{key:"numAlreadyLoaded",get:function(){return this._numAlreadyLoaded},set:function(e){this._numAlreadyLoaded=e}},{key:"reachedBottom",get:function(){return this._reachedBottom},set:function(e){this._reachedBottom=e}},{key:"listRef",get:function(){return this._listRef},set:function(e){this._listRef=e}},{key:"listNode",get:function(){return this._listNode},set:function(e){this._listNode=e}}]),a}(n.Component),at=a(90),nt=function(e){Object(y.a)(a,e);var t=Object(b.a)(a);function a(){var e;Object(g.a)(this,a);for(var n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return(e=t.call.apply(t,[this].concat(r))).clicked=function(t){e.props.isSelected?e.props.deselectUser(e.props.index):e.props.selectUser(e.props.index)},e}return Object(v.a)(a,[{key:"render",value:function(){return r.a.createElement("li",{key:this.props.index,onClick:this.clicked},r.a.createElement("div",{className:"username"},this.props.username),r.a.createElement("div",{className:"user-select fa-lg"+(this.props.isSelected?" selected":"")},r.a.createElement("i",{className:"fas fa-check"})))}}]),a}(n.Component),rt=0,st=1,it=function(e){Object(y.a)(a,e);var t=Object(b.a)(a);function a(e){var n;return Object(g.a)(this,a),(n=t.call(this,e))._numAlreadyLoaded=0,n._reachedBottom=!1,n.refreshSearch=function(){n.numAlreadyLoaded=0,n.loadUsers().then((function(e){}))},n.searchChanged=function(e){n.setState({searchValue:e.target.value}),n.refreshSearch()},n.loadUsers=Object(l.a)(o.a.mark((function e(){var t,a,r,s;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t={method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({search:n.state.searchValue,limit:10,start:n.numAlreadyLoaded})},e.next=4,fetch("/user/",t);case 4:if(!(a=e.sent).ok){e.next=13;break}return e.next=8,a.json();case 8:0===(r=e.sent).length&&0===n.numAlreadyLoaded?n.setState({searchResult:[]}):0===r.length?n.reachedBottom=!0:(s=n.getScrollToBottom(),0===n.numAlreadyLoaded?n.setState({searchResult:r}):n.setState((function(e){return{searchResult:e.searchResult.concat(r)}})),n.numAlreadyLoaded+=r.length,0===s&&n.loadUsers(n.props.searchValue)),n.setState({error:rt}),e.next=14;break;case 13:n.setState({error:st});case 14:e.next=19;break;case 16:e.prev=16,e.t0=e.catch(0),n.setState({error:st});case 19:case"end":return e.stop()}}),e,null,[[0,16]])}))),n.selectUser=function(e){var t=n.state.searchResult[e];n.props.selectUser(t.uid,t.username)},n.deselectUser=function(e){var t=n.state.searchResult[e];n.props.deselectUser(t.uid)},n.assignListRef=function(e){n.listRef=e},n.setScrollToBottom=function(e){n.listNode.scrollTop=n.listNode.scrollHeight-n.listNode.offsetHeight-e},n.getScrollToBottom=function(){return null!==n.listNode?n.listNode.scrollHeight-n.listNode.offsetHeight-n.listNode.scrollTop:0},n.state={searchValue:"",searchResult:[],showLoaderBottom:!1,error:rt},n}return Object(v.a)(a,[{key:"render",value:function(){var e=this;return r.a.createElement(pe,null,r.a.createElement("form",{className:"form-group",style:{width:"90%",maxWidth:"650px"}},r.a.createElement("input",{type:"text",className:"form-control p-2 m-2",placeholder:"Benutzer suchen",value:this.state.searchValue,onChange:this.searchChanged})),r.a.createElement("ul",{className:"selectUsers-list result-list",ref:this.assignListRef},this.state.searchResult.length>0?this.state.searchResult.map((function(t,a){return r.a.createElement(nt,{key:a,index:a,uid:t.uid,username:t.username,selectUser:e.selectUser,deselectUser:e.deselectUser,isSelected:e.props.isUserSelected(t.uid)})})):r.a.createElement("div",{className:"alert alert-warning",role:"alert"},"Nichts gefunden!")))}},{key:"componentDidMount",value:function(){this.listNode=i.a.findDOMNode(this.listRef),this.refreshSearch()}},{key:"componentDidUpdate",value:function(e,t,a){this.listNode=i.a.findDOMNode(this.listRef),this.props.searchValue!==e.searchValue&&this.refreshSearch()}},{key:"componentWillUnmount",value:function(){}},{key:"numAlreadyLoaded",get:function(){return this._numAlreadyLoaded},set:function(e){this._numAlreadyLoaded=e}},{key:"reachedBottom",get:function(){return this._reachedBottom},set:function(e){this._reachedBottom=e}},{key:"listRef",get:function(){return this._listRef},set:function(e){this._listRef=e}},{key:"listNode",get:function(){return this._listNode},set:function(e){this._listNode=e}}]),a}(n.Component),ct=(a(163),function(e){Object(y.a)(a,e);var t=Object(b.a)(a);function a(e){var n;return Object(g.a)(this,a),(n=t.call(this,e)).selectUser=function(e,t){n.setState((function(a){return{selectedUsers:a.selectedUsers.concat({uid:e,username:t})}}))},n.deselectUser=function(e){n.setState((function(t){var a=Object(at.a)(t.selectedUsers),n=a.findIndex((function(t){return t.uid===e}));return a.splice(n,1),{selectedUsers:a}}))},n.deselectIndex=function(e){n.deselectUser(n.state.selectedUsers[e].uid)},n.isUserSelected=function(e){return n.state.selectedUsers.find((function(t){return t.uid===e}))},n.btnNextClicked=function(e){n.props.onNext(n.state.selectedUsers)},n.state={selectedUsers:[],showOnlySelected:!1},n}return Object(v.a)(a,[{key:"render",value:function(){var e=this;return 0===this.state.selectedUsers.length&&this.state.showOnlySelected&&this.setState({showOnlySelected:!1}),r.a.createElement(pe,null,r.a.createElement("div",{className:"select-users"},0===e.state.selectedUsers.length?r.a.createElement("h4",null,"Noch niemand ausgew\xe4hlt"):r.a.createElement("h4",{className:"w-100"},r.a.createElement("span",{className:"selected-num"+(e.state.showOnlySelected?" selected":""),onClick:function(t){e.setState((function(e){return{showOnlySelected:!e.showOnlySelected}}))}},e.state.selectedUsers.length,"\xa0Benutzer"),"\xa0ausgew\xe4hlt",r.a.createElement("i",{className:"fas fa-arrow-right fa-lg float-right btn-next",onClick:e.btnNextClicked}))),this.state.showOnlySelected?r.a.createElement("ul",{className:"selectUsers-list only-selected result-list"},this.state.selectedUsers.map((function(t,a){return r.a.createElement(nt,{key:a,index:a,uid:t.uid,username:t.username,selectUser:function(){},deselectUser:e.deselectIndex,isSelected:!0})}))):r.a.createElement(it,{selectUser:this.selectUser,deselectUser:this.deselectUser,isUserSelected:this.isUserSelected}))}}]),a}(n.Component)),ot=function(e){Object(y.a)(a,e);var t=Object(b.a)(a);function a(e){var n;return Object(g.a)(this,a),(n=t.call(this,e)).groupNameChanged=function(e){n.setState({groupName:e.target.value})},n.formSubmitted=function(e){e.preventDefault(),n.props.submitGroup({name:n.state.groupName,description:"",isPublic:!1})},n.state={groupName:""},n}return Object(v.a)(a,[{key:"render",value:function(){return r.a.createElement("div",{className:"user-results"},r.a.createElement("form",{className:"form-group p-3",onSubmit:this.formSubmitted},r.a.createElement("h4",null,"Gruppennamen eingeben"),r.a.createElement("input",{type:"text",id:"input-groupName",name:"groupName",className:"form-control",placeholder:"Gruppenname",onChange:this.groupNameChanged}),r.a.createElement("div",null,r.a.createElement("button",{type:"submit",className:"float-right btn btn-primary m-3"},"Gruppe erstellen"))))}}]),a}(n.Component),ut=0,lt=1,ht=function(e){Object(y.a)(a,e);var t=Object(b.a)(a);function a(e){var n;return Object(g.a)(this,a),(n=t.call(this,e)).showEnterChatInfo=function(e){n.setState({currentTab:lt,selectedUsers:e})},n.submitGroup=function(e){for(var t=new Array(n.state.selectedUsers.length),a=0;a<n.state.selectedUsers.length;a++)t[a]={uid:n.state.selectedUsers[a].uid,username:n.state.selectedUsers[a].username,isAdmin:!1};n.createGroupChat(e,t).then((function(e){}))},n.createGroupChat=function(){var e=Object(l.a)(o.a.mark((function e(t,a){var r;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,r={method:"PUT",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({data:t,users:a})},e.next=4,fetch("/group/",r);case 4:e.sent.ok&&n.props.history.goBack(),e.next=10;break;case 8:e.prev=8,e.t0=e.catch(0);case 10:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(t,a){return e.apply(this,arguments)}}(),n.state={currentTab:ut,selectedUsers:[]},n}return Object(v.a)(a,[{key:"render",value:function(){switch(this.state.currentTab){case ut:return r.a.createElement(ct,{onNext:this.showEnterChatInfo});case lt:return r.a.createElement(ot,{submitGroup:this.submitGroup});default:return null}}}]),a}(n.Component),dt=Object(p.j)(ht),mt=(a(164),{chooseUser:0,newGroup:1,chooseGroup:2}),pt=function(e){Object(y.a)(a,e);var t=Object(b.a)(a);function a(e){var n;return Object(g.a)(this,a),(n=t.call(this,e)).setCurrentTab=function(e){n.setState({currentTab:e})},n.state={currentTab:mt.chooseUser},n}return Object(v.a)(a,[{key:"render",value:function(){var e=this;return r.a.createElement(pe,null,r.a.createElement($e,null,r.a.createElement("h1",null,function(){switch(e.state.currentTab){case mt.chooseUser:return"Neuer Chat";case mt.newGroup:return"Neue Gruppe";case mt.chooseGroup:return"Gruppe ausw\xe4hlen";default:return"Neuer Chat"}}())),r.a.createElement(Ke,null,r.a.createElement("div",{className:"newChat"},function(){switch(e.state.currentTab){case mt.chooseUser:return r.a.createElement(tt,{setCurrentTab:e.setCurrentTab,hide:e.props.hide});case mt.newGroup:return r.a.createElement(dt,null);case mt.chooseGroup:return r.a.createElement("div",null,r.a.createElement("h4",null,"chooseGroup"));default:return r.a.createElement(tt,{setCurrentTab:e.setCurrentTab,hide:e.props.hide})}}())))}}]),a}(n.Component),ft=0,gt=1,vt=2,yt=function(e){Object(y.a)(a,e);var t=Object(b.a)(a);function a(e){var n;return Object(g.a)(this,a),(n=t.call(this,e)).setUser=function(){if(isNaN(n.props.uid))n.setState({error:vt});else if(ne.userSelf.uid===parseInt(n.props.uid))n.setState({error:gt,loaded:!0});else{var e=parseInt(n.props.uid);n.setState({uid:e,error:ft,loaded:!1}),n.fetchUser(e).then().catch()}},n.state={uid:0,loaded:!1,error:ft,userInfo:null},n}return Object(v.a)(a,[{key:"render",value:function(){return this.state.loaded?this.state.error===gt?r.a.createElement(pe,null,r.a.createElement($e,null,r.a.createElement("h1",null,"Du")),r.a.createElement(Ke,null,"xx")):r.a.createElement(pe,null,r.a.createElement($e,null,r.a.createElement("h1",null,this.state.userInfo.username,"\xa0",r.a.createElement(m.b,{to:"/chat/user/"+this.state.uid},r.a.createElement("i",{className:"far fa-comment-alt"})))),r.a.createElement(Ke,null,r.a.createElement("h2",null,"Gruppen"))):null}},{key:"fetchUser",value:function(){var e=Object(l.a)(o.a.mark((function e(t){var a,n,r;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a={method:"GET",headers:{Accept:"application/json"}},e.next=3,fetch("/user/"+t,a);case 3:if(!(n=e.sent).ok){e.next=12;break}return e.next=7,n.json();case 7:return r=e.sent,this.setState({userInfo:r,loaded:!0}),e.abrupt("return",r);case 12:return e.abrupt("return",null);case 13:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"componentDidMount",value:function(){this.setUser()}},{key:"componentDidUpdate",value:function(e,t,a){e.uid!==this.props.uid&&this.setUser()}},{key:"componentWillUnmount",value:function(){}}]),a}(n.Component);function bt(e){var t=Object(p.i)().path;return r.a.createElement(p.d,null,r.a.createElement(p.b,{path:"".concat(t,"/newChat")},e.children,r.a.createElement(qe,null,r.a.createElement(pt,null))),r.a.createElement(p.b,{path:"".concat(t,"/userInfo/:uidInfo"),render:function(t){return r.a.createElement(pe,null,e.children,r.a.createElement(qe,null,r.a.createElement(yt,{uid:t.match.params.uidInfo})))}}),r.a.createElement(p.b,{path:"".concat(t,"/settings")},e.children,r.a.createElement(qe,null,r.a.createElement("h3",null,"settings"))),r.a.createElement(p.b,{path:"*"},e.children))}function Et(e){var t=Object(p.i)(),a=t.path;t.url,Object(p.h)();return r.a.createElement("div",{className:"row justify-content-end main-container"},r.a.createElement("div",{className:"col-md-5 col-lg-4 col-xl-3 d-none d-md-block pr-3 pl-0 h-100"},r.a.createElement(je,null)),r.a.createElement("div",{className:"col-md-7 col-lg-8 col-xl-9 col-overflow",style:{padding:"0"}},r.a.createElement(p.d,null,r.a.createElement(p.b,{path:"".concat(a,"/user/:uid"),render:function(e){return r.a.createElement(bt,null,r.a.createElement(Re,{uid:e.match.params.uid}))}}),r.a.createElement(p.b,{path:"".concat(a,"/group/:gcid"),render:function(e){return r.a.createElement(bt,null,r.a.createElement(Je,{gcid:e.match.params.gcid,tab:We}))}}),r.a.createElement(p.b,{path:"".concat(a,"/groupInfo/:gcid"),render:function(e){return r.a.createElement(bt,null,r.a.createElement(Je,{gcid:e.match.params.gcid,tab:ze}))}}),r.a.createElement(p.b,{path:a},r.a.createElement(bt,null,r.a.createElement("h1",null,"noch kein chat ausgew\xe4hlt"))))))}a(165);var kt=function(e){Object(y.a)(a,e);var t=Object(b.a)(a);function a(e){var n;return Object(g.a)(this,a),(n=t.call(this,e)).typeStateChanged=function(){var e=ne.getChat(n.props.chatType,n.props.chatId);n.setState({usersTyping:e.getUsersTyping()})},n.state={usersTyping:[]},n}return Object(v.a)(a,[{key:"render",value:function(){return r.a.createElement("div",{className:"typeMsg-container"},this.state.usersTyping.map((function(e,t){return r.a.createElement("div",{key:t,className:"typeMsg"},e.username+" schreibt...")})))}},{key:"componentDidMount",value:function(){ne.getChat(this.props.chatType,this.props.chatId).event.on("typeState changed",this.typeStateChanged)}},{key:"componentDidUpdate",value:function(e,t,a){e.chatType===this.props.chatType&&e.chatId===this.props.chatId||(ne.getChat(e.chatType,e.chatId).event.rm("typeState changed",this.typeStateChanged),ne.getChat(this.props.chatType,this.props.chatId).event.on("typeState changed",this.typeStateChanged))}},{key:"componentWillUnmount",value:function(){ne.getChat(this.props.chatType,this.props.chatId).event.rm("typeState changed",this.typeStateChanged)}}]),a}(n.Component);function Ct(e){var t=Object(p.i)().path;return r.a.createElement(p.d,null,r.a.createElement(p.b,{path:"".concat(t,"/newChat")},r.a.createElement(pt,null)),r.a.createElement(p.b,{path:"".concat(t,"/userInfo/:uidInfo"),render:function(e){return r.a.createElement(yt,{uid:e.match.params.uidInfo})}}),r.a.createElement(p.b,{path:"".concat(t,"/settings")},r.a.createElement("h3",null,"settings")),r.a.createElement(p.b,{path:"*"},e.children))}function wt(e){var t=Object(p.i)().path,a=Object(h.useGlobal)(),n=Object(u.a)(a,2),r=n[0],s=(n[1],function(){return""!==r.currentChat.type&&0!==r.currentChat.id?d.a.createElement(kt,{chatType:r.currentChat.type,chatId:r.currentChat.id}):null});return d.a.createElement("div",{className:"main-container"},d.a.createElement(p.d,null,d.a.createElement(p.b,{path:"".concat(t,"/user/:uid"),render:function(e){return d.a.createElement(Ct,null,d.a.createElement(Re,{uid:e.match.params.uid}),s())}}),d.a.createElement(p.b,{path:"".concat(t,"/group/:gcid"),render:function(e){return d.a.createElement(Ct,null,d.a.createElement(Je,{gcid:e.match.params.gcid,tab:We}),s())}}),d.a.createElement(p.b,{path:"".concat(t,"/groupInfo/:gcid"),render:function(e){return d.a.createElement(Ct,null,d.a.createElement(Je,{gcid:e.match.params.gcid,tab:ze}))}}),d.a.createElement(p.b,{path:t},d.a.createElement(Ct,null,d.a.createElement(je,{paddingTop:"20px"}))),d.a.createElement(p.b,{path:"*"},d.a.createElement("h3",null,"Not found!"))))}var Nt=function(e){Object(y.a)(a,e);var t=Object(b.a)(a);function a(e){var n;return Object(g.a)(this,a),(n=t.call(this,e)).state={modal:0,modalInfo:null,notifications:0},n}return Object(v.a)(a,[{key:"componentDidMount",value:function(){ne.initCalled||ne.init().then((function(e){}))}},{key:"render",value:function(){return r.a.createElement("div",{className:"h-100"},r.a.createElement(Ce,null),r.a.createElement(me,{displayIn:["Mobile"]},r.a.createElement(wt,null)),r.a.createElement(me,{displayIn:["Laptop","Tablet"]},r.a.createElement(Et,null)))}}]),a}(n.Component);a(166),a(167),a(168);function Ot(e,t){try{var a=e.uid,n=e.username;t.setUserSelf(a,n)}catch(r){}}function jt(){return(jt=Object(l.a)(o.a.mark((function e(){var t;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t={method:"GET",headers:{Accept:"application/json"}},e.next=4,fetch("/user/self",t);case 4:if(403!==e.sent.status){e.next=7;break}return e.abrupt("return",!1);case 7:return e.abrupt("return",!0);case 10:return e.prev=10,e.t0=e.catch(0),e.abrupt("return",!1);case 13:case"end":return e.stop()}}),e,null,[[0,10]])})))).apply(this,arguments)}function St(){var e=Object(h.useDispatch)(),t=function(t){(function(){return jt.apply(this,arguments)})().then((function(a){a?(Ot(t,e),s(t)):(localStorage.removeItem("tokens"),s(void 0))}))},a=Object(h.useState)({loading:!0}),n=Object(u.a)(a,2),r=n[0],s=n[1];Object(h.useEffect)((function(){var e=JSON.parse(localStorage.getItem("tokens"));t(e)}),[]);return d.a.createElement(j.Provider,{value:{authTokens:r,setAuthTokens:function(t){localStorage.setItem("tokens",JSON.stringify(t)),s(t),Ot(t,e)},deleteAuthTokens:function(){localStorage.removeItem("tokens"),s(void 0),e.deleteUserSelf(),e.resetGlobal(),ae()}}},d.a.createElement(m.a,null,d.a.createElement(p.d,null,d.a.createElement(U,{path:"/chat",component:Nt}),d.a.createElement(p.b,{exact:!0,path:"/login",component:T}),d.a.createElement(p.b,{exact:!0,path:"/register",component:M}),d.a.createElement(p.b,{path:"/about"},d.a.createElement("h1",null,"about")),d.a.createElement(U,{exact:!0,path:"/",component:Nt}),d.a.createElement(p.b,{path:"*"},d.a.createElement(Tt,null)))))}function Tt(){var e=Object(p.g)();return d.a.createElement("div",null,d.a.createElement("h3",null,"No match for ",d.a.createElement("code",null,e.pathname)))}!function(){var e=this;function t(e,t){return e.chats.findIndex((function(e){return e.id===t.id&&e.type===t.type}))}Object(h.setGlobal)({userSelf:{},infoHeaderCenter:fe,ihcData:null,currentChat:{type:"",id:0,newMessages:0,messages:[]},tempChat:null,chats:[],newMessages:0}),function(){function e(e){Object(h.setGlobal)({chats:e})}ne.finishedLoading?e(ne.getChatArraySortedByDate()):ne.event.on("chats loaded",e)}(),Object(h.addReducer)("setUserSelf",(function(e,t,a,n){return{userSelf:{uid:a,username:n}}})),Object(h.addReducer)("deleteUserSelf",(function(e,t){return{userSelf:{}}})),Object(h.addReducer)("resetGlobal",(function(e,t){return{infoHeaderCenter:fe,ihcData:null,currentChat:{type:"",id:0,newMessages:0,messages:[]},tempChat:null,chats:[],newMessages:0}})),Object(h.addReducer)("newMsg",(function(e,a,n,r,s){var i=t(e,n);if(-1!==i){if(function(e,t){var a=e.currentChat;return a.type===t.type&&a.id===t.id}(e,n)){var c=e.chats.splice(0),o=c[i];return o.latestMessage=n.getLatestMessageObject(),o.unreadMessages=0,c.splice(i,1),c.unshift(o),{chats:c,currentChat:Object(Te.a)({},e.currentChat,{messages:e.currentChat.messages.concat(s),newMessages:e.currentChat.newMessages+1})}}var u=e.chats.splice(0),l=u[i];l.latestMessage=n.getLatestMessageObject();var h=e.newMessages;return 0===l.unreadMessages&&h++,l.unreadMessages=r+1,u.splice(i,1),u.unshift(l),{chats:u,newMessages:h}}})),Object(h.addReducer)("selectChat",(function(e,a,n){var r=t(e,n);if(-1!==r){var s=e.chats.splice(0),i=s[r],c=e.newMessages;return i.unreadMessages>0&&c--,i.unreadMessages=0,s[r]=i,ne.socket.emit("change chat",{type:n.type,id:n.id}),{currentChat:{type:n.type,id:n.id,messages:n.getMessages(),newMessages:0},chats:s,tempChat:null,newMessages:c}}})),Object(h.addReducer)("selectNoChat",(function(e,t){return ne.socket.emit("change chat",null),{currentChat:{type:"",id:0,messages:[]}}})),Object(h.addReducer)("addLoadedMessages",(function(e,t,a){return{currentChat:Object(Te.a)({},e.currentChat,{messages:a?a.concat(e.currentChat.messages):e.currentChat.messages})}})),Object(h.addReducer)("addChat",(function(e,t,a){for(var n,r,s=e.chats.splice(0),i=a.getChatObject(),c=0;c<s.length;c++)if(n=s[c],r=i,!n.latestMessage||r.latestMessage&&n.latestMessage.date.getTime()<r.latestMessage.date.getTime()){s.splice(c,0,i);break}return{chats:s}})),Object(h.addReducer)("removeChat",(function(a,n,r){var s=t(a,r),i=e.state.chats.splice(0);return i.splice(s,1),{chats:i}})),Object(h.addReducer)("showTempChat",(function(e,t){var a=ne.temporaryChat.chatNow;return ne.socket.emit("change chat",null),{tempChat:a.getChatObject(),currentChat:{type:"tempChat",id:0,messages:[]}}})),Object(h.addReducer)("updateTempChat",(function(e,t,a){return{tempChat:a.getChatObject(),currentChat:{type:"tempChat",id:0,messages:[]}}})),Object(h.addReducer)("hideTempChat",(function(e,t){return{tempChat:null}}))}();Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(St,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))},93:function(e,t,a){e.exports=a(169)}},[[93,1,2]]]);
//# sourceMappingURL=main.db446a27.chunk.js.map