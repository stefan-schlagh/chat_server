(this.webpackJsonpchat_client=this.webpackJsonpchat_client||[]).push([[0],{129:function(e,t,n){},134:function(e,t,n){},135:function(e,t,n){},136:function(e,t,n){},138:function(e,t,n){},139:function(e,t,n){},170:function(e,t,n){},171:function(e,t,n){},172:function(e,t,n){},175:function(e,t,n){},176:function(e,t,n){},177:function(e,t,n){},178:function(e,t,n){},179:function(e,t,n){},181:function(e,t,n){},182:function(e,t,n){},183:function(e,t,n){},184:function(e,t,n){},185:function(e,t,n){},186:function(e,t,n){},187:function(e,t,n){},188:function(e,t,n){},189:function(e,t,n){},190:function(e,t,n){},191:function(e,t,n){},192:function(e,t,n){},193:function(e,t,n){},195:function(e,t,n){},196:function(e,t,n){"use strict";n.r(t);var s=n(1),r=n.n(s),a=n(20),c=n.n(a),i=n(9),o=n(10),u=n(15),l=n(2),h=n.n(l),d=n(6),p=n(29),f=n(4),j=n(5),b=n(7),m=n(8),g=n(32),O=n.n(g),v=n(0),x=function(e){Object(b.a)(n,e);var t=Object(m.a)(n);function n(){return Object(f.a)(this,n),t.apply(this,arguments)}return Object(j.a)(n,[{key:"render",value:function(){return Object(v.jsx)("small",{className:"alert alert-danger p-1 message d-block",children:this.props.children})}}]),n}(s.Component),y=function(e){Object(b.a)(n,e);var t=Object(m.a)(n);function n(){return Object(f.a)(this,n),t.apply(this,arguments)}return Object(j.a)(n,[{key:"render",value:function(){return Object(v.jsx)("small",{className:"alert alert-success p-1 message d-block",children:this.props.children})}}]),n}(s.Component),k=n(12),w=(n(129),function(e){Object(b.a)(n,e);var t=Object(m.a)(n);function n(e){var s;return Object(f.a)(this,n),(s=t.call(this,e)).state={showPassword:!1},s}return Object(j.a)(n,[{key:"render",value:function(){var e=this;return Object(v.jsxs)("div",{className:"psw-group",children:[Object(v.jsx)("i",{className:(this.state.showPassword?"fa-eye-slash":"fa-eye")+" fas psw-toggle-icon",onClick:function(){return e.setState((function(e){return{showPassword:!e.showPassword}}))}}),Object(v.jsx)("input",Object(k.a)({type:this.state.showPassword?"text":"password"},this.props))]})}}]),n}(s.Component)),C=function(){var e=Object(d.a)(h.a.mark((function e(t,n){var s;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s={method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({username:t,password:n})},e.next=3,fetch("/auth/login",s);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),S=function(){var e=Object(d.a)(h.a.mark((function e(t,n,s){var r,a;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=""===s?{username:t,password:n}:{username:t,password:n,email:s},a={method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(r)},e.next=4,fetch("/auth/register",a);case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}}),e)})));return function(t,n,s){return e.apply(this,arguments)}}(),N=function(){var e=Object(d.a)(h.a.mark((function e(t){var n;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={method:"GET",headers:{Accept:"application/json"}},e.next=3,fetch("/user/verifyEmail/"+t,n);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),M=function(){var e=Object(d.a)(h.a.mark((function e(t,n){var s;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s={method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({username:t,email:n})},e.next=3,fetch("/pwReset/requestLink",s);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),T=function(){var e=Object(d.a)(h.a.mark((function e(t){var n;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={method:"GET",headers:{Accept:"application/json"}},e.next=3,fetch("/pwReset/isValid/"+t,n);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),E=function(){var e=Object(d.a)(h.a.mark((function e(t,n){var s;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s={method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({code:t,password:n})},e.next=3,fetch("/pwReset/set",s);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),U=function(e){Object(b.a)(n,e);var t=Object(m.a)(n);function n(e){var s;return Object(f.a)(this,n),(s=t.call(this,e)).changeHandler=function(e){var t=e.target.name,n=e.target.value;s.setState(Object(p.a)({},t,n))},s.submitHandler=function(e){e.preventDefault();var t,n={username:{presence:!0,length:{minimum:3,tooShort:"Benutzername zu kurz",maximum:30,tooLong:"Benutzername zu lang"},format:{pattern:new RegExp(/^\w[\w ]*$$/),message:"ung\xfcltiges Format"}},password:{presence:!0,length:{minimum:8,tooShort:"Passwort muss mindestens 8 Zeichen lang sein",maximum:50,tooLong:"Passwort darf h\xf6chstens 50 Zeichen lang sein"}}},r=O()({username:s.state.username,password:s.state.password},n);"undefined"!=typeof r?("undefined"!=typeof r.username?t=r.username[0]:"undefined"!=typeof r.password&&(t=r.password[0]),t=t.replace("Username ","").replace("Password ",""),s.setState({error:!0,errorMessage:t})):(s.setState({valid:!0,uNameErr:"",pwErr:""}),C(s.state.username,s.state.password).then(function(){var e=Object(d.a)(h.a.mark((function e(t){var n;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(200!==t.status){e.next=11;break}return e.next=3,t.json();case 3:return n=e.sent,e.next=6,s.dispatch.setUserSelf(n.uid,s.state.username);case 6:return e.next=8,s.dispatch.setAuthTokens(n.tokens);case 8:s.props.history.push("/chat"),e.next=12;break;case 11:403===t.status?s.setState({error:!0,errorMessage:"Falsches Passwort!"}):404===t.status?s.setState({error:!0,errorMessage:"Falscher Benutzername E-Mail Addresse"}):s.setState({error:!0,errorMessage:"ein Fehler ist aufgetreten"});case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).catch((function(e){s.setState({error:!0,errorMessage:"ein Fehler ist aufgetreten"})})))},s.errorMessage=function(){if(s.state.error)return Object(v.jsx)(x,{children:s.state.errorMessage})},s.state={error:!1,errorMessage:"",username:"",password:"",redirect:!1},s}return Object(j.a)(n,[{key:"render",value:function(){return Object(v.jsx)("div",{className:"h-100",style:{display:"flex",overflowY:"auto"},children:Object(v.jsx)("div",{className:"col-sm-12 my-auto",children:Object(v.jsxs)("div",{className:"container border rounded p-3",style:{maxWidth:"800px"},children:[Object(v.jsx)("h1",{children:"Login"}),this.errorMessage(),Object(v.jsxs)("form",{onSubmit:this.submitHandler,children:[Object(v.jsxs)("div",{className:"form-group",children:[Object(v.jsx)("label",{htmlFor:"username",children:"Benutzername:"}),Object(v.jsx)("input",{type:"text",name:"username",className:"form-control",placeholder:"Benutzernamen eingeben",onChange:this.changeHandler})]}),Object(v.jsxs)("div",{className:"form-group",children:[Object(v.jsx)("label",{htmlFor:"password",children:"Passwort:"}),Object(v.jsx)(w,{name:"password",className:"form-control",placeholder:"Passwort eingeben",onChange:this.changeHandler})]}),Object(v.jsxs)("div",{className:"form-group",children:["haben Sie noch keinen Account? ",Object(v.jsx)(o.b,{to:"/register",children:"Jetzt registrieren"})]}),Object(v.jsxs)("div",{className:"form-group",children:["Passwort vergessen? ",Object(v.jsx)(o.b,{to:"/forgotPassword",children:"Jetzt zur\xfccksetzen"})]}),Object(v.jsx)("input",{type:"submit",className:"btn btn-primary",value:"Login"})]})]})})})}}]),n}(i.Component),D=Object(u.j)(U);n(134);function B(){return Object(v.jsx)("h5",{className:"back-to-login",children:Object(v.jsxs)(o.b,{to:"/login",children:[Object(v.jsx)("i",{className:"fas fa-arrow-left"}),"\xa0 zur\xfcck zu login"]})})}var I=function(e){Object(b.a)(n,e);var t=Object(m.a)(n);function n(){return Object(f.a)(this,n),t.apply(this,arguments)}return Object(j.a)(n,[{key:"componentDidMount",value:function(){"function"===typeof this.props.didMount&&this.props.didMount()}},{key:"componentDidUpdate",value:function(e,t,n){"function"===typeof this.props.didUpdate&&this.props.didUpdate()}},{key:"render",value:function(){return this.props.children?this.props.children:null}}]),n}(s.Component),_=function(e){Object(b.a)(n,e);var t=Object(m.a)(n);function n(e){var s;return Object(f.a)(this,n),(s=t.call(this,e)).changeHandler=function(e){var t=e.target.name,n=e.target.value;s.setState(Object(p.a)({},t,n))},s.submitHandler=function(e){e.preventDefault();var t,n={username:{presence:!0,length:{minimum:3,tooShort:"Benutzername zu kurz",maximum:30,tooLong:"Benutzername zu lang"},format:{pattern:new RegExp(/^\w[\w ]*$$/),message:"ung\xfcltiges Format"}},password:{presence:!0,length:{minimum:8,tooShort:"Passwort muss mindestens 8 Zeichen lang sein",maximum:50,tooLong:"Passwort darf h\xf6chstens 50 Zeichen lang sein"}},passwordRepeat:{presence:!0,equality:"password",length:{minimum:8,tooShort:"Passwort muss mindestens 8 Zeichen lang sein",maximum:50,tooLong:"Passwort darf h\xf6chstens 50 Zeichen lang sein"}}},r=O()({username:s.state.username,password:s.state.password,passwordRepeat:s.state.passwordRepeat},n);"undefined"!=typeof r?("undefined"!=typeof r.username?t=r.username[0]:"undefined"!=typeof r.password?t=r.password[0]:"undefined"!=typeof r.passwordRepeat&&(t="Passw\xf6rter stimmen nicht \xfcberein!"),t=t.replace("Username ","").replace("Password ",""),s.setState({error:!0,errorMessage:t})):(s.setState({error:!1,errorMessage:""}),S(s.state.username,s.state.password,s.state.email).then(function(){var e=Object(d.a)(h.a.mark((function e(t){var n;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(200!==t.status){e.next=15;break}return e.next=3,t.json();case 3:if(!(n=e.sent).usernameTaken){e.next=8;break}s.setState({error:!0,errorMessage:"Benutzername bereits vergeben"}),e.next=13;break;case 8:return e.next=10,s.dispatch.setUserSelf(n.uid,s.state.username);case 10:return e.next=12,s.dispatch.setAuthTokens(n.tokens);case 12:s.setState({accountCreated:!0,emailSet:""!==s.state.email});case 13:e.next=16;break;case 15:s.setState({error:!0,errorMessage:"ein Fehler ist aufgetreten"});case 16:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).catch((function(e){s.setState({error:!0,errorMessage:"ein Fehler ist aufgetreten"})})))},s.goToChatHome=function(){s.props.history.push("/chat")},s.errorMessage=function(){if(s.state.error)return Object(v.jsx)(x,{children:s.state.errorMessage})},s.state={error:!1,errorMessage:"",username:"",email:"",password:"",passwordRepeat:"",redirect:!1,emailSet:!1,accountCreated:!1},s}return Object(j.a)(n,[{key:"render",value:function(){return Object(v.jsx)("div",{className:"h-100",style:{display:"flex",overflowY:"auto"},children:Object(v.jsx)("div",{className:"col-sm-12 my-auto",children:Object(v.jsxs)("div",{className:"container border rounded p-3",style:{maxWidth:"800px"},children:[Object(v.jsx)(B,{}),this.state.accountCreated?Object(v.jsxs)(I,{children:[Object(v.jsxs)(y,{children:["Benutzer ",this.state.username," wurde erfolgreich angelegt",this.state.emailSet?Object(v.jsxs)(I,{children:[Object(v.jsx)("br",{}),"E-Mail mit Verifizierungslink wurde versendet!"]}):null]}),Object(v.jsx)("button",{className:"btn btn-primary",onClick:this.goToChatHome,children:"weiter"})]}):Object(v.jsxs)(I,{children:[Object(v.jsx)("h1",{children:"Registrieren"}),this.errorMessage(),Object(v.jsxs)("form",{onSubmit:this.submitHandler,children:[Object(v.jsxs)("div",{className:"form-group",children:[Object(v.jsx)("label",{htmlFor:"username",children:"Benutzername: *"}),Object(v.jsx)("input",{type:"text",name:"username",className:"form-control",placeholder:"Benutzernamen eingeben",onChange:this.changeHandler})]}),Object(v.jsxs)("div",{className:"form-group",children:[Object(v.jsx)("label",{htmlFor:"email",children:"E-Mail Addresse: (nicht verpflichtend)"}),Object(v.jsx)("input",{type:"email",name:"email",className:"form-control",placeholder:"E-Mail Addresse eingeben",onChange:this.changeHandler})]}),Object(v.jsxs)("div",{className:"form-group",children:[Object(v.jsx)("label",{htmlFor:"password",children:"Passwort: *"}),Object(v.jsx)(w,{name:"password",className:"form-control",placeholder:"Passwort eingeben",onChange:this.changeHandler})]}),Object(v.jsxs)("div",{className:"form-group",children:[Object(v.jsx)("label",{htmlFor:"passwordRepeat",children:"Passwort wiederholen: *"}),Object(v.jsx)(w,{name:"passwordRepeat",className:"form-control",placeholder:"Passwort eingeben",onChange:this.changeHandler})]}),Object(v.jsx)("input",{type:"submit",className:"btn btn-primary",value:"Registrieren"})]})]})]})})})}}]),n}(i.Component),A=Object(u.j)(_),R=(n(135),function(e){Object(b.a)(n,e);var t=Object(m.a)(n);function n(e){var s;return Object(f.a)(this,n),(s=t.call(this,e)).componentDidMount=function(){N(s.props.verificationCode).then((function(e){s.setState({loading:!1,success:200===e.status})})).catch((function(e){s.setState({loading:!1,error:!0})}))},s.state={loading:!0,error:!1,success:!1},s}return Object(j.a)(n,[{key:"render",value:function(){return this.state.loading?null:this.state.error?Object(v.jsx)("div",{className:"h-100 verifyEmail error",children:Object(v.jsx)("h3",{children:"Fehler!"})}):this.state.success?Object(v.jsx)("div",{className:"h-100 verifyEmail",children:Object(v.jsx)("h3",{children:"E-Mail Addresse erfolgreich verifiziert!"})}):Object(v.jsx)("div",{className:"h-100 verifyEmail",children:Object(v.jsx)("h3",{children:"Ung\xfcltiger Verifizierungscode!"})})}}]),n}(i.Component)),P=function(e){Object(b.a)(n,e);var t=Object(m.a)(n);function n(e){var s;return Object(f.a)(this,n),(s=t.call(this,e)).changeHandler=function(e){var t=e.target.name,n=e.target.value;s.setState(Object(p.a)({},t,n))},s.submitHandler=function(e){e.preventDefault();var t={username:{presence:!0,length:{minimum:3,tooShort:"Benutzername zu kurz",maximum:30,tooLong:"Benutzername zu lang"},format:{pattern:new RegExp(/^\w[\w ]*$$/),message:"ung\xfcltiges Format"}},email:{presence:!0,length:{minimum:1,tooShort:"E-Mail Addresse ben\xf6tigt"}}},n=O()({username:s.state.username,email:s.state.email},t);if("undefined"!=typeof n){var r;"undefined"!=typeof n.username?r=n.username[0]:"undefined"!=typeof n.email&&(r=n.email[0]),r=r.replace("Username ","").replace("Email ",""),s.setState({error:!0,errorMessage:r})}else{var a=s.state,c=a.username,i=a.email;M(c,i).then((function(e){200===e.status?s.setState({error:!1,sentMail:!0}):404===e.status?s.setState({error:!0,errorMessage:"Dieser Benutzer scheint nicht zu existieren"}):s.setState({error:!0,errorMessage:"ein Fehler ist aufgetreten"})})).catch((function(e){s.setState({error:!0,errorMessage:"ein Fehler ist aufgetreten"})}))}},s.errorMessage=function(){if(s.state.error)return Object(v.jsx)(x,{children:s.state.errorMessage})},s.successMessage=function(){if(s.state.sentMail)return Object(v.jsx)(y,{children:"E-Mail zum zur\xfccksetzen des Passwortes wurde versendet!"})},s.state={error:!1,errorMessage:"",username:"",email:"",sentMail:!1},s}return Object(j.a)(n,[{key:"render",value:function(){return Object(v.jsx)("div",{className:"h-100",style:{display:"flex",overflowY:"auto"},children:Object(v.jsx)("div",{className:"col-sm-12 my-auto",children:Object(v.jsxs)("div",{className:"container border rounded p-3",style:{maxWidth:"800px"},children:[Object(v.jsx)(B,{}),Object(v.jsx)("h1",{children:"Passwort zur\xfccksetzen"}),this.errorMessage(),Object(v.jsxs)("form",{onSubmit:this.submitHandler,children:[Object(v.jsxs)("div",{className:"form-group",children:[Object(v.jsx)("label",{htmlFor:"username",children:"Benutzername:"}),Object(v.jsx)("input",{type:"text",name:"username",className:"form-control",placeholder:"Benutzernamen eingeben",onChange:this.changeHandler})]}),Object(v.jsxs)("div",{className:"form-group",children:[Object(v.jsx)("label",{htmlFor:"email",children:"E-Mail Addresse:"}),Object(v.jsx)("input",{type:"email",name:"email",className:"form-control",placeholder:"E-Mail Addresse eingeben",onChange:this.changeHandler})]}),this.successMessage(),Object(v.jsx)("input",{type:"submit",className:"btn btn-primary",value:"Passwort zur\xfccksetzen"})]})]})})})}}]),n}(i.Component),z=n(58),F=n(108);var G=function(e){var t=e.component,n=Object(F.a)(e,["component"]),s=Object(i.useGlobal)(),r=Object(z.a)(s,2),a=r[0];return r[1],Object(v.jsx)(u.b,Object(k.a)(Object(k.a)({},n),{},{render:function(e){return a.loaded?a.authTokens?Object(v.jsx)(t,Object(k.a)({},e)):Object(v.jsx)(u.a,{to:{pathname:"/login",state:{referer:e.location}}}):null}}))},L=992,V=768,H=991,J=767,W=320,q=425,Y=function(){return{width:window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,height:window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight}},Z=Y(),$={width:Z.width,height:Z.height},K=function(e){Object(b.a)(n,e);var t=Object(m.a)(n);function n(){var e;Object(f.a)(this,n);for(var s=arguments.length,a=new Array(s),c=0;c<s;c++)a[c]=arguments[c];return(e=t.call.apply(t,[this].concat(a))).state=$,e.render=function(){var t=e.props,n=t.children,s=t.displayIn,a=e.state,c=a.width,i=a.height,o=e.shouldRender(s,c,i);return Object(v.jsx)(r.a.Fragment,{children:o?n:null})},e.handleResize=function(){var t=Y(),n=t.width,s=t.height;e.setState({width:n,height:s})},e.shouldRender=function(e,t,n){return-1!==e.indexOf("Laptop")&&t>=L||(-1!==e.indexOf("Tablet")&&t<=H&&t>=V||(-1!==e.indexOf("Mobile")&&t<=J||(-1!==e.indexOf("MobilePortrait")&&t<=J&&n>=q||!!(-1!==e.indexOf("MobileLandScape")&&t<=J&&n<=W))))},e}return Object(j.a)(n,[{key:"componentDidMount",value:function(){window.addEventListener("resize",this.handleResize,!1)}},{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this.handleResize,!1)}}]),n}(r.a.PureComponent),Q=(n(136),0),X=1,ee=2,te=function(e){Object(b.a)(n,e);var t=Object(m.a)(n);function n(){return Object(f.a)(this,n),t.apply(this,arguments)}return Object(j.a)(n,[{key:"render",value:function(){var e=this,t=this.props.location.pathname;return Object(v.jsxs)(I,{children:[Object(v.jsx)(K,{displayIn:["Mobile"],children:Object(v.jsxs)("div",{className:"float-left left",children:[Object(v.jsx)("i",{id:"btnBackToChatList",className:"fas fa-arrow-left fa-2x d-block d-md-none",onClick:function(){e.props.history.goBack()}}),e.global.newMessages>0?Object(v.jsx)("div",{className:"btnBack-number",children:e.global.newMessages}):null]})}),function(){switch(e.global.infoHeaderCenter){case X:return Object(v.jsxs)(se,{children:[Object(v.jsx)("h3",{id:"chat-info-name",children:e.global.ihcData.name}),Object(v.jsx)(o.b,{to:t+"/userInfo/"+e.global.ihcData.uid,children:Object(v.jsx)("i",{className:"fas fa-info-circle fa-2x","data-toggle":"tooltip",title:"chat info"})})]});case ee:return Object(v.jsxs)(se,{children:[Object(v.jsx)("h3",{id:"chat-info-name",children:e.global.ihcData.name}),Object(v.jsx)(o.b,{to:"/chat/groupInfo/"+e.global.ihcData.gcid,children:Object(v.jsx)("i",{className:"fas fa-info-circle fa-2x","data-toggle":"tooltip",title:"chat info"})})]});default:return Object(v.jsx)(K,{displayIn:["Laptop","Tablet"],children:Object(v.jsx)("h3",{className:"pt-2 pl-2",children:"chat"})})}}()]})}}]),n}(i.Component),ne=Object(u.j)(te);function se(e){return Object(v.jsx)("div",{id:"chat-info",className:"center pt-2",children:e.children})}var re=n(106),ae=(n(137),n(138),function(e){Object(b.a)(n,e);var t=Object(m.a)(n);function n(e){var s;return Object(f.a)(this,n),(s=t.call(this,e)).clickCheckBox=function(e){s.state.checkBoxClicked?e.stopPropagation():setTimeout((function(){s.setState((function(e){return{checkBoxClicked:!0}}))}),20)},s.clickDocument=function(e){s.state.checkBoxClicked&&s.changeChecked(e)},s.changeChecked=function(e){s.setState((function(e){return{checkBoxClicked:!e.checkBoxClicked}}))},s.logout=function(){s.dispatch.deleteAuthTokens()},s.state={checkBoxClicked:!1},s}return Object(j.a)(n,[{key:"render",value:function(){var e=this.props.location.pathname;return Object(v.jsxs)("div",{className:"c-header",children:[Object(v.jsx)(ne,{}),Object(v.jsxs)("div",{id:"top-right",className:"right",onClick:this.clickCheckBox,children:[Object(v.jsx)("div",{className:"right-l"}),Object(v.jsx)("input",{type:"checkbox",id:"btnControlTopRight",className:"btnControl",checked:this.state.checkBoxClicked,onChange:this.changeChecked}),Object(v.jsx)("label",{htmlFor:"btnControlTopRight",children:Object(v.jsxs)("div",{className:"right-c",children:[Object(v.jsx)("div",{className:"d-only-when-small",children:Object(v.jsx)("i",{id:"user-info",className:"fas fa-user fa-2x user-icon","data-toggle":"tooltip",title:"Benutzer-Info"})}),Object(v.jsxs)("div",{className:"d-only-when-big top-2right",children:[Object(v.jsx)(o.b,{to:e+"/userInfo/"+this.global.userSelf.uid,children:Object(v.jsx)(ce,{text:"Benutzer-Info",children:Object(v.jsx)("h4",{id:"username",className:"p-2 username",children:this.global.userSelf.username})})}),Object(v.jsxs)("div",{className:"float-right",children:[Object(v.jsx)(o.b,{to:e+"/settings",children:Object(v.jsx)(ce,{text:"Einstellungen",children:Object(v.jsx)("i",{className:"fas fa-user-cog fa-2x"})})}),"\xa0",Object(v.jsx)(ce,{text:"logout",children:Object(v.jsx)("i",{id:"user-logout",className:"fas fa-sign-out-alt fa-2x logout",onClick:this.logout})})]})]})]})})]})]})}},{key:"componentDidMount",value:function(){document.addEventListener("click",this.clickDocument,!1)}},{key:"componentWillUnmount",value:function(){document.removeEventListener("click",this.clickDocument,!1)}}]),n}(i.Component));function ce(e){return Object(v.jsx)(re.a,{placement:"bottom",trigger:["hover"],overlay:Object(v.jsx)("span",{children:e.text}),children:e.children})}var ie=Object(u.j)(ae),oe=(n(139),function(e){Object(b.a)(n,e);var t=Object(m.a)(n);function n(){var e;Object(f.a)(this,n);for(var s=arguments.length,r=new Array(s),a=0;a<s;a++)r[a]=arguments[a];return(e=t.call.apply(t,[this].concat(r))).searchChanged=function(t){e.props.onSearch(t.target.value)},e}return Object(j.a)(n,[{key:"render",value:function(){var e=this.props.location.pathname;return Object(v.jsx)("div",{className:"chatSearchBox",children:Object(v.jsxs)("div",{className:"chat-select-form",children:[Object(v.jsx)("input",{type:"text",name:"chat-search",className:"chat-search",placeholder:"Chat suchen",onChange:this.searchChanged}),Object(v.jsx)(o.b,{to:e+"/newChat",children:Object(v.jsx)("button",{id:"btn-newChat",className:"btn-newChat",children:Object(v.jsx)("i",{className:"fas fa-plus fa-lg"})})})]})})}}]),n}(s.Component)),ue=Object(u.j)(oe),le=n(31),he=n(104),de=n.n(he),pe={names:{aqua:"#00ffff",black:"#000000",blue:"#0000ff",brown:"#a52a2a",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgrey:"#a9a9a9",darkgreen:"#006400",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkviolet:"#9400d3",fuchsia:"#ff00ff",gold:"#ffd700",green:"#008000",indigo:"#4b0082",khaki:"#f0e68c",lightblue:"#add8e6",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightpink:"#ffb6c1",lime:"#00ff00",magenta:"#ff00ff",maroon:"#800000",navy:"#000080",olive:"#808000",orange:"#ffa500",pink:"#ffc0cb",purple:"#800080",violet:"#800080",red:"#ff0000",silver:"#c0c0c0"},random:function(){var e,t=0;for(var n in this.names)Math.random()<1/++t&&(e=n);return e}},fe=pe,je=n(107),be=function(e){Object(b.a)(n,e);var t=Object(m.a)(n);function n(){return Object(f.a)(this,n),t.apply(this,arguments)}return Object(j.a)(n,[{key:"getIndex",value:function(e){for(var t=0,n=this.length-1;t<=n;){var s=Math.floor((t+n)/2);if(this[s].key===e)return s;this[s].key<e?t=s+1:n=s-1}return-1}},{key:"getNearestKey",value:function(e){var t;for(++e;-1===(t=this.getIndex(--e));)if(0===e)return-1;return t}},{key:"get",value:function(e){var t=this.getIndex(e);if(-1!==t)return this[t].value}},{key:"add",value:function(e,t){-1===this.getIndex(e)&&this.splice(this.getNearestKey(e)+1,0,{key:e,value:t})}},{key:"remove",value:function(e){var t=this.getIndex(e);-1!==t&&this.splice(t,1)}}]),n}(Object(je.a)(Array));function me(e,t,n){return ge.apply(this,arguments)}function ge(){return(ge=Object(d.a)(h.a.mark((function e(t,n,s){var r,a,c;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=s||Object(i.getGlobal)().authTokens,a=Object(k.a)(Object(k.a)({},n),{},{method:n.method,headers:Object(k.a)(Object(k.a)({},n.headers),{},{Authorization:r})}),e.next=4,fetch(t,a);case 4:if(401!==(c=e.sent).status){e.next=8;break}throw Object(i.getDispatch)().deleteAuthTokens(),new Error("jwt expired");case 8:return e.abrupt("return",c);case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Oe(){return ve.apply(this,arguments)}function ve(){return(ve=Object(d.a)(h.a.mark((function e(){var t;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={method:"GET",headers:{Accept:"application/json"}},e.next=3,me("/chats",t);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function xe(e){return ye.apply(this,arguments)}function ye(){return(ye=Object(d.a)(h.a.mark((function e(t){var n;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={method:"PUT",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(t)},e.next=3,me("/user/chat",n);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ke(e){return we.apply(this,arguments)}function we(){return(we=Object(d.a)(h.a.mark((function e(t){var n;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={method:"GET",headers:{Accept:"application/json"}},e.next=3,me("/user/"+t,n);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ce(e){return Se.apply(this,arguments)}function Se(){return(Se=Object(d.a)(h.a.mark((function e(t){var n;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(t)},e.next=3,me("/message/load",n);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Ne=0,Me=1,Te=2,Ee=3,Ue=4,De=5,Be=6;function Ie(){return(Ie=Object(d.a)(h.a.mark((function e(t){var n,s,r;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(-1===rt.users.getIndex(t)){e.next=10;break}if(0===rt.users.get(t).normalChat){e.next=5;break}return e.abrupt("return",Ne);case 5:return n=rt.users.get(t),rt.temporaryChat.createNew(t,n.username),e.abrupt("return",Te);case 8:e.next=40;break;case 10:if(!rt.temporaryChat.doesExist(t)){e.next=14;break}return e.abrupt("return",Te);case 14:return e.prev=14,e.next=17,ke(t);case 17:if(!(s=e.sent).ok){e.next=34;break}return e.next=21,s.json();case 21:if(!(r=e.sent).userExists||r.blocked){e.next=27;break}return rt.temporaryChat.createNew(t,r.username),e.abrupt("return",Te);case 27:if(r.userExists){e.next=31;break}return e.abrupt("return",Ee);case 31:return e.abrupt("return",Ue);case 32:e.next=35;break;case 34:return e.abrupt("return",Be);case 35:e.next=40;break;case 37:return e.prev=37,e.t0=e.catch(14),e.abrupt("return",Be);case 40:case"end":return e.stop()}}),e,null,[[14,37]])})))).apply(this,arguments)}var _e=function(){function e(t,n){Object(f.a)(this,e),this._normalChat=0,this._groupChats=new be,this.uid=t,this.username=n,this.color=fe.random()}return Object(j.a)(e,[{key:"addGroupChat",value:function(e){this.groupChats.add(e,e)}},{key:"removeGroupChat",value:function(e){this.groupChats.remove(e)}},{key:"updateChatBlockInfo",value:function(e){if(-1!==rt.chats.normal.getIndex(this.normalChat)){var t=rt.chats.normal.get(this.normalChat);t.blockedByOther=e.blockedByOther,t.blockedBySelf=e.blockedBySelf,Object(i.getDispatch)().updateChat(t).then((function(e){}))}}},{key:"uid",get:function(){return this._uid},set:function(e){this._uid=e}},{key:"username",get:function(){return this._username},set:function(e){this._username=e}},{key:"color",get:function(){return this._color},set:function(e){this._color=e}},{key:"normalChat",get:function(){return this._normalChat},set:function(e){this._normalChat=e}},{key:"groupChats",get:function(){return this._groupChats},set:function(e){this._groupChats=e}}]),e}(),Ae={};function Re(){return Pe.apply(this,arguments)}function Pe(){return(Pe=Object(d.a)(h.a.mark((function e(){var t,n;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={method:"GET",headers:{Accept:"application/json"}},e.next=3,fetch("/data.json",t);case 3:if(!(n=e.sent).ok){e.next=10;break}return e.next=7,n.json();case 7:Ae=e.sent,e.next=11;break;case 10:throw new Error;case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ze(e){var t=function(){var t=Object(d.a)(h.a.mark((function t(){var n,s,r,a;return h.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,me("/message/file/"+e.file.fid+"/"+e.file.fileName,{method:"GET"});case 2:return n=t.sent,t.next=5,n.blob();case 5:s=t.sent,r=window.URL.createObjectURL(s),(a=document.createElement("a")).href=r,a.download=e.file.fileName,document.body.appendChild(a),a.click(),a.remove();case 13:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();return Object(v.jsxs)("div",{className:"file",children:[Object(v.jsx)("i",{className:"far fa-lg fa-file"}),"\xa0",e.file.fileName,"\xa0",Object(v.jsx)("div",{className:"download",onClick:t,children:Object(v.jsx)("i",{className:"fas fa-arrow-down"})})]})}function Fe(e){var t=e.msg;return Object(v.jsxs)("div",{className:(t.bySelf?"self ":"other ")+"msg-container",children:[t.userTop?Object(v.jsx)("div",{className:"w-100",children:Object(v.jsx)("strong",{className:"header",children:Object(v.jsx)(Je,{user:t.userTop})})}):null,Object(v.jsxs)("div",{className:"content",children:[t.content.files.map((function(e,t){return Object(v.jsx)(ze,{file:e},t)})),Object(v.jsx)(Ge,{text:t.content.text})]}),Object(v.jsx)("div",{className:"date-outer",children:Object(v.jsx)("div",{className:"date",children:t.mDateString})})]})}function Ge(e){var t=new RegExp(/(\b(?:https?:\/\/)?(?:(?:[a-z]+\.)+)[^\s,]+\b)/g),n=new RegExp(/(https?:\/\/)/gim);function s(e){return n.test(e)?e:"https://"+e}var r=e.text.split(t);return Object(v.jsx)("p",{children:r.map((function(e){return t.test(e)?Object(v.jsx)("a",{href:s(e),target:"_blank",rel:"noreferrer",children:e}):e}))})}function Le(e){var t=e.msg;return Object(v.jsxs)("div",{className:(t.bySelf?"self ":"other ")+"msg-container",children:[Object(v.jsx)(Ve,{msg:t}),Object(v.jsx)("div",{className:"date-outer",children:Object(v.jsx)("div",{className:"date",children:t.mDateString})})]})}function Ve(e){var t=e.msg;return Object(v.jsx)(I,{children:Ze(t,!0)})}n(170);function He(e){var t=e.msg;switch(t.type){case Ae.messageTypes.normalMessage:return Object(v.jsx)("div",{className:"msg-container-outer",children:Object(v.jsx)(Fe,{msg:t})});case Ae.messageTypes.statusMessage:return Object(v.jsx)("div",{className:"msg-container-outer",children:Object(v.jsx)(Le,{msg:t})});default:return Object(v.jsx)("span",{})}}function Je(e){return Object(v.jsx)("span",{style:{color:fe.names[e.user.color]},children:e.user.username})}var We=0,qe=1,Ye=["den Chat erstellt","zum Chat hinzugef\xfcgt","aus dem Chat entfernt","dem Chat beigetreten","den Chat verlassen","zum Admin bef\xf6rdert","den Admin-Status entfernt","nicht mehr Admin","den Chatnamen ge\xe4ndert","die Chat-Beschreibung ge\xe4ndert","Sichtbarkeit des Chats ge\xe4ndert"];function Ze(e,t){return function(){var t=e.userTop,s=e.content.passiveUsers;switch(e.content.type){case Ae.statusMessageTypes.chatCreated:return n(t,We,s,Ae.statusMessageTypes.chatCreated);case Ae.statusMessageTypes.usersAdded:return n(t,We,s,Ae.statusMessageTypes.usersAdded);case Ae.statusMessageTypes.usersRemoved:return n(t,We,s,Ae.statusMessageTypes.usersRemoved);case Ae.statusMessageTypes.usersJoined:return n(t,qe,[],Ae.statusMessageTypes.usersJoined);case Ae.statusMessageTypes.usersLeft:return n(t,We,[],Ae.statusMessageTypes.usersLeft);case Ae.statusMessageTypes.usersMadeAdmin:return n(t,We,s,Ae.statusMessageTypes.usersMadeAdmin);case Ae.statusMessageTypes.usersRemovedAdmin:return n(t,qe,[],Ae.statusMessageTypes.usersRemovedAdmin);case Ae.statusMessageTypes.userResignedAdmin:return n(t,qe,[],Ae.statusMessageTypes.userResignedAdmin);case Ae.statusMessageTypes.chatNameChanged:return n(t,We,[],Ae.statusMessageTypes.chatNameChanged);case Ae.statusMessageTypes.descriptionChanged:return n(t,We,[],Ae.statusMessageTypes.descriptionChanged);case Ae.statusMessageTypes.isPublicChanged:return n(t,We,[],Ae.statusMessageTypes.isPublicChanged)}}();function n(n,s,r,a){function c(){switch(s){case We:return e.bySelf?" hast ":" hat ";case qe:return e.bySelf?" bist ":" ist "}}function i(){if(r.length<1)return"";if(1===r.length){if(o())return"dich ";var e=rt.users.get(r[0]);return e?t?Object(v.jsx)(Je,{user:e}):e.username:"1 Benutzer"}return 2===r.length&&o()?"dich und einen weiteren Benutzer":o()?"dich und "+(r.length-1)+" weitere Benutzer ":r.length+" Benutzer"}function o(){var e,t=Object(le.a)(r);try{for(t.s();!(e=t.n()).done;){if(e.value===rt.userSelf.uid)return!0}}catch(n){t.e(n)}finally{t.f()}return!1}function u(){return" "+Ye[a]}return t?Object(v.jsxs)("span",{children:[Object(v.jsx)(Je,{user:e.userTop}),c(),i(),u()]}):e.userTop.username+c()+i()+u()}}var $e=function(){function e(t,n,s){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new Date(Date.now()),a=arguments.length>4?arguments[4]:void 0,c=arguments.length>5?arguments[5]:void 0;Object(f.a)(this,e),this.mid=t,this.uid=n,this.date=r,this.chat=s,this.type=a,this.content=c}return Object(j.a)(e,[{key:"getMessageObject",value:function(e){var t={mDateString:this.getMessageViewDateString(),dateString:this.getDateString(),date:this.date,bySelf:this.uid===rt.userSelf.uid,type:this.type,content:this.content};return e&&(t.userTop=this.getUserTop()),t}},{key:"getUserTop",value:function(){if(this.isBySelf())return{uid:this.uid,username:"Du",color:rt.userSelf.color};var e=rt.users.get(this.uid);return{uid:this.uid,username:e.username,color:e.color}}},{key:"isBySelf",value:function(){return this.uid===rt.userSelf.uid}},{key:"getChatViewDateString",value:function(){return this.isDateToday()?"heute "+this.getTimeString():this.isDateYesterday()?"gestern":this.getDateString()}},{key:"getChatViewMsgString",value:function(){switch(this.type){case Ae.messageTypes.normalMessage:var e=this.content.text;return e.length>18&&(e=e.substr(0,18)+"..."),this.uid===rt.userSelf.uid?"Du: ".concat(e):"normalchat"===this.chat.type?this.content.text:"".concat(rt.users.get(this.uid).username,": ").concat(e);case Ae.messageTypes.statusMessage:return Ze(this.getMessageObject(!0),!1)}}},{key:"getMessageViewDateString",value:function(){return this.isDateToday()?this.getTimeString():this.isDateYesterday()?"gestern "+this.getTimeString():this.getDateString()+" "+this.getTimeString()}},{key:"isDateToday",value:function(){var e=new Date(Date.now());return this.date.getDate()===e.getDate()&&this.date.getMonth()===e.getMonth()&&this.date.getFullYear()===e.getFullYear()}},{key:"isDateYesterday",value:function(){var e=new Date(Date.now());return this.date.getDate()===e.getDate()-1&&this.date.getMonth()===e.getMonth()&&this.date.getFullYear()===e.getFullYear()}},{key:"getDateString",value:function(){var e,t=this.date.getDate();e=t<10?"0"+t:t;var n,s=this.date.getMonth();n=s+1<10?"0"+(s+1):s+1;var r=this.date.getFullYear();return"".concat(e,".").concat(n,".").concat(r)}},{key:"getTimeString",value:function(){var e,t=this.date.getHours();e=t<10?"0"+t:t;var n,s=this.date.getMinutes();return n=s<10?"0"+s:s,"".concat(e,":").concat(n)}},{key:"isDifferentDay",value:function(e){return this.date.getDate()!==e.getDate()||this.date.getMonth()!==e.getMonth()||this.date.getFullYear()!==e.getFullYear()}},{key:"mid",get:function(){return this._mid},set:function(e){this._mid=e}},{key:"uid",get:function(){return this._uid},set:function(e){this._uid=e}},{key:"date",get:function(){return this._date},set:function(e){this._date=e}},{key:"chat",get:function(){return this._chat},set:function(e){this._chat=e}},{key:"type",get:function(){return this._type},set:function(e){this._type=e}},{key:"content",get:function(){return this._content},set:function(e){this._content=e}}]),e}(),Ke=function(){function e(){Object(f.a)(this,e),this.events=new Map}return Object(j.a)(e,[{key:"on",value:function(e,t){this.events.has(e)?this.events.get(e).push(t):this.events.set(e,[t])}},{key:"rm",value:function(e,t){if(this.events.has(e))for(var n=this.events.get(e),s=0;s<n.length;s++)n[s]===t&&n.splice(s,1)}},{key:"trigger",value:function(e){if(this.events.has(e)){for(var t=this.events.get(e),n=arguments.length,s=new Array(n>1?n-1:0),r=1;r<n;r++)s[r-1]=arguments[r];for(var a=0;a<t.length;a++)t[a].apply(t,s)}}},{key:"events",get:function(){return this._events},set:function(e){this._events=e}}]),e}(),Qe=function(){function e(t,n,s){var r=this;Object(f.a)(this,e),this._messages=new be,this._event=new Ke,this._unreadMessages=0,this._reachedTopMessages=!1,this.isBlockedBySelf=function(){return"normalChat"===r.type&&r.blockedBySelf},this.isBlockedByOther=function(){return"normalChat"===r.type&&r.blockedByOther},this.type=t,this.id=n,this.chatName=s}return Object(j.a)(e,[{key:"initFirstMessage",value:function(e){void 0===e.canBeShown&&(e.canBeShown=!0),!e.empty&&e.canBeShown?this.messages.add(e.mid,new $e(e.mid,e.uid,this,new Date(e.date),e.type,e.content)):e.date&&(this.latestMsgDate=new Date(e.date))}},{key:"reloadMessages",value:function(){var e=Object(d.a)(h.a.mark((function e(){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.messages=new be,this.reachedTopMessages=!1,e.next=4,this.loadMessages(10);case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"loadMessages",value:function(){var e=Object(d.a)(h.a.mark((function e(t){var n,s,r,a,c,i,o,u,l,d=this;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.reachedTopMessages){e.next=16;break}return n=function(){var e=d.getLastMessage();return null!==e?e.mid:-1},e.next=4,Ce({chatType:this.type,chatId:this.id,lastMsgId:n(),num:t});case 4:if(!(s=e.sent).ok){e.next=15;break}return e.next=8,s.json();case 8:for(r=e.sent,this.reachedTopMessages="reached top"===r.status,a=r.messages,c=new Array(a.length),i=this.showUserInfoMessage(),o=a.length-1;o>=0;o--)u=a[o],l=new $e(u.mid,u.uid,this,new Date(u.date),u.type,u.content),this.messages.add(u.mid,l),c[o]=l.getMessageObject(i);return e.abrupt("return",c);case 15:throw new Error;case 16:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getLastMessage",value:function(){return 0!==this.messages.length?this.messages[0].value:null}},{key:"getFirstMessage",value:function(){return 0!==this.messages.length?this.messages[this.messages.length-1].value:null}},{key:"getMessages",value:function(){for(var e=this.showUserInfoMessage(),t=new Array(this.messages.length),n=0;n<this.messages.length;n++){var s=this.messages[n].value;t[n]=s.getMessageObject(e)}return t}},{key:"addMessage",value:function(e,t,n,s){var r=new $e(t,e,this,new Date(Date.now()),n,s);this.messages.add(t,r),Object(i.getDispatch)().newMsg(this,this.unreadMessages,r.getMessageObject(this.showUserInfoMessage()))}},{key:"showUserInfoMessage",value:function(){return"groupChat"===this.type}},{key:"getChatObject",value:function(){return{type:this.type,id:this.id,chatName:this.chatName,latestMessage:this.getLatestMessageObject(),unreadMessages:this.unreadMessages,isStillMember:"groupChat"!==this.type||this.isStillMember,blockedBySelf:this.isBlockedBySelf(),blockedByOther:this.isBlockedByOther()}}},{key:"getLatestMessageObject",value:function(){var e=this.getFirstMessage();return e?{msgString:e.getChatViewMsgString(),dateString:e.getChatViewDateString(),date:e.date}:this.latestMsgDate?{msgString:"",dateString:"",date:this.latestMsgDate}:null}},{key:"updateChat",value:function(){var e=Object(d.a)(h.a.mark((function e(t,n){var s,r;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(s=rt.isCurrentChat(t.type,t.id))){e.next=4;break}return e.next=4,Object(i.getDispatch)().selectNoChat();case 4:return this.isStillMember=n,e.next=7,this.reloadMessages();case 7:if(!s){e.next=10;break}return e.next=10,Object(i.getDispatch)().selectChat(this);case 10:return r=this.getFirstMessage(),e.next=13,Object(i.getDispatch)().updateChat(this);case 13:return e.next=15,Object(i.getDispatch)().newMsg(this,1,r.getMessageObject(!0));case 15:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"type",get:function(){return this._type},set:function(e){this._type=e}},{key:"id",get:function(){return this._id},set:function(e){this._id=e}},{key:"messages",get:function(){return this._messages},set:function(e){this._messages=e}},{key:"chatName",get:function(){return this._chatName},set:function(e){this._chatName=e}},{key:"event",get:function(){return this._event},set:function(e){this._event=e}},{key:"unreadMessages",get:function(){return this._unreadMessages},set:function(e){this._unreadMessages=e}},{key:"reachedTopMessages",get:function(){return this._reachedTopMessages},set:function(e){this._reachedTopMessages=e}},{key:"latestMsgDate",get:function(){return this._latestMsgDate},set:function(e){this._latestMsgDate=e}}]),e}(),Xe=function(e){Object(b.a)(n,e);var t=Object(m.a)(n);function n(e,s,r){var a,c=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=arguments.length>4?arguments[4]:void 0,o=arguments.length>5?arguments[5]:void 0;return Object(f.a)(this,n),(a=t.call(this,"normalChat",e,s))._isTyping=!1,a.otherUser=r,a.unreadMessages=c,a.blockedBySelf=i,a.blockedByOther=o,a}return Object(j.a)(n,[{key:"getUsersTyping",value:function(){if(this.isTyping){var e=rt.users.get(this.otherUser);return[{uid:e.uid,username:e.username}]}return[]}},{key:"getLatestUserTyping",value:function(){if(this.isTyping){var e=rt.users.get(this.otherUser);return{uid:e.uid,username:e.username}}return null}},{key:"startedTyping",value:function(e){e===this.otherUser&&(this.isTyping=!0,this.event.trigger("typeState changed"))}},{key:"stoppedTyping",value:function(e){e===this.otherUser&&(this.isTyping=!1,this.event.trigger("typeState changed"))}},{key:"otherUser",get:function(){return this._otherUser},set:function(e){this._otherUser=e}},{key:"isTyping",get:function(){return this._isTyping},set:function(e){this._isTyping=e}},{key:"blockedBySelf",get:function(){return this._blockedBySelf},set:function(e){this._blockedBySelf=e}},{key:"blockedByOther",get:function(){return this._blockedByOther},set:function(e){this._blockedByOther=e}}]),n}(Qe),et=function(e){Object(b.a)(n,e);var t=Object(m.a)(n);function n(e,s,r){var a,c=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=arguments.length>4?arguments[4]:void 0;return Object(f.a)(this,n),(a=t.call(this,"groupChat",e,s))._users=[],a._usersTyping=[],a.users=r,a.unreadMessages=c,a.isStillMember=i,a}return Object(j.a)(n,[{key:"getUsersTyping",value:function(){if(this.usersTyping.length>0){for(var e=[],t=0;t<this.usersTyping.length;t++){var n=rt.users.get(this.usersTyping[t]);e.push({uid:n.uid,username:n.username})}return e}return[]}},{key:"getLatestUserTyping",value:function(){if(this.usersTyping.length>0){var e=rt.users.get(this.usersTyping[this.usersTyping.length-1]);return{uid:e.uid,username:e.username}}return null}},{key:"startedTyping",value:function(e){this.isMember(e)&&(this.isTyping(e)||(this.usersTyping.push(e),this.event.trigger("typeState changed")))}},{key:"stoppedTyping",value:function(e){this.isMember(e)&&this.isTyping(e)&&(this.usersTyping.splice(this.getIndexOfTyping(e),1),this.event.trigger("typeState changed"))}},{key:"isMember",value:function(e){return e!==rt.userSelf.uid&&this.users.find((function(t){return t===e}))}},{key:"isTyping",value:function(e){return this.usersTyping.find((function(t){return t===e}))}},{key:"getIndexOfTyping",value:function(e){return this.usersTyping.findIndex((function(t){return t===e}))}},{key:"users",get:function(){return this._users},set:function(e){this._users=e}},{key:"usersTyping",get:function(){return this._usersTyping},set:function(e){this._usersTyping=e}},{key:"isStillMember",get:function(){return this._isStillMember},set:function(e){this._isStillMember=e}}]),n}(Qe),tt=function(){function e(){Object(f.a)(this,e),this._isShown=!1}return Object(j.a)(e,[{key:"createNew",value:function(e,t){this.chatNow=new Xe(0,t,e)}},{key:"doesExist",value:function(e){return void 0!==this.chatNow&&this.chatNow.otherUser===e}},{key:"show",value:function(){this.isShown=!0,Object(i.getDispatch)().showTempChat(this.chatNow)}},{key:"update",value:function(){Object(i.getDispatch)().updateTempChat(this.chatNow)}},{key:"hide",value:function(){this.isShown=!1,Object(i.getDispatch)().hideTempChat()}},{key:"createNewNormalChat",value:function(){var e=Object(d.a)(h.a.mark((function e(t,n){var s,r,a,c,o,u,l;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=this.chatNow.otherUser,r=this.chatNow.chatName,e.next=4,xe({uid:s,username:r,message:{type:Ae.messageTypes.normalMessage,content:n}});case 4:if(!(a=e.sent).ok){e.next=22;break}return e.next=8,a.json();case 8:return c=e.sent,-1===rt.users.getIndex(s)&&rt.users.add(s,new _e(s,r)),o=rt.users.get(s),u=new Xe(c.ncid,r,s),o.normalChat=u.id,rt.chats.normal.add(c.ncid,u),l=new $e(c.mid,rt.userSelf.uid,u,new Date(Date.now()),Ae.messageTypes.normalMessage,t),u.messages.add(l.mid,l),e.next=18,Object(i.getDispatch)().addChat(u);case 18:return e.next=20,Object(i.getDispatch)().selectChat(u);case 20:return this.hide(),e.abrupt("return",!0);case 22:return e.abrupt("return",!1);case 23:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"isShown",get:function(){return this._isShown},set:function(e){this._isShown=e}},{key:"chatNow",get:function(){return this._chatNow},set:function(e){this._chatNow=e}}]),e}(),nt=function(){function e(){Object(f.a)(this,e),this._userSelf={uid:0,username:""},this._users=new be,this._chats={normal:new be,group:new be},this._event=new Ke,this._finishedLoading=!1,this._temporaryChat=new tt,this._initCalled=!1}return Object(j.a)(e,[{key:"destruct",value:function(){this.socket&&(this.socket.removeAllListeners(),this.socket.disconnect()),this.initCalled=!1}},{key:"init",value:function(){var e=Object(d.a)(h.a.mark((function e(){var t,n,s,r=this;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=Object(i.getGlobal)().userSelf,n=t.uid,s=t.username,this.userSelf=new _e(n,s),this.userInfo={uid:n,username:s},this.initCalled=!0,this.userSelf=new _e(n,s),this.userInfo={uid:n,username:s},this.socket=de.a.connect("/",{secure:!0}),this.socket.emit("auth",Object(i.getGlobal)().authTokens),this.socket.on("initialized",(function(){r.initChats()})),this.socket.on("chat message",(function(e){var t=r.getChat(e.chat.type,e.chat.id);if(null!==t){var n=r.isCurrentChat(t.type,t.id);t.addMessage(e.uid,e.mid,e.type,e.content),t.hasNewMsg=!n,t.unreadMessages++,r.event.trigger("new message",e.chat.type,e.chat.id)}})),this.socket.on("started typing",(function(e){r.getChat(e.chat.type,e.chat.id).startedTyping(e.uid)})),this.socket.on("stopped typing",(function(e){r.getChat(e.chat.type,e.chat.id).stoppedTyping(e.uid)})),this.socket.on("new chat",function(){var e=Object(d.a)(h.a.mark((function e(t){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.addNewChat(Object(k.a)({isStillMember:!0},t));case 2:r.event.trigger("new chat",t);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),this.socket.on("removed chat",function(){var e=Object(d.a)(h.a.mark((function e(t){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.removedGroupChat(t);case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),this.socket.on("groupChat updated",(function(e){var t=r.chats.group.get(e.id);if(t){t.chatName=e.chatName;var n,s=[],a=Object(le.a)(e.members);try{for(a.s();!(n=a.n()).done;){var c=n.value;r.users.get(c.uid)||r.users.add(new _e(c.uid,c.username),c.uid),s.push(c.uid)}}catch(o){a.e(o)}finally{a.f()}t.users=s,Object(i.getDispatch)().updateChat(t),r.event.trigger("groupChat updated")}})),this.socket.on("disconnect",(function(){setTimeout((function(){alert("Verbindung verloren! Seite wird neu geladen"),location.reload()}),1e3)}));case 16:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"initChats",value:function(){var e=Object(d.a)(h.a.mark((function e(){var t,n,s;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Oe();case 2:if(200!==(t=e.sent).status){e.next=8;break}return e.next=6,t.json();case 6:for(n=e.sent,s=0;s<n.length;s++)"normalChat"===n[s].type?this.addNewNormalChat(n[s]):"groupChat"===n[s].type&&this.addNewGroupChat(n[s]);case 8:this.finishedLoading=!0,this.event.trigger("chats loaded",this.getChatArraySortedByDate());case 10:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getChatArraySortedByDate",value:function(){function e(e){var t=e.latestMessage;return null!==t?t.date.getTime():new Date(0).getTime()}function t(t,n){for(var s=n,r=n+1;r<t.length;r++)e(t[s])<e(t[r])&&(s=r);return s}function n(e,t,n){var s=e[t];e[t]=e[n],e[n]=s}function s(e){for(var s=function(e){for(var t=new Array(e.length),n=0;n<e.length;n++){var s=e[n].value;t[n]=s.getChatObject()}return t}(e),r=0;r<s.length-1;r++){n(s,r,t(s,r))}return s}return function(t,n){for(var s=new Array(t.length+n.length),r=0,a=0,c=0;c<s.length;c++)a<n.length?r<t.length&&e(t[r])>e(n[a])?(s[c]=t[r],r++):(s[c]=n[a],a++):(s[c]=t[r],r++);return s}(s(this.chats.normal),s(this.chats.group))}},{key:"isCurrentChat",value:function(e,t){var n=Object(i.getGlobal)().currentChat;return n.type===e&&n.id===t}},{key:"getChat",value:function(e,t){return"normalChat"===e?this.chats.normal.get(t):"tempChat"===e?this.temporaryChat.chatNow:"groupChat"===e?this.chats.group.get(t):void 0}},{key:"addNewChat",value:function(){var e=Object(d.a)(h.a.mark((function e(t){var n;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("normalChat"!==t.type){e.next=4;break}n=this.addNewNormalChat(t),e.next=13;break;case 4:if("groupChat"!==t.type){e.next=13;break}if(-1!==this.chats.group.getIndex(t.id)){e.next=9;break}n=this.addNewGroupChat(t),e.next=13;break;case 9:return n=this.chats.group.get(t.id),e.next=12,n.updateChat(t,!0);case 12:return e.abrupt("return");case 13:return n.unreadMessages=1,e.next=16,Object(i.getDispatch)().addChat(n);case 16:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"removedGroupChat",value:function(){var e=Object(d.a)(h.a.mark((function e(t){var n;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(-1===this.chats.group.getIndex(t.id)){e.next=4;break}return n=this.chats.group.get(t.id),e.next=4,n.updateChat(t,!1);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"addNewNormalChat",value:function(e){var t;-1===this.users.getIndex(e.members[0].uid)?(t=new _e(e.members[0].uid,e.members[0].username),this.users.add(t.uid,t)):t=this.users.get(e.members[0].uid);var n=new Xe(e.id,e.chatName,t.uid,e.unreadMessages,e.blockedBySelf,e.blockedByOther);return t.normalChat=n.id,n.initFirstMessage(e.firstMessage),this.chats.normal.add(e.id,n),n}},{key:"addNewGroupChat",value:function(e){for(var t=[],n=0;n<e.members.length;n++){var s=e.members[n],r=void 0;-1===this.users.getIndex(s.uid)?(r=new _e(s.uid,s.username),this.users.add(r.uid,r)):r=this.users.get(s.uid),t.push(r.uid),r.addGroupChat(e.id)}var a=new et(e.id,e.chatName,t,e.unreadMessages,e.isStillMember);return a.initFirstMessage(e.firstMessage),this.chats.group.add(e.id,a),a}},{key:"socket",get:function(){return this._socket},set:function(e){this._socket=e}},{key:"userSelf",get:function(){return this._userSelf},set:function(e){this._userSelf=e}},{key:"users",get:function(){return this._users},set:function(e){this._users=e}},{key:"chats",get:function(){return this._chats},set:function(e){this._chats=e}},{key:"event",get:function(){return this._event},set:function(e){this._event=e}},{key:"finishedLoading",get:function(){return this._finishedLoading},set:function(e){this._finishedLoading=e}},{key:"temporaryChat",get:function(){return this._temporaryChat},set:function(e){this._temporaryChat=e}},{key:"initCalled",get:function(){return this._initCalled},set:function(e){this._initCalled=e}}]),e}(),st=new nt;var rt=st,at=function(e){Object(b.a)(n,e);var t=Object(m.a)(n);function n(e){var s;return Object(f.a)(this,n),(s=t.call(this,e)).isSelected=function(){return s.props.id===s.global.currentChat.id&&s.props.type===s.global.currentChat.type},s.typeStateChanged=function(){var e="",t=rt.getChat(s.props.type,s.props.id).getLatestUserTyping();null!==t&&(e=t.username+" schreibt..."),s.setState({typeMsg:e})},s.state={lastMsg:void 0,typeMsg:""},s}return Object(j.a)(n,[{key:"render",value:function(){var e=this,t=function(){return e.props.isStillMember?e.props.blockedByOther?Object(v.jsxs)("span",{children:["Du wurdest von ",e.props.name," blockiert"]}):e.props.blockedBySelf?Object(v.jsxs)("span",{children:["Du hast ",e.props.name," blockiert"]}):e.props.latestMessage?Object(v.jsx)("span",{children:e.props.latestMessage.msgString}):Object(v.jsx)("span",{children:"Noch keine Nachrichten vorhanden"}):Object(v.jsx)("span",{children:"Du bist nicht mehr Mitglied"})},n=function(){return e.props.isStillMember&&e.props.latestMessage?Object(v.jsx)("div",{className:"lastMsg-date",children:e.props.latestMessage.dateString}):null};return Object(v.jsx)("li",{className:"chat-item"+(this.isSelected()?" selected ":""),children:Object(v.jsxs)(o.b,{to:"normalChat"===e.props.type?"/chat/user/"+rt.getChat("normalChat",e.props.id).otherUser:"groupChat"===e.props.type?"/chat/group/"+e.props.id:"tempChat"===e.props.type?"/chat/user/"+rt.temporaryChat.chatNow.otherUser:void 0,children:[Object(v.jsxs)("div",{className:"w-100",children:[Object(v.jsx)("strong",{className:"chatItem-username",children:this.props.name}),0!==e.props.unreadMessages&&e.props.isStillMember?Object(v.jsx)("div",{className:"newMsg-number",children:e.props.unreadMessages}):null]}),""===e.state.typeMsg?Object(v.jsxs)("div",{className:"w-100 lastMsg",children:[t(),n()]}):Object(v.jsx)("div",{className:"w-100 typeMsg",children:e.state.typeMsg})]})})}},{key:"componentDidMount",value:function(){rt.getChat(this.props.type,this.props.id).event.on("typeState changed",this.typeStateChanged)}},{key:"componentDidUpdate",value:function(e,t,n){e.type===this.props.type&&e.id===this.props.id||(rt.getChat(e.type,e.id).event.rm("typeState changed",this.typeStateChanged),rt.getChat(this.props.type,this.props.id).event.on("typeState changed",this.typeStateChanged),this.setState({typeMsg:""}))}},{key:"componentWillUnmount",value:function(){rt.getChat(this.props.type,this.props.id).event.rm("typeState changed",this.typeStateChanged)}}]),n}(i.Component),ct=(n(171),function(e){Object(b.a)(n,e);var t=Object(m.a)(n);function n(e){var s;return Object(f.a)(this,n),(s=t.call(this,e)).state={searchValue:""},s}return Object(j.a)(n,[{key:"render",value:function(){var e=this,t=0;return Object(v.jsxs)(I,{children:[Object(v.jsx)(ue,{onSearch:function(t){e.setState({searchValue:t})}}),Object(v.jsxs)("ul",{className:"chat-list",children:[e.global.tempChat?Object(v.jsx)(at,{id:0,type:"tempChat",name:e.global.tempChat.chatName,unreadMessages:0,isStillMember:!0,latestMessage:null},-1):null,this.global.chats.map((function(n,s){return n.chatName.includes(e.state.searchValue)?(t++,Object(v.jsx)(at,{id:n.id,type:n.type,name:n.chatName,unreadMessages:n.unreadMessages,latestMessage:n.latestMessage,isStillMember:n.isStillMember,blockedBySelf:n.blockedBySelf,blockedByOther:n.blockedByOther},s)):null}))]}),0===t?Object(v.jsx)("span",{children:"Nichts gefunden"}):null]})}}]),n}(i.Component));n(172);function it(e){return Object(v.jsx)("div",{className:"loader-init",children:Object(v.jsx)("div",{className:"col-sm-12 my-auto",children:Object(v.jsxs)("div",{className:"init-container border rounded",children:[Object(v.jsx)("div",{className:"spinner-border text-secondary",style:{width:"15rem",height:"15rem",borderWidth:"0.5rem"},role:"status",children:Object(v.jsx)("span",{className:"sr-only",children:"Loading..."})}),Object(v.jsx)("div",{className:"loader-text",children:e.msg})]})})})}var ot=n(41),ut=n(50),lt=(n(173),n(105));function ht(e){return dt.apply(this,arguments)}function dt(){return(dt=Object(d.a)(h.a.mark((function e(t){var n;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={method:"GET",headers:{Accept:"application/json"}},e.next=3,me("/group/"+t+"/",n);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function pt(e){return ft.apply(this,arguments)}function ft(){return(ft=Object(d.a)(h.a.mark((function e(t){var n;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={method:"PUT",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(t)},e.next=3,me("/message",n);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function jt(e){return bt.apply(this,arguments)}function bt(){return(bt=Object(d.a)(h.a.mark((function e(t){var n;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"}},e.next=3,me("/group/"+t+"/join/",n);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}n(175);var mt=function(e){Object(b.a)(n,e);var t=Object(m.a)(n);function n(e){var s;return Object(f.a)(this,n),(s=t.call(this,e)).assignFilesRef=function(e){s.files=e},s.uploadFiles=Object(d.a)(h.a.mark((function e(){var t,n,r,a,c,i,o;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=s.files.files,n=[],r=Object(le.a)(t),e.prev=3,r.s();case 5:if((a=r.n()).done){e.next=23;break}return c=a.value,e.prev=7,e.next=10,me("/message/file/"+c.name,{body:c,method:"PUT",headers:{"Content-type":c.type}});case 10:if(!(i=e.sent).ok){e.next=16;break}return e.next=14,i.json();case 14:o=e.sent,n.push({fid:o.fid,mimeType:c.type,fileName:c.name});case 16:e.next=21;break;case 18:e.prev=18,e.t0=e.catch(7),console.log(e.t0);case 21:e.next=5;break;case 23:e.next=28;break;case 25:e.prev=25,e.t1=e.catch(3),r.e(e.t1);case 28:return e.prev=28,r.f(),e.finish(28);case 31:s.props.onFileUpload(n);case 32:case"end":return e.stop()}}),e,null,[[3,25,28,31],[7,18]])}))),s.assignFilesRef=s.assignFilesRef.bind(Object(ot.a)(s)),s}return Object(j.a)(n,[{key:"render",value:function(){var e=this;return Object(v.jsx)("i",{className:"fas fa-paperclip fa-2x file-chooser",onClick:function(){return e.files.click()},children:Object(v.jsx)("input",{type:"file",className:"fileInput",name:"files",multiple:!0,ref:this.assignFilesRef,onChange:this.uploadFiles})})}}]),n}(s.Component),gt=function(e){Object(b.a)(n,e);var t=Object(m.a)(n);function n(){var e;Object(f.a)(this,n);for(var s=arguments.length,r=new Array(s),a=0;a<s;a++)r[a]=arguments[a];return(e=t.call.apply(t,[this].concat(r))).deleteFile=function(t){e.props.deleteFile(t)},e}return Object(j.a)(n,[{key:"render",value:function(){var e=this;return Object(v.jsx)("div",{className:"file-list",children:this.props.files.map((function(t){return Object(v.jsxs)("div",{className:"file",children:[Object(v.jsx)("i",{className:"far fa-file"}),"\xa0",t.fileName,Object(v.jsx)("span",{className:"close",onClick:function(){return e.deleteFile(t)},children:"x"})]})}))})}}]),n}(s.Component),Ot=(n(176),function(e){Object(b.a)(n,e);var t=Object(m.a)(n);function n(e){var s;return Object(f.a)(this,n),(s=t.call(this,e))._userTyping=!1,s._typeEventEmitted=!1,s.onTyping=function(e){s.setState({message:e.target.value}),s.handleTypeMessage()},s.handleTypeMessage=function(){s.isTempChat||(s.userTyping&&clearTimeout(s.typeTimeout),s.userTyping=!0,s.typeEventEmitted||(s.typeEventEmitted=!0,rt.socket.emit("started typing")),s.typeTimeout=setTimeout((function(){s.userTyping=!1,s.typeEventEmitted&&(s.typeEventEmitted=!1,rt.socket.emit("stopped typing"))}),1e3))},s.onSubmit=function(e){if(e.preventDefault(),""!==s.state.message||s.state.files.length>0){var t={text:s.state.message,files:s.state.files},n={text:s.state.message,files:s.getFileIds()};if(s.setState({message:""}),s.isTempChat){var r=s.props.location.pathname;rt.temporaryChat.createNewNormalChat(t,n).then((function(e){e&&(s.props.history.replace("/chat"),s.props.history.replace(r))}))}else s.sendMessage(n).then((function(e){s.setState({files:[]}),rt.getChat(s.props.chatType,s.props.chatId).addMessage(rt.userSelf.uid,e,Ae.messageTypes.normalMessage,t)})).catch((function(e){}))}},s.sendMessage=function(){var e=Object(d.a)(h.a.mark((function e(t){var n,s;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,pt({type:Ae.messageTypes.normalMessage,content:t});case 2:if(!(n=e.sent).ok){e.next=8;break}return e.next=6,n.json();case 6:return s=e.sent,e.abrupt("return",s.mid);case 8:throw new Error;case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),s.onEmojiInput=function(e){s.setState({message:s.state.message+e.native}),s.handleTypeMessage()},s.toggleEmoji=function(e){s.setState((function(e){return{showEmoji:!e.showEmoji}}))},s.addFiles=function(e){s.setState((function(t){return t.files.length+e.length<=10?{files:[].concat(Object(ut.a)(t.files),Object(ut.a)(e)),tooManyFiles:!1}:{tooManyFiles:!0}}))},s.deleteFile=function(e){s.setState((function(t){var n,s=t.files.slice(),r=0,a=Object(le.a)(s);try{for(a.s();!(n=a.n()).done;){if(n.value.fid===e.fid){s.splice(r,1);break}r++}}catch(c){a.e(c)}finally{a.f()}return{files:s}}))},s.getFileIds=function(){var e,t=[],n=Object(le.a)(s.state.files);try{for(n.s();!(e=n.n()).done;){var r=e.value;t.push(r.fid)}}catch(a){n.e(a)}finally{n.f()}return t},s.state={message:"",files:[],tooManyFiles:!1,showEmoji:!1},s}return Object(j.a)(n,[{key:"render",value:function(){return Object(v.jsxs)(I,{children:[Object(v.jsx)(gt,{files:this.state.files,deleteFile:this.deleteFile}),Object(v.jsxs)("form",{onSubmit:this.onSubmit,className:"msg-form",children:[Object(v.jsxs)("div",{className:"message-input",children:[Object(v.jsx)("input",{autoComplete:"off",placeholder:"Nachricht:",name:"message-input-text",value:this.state.message,onChange:this.onTyping}),Object(v.jsx)(K,{displayIn:["Laptop","Tablet"],children:Object(v.jsx)("i",{className:"far fa-smile fa-2x emoji-toggle",onClick:this.toggleEmoji})}),Object(v.jsx)(mt,{onFileUpload:this.addFiles})]}),Object(v.jsx)("button",{className:"btn-submit",type:"submit",children:Object(v.jsx)("i",{className:"far fa-paper-plane fa-2x","data-toggle":"tooltip",title:"send message"})})]}),this.state.showEmoji?Object(v.jsx)("div",{style:{position:"absolute",bottom:"60px",right:"50px",width:"350px",height:"425px"},children:Object(v.jsx)(lt.a,{onSelect:this.onEmojiInput,native:!0})}):null]})}},{key:"componentDidMount",value:function(){this.isTempChat="tempChat"===this.props.chatType}},{key:"componentDidUpdate",value:function(e,t,n){this.isTempChat="tempChat"===this.props.chatType}},{key:"userTyping",get:function(){return this._userTyping},set:function(e){this._userTyping=e}},{key:"typeEventEmitted",get:function(){return this._typeEventEmitted},set:function(e){this._typeEventEmitted=e}},{key:"typeTimeout",get:function(){return this._typeTimeout},set:function(e){this._typeTimeout=e}},{key:"isTempChat",get:function(){return this._isTempChat},set:function(e){this._isTempChat=e}}]),n}(s.Component)),vt=Object(u.j)(Ot),xt=(n(177),function(e){Object(b.a)(n,e);var t=Object(m.a)(n);function n(e){var s;return Object(f.a)(this,n),(s=t.call(this,e))._isMounted=!1,s.scrollHandler=function(e){s.setState({scrollToBottom:s.getScrollToBottom()}),0===s.messagesNode.scrollTop&&s.isChatSelected()&&s.loadMessages()},s.setScrollToBottom=function(e){s.messagesNode.scrollTop=s.messagesNode.scrollHeight-s.messagesNode.offsetHeight-e},s.getScrollToBottom=function(){return s.messagesNode.scrollHeight-s.messagesNode.offsetHeight-s.messagesNode.scrollTop},s.assignMessagesRef=function(e){s.messages=e},s.loadMessages=function(){var e=rt.getChat(s.global.currentChat.type,s.global.currentChat.id);e.reachedTopMessages||s.setState({msgLoading:!0}),e.loadMessages(10).then((function(e){s.dispatch.addLoadedMessages(e),s.setState((function(e){return{msgLoading:!1}})),s.setScrollToBottom(s.state.scrollToBottom)})).catch((function(e){return s.setState({msgLoading:!1})}))},s.chatChanged=function(){0===s.messagesNode.scrollTop&&s.isChatSelected()&&s.loadMessages()},s.isChatSelected=function(){return!(""===s.global.currentChat.type&&0===s.global.currentChat.id)},s.assignMessagesRef=s.assignMessagesRef.bind(Object(ot.a)(s)),s.state={msgLoading:!1,scrollToBottom:0},s}return Object(j.a)(n,[{key:"componentDidMount",value:function(){this.messagesNode=c.a.findDOMNode(this.messages),this.chatChanged(),this.isMounted=!0}},{key:"componentDidUpdate",value:function(e,t,n){e.chatType===this.props.chatType&&e.chatId===this.props.chatId||(this.setScrollToBottom(0),this.chatChanged()),0===this.state.scrollToBottom&&(this.setScrollToBottom(0),this.global.currentChat.newMessages>0&&this.setGlobal((function(e){return{currentChat:Object(k.a)(Object(k.a)({},e.currentChat),{},{newMessages:0})}})))}},{key:"render",value:function(){var e=this,t=new Date(0),n=function(e){return n=e.date,s=t,n.getDay()!==s.getDay()||n.getMonth()!==s.getMonth()||n.getFullYear()!==s.getFullYear()?(t=e.date,Object(v.jsx)("div",{className:"date-container",children:Object(v.jsx)("div",{children:e.dateString})})):(t=e.date,null);var n,s};return Object(v.jsxs)("div",{className:"chat-container",children:[Object(v.jsxs)("div",{className:"messages",onScroll:this.scrollHandler,ref:this.assignMessagesRef,children:[e.state.msgLoading?Object(v.jsx)("div",{className:"messageLoader-top",children:Object(v.jsx)("div",{className:"spinner-border text-secondary",role:"status",children:Object(v.jsx)("span",{className:"sr-only",children:"Loading..."})})}):null,this.global.currentChat.messages.map((function(e,t){return Object(v.jsxs)(I,{children:[n(e),Object(v.jsx)(He,{msg:e})]},t)})),0===e.global.currentChat.messages.length?Object(v.jsx)("div",{className:"alert alert-primary",role:"alert",children:"Noch keine Nachrichten vorhanden"}):null,e.global.currentChat.isStillMember?null:Object(v.jsx)("div",{className:"error-container",children:Object(v.jsx)("div",{children:"Du bist nicht mehr im chat"})}),e.global.currentChat.blockedByOther?Object(v.jsx)("div",{className:"error-container",children:Object(v.jsxs)("div",{children:["Du wurdest von ",e.global.currentChat.chatName," blockiert"]})}):null,e.global.currentChat.blockedBySelf?Object(v.jsx)("div",{className:"error-container",children:Object(v.jsxs)("div",{children:["Du hast ",e.global.currentChat.chatName," blockiert"]})}):null,e.isMounted&&e.getScrollToBottom()>10?Object(v.jsxs)("div",{id:"messages-bottom",className:"messages-bottom",onClick:function(){e.setState({scrollToBottom:0})},children:[Object(v.jsx)("div",{id:"btnToBottom",className:"chevron-down",children:Object(v.jsx)("i",{className:"fas fa-chevron-down fa-2x"})}),e.global.currentChat.newMessages>0?Object(v.jsx)("div",{id:"scroll-down-number",className:"number",children:e.global.currentChat.newMessages}):null]}):null]}),!e.global.currentChat.isStillMember||e.global.currentChat.blockedBySelf||e.global.currentChat.blockedByOther?null:Object(v.jsx)(vt,{chatType:e.props.chatType,chatId:e.props.chatId})]})}},{key:"componentWillUnmount",value:function(){this.isMounted=!1}},{key:"isMounted",get:function(){return this._isMounted},set:function(e){this._isMounted=e}},{key:"messages",get:function(){return this._messages},set:function(e){this._messages=e}},{key:"messagesNode",get:function(){return this._messagesNode},set:function(e){this._messagesNode=e}}]),n}(i.Component)),yt=function(e){Object(b.a)(n,e);var t=Object(m.a)(n);function n(){return Object(f.a)(this,n),t.apply(this,arguments)}return Object(j.a)(n,[{key:"render",value:function(){return Object(v.jsxs)("div",{className:"chat-container",children:[Object(v.jsx)("div",{className:"messages",children:Object(v.jsx)("div",{className:"alert alert-primary",role:"alert",children:"Noch keine Nachrichten vorhanden"})}),Object(v.jsx)(vt,{chatType:"tempChat",chatId:0})]})}},{key:"componentDidMount",value:function(){rt.temporaryChat.show()}},{key:"componentDidUpdate",value:function(e,t,n){e.uid!==this.props.uid&&rt.temporaryChat.update()}},{key:"componentWillUnmount",value:function(){rt.temporaryChat.hide()}}]),n}(s.Component);n(178);function kt(){return Object(v.jsx)("div",{children:Object(v.jsx)("h2",{children:"ung\xfcltige Addresse"})})}function wt(){return Object(v.jsx)("div",{children:Object(v.jsx)("h2",{children:"Du kannst dir selbst nicht schreiben"})})}function Ct(){return Object(v.jsx)("div",{children:Object(v.jsx)("h2",{children:"Dieser User hat dich blockiert"})})}function St(){return Object(v.jsx)("div",{children:Object(v.jsx)("h2",{children:"Dieser User existiert nicht"})})}function Nt(e){return Object(v.jsxs)("div",{className:"notMemberPublicChat",children:[Object(v.jsx)("h3",{children:"Du bist nicht Mitglied in diesem chat"}),Object(v.jsx)("button",{onClick:function(){jt(e.gcid).then((function(){e.onJoined()})).catch((function(){}))},children:"jetzt beitreten"})]})}function Mt(){return Object(v.jsx)("div",{children:Object(v.jsx)("h2",{children:"Du bist nicht dazu berechtigt diesen chat anzusehen"})})}function Tt(){return Object(v.jsx)("div",{children:Object(v.jsx)("h2",{children:"Dieser Chat existiert nicht"})})}function Et(){return Object(v.jsx)("div",{children:Object(v.jsx)("h2",{children:"Fehler"})})}var Ut=function(e){Object(b.a)(n,e);var t=Object(m.a)(n);function n(e){var s;return Object(f.a)(this,n),(s=t.call(this,e)).userChanged=function(){var e=parseInt(s.props.uid);if(s.global.userSelf.uid===e)s.setState({error:De,loaded:!0});else{var t=function(){(function(e){return Ie.apply(this,arguments)})(e).then((function(t){t===Ne?(s.setState({error:t}),s.setGlobal({infoHeaderCenter:X,ihcData:{name:rt.users.get(e).username,uid:e}}).then(),s.selectNormalChat(e)):t===Te?(s.setState({error:t}),s.setGlobal({infoHeaderCenter:X,ihcData:{name:rt.temporaryChat.chatNow.chatName,uid:e}}).then(),s.selectTempChat()):s.setState({error:Be}),s.setState({loaded:!0})})).catch((function(e){return s.setState({error:Be})}))};rt.finishedLoading?t():rt.event.on("chats loaded",(function(){t()})),s.setState({uid:parseInt(s.props.uid)})}},s.state={uid:0,loaded:!1,error:Ne},s}return Object(j.a)(n,[{key:"render",value:function(){var e=this;return Object(v.jsxs)("div",{className:"h-100",children:[function(){if(!e.state.loaded)return Object(v.jsx)(it,{msg:"Chat wird geladen"})}(),e.state.error===Me?Object(v.jsx)(kt,{}):e.state.error===De?Object(v.jsx)(wt,{}):e.state.loaded?e.state.error===Ne?Object(v.jsx)(xt,{chatType:e.global.currentChat.type,chatId:e.global.currentChat.id}):e.state.error===Te?Object(v.jsx)(yt,{uid:e.state.uid}):e.state.error===Ue?Object(v.jsx)(Ct,{}):Object(v.jsx)(St,{}):void 0]})}},{key:"componentDidMount",value:function(){this.userChanged()}},{key:"componentDidUpdate",value:function(e,t,n){e.uid!==this.props.uid&&(isNaN(this.props.uid)?this.setState({error:Me}):this.userChanged())}},{key:"selectTempChat",value:function(){this.dispatch.showTempChat()}},{key:"selectNormalChat",value:function(e){if(-1===rt.users.getIndex(e))this.setState({error:Ee});else{var t=rt.users.get(e).normalChat,n=rt.getChat("normalChat",t);this.dispatch.selectChat(n)}}},{key:"componentWillUnmount",value:function(){this.setGlobal({infoHeaderCenter:Q,ihcData:null}).then()}}]),n}(i.Component),Dt=(n(179),function(e){Object(b.a)(n,e);var t=Object(m.a)(n);function n(){return Object(f.a)(this,n),t.apply(this,arguments)}return Object(j.a)(n,[{key:"render",value:function(){var e=this;return Object(v.jsx)("div",{className:"modal-outer",onClick:function(){e.props.history.goBack()},children:Object(v.jsx)("div",{className:"h-100",style:{display:"flex"},children:Object(v.jsxs)("div",{className:"modal-inner",onClick:function(e){e.stopPropagation()},children:[Object(v.jsx)("div",{className:"btn-close",onClick:function(){e.props.history.goBack()},children:"\xd7"}),this.props.children]})})})}}]),n}(s.Component)),Bt=Object(u.j)(Dt);function It(e){return Object(v.jsx)("div",{className:"m-header",children:e.children})}function _t(e){return Object(v.jsx)("div",{className:"m-main",children:e.children})}var At=function(e){Object(b.a)(n,e);var t=Object(m.a)(n);function n(){var e;Object(f.a)(this,n);for(var s=arguments.length,r=new Array(s),a=0;a<s;a++)r[a]=arguments[a];return(e=t.call.apply(t,[this].concat(r))).clicked=function(t){e.props.isSelected?e.props.deselectUser(e.props.index):e.props.selectUser(e.props.index)},e}return Object(j.a)(n,[{key:"render",value:function(){return Object(v.jsxs)("li",{onClick:this.clicked,children:[Object(v.jsx)("div",{className:"username",children:this.props.username}),Object(v.jsx)("div",{className:"user-select fa-lg"+(this.props.isSelected?" selected":""),children:Object(v.jsx)("i",{className:"fas fa-check"})})]},this.props.index)}}]),n}(s.Component),Rt=n(56),Pt=n.n(Rt),zt=0,Ft=1,Gt=function(e){Object(b.a)(n,e);var t=Object(m.a)(n);function n(e){var s;return Object(f.a)(this,n),(s=t.call(this,e)).lastRequest={},s.searchChanged=function(e){s.setState({searchValue:e.target.value,searchResult:[],hasMore:!0})},s.loadUsers=Object(d.a)(h.a.mark((function e(){var t,n,r;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=s.state.searchValue,n=s.state.searchResult.length,s.lastRequest.searchValue===t&&s.lastRequest.length===n){e.next=14;break}return s.lastRequest={searchValue:t,length:n},e.prev=4,e.next=7,s.props.loadUsers(t,n);case 7:0===(r=e.sent).length?s.setState({hasMore:!1,error:zt}):s.setState((function(e){return{searchResult:e.searchResult.concat(r),error:zt}})),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(4),s.setState({error:Ft});case 14:case"end":return e.stop()}}),e,null,[[4,11]])}))),s.selectUser=function(e){var t=s.state.searchResult[e];s.props.selectUser(t.uid,t.username)},s.deselectUser=function(e){var t=s.state.searchResult[e];s.props.deselectUser(t.uid)},s.state={searchValue:"",searchResult:[],error:zt,hasMore:!0},s}return Object(j.a)(n,[{key:"render",value:function(){var e=this;return Object(v.jsxs)(I,{children:[Object(v.jsx)("form",{className:"form-group",style:{width:"90%",maxWidth:"650px"},children:Object(v.jsx)("input",{type:"text",className:"form-control p-2 m-2",placeholder:"Benutzer suchen",value:this.state.searchValue,onChange:this.searchChanged})}),Object(v.jsx)("div",{className:"selectUsers",ref:function(t){return e.scrollParentRef=t},children:Object(v.jsx)(Pt.a,{pageStart:0,loadMore:this.loadUsers,hasMore:this.state.hasMore,loader:Object(v.jsx)("div",{className:"loader",children:Object(v.jsx)("div",{className:"spinner-border text-secondary",role:"status",children:Object(v.jsx)("span",{className:"sr-only",children:"Loading..."})})},-1),useWindow:!1,getScrollParent:function(){return e.scrollParentRef},children:Object(v.jsxs)("ul",{className:"selectUsers",children:[this.state.searchResult.map((function(t,n){return Object(v.jsx)(At,{index:n,uid:t.uid,username:t.username,selectUser:e.selectUser,deselectUser:e.deselectUser,isSelected:e.props.isUserSelected(t.uid)},n)})),0===this.state.searchResult.length?Object(v.jsx)("div",{className:"nothingFound",children:"Nichts gefunden!"},-1):null]})})})]})}}]),n}(s.Component),Lt=(n(181),function(e){Object(b.a)(n,e);var t=Object(m.a)(n);function n(e){var s;return Object(f.a)(this,n),(s=t.call(this,e)).selectUser=function(e,t){s.setState((function(n){return{selectedUsers:n.selectedUsers.concat({uid:e,username:t})}}))},s.deselectUser=function(e){s.setState((function(t){var n=Object(ut.a)(t.selectedUsers),s=n.findIndex((function(t){return t.uid===e}));return n.splice(s,1),{selectedUsers:n}}))},s.deselectIndex=function(e){s.deselectUser(s.state.selectedUsers[e].uid)},s.isUserSelected=function(e){return s.state.selectedUsers.find((function(t){return t.uid===e}))},s.btnNextClicked=function(e){s.props.onNext(s.state.selectedUsers)},s.state={selectedUsers:[],showOnlySelected:!1},s}return Object(j.a)(n,[{key:"render",value:function(){var e=this;return 0===this.state.selectedUsers.length&&this.state.showOnlySelected&&this.setState({showOnlySelected:!1}),Object(v.jsxs)(I,{children:[Object(v.jsx)("div",{className:"select-users",children:0===e.state.selectedUsers.length?Object(v.jsx)("h4",{children:"Noch niemand ausgew\xe4hlt"}):Object(v.jsxs)("h4",{className:"w-100",children:[Object(v.jsxs)("span",{className:"selected-num"+(e.state.showOnlySelected?" selected":""),onClick:function(t){e.setState((function(e){return{showOnlySelected:!e.showOnlySelected}}))},children:[e.state.selectedUsers.length,"\xa0Benutzer"]}),"\xa0ausgew\xe4hlt",Object(v.jsx)("i",{className:"fas fa-arrow-right fa-lg float-right btn-next",onClick:e.btnNextClicked})]})}),this.state.showOnlySelected?Object(v.jsx)("div",{className:"selectUsers",children:Object(v.jsx)("ul",{className:"selectUsers only-selected",children:this.state.selectedUsers.map((function(t,n){return Object(v.jsx)(At,{index:n,uid:t.uid,username:t.username,selectUser:function(){},deselectUser:e.deselectIndex,isSelected:!0},n)}))})}):Object(v.jsx)(Gt,{selectUser:this.selectUser,deselectUser:this.deselectUser,isUserSelected:this.isUserSelected,loadUsers:this.props.loadUsers})]})}}]),n}(s.Component)),Vt=function(){var e=Object(d.a)(h.a.mark((function e(t,n){var s;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s={method:"PUT",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({users:n})},e.next=3,me("/group/"+t+"/members",s);case 3:if(e.sent.ok){e.next=6;break}throw new Error("Error adding members");case 6:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),Ht=function(){var e=Object(d.a)(h.a.mark((function e(t,n){var s,r;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s={method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(n)},e.next=3,me("/user/notInGroup/"+t,s);case 3:if(!(r=e.sent).ok){e.next=10;break}return e.next=7,r.json();case 7:return e.abrupt("return",e.sent);case 10:throw new Error("Error fetching users");case 11:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),Jt=function(){var e=Object(d.a)(h.a.mark((function e(t){var n,s;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={method:"POST",headers:{Accept:"application/json"}},e.next=3,me("/group/"+t+"/leave",n);case 3:if(!(s=e.sent).ok){e.next=12;break}return e.next=7,s.json();case 7:if(!e.sent.error){e.next=10;break}throw new Error("Error leaving chat");case 10:e.next=13;break;case 12:throw new Error("Error leaving chat");case 13:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Wt=function(){var e=Object(d.a)(h.a.mark((function e(t){var n,s;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={method:"POST",headers:{Accept:"application/json"}},e.next=3,me("/group/"+t+"/removeAdmin",n);case 3:if(!(s=e.sent).ok){e.next=12;break}return e.next=7,s.json();case 7:if(!e.sent.error){e.next=10;break}throw new Error("Error removing admin");case 10:e.next=13;break;case 12:throw new Error("Error removing admin");case 13:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();function qt(e){var t=Object(u.g)(),n=function(){var n=Object(d.a)(h.a.mark((function n(s){return h.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,Vt(e.gcid,s);case 3:t.goBack(),n.next=8;break;case 6:n.prev=6,n.t0=n.catch(0);case 8:case"end":return n.stop()}}),n,null,[[0,6]])})));return function(e){return n.apply(this,arguments)}}(),s=function(){var t=Object(d.a)(h.a.mark((function t(n,s){return h.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Ht(e.gcid,{search:n,limit:10,start:s});case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}();return Object(v.jsxs)(I,{children:[Object(v.jsx)(It,{children:Object(v.jsx)("h2",{children:"Benutzer hinzuf\xfcgen"})}),Object(v.jsx)(_t,{children:Object(v.jsx)("div",{className:"addMembers",children:Object(v.jsx)(Lt,{onNext:n,loadUsers:s})})})]})}var Yt=n(35),Zt=function(e){Object(b.a)(n,e);var t=Object(m.a)(n);function n(){var e;Object(f.a)(this,n);for(var s=arguments.length,r=new Array(s),a=0;a<s;a++)r[a]=arguments[a];return(e=t.call.apply(t,[this].concat(r))).isSelfAdmin=function(){return e.props.memberSelf.isAdmin},e.removeMemberFromChat=Object(d.a)(h.a.mark((function t(){var n;return h.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e.isSelfAdmin()){t.next=5;break}return n={method:"DELETE",headers:{Accept:"application/json"}},t.next=4,me("/group/"+e.props.gcid+"/member/"+e.props.member.uid,n);case 4:t.sent;case 5:case"end":return t.stop()}}),t)}))),e.makeMemberAdmin=Object(d.a)(h.a.mark((function t(){var n;return h.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e.isSelfAdmin()){t.next=5;break}return n={method:"POST",headers:{Accept:"application/json"}},t.next=4,me("/group/"+e.props.gcid+"/member/"+e.props.member.uid+"/giveAdmin",n);case 4:t.sent;case 5:case"end":return t.stop()}}),t)}))),e.removeMemberAdmin=Object(d.a)(h.a.mark((function t(){var n;return h.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e.isSelfAdmin()){t.next=5;break}return n={method:"POST",headers:{Accept:"application/json"}},t.next=4,me("/group/"+e.props.gcid+"/member/"+e.props.member.uid+"/removeAdmin",n);case 4:t.sent;case 5:case"end":return t.stop()}}),t)}))),e}return Object(j.a)(n,[{key:"isMemberSelf",value:function(){return this.props.member.uid===this.global.userSelf.uid}},{key:"render",value:function(){var e=this.props.location.pathname;return Object(v.jsxs)("ul",{className:"userOptions",children:[Object(v.jsx)("li",{children:Object(v.jsxs)(o.b,{to:e+"/userInfo/"+this.props.member.uid,children:["zeige ",this.props.member.username," an"]})},0),Object(v.jsx)("li",{children:Object(v.jsxs)(o.b,{to:"/chat/user/"+this.props.member.uid,children:["Nachricht an ",this.props.member.username]})},1),this.isSelfAdmin()&&!this.isMemberSelf()?Object(v.jsxs)(I,{children:[Object(v.jsx)("li",{className:"noLink",onClick:this.removeMemberFromChat,children:"aus chat entfernen"},2),this.props.member.isAdmin?Object(v.jsx)("li",{className:"noLink",onClick:this.removeMemberAdmin,children:"admin status entfernen"},3):Object(v.jsx)("li",{className:"noLink",onClick:this.makeMemberAdmin,children:"zu admin machen"},4)]}):null]})}}]),n}(i.Component),$t=Object(u.j)(Zt);function Kt(e){var t=Object(u.h)().pathname;return Object(v.jsxs)("ul",{className:"chatOptions",children:[e.memberSelf.isAdmin?Object(v.jsxs)(I,{children:[Object(v.jsx)("li",{className:"addUsers",children:Object(v.jsx)(o.b,{to:t+"/addUsers",children:"Benutzer hinzuf\xfcgen"})},0),Object(v.jsx)("li",{className:"removeSelfAdmin noLink",onClick:function(){Wt(e.gcid).then((function(){})).catch((function(e){console.log(e)}))},children:"admin status entfernen"},1)]}):null,Object(v.jsx)("li",{className:"leaveChat noLink",onClick:function(){Jt(e.gcid).then((function(){})).catch((function(e){console.log(e)}))},children:"Chat verlassen"},2)]})}n(182);var Qt=function(e){Object(b.a)(n,e);var t=Object(m.a)(n);function n(e){var s;return Object(f.a)(this,n),(s=t.call(this,e)).startEdit=function(){s.setState({isEditing:!0})},s.cancelEdit=function(){s.setState({isEditing:!1,value:s.props.value})},s.submitEdit=function(e){e.preventDefault(),s.setState({isEditing:!1}),s.props.value!==s.state.value&&"function"===typeof s.props.onChange&&s.props.onChange(s.state.value)},s.state={isEditing:!1,value:s.props.value},s}return Object(j.a)(n,[{key:"render",value:function(){var e=this;return Object(v.jsx)("span",{className:"label-edit "+this.props.className,children:this.state.isEditing?Object(v.jsxs)("form",{onSubmit:this.submitEdit,children:[Object(v.jsx)("input",{type:"text",value:this.state.value,style:{width:this.state.value.length+"ch"},onChange:function(t){e.setState({value:t.target.value})}}),"\xa0\xa0",Object(v.jsx)("i",{className:"fas fa-check fa-lg edit-submit",onClick:this.submitEdit}),"\xa0\xa0",Object(v.jsx)("i",{className:"fas fa-times fa-lg edit-cancel",onClick:this.cancelEdit})]}):Object(v.jsxs)("span",{onDoubleClick:this.startEdit,className:"value-noEdit",children:[null!=this.props.children?this.props.children:this.state.value,"\xa0",Object(v.jsx)("i",{className:"fas fa-pen edit-start",onClick:this.startEdit})]})})}}]),n}(s.Component),Xt=function(e){Object(b.a)(n,e);var t=Object(m.a)(n);function n(){var e;Object(f.a)(this,n);for(var s=arguments.length,r=new Array(s),a=0;a<s;a++)r[a]=arguments[a];return(e=t.call.apply(t,[this].concat(r))).onSubmit=function(){var t=Object(d.a)(h.a.mark((function t(n){var s;return h.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return s={method:"PUT",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({description:n})},t.next=3,me("/group/"+e.props.gcid+"/description",s);case 3:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),e}return Object(j.a)(n,[{key:"render",value:function(){return Object(v.jsx)(Qt,{className:"description",value:this.props.description,onChange:this.onSubmit})}}]),n}(s.Component),en=function(e){Object(b.a)(n,e);var t=Object(m.a)(n);function n(){var e;Object(f.a)(this,n);for(var s=arguments.length,r=new Array(s),a=0;a<s;a++)r[a]=arguments[a];return(e=t.call.apply(t,[this].concat(r))).onSubmit=function(){var t=Object(d.a)(h.a.mark((function t(n){var s;return h.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return s={method:"PUT",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({chatName:n})},t.next=3,me("/group/"+e.props.gcid+"/chatName",s);case 3:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),e}return Object(j.a)(n,[{key:"render",value:function(){return Object(v.jsx)(Qt,{className:"chatName",value:this.props.chatName,onChange:this.onSubmit})}}]),n}(s.Component),tn=(n(183),function(e){Object(b.a)(n,e);var t=Object(m.a)(n);function n(e){var s;return Object(f.a)(this,n),(s=t.call(this,e)).state={error:!1},s}return Object(j.a)(n,[{key:"render",value:function(){var e=this;if(this.state.error)return Object(v.jsx)("div",{className:"alert alert-danger",role:"alert",children:"Ein Fehler ist aufgetreten!"});var t=rt.userSelf.uid;return Object(v.jsxs)("div",{className:"groupChatInfo",children:[this.props.data.memberSelf.isAdmin?Object(v.jsx)("h1",{className:"chatName",children:Object(v.jsx)(en,{gcid:this.props.gcid,chatName:this.props.data.chatName})}):Object(v.jsx)("div",{className:"chatName",children:Object(v.jsx)("h1",{children:this.props.data.chatName})}),this.props.data.memberSelf.isAdmin?Object(v.jsx)(Xt,{gcid:this.props.gcid,description:this.props.data.description}):Object(v.jsx)("div",{className:"description",children:this.props.data.description}),Object(v.jsx)(Yt.a,{trigger:["click"],overlay:Object(v.jsx)(Kt,{gcid:this.props.gcid,memberSelf:this.props.data.memberSelf}),children:Object(v.jsx)("i",{className:"fas fa-ellipsis-v fa-lg chat-options-btn fa-2x",role:"button"})}),this.props.data.memberSelf.isStillMember?null:Object(v.jsx)("div",{className:"error",children:"Du bist nicht mehr im chat"}),Object(v.jsxs)("h4",{children:[this.props.data.members.length,"\xa0Mitglieder:"]}),Object(v.jsx)("ul",{className:"userList",children:this.props.data.members.map((function(n,s){return Object(v.jsx)("li",{children:Object(v.jsxs)("div",{className:"userItem",children:[t===n.uid?Object(v.jsx)("span",{children:"Du"}):n.username,Object(v.jsxs)("div",{className:"right",children:[n.isAdmin?Object(v.jsx)("span",{className:"user-admin",children:"Admin\xa0\xa0"}):null,Object(v.jsx)(Yt.a,{trigger:["click"],overlay:Object(v.jsx)($t,{gcid:e.props.gcid,memberSelf:e.props.data.memberSelf,member:n}),animation:"slide-up",alignPoint:!0,children:Object(v.jsx)("i",{className:"fas fa-ellipsis-v fa-lg",role:"button"})})]})]})},s)}))})]})}}]),n}(s.Component)),nn=Object(u.j)(tn);function sn(e){var t=Object(u.i)().path,n=Object(v.jsx)(nn,{gcid:e.gcid,data:e.data});return Object(v.jsxs)(I,{children:[Object(v.jsx)(K,{displayIn:["Mobile"],children:Object(v.jsxs)(u.d,{children:[Object(v.jsx)(u.b,{path:"".concat(t,"/addUsers"),children:Object(v.jsx)(qt,{gcid:e.gcid})}),Object(v.jsx)(u.b,{path:"*",children:n})]})}),Object(v.jsxs)(K,{displayIn:["Laptop","Tablet"],children:[Object(v.jsx)(u.d,{children:Object(v.jsx)(u.b,{path:"".concat(t,"/addUsers"),children:Object(v.jsx)(Bt,{children:Object(v.jsx)(qt,{gcid:e.gcid})})})}),n]})]})}var rn=0,an=1,cn=2,on=3,un=4,ln=5,hn=0,dn=1,pn=function(e){Object(b.a)(n,e);var t=Object(m.a)(n);function n(e){var s;return Object(f.a)(this,n),(s=t.call(this,e)).loadGroupChatInfo=function(){var e=Object(d.a)(h.a.mark((function e(t){var n,r;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,ht(s.props.gcid);case 3:if(403!==(n=e.sent).status){e.next=8;break}return e.abrupt("return",un);case 8:if(404!==n.status){e.next=12;break}return e.abrupt("return",cn);case 12:if(!n.ok){e.next=29;break}return e.next=15,n.json();case 15:if(r=e.sent,s.setState({chatData:r}),!r.error){e.next=21;break}return e.abrupt("return",ln);case 21:if(-1===rt.chats.group.getIndex(t)){e.next=25;break}return e.abrupt("return",rn);case 25:if(!r.public){e.next=27;break}return e.abrupt("return",on);case 27:e.next=30;break;case 29:return e.abrupt("return",ln);case 30:e.next=35;break;case 32:return e.prev=32,e.t0=e.catch(0),e.abrupt("return",ln);case 35:case"end":return e.stop()}}),e,null,[[0,32]])})));return function(t){return e.apply(this,arguments)}}(),s.chatChanged=function(){if(isNaN(s.props.gcid))s.setState({error:an,loaded:!0});else{var e=function(){var e=parseInt(s.props.gcid);s.loadGroupChatInfo(e).then((function(t){t===rn?(s.selectGroupChat(e),s.setState({loaded:!0,error:rn,gcid:e}),s.setGlobal({infoHeaderCenter:ee,ihcData:{name:rt.chats.group.get(e).chatName,gcid:e}}).then()):t===on?s.setState({loaded:!0,error:t,gcid:e}):s.setState({loaded:!0,error:t})})).catch()};rt.finishedLoading?e():rt.event.on("chats loaded",(function(){e()}))}},s.reloadChatInfo=function(){if(s.state.error===rn){var e=parseInt(s.props.gcid);s.loadGroupChatInfo(e).then((function(){}))}},s.setChatUpdated=function(){rt.event.on("groupChat updated",s.reloadChatInfo)},s.removeChatUpdated=function(){rt.event.rm("groupChat updated",s.reloadChatInfo)},s.componentDidMount=function(){s.chatChanged(),s.setChatUpdated()},s.state={gcid:0,loaded:!1,chatData:null,error:rn},s}return Object(j.a)(n,[{key:"selectGroupChat",value:function(e){if(-1===rt.chats.group.getIndex(e))this.setState({error:cn});else{var t=rt.chats.group.get(e);this.dispatch.selectChat(t)}}},{key:"componentDidUpdate",value:function(e,t,n){e.gcid!==this.props.gcid&&this.chatChanged()}},{key:"componentWillUnmount",value:function(){this.removeChatUpdated(),this.setGlobal({infoHeaderCenter:Q,ihcData:null}).then()}},{key:"render",value:function(){var e=this;return Object(v.jsxs)("div",{className:"h-100",children:[function(){if(!e.state.loaded)return Object(v.jsx)(it,{msg:"Chat wird geladen"})}(),function(){if(e.state.error===an)return Object(v.jsx)(kt,{});if(e.state.loaded)switch(e.state.error){case rn:switch(e.props.tab){case hn:return Object(v.jsx)(xt,{chatType:e.global.currentChat.type,chatId:e.global.currentChat.id});case dn:return Object(v.jsx)(sn,{gcid:e.state.gcid,data:e.state.chatData});default:return null}case on:return Object(v.jsx)(Nt,{gcid:e.state.gcid,onJoined:e.chatChanged});case un:return Object(v.jsx)(Mt,{});case cn:return Object(v.jsx)(Tt,{});case ln:return Object(v.jsx)(Et,{});default:return null}}()]})}}]),n}(i.Component),fn=(n(184),0),jn=1,bn=function(e){Object(b.a)(n,e);var t=Object(m.a)(n);function n(e){var s;return Object(f.a)(this,n),(s=t.call(this,e)).lastRequest={},s.searchChanged=function(e){s.setState({searchValue:e,searchResult:[],hasMore:!0})},s.loadChats=Object(d.a)(h.a.mark((function e(){var t,n,r,a;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=s.state.searchValue,n=s.state.searchResult.length,s.lastRequest.searchValue===t&&s.lastRequest.length===n){e.next=22;break}return s.lastRequest={searchValue:t,length:n},e.prev=4,e.next=7,s.props.loadChats(t,n);case 7:if(!(r=e.sent).ok){e.next=16;break}return e.next=11,r.json();case 11:0===(a=e.sent).length?s.setState({hasMore:!1}):s.setState((function(e){return{searchResult:e.searchResult.concat(a)}})),s.setState({error:fn}),e.next=17;break;case 16:s.setState({error:jn});case 17:e.next=22;break;case 19:e.prev=19,e.t0=e.catch(4),s.setState({error:jn});case 22:case"end":return e.stop()}}),e,null,[[4,19]])}))),s.state={error:fn,showOptions:!1,searchValue:"",searchResult:[],hasMore:!0},s}return Object(j.a)(n,[{key:"componentDidUpdate",value:function(e,t,n){this.props.showSearchBar||this.props.searchValue!==e.searchValue&&this.searchChanged(this.props.searchValue)}},{key:"render",value:function(){var e=this;return this.state.error===jn?Object(v.jsx)("div",{className:"alert alert-danger",role:"alert",children:"Ein Fehler ist aufgetreten!"},0):Object(v.jsxs)(I,{children:[this.props.showSearchBar?Object(v.jsx)("div",{className:"user-top",children:Object(v.jsx)("div",{className:"searchUser",children:Object(v.jsx)("input",{type:"text",name:"newChat-searchUser",className:"form-control",placeholder:"Benutzer suchen",onChange:function(t){e.searchChanged()}})})}):null,Object(v.jsx)("div",{className:"selectChat",ref:function(t){return e.scrollParentRef=t},children:Object(v.jsx)(Pt.a,{pageStart:0,loadMore:this.loadChats,hasMore:this.state.hasMore,loader:Object(v.jsx)("div",{className:"loader",children:Object(v.jsx)("div",{className:"spinner-border text-secondary",role:"status",children:Object(v.jsx)("span",{className:"sr-only",children:"Loading..."})})},-1),useWindow:!1,getScrollParent:function(){return e.scrollParentRef},children:Object(v.jsxs)("ul",{className:"selectChat",children:[this.state.searchResult.map((function(t,n){return e.props.renderItem(t,n)})),0===this.state.searchResult.length?Object(v.jsx)("div",{className:"nothingFound",children:"Nichts gefunden!"},-1):null]})})})]})}}]),n}(s.Component);function mn(e){return gn.apply(this,arguments)}function gn(){return(gn=Object(d.a)(h.a.mark((function e(t){var n;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(t)},e.next=3,me("/user/noChat",n);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function On(e){return vn.apply(this,arguments)}function vn(){return(vn=Object(d.a)(h.a.mark((function e(t){var n;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={method:"PUT",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(t)},e.next=3,me("/group/",n);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function xn(e){return yn.apply(this,arguments)}function yn(){return(yn=Object(d.a)(h.a.mark((function e(t){var n,s;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(t)},e.next=3,me("/user/",n);case 3:if(!(s=e.sent).ok){e.next=10;break}return e.next=7,s.json();case 7:return e.abrupt("return",e.sent);case 10:throw new Error("Error fetching users");case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function kn(e){return wn.apply(this,arguments)}function wn(){return(wn=Object(d.a)(h.a.mark((function e(t){var n;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(t)},e.next=3,me("/group/public/",n);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Cn=function(e){Object(b.a)(n,e);var t=Object(m.a)(n);function n(){var e;Object(f.a)(this,n);for(var s=arguments.length,r=new Array(s),a=0;a<s;a++)r[a]=arguments[a];return(e=t.call.apply(t,[this].concat(r))).elementClicked=function(t){rt.temporaryChat.createNew(e.props.uid,e.props.username)},e}return Object(j.a)(n,[{key:"render",value:function(){return Object(v.jsx)("li",{children:Object(v.jsx)(o.b,{to:"/chat/user/"+this.props.uid,onClick:this.elementClicked,replace:!0,children:this.props.username})})}}]),n}(s.Component),Sn=Object(u.j)(Cn),Nn=(n(101),n(185),0),Mn=function(e){Object(b.a)(n,e);var t=Object(m.a)(n);function n(e){var s;return Object(f.a)(this,n),(s=t.call(this,e)).newGroupClick=function(e){e.stopPropagation(),s.props.setCurrentTab(zn.newGroup)},s.joinGroupClick=function(e){e.stopPropagation(),s.props.setCurrentTab(zn.chooseGroup)},s.searchChanged=function(e){var t=e.target.value;s.setState({searchValue:t,searchValid:!0})},s.loadChats=function(){var e=Object(d.a)(h.a.mark((function e(t,n){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,mn({search:t,limit:10,start:n});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),s.state={error:Nn,searchValue:""},s}return Object(j.a)(n,[{key:"render",value:function(){var e=Object(v.jsx)("div",{className:"options",children:Object(v.jsxs)("ul",{children:[Object(v.jsx)("li",{onClick:this.newGroupClick,children:"neue Gruppe"}),Object(v.jsx)("li",{onClick:this.joinGroupClick,children:"einer Gruppe beitreten"})]})});return Object(v.jsxs)(I,{children:[Object(v.jsxs)("div",{className:"user-top",children:[Object(v.jsx)("div",{className:"searchUser",children:Object(v.jsx)("input",{type:"text",name:"newChat-searchUser",className:"form-control",placeholder:"Benutzer suchen",onChange:this.searchChanged})}),Object(v.jsx)("div",{className:"user-more",children:Object(v.jsx)(Yt.a,{trigger:["click"],overlay:e,animation:"slide-up",alignPoint:!0,children:Object(v.jsx)("i",{className:"fas fa-ellipsis-h fa-2x",role:"button"})})})]}),Object(v.jsx)(bn,{showSearchBar:!1,searchValue:this.state.searchValue,loadChats:this.loadChats,renderItem:function(e,t){return Object(v.jsx)(Sn,{uid:e.uid,username:e.username},t)}})]})}}]),n}(s.Component),Tn=function(e){Object(b.a)(n,e);var t=Object(m.a)(n);function n(){var e;Object(f.a)(this,n);for(var s=arguments.length,r=new Array(s),a=0;a<s;a++)r[a]=arguments[a];return(e=t.call.apply(t,[this].concat(r))).newChat=function(t){if(t.id===e.props.id){var n=rt.getChat("groupChat",e.props.id);e.dispatch.selectChat(n).then((function(){e.props.history.push("/chat/group/"+e.props.id),rt.event.rm("new chat",e.newChat)}))}},e.elementClicked=function(t){rt.event.on("new chat",e.newChat),jt(e.props.id).then((function(){})).catch((function(){}))},e}return Object(j.a)(n,[{key:"render",value:function(){return Object(v.jsx)("li",{children:Object(v.jsx)("span",{className:"item",onClick:this.elementClicked,children:this.props.name})})}}]),n}(i.Component),En=Object(u.j)(Tn),Un=(n(186),0),Dn=function(e){Object(b.a)(n,e);var t=Object(m.a)(n);function n(e){var s;return Object(f.a)(this,n),(s=t.call(this,e)).searchChanged=function(e){var t=e.target.value;s.setState({searchValue:t,searchValid:!0})},s.loadChats=function(){var e=Object(d.a)(h.a.mark((function e(t,n){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,kn({search:t,limit:10,start:n,isNotPart:!0});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),s.state={error:Un,searchValue:""},s}return Object(j.a)(n,[{key:"render",value:function(){return Object(v.jsxs)(I,{children:[Object(v.jsx)("div",{className:"chooseGroup-top",children:Object(v.jsx)("div",{className:"searchGroup",children:Object(v.jsx)("input",{type:"text",name:"newChat-searchGroup",className:"form-control",placeholder:"Gruppe suchen",onChange:this.searchChanged})})}),Object(v.jsx)(bn,{showSearchBar:!1,searchValue:this.state.searchValue,loadChats:this.loadChats,renderItem:function(e,t){return Object(v.jsx)(En,{id:e.id,name:e.name},t)}})]})}}]),n}(s.Component),Bn=(n(187),n.p+"static/media/placeholder.3c40b139.png"),In=function(e){Object(b.a)(n,e);var t=Object(m.a)(n);function n(e){var s;return Object(f.a)(this,n),(s=t.call(this,e)).groupNameChanged=function(e){s.setState({groupName:e.target.value})},s.descriptionChanged=function(e){s.setState({description:e.target.value})},s.isPublicChanged=function(){s.setState((function(e){return{isPublic:!e.isPublic}}))},s.formSubmitted=function(e){e.preventDefault(),""!==s.state.groupName&&s.props.submitGroup({name:s.state.groupName,description:s.state.description,isPublic:s.state.isPublic})},s.state={groupName:"",description:"",isPublic:!1},s}return Object(j.a)(n,[{key:"render",value:function(){return Object(v.jsx)("div",{className:"groupInfoForm",children:Object(v.jsxs)("form",{onSubmit:this.formSubmitted,children:[Object(v.jsx)("img",{style:{display:"none"},id:"groupImgInput1",src:Bn,alt:"Placeholder"}),Object(v.jsxs)("div",{className:"form-group",children:[Object(v.jsx)("label",{htmlFor:"exampleFormControlInput1",children:"Gruppenname"}),Object(v.jsx)("input",{type:"text",name:"groupName",className:"form-control",id:"input-groupName",placeholder:"Gruppenname",value:this.state.name,onChange:this.groupNameChanged,minLength:1})]}),Object(v.jsxs)("div",{className:"form-group",children:[Object(v.jsx)("label",{htmlFor:"description1",children:"Beschreibung"}),Object(v.jsx)("textarea",{className:"form-control",id:"description1",rows:"3",value:this.state.description,onChange:this.descriptionChanged})]}),Object(v.jsx)("div",{className:"form-group",children:Object(v.jsxs)("label",{className:"check-container",children:["\xf6ffentlicher chat",Object(v.jsx)("input",{type:"checkbox",checked:this.state.isPublic,onChange:this.isPublicChanged}),Object(v.jsx)("span",{className:"checkmark",children:Object(v.jsx)("i",{className:"fas fa-check"})})]})}),Object(v.jsx)("div",{className:"form-group",children:Object(v.jsx)("button",{type:"submit",className:"float-right btn btn-primary m-3",children:"Gruppe erstellen"})})]})})}}]),n}(s.Component),_n=0,An=1,Rn=function(e){Object(b.a)(n,e);var t=Object(m.a)(n);function n(e){var s;return Object(f.a)(this,n),(s=t.call(this,e)).showEnterChatInfo=function(e){s.setState({currentTab:An,selectedUsers:e})},s.submitGroup=function(e){for(var t=new Array(s.state.selectedUsers.length),n=0;n<s.state.selectedUsers.length;n++)t[n]={uid:s.state.selectedUsers[n].uid,username:s.state.selectedUsers[n].username,isAdmin:!1};s.createGroupChat(e,t).then((function(e){}))},s.createGroupChat=function(){var e=Object(d.a)(h.a.mark((function e(t,n){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,On({data:t,users:n});case 3:e.sent.ok&&s.props.history.goBack(),e.next=9;break;case 7:e.prev=7,e.t0=e.catch(0);case 9:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,n){return e.apply(this,arguments)}}(),s.loadUsers=function(){var e=Object(d.a)(h.a.mark((function e(t,n){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,xn({search:t,limit:10,start:n});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),s.state={currentTab:_n,selectedUsers:[]},s}return Object(j.a)(n,[{key:"render",value:function(){switch(this.state.currentTab){case _n:return Object(v.jsx)(Lt,{onNext:this.showEnterChatInfo,loadUsers:this.loadUsers});case An:return Object(v.jsx)(In,{submitGroup:this.submitGroup});default:return null}}}]),n}(s.Component),Pn=Object(u.j)(Rn),zn=(n(188),{chooseUser:0,newGroup:1,chooseGroup:2}),Fn=function(e){Object(b.a)(n,e);var t=Object(m.a)(n);function n(e){var s;return Object(f.a)(this,n),(s=t.call(this,e)).setCurrentTab=function(e){s.setState({currentTab:e})},s.state={currentTab:zn.chooseUser},s}return Object(j.a)(n,[{key:"render",value:function(){var e=this;return Object(v.jsxs)(I,{children:[Object(v.jsx)(It,{children:Object(v.jsx)("h1",{children:function(){switch(e.state.currentTab){case zn.chooseUser:return"Neuer Chat";case zn.newGroup:return"Neue Gruppe";case zn.chooseGroup:return"Gruppe ausw\xe4hlen";default:return"Neuer Chat"}}()})}),Object(v.jsx)(_t,{children:Object(v.jsx)("div",{className:"newChat",children:function(){switch(e.state.currentTab){case zn.chooseUser:return Object(v.jsx)(Mn,{setCurrentTab:e.setCurrentTab,hide:e.props.hide});case zn.newGroup:return Object(v.jsx)(Pn,{});case zn.chooseGroup:return Object(v.jsx)(Dn,{});default:return Object(v.jsx)(Mn,{setCurrentTab:e.setCurrentTab,hide:e.props.hide})}}()})})]})}}]),n}(s.Component),Gn=function(){var e=Object(d.a)(h.a.mark((function e(t){var n,s;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={method:"GET",headers:{Accept:"application/json"}},e.next=3,me("/user/"+t,n);case 3:if(!(s=e.sent).ok){e.next=10;break}return e.next=7,s.json();case 7:return e.abrupt("return",e.sent);case 10:throw new Error("Error fetching UserInfo");case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Ln=function(){var e=Object(d.a)(h.a.mark((function e(t){var n;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={method:"GET",headers:{Accept:"application/json"}},e.next=3,me("/user/block/"+t,n);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Vn=function(){var e=Object(d.a)(h.a.mark((function e(t){var n;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={method:"GET",headers:{Accept:"application/json"}},e.next=3,me("/user/unblock/"+t,n);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Hn=function(e){Object(b.a)(n,e);var t=Object(m.a)(n);function n(){var e;Object(f.a)(this,n);for(var s=arguments.length,r=new Array(s),a=0;a<s;a++)r[a]=arguments[a];return(e=t.call.apply(t,[this].concat(r))).blockUser=function(){Ln(e.props.uid).then((function(t){t.ok&&e.props.onBlockedBySelfChanged(!0)})).catch((function(){}))},e.unblockUser=function(){Vn(e.props.uid).then((function(t){t.ok&&e.props.onBlockedBySelfChanged(!1)})).catch((function(){}))},e}return Object(j.a)(n,[{key:"render",value:function(){return Object(v.jsx)("ul",{className:"userOptions",children:this.props.userInfo.blockedBySelf?Object(v.jsx)("li",{className:"noLink",onClick:this.unblockUser,children:"nicht mehr blockieren"}):Object(v.jsx)("li",{className:"noLink",onClick:this.blockUser,children:"blockieren"})})}}]),n}(s.Component),Jn=(n(189),0),Wn=1,qn=2,Yn=3,Zn=4,$n=function(e){Object(b.a)(n,e);var t=Object(m.a)(n);function n(e){var s;return Object(f.a)(this,n),(s=t.call(this,e)).isBlocked=function(){return s.state.userInfo.blockedBySelf||s.state.userInfo.blockedByOther},s.updateChat=function(){-1!==rt.users.getIndex(s.state.uid)&&rt.users.get(s.state.uid).updateChatBlockInfo(s.state.userInfo)},s.setUser=Object(d.a)(h.a.mark((function e(){var t,n;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!isNaN(s.props.uid)){e.next=4;break}s.setState({error:qn}),e.next=17;break;case 4:return t=parseInt(s.props.uid),s.setState({uid:t,error:Jn,loaded:!1}),e.prev=6,e.next=9,Gn(t);case 9:n=e.sent,rt.userSelf.uid===t?s.setState({error:Wn,loaded:!0}):n.userExists?s.setState({userInfo:n,loaded:!0}):s.setState({error:Yn,loaded:!0}),e.next=17;break;case 14:e.prev=14,e.t0=e.catch(6),s.setState({error:Zn,loaded:!0});case 17:case"end":return e.stop()}}),e,null,[[6,14]])}))),s.state={uid:0,loaded:!1,error:Jn,userInfo:null},s}return Object(j.a)(n,[{key:"render",value:function(){var e=this;return this.state.loaded?this.state.error===Wn?Object(v.jsxs)(I,{children:[Object(v.jsx)(It,{children:Object(v.jsx)("h1",{children:"Du"})}),Object(v.jsx)(_t,{children:"xx"})]}):this.state.error!==Jn?Object(v.jsx)("div",{children:"Error!"}):Object(v.jsxs)(I,{children:[Object(v.jsx)(It,{children:Object(v.jsxs)("h1",{children:[this.state.userInfo.username,"\xa0",Object(v.jsx)(o.b,{to:"/chat/user/"+this.state.uid,children:Object(v.jsx)("i",{className:"far fa-comment-alt"})}),"\xa0\xa0",Object(v.jsx)(Yt.a,{trigger:["hover","click"],overlay:Object(v.jsx)(Hn,{uid:this.state.uid,userInfo:this.state.userInfo,onBlockedBySelfChanged:function(t){e.setState((function(e){return{userInfo:Object(k.a)(Object(k.a)({},e.userInfo),{},{blockedBySelf:t})}})),e.updateChat()}}),children:Object(v.jsx)("i",{className:"fas fa-ellipsis-v user-options-btn ",role:"button"})})]})}),Object(v.jsx)(_t,{children:Object(v.jsxs)("div",{className:"userInfo",children:[this.state.userInfo.blockedByOther?Object(v.jsxs)("div",{className:"error",children:["Du wurdest von ",this.state.userInfo.username," blockiert"]}):null,this.state.userInfo.blockedBySelf?Object(v.jsxs)("div",{className:"error",children:["Du hast ",this.state.userInfo.username," blockiert"]}):null,this.isBlocked()?null:this.state.userInfo.groups.length>0?Object(v.jsxs)(I,{children:[Object(v.jsxs)("h3",{children:[this.state.userInfo.groups.length," gemeinsame Gruppen:"]}),Object(v.jsx)("ul",{className:"groupList",children:this.state.userInfo.groups.map((function(e,t){return Object(v.jsx)("li",{children:Object(v.jsx)(o.b,{to:"/chat/group/"+e.id,children:e.chatName})},t)}))})]}):Object(v.jsx)("h3",{children:"keine gemeinsamen Gruppen"})]})})]}):null}},{key:"componentDidMount",value:function(){var e=Object(d.a)(h.a.mark((function e(){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.setUser();case 3:e.next=8;break;case 5:e.prev=5,e.t0=e.catch(0),this.setState({error:4,loaded:!0});case 8:case"end":return e.stop()}}),e,this,[[0,5]])})));return function(){return e.apply(this,arguments)}}()},{key:"componentDidUpdate",value:function(){var e=Object(d.a)(h.a.mark((function e(t,n,s){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,t.uid===this.props.uid){e.next=4;break}return e.next=4,this.setUser();case 4:e.next=9;break;case 6:e.prev=6,e.t0=e.catch(0),this.setState({error:4,loaded:!0});case 9:case"end":return e.stop()}}),e,this,[[0,6]])})));return function(t,n,s){return e.apply(this,arguments)}}()}]),n}(s.Component),Kn=(n(190),function(){var e=Object(d.a)(h.a.mark((function e(){var t,n;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={method:"GET",headers:{Accept:"application/json"}},e.next=3,me("/user/self",t);case 3:if(!(n=e.sent).ok){e.next=10;break}return e.next=7,n.json();case 7:return e.abrupt("return",e.sent);case 10:throw new Error("Error requesting user info!");case 11:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()),Qn=function(){var e=Object(d.a)(h.a.mark((function e(t){var n;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(t)},e.next=3,me("/user/setEmail",n);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();function Xn(e){return es.apply(this,arguments)}function es(){return(es=Object(d.a)(h.a.mark((function e(t){var n,s,r;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,me("/push/vapidPublicKey",{method:"get"},t);case 2:return n=e.sent,e.next=5,n.text();case 5:return s=e.sent,r=ns(s),e.next=9,navigator.serviceWorker.register("/push-service-worker.js");case 9:navigator.serviceWorker.ready.then((function(e){e.pushManager?e.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:r}).then((function(e){return me("/push/register",{method:"post",headers:{"Content-type":"application/json"},body:JSON.stringify({subscription:e})},t)})).catch((function(e){return console.error("Push subscription error: ",e)})):console.log("Push Unsupported")})).catch((function(e){console.error(e.message,e)}));case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ts(){navigator.serviceWorker&&navigator.serviceWorker.ready.then((function(e){e.pushManager.getSubscription().then((function(e){e&&e.unsubscribe().then((function(){})).catch((function(e){return console.error(e)}))})).catch((function(e){return console.error(e)}))}))}function ns(e){for(var t=(e+"=".repeat((4-e.length%4)%4)).replace(/\-/g,"+").replace(/_/g,"/"),n=window.atob(t),s=new Uint8Array(n.length),r=0;r<n.length;++r)s[r]=n.charCodeAt(r);return s}var ss=function(e){Object(b.a)(n,e);var t=Object(m.a)(n);function n(e){var s;Object(f.a)(this,n),(s=t.call(this,e)).setNotifications=function(){s.setState((function(e){var t={permissions:Object(k.a)(Object(k.a)({},e.permissions),{},{notifications:!e.permissions.notifications})};return t.permissions.notifications?(Notification.requestPermission().then((function(e){"granted"!==e&&s.setState((function(e){var t={permissions:Object(k.a)(Object(k.a)({},e.permissions),{},{notifications:!1})};return s.setPermissions(t.permissions),t}))})),s.subscribed||(Xn(s.global.authTokens).then((function(){})),s.subscribed=!0)):(s.subscribed=!1,ts()),s.setPermissions(t.permissions),t}))},s.setPermissions=function(e){localStorage.setItem("permissions",JSON.stringify(e))};var r,a=localStorage.getItem("permissions");return null===a?(r={notifications:!1},localStorage.setItem("permissions",JSON.stringify(r))):r=JSON.parse(a),s.state={permissions:r},s.subscribed=r.notifications,s}return Object(j.a)(n,[{key:"render",value:function(){return Object(v.jsxs)("div",{children:[Object(v.jsx)("h4",{children:"Berechtigungen"}),Object(v.jsx)("span",{children:"Benachrichtigungen"}),"\xa0",Object(v.jsxs)("label",{className:"switch",children:[Object(v.jsx)("input",{type:"checkbox",checked:this.state.permissions.notifications,onChange:this.setNotifications}),Object(v.jsx)("span",{className:"slider round"})]})]})}}]),n}(i.Component),rs=function(e){Object(b.a)(n,e);var t=Object(m.a)(n);function n(e){var s;return Object(f.a)(this,n),(s=t.call(this,e)).changeEmail=function(e){s.state.userDataSelf.email!==e&&Qn({email:e}).then(function(){var e=Object(d.a)(h.a.mark((function e(t){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(200!==t.status){e.next=7;break}return e.next=3,t.json();case 3:e.sent.emailTaken?s.setState({emailChangeRequested:!1,setEmailError:!0,setEmailErrorMessage:"E-Mail wird bereits verwendet!"}):s.setState({setEmailError:!1,emailChangeRequested:!0}),e.next=8;break;case 7:s.setState({setEmailError:!0,setEmailErrorMessage:"Fehler beim Versenden der E-Mail!",emailChangeRequested:!1});case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).catch((function(e){s.setState({setEmailError:!0,setEmailErrorMessage:"Fehler beim Versenden der E-Mail!",emailChangeRequested:!1})}))},s.state={userDataSelf:null,loaded:!1,error:!1,emailChangeRequested:!1,setEmailError:!1,setEmailErrorMessage:""},s}return Object(j.a)(n,[{key:"render",value:function(){return Object(v.jsxs)(I,{children:[Object(v.jsx)(It,{children:Object(v.jsx)("h1",{children:"Einstellungen"})}),Object(v.jsx)(_t,{children:this.state.loaded?Object(v.jsxs)("div",{className:"settings",children:[Object(v.jsxs)("span",{className:"settings-header",children:["E-Mail Addresse: ",Object(v.jsx)("br",{})]}),Object(v.jsx)(Qt,{className:"email",value:this.state.userDataSelf.email,onChange:this.changeEmail,children:""===this.state.userDataSelf.email?"Noch keine E-Mail Addresse!":this.state.userDataSelf.email}),this.state.emailChangeRequested?Object(v.jsxs)(I,{children:["\xa0",Object(v.jsx)("span",{className:"emailChanged",children:"E-Mail mit Verifizierungslink wurde versendet!"})]}):null,this.state.setEmailError?Object(v.jsxs)(I,{children:["\xa0",Object(v.jsx)("span",{className:"set-email-error",children:this.state.setEmailErrorMessage})]}):null,Object(v.jsx)("div",{className:"settings-about",children:Object(v.jsx)(o.b,{to:"/about",children:"\xfcber diese Seite"})}),Object(v.jsx)(ss,{})]}):this.state.error?Object(v.jsx)("span",{className:"error",children:"ein Fehler ist aufgetreten!"}):Object(v.jsx)("span",{className:"loading",children:"laden..."})})]})}},{key:"componentDidMount",value:function(){var e=Object(d.a)(h.a.mark((function e(){var t;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Kn();case 3:t=e.sent,this.setState({loaded:!0,userDataSelf:t}),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),this.setState({error:!0});case 10:case"end":return e.stop()}}),e,this,[[0,7]])})));return function(){return e.apply(this,arguments)}}()}]),n}(s.Component);function as(e){var t=Object(u.i)().path;return Object(v.jsxs)(u.d,{children:[Object(v.jsxs)(u.b,{path:"".concat(t,"/newChat"),children:[e.children,Object(v.jsx)(Bt,{children:Object(v.jsx)(Fn,{})})]}),Object(v.jsx)(u.b,{path:"".concat(t,"/userInfo/:uidInfo"),render:function(t){return Object(v.jsxs)(I,{children:[e.children,Object(v.jsx)(Bt,{children:Object(v.jsx)($n,{uid:t.match.params.uidInfo})})]})}}),Object(v.jsxs)(u.b,{path:"".concat(t,"/settings"),children:[e.children,Object(v.jsx)(Bt,{children:Object(v.jsx)(rs,{})})]}),Object(v.jsx)(u.b,{path:"*",children:e.children})]})}function cs(e){var t=Object(u.i)().path;return Object(v.jsxs)("div",{className:"main-container",children:[Object(v.jsx)("div",{className:"mc-left",children:Object(v.jsx)(ct,{})}),Object(v.jsx)("div",{className:"mc-right",children:Object(v.jsxs)(u.d,{children:[Object(v.jsx)(u.b,{path:"".concat(t,"/user/:uid"),render:function(e){return Object(v.jsx)(as,{children:Object(v.jsx)(Ut,{uid:e.match.params.uid})})}}),Object(v.jsx)(u.b,{path:"".concat(t,"/group/:gcid"),render:function(e){return Object(v.jsx)(as,{children:Object(v.jsx)(pn,{gcid:e.match.params.gcid,tab:hn})})}}),Object(v.jsx)(u.b,{path:"".concat(t,"/groupInfo/:gcid"),render:function(e){return Object(v.jsx)(as,{children:Object(v.jsx)(pn,{gcid:e.match.params.gcid,tab:dn})})}}),Object(v.jsx)(u.b,{path:t,children:Object(v.jsx)(as,{children:Object(v.jsx)("h1",{children:"noch kein chat ausgew\xe4hlt"})})})]})})]})}n(191);var is=function(e){Object(b.a)(n,e);var t=Object(m.a)(n);function n(e){var s;return Object(f.a)(this,n),(s=t.call(this,e)).typeStateChanged=function(){var e=rt.getChat(s.props.chatType,s.props.chatId);s.setState({usersTyping:e.getUsersTyping()})},s.state={usersTyping:[]},s}return Object(j.a)(n,[{key:"render",value:function(){return Object(v.jsx)("div",{className:"typeMsg-container",children:this.state.usersTyping.map((function(e,t){return Object(v.jsx)("div",{className:"typeMsg",children:e.username+" schreibt..."},t)}))})}},{key:"componentDidMount",value:function(){rt.getChat(this.props.chatType,this.props.chatId).event.on("typeState changed",this.typeStateChanged)}},{key:"componentDidUpdate",value:function(e,t,n){e.chatType===this.props.chatType&&e.chatId===this.props.chatId||(rt.getChat(e.chatType,e.chatId).event.rm("typeState changed",this.typeStateChanged),rt.getChat(this.props.chatType,this.props.chatId).event.on("typeState changed",this.typeStateChanged))}},{key:"componentWillUnmount",value:function(){rt.getChat(this.props.chatType,this.props.chatId).event.rm("typeState changed",this.typeStateChanged)}}]),n}(s.Component);function os(e){var t=Object(u.i)().path;return Object(v.jsxs)(u.d,{children:[Object(v.jsx)(u.b,{path:"".concat(t,"/newChat"),children:Object(v.jsx)(Fn,{})}),Object(v.jsx)(u.b,{path:"".concat(t,"/userInfo/:uidInfo"),render:function(e){return Object(v.jsx)($n,{uid:e.match.params.uidInfo})}}),Object(v.jsx)(u.b,{path:"".concat(t,"/settings"),children:Object(v.jsx)(rs,{})}),Object(v.jsx)(u.b,{path:"*",children:e.children})]})}function us(e){var t=Object(u.i)().path,n=Object(i.useGlobal)(),s=Object(z.a)(n,2),r=s[0],a=(s[1],function(){return""!==r.currentChat.type&&0!==r.currentChat.id?Object(v.jsx)(is,{chatType:r.currentChat.type,chatId:r.currentChat.id}):null});return Object(v.jsxs)(u.d,{children:[Object(v.jsx)(u.b,{path:"".concat(t,"/user/:uid"),render:function(e){return Object(v.jsxs)(os,{children:[Object(v.jsx)("div",{className:"main-container",children:Object(v.jsx)(Ut,{uid:e.match.params.uid})}),a()]})}}),Object(v.jsx)(u.b,{path:"".concat(t,"/group/:gcid"),render:function(e){return Object(v.jsxs)(os,{children:[Object(v.jsx)("div",{className:"main-container",children:Object(v.jsx)(pn,{gcid:e.match.params.gcid,tab:hn})}),a()]})}}),Object(v.jsx)(u.b,{path:"".concat(t,"/groupInfo/:gcid"),render:function(e){return Object(v.jsx)(os,{children:Object(v.jsx)(pn,{gcid:e.match.params.gcid,tab:dn})})}}),Object(v.jsx)(u.b,{path:t,children:Object(v.jsx)(os,{children:Object(v.jsx)("div",{className:"chat-list-outer-small",children:Object(v.jsx)(ct,{})})})}),Object(v.jsx)(u.b,{path:"*",children:Object(v.jsx)("h3",{children:"Not found!"})})]})}n(192);var ls=function(e){Object(b.a)(n,e);var t=Object(m.a)(n);function n(e){var s;return Object(f.a)(this,n),(s=t.call(this,e)).state={modal:0,modalInfo:null,notifications:0},s}return Object(j.a)(n,[{key:"componentDidMount",value:function(){rt.initCalled||rt.init().then((function(e){}))}},{key:"render",value:function(){return Object(v.jsxs)("div",{className:"h-100",children:[Object(v.jsx)(ie,{}),Object(v.jsx)(K,{displayIn:["Mobile"],children:Object(v.jsx)(us,{})}),Object(v.jsx)(K,{displayIn:["Laptop","Tablet"],children:Object(v.jsx)(cs,{})})]})}}]),n}(s.Component);n(193);function hs(){return Object(v.jsxs)("div",{className:"about",children:[Object(v.jsx)("h2",{children:"\xdcber diese Seite"}),Object(v.jsx)("h4",{children:"Erstellt von:"}),"Stefan Schlaghuber",Object(v.jsx)("br",{}),"2002 Gro\xdfmugl",Object(v.jsx)("br",{}),"stefan.schlaghuber@gmail.com",Object(v.jsx)("br",{})]})}n(194),n(195);function ds(e){return ps.apply(this,arguments)}function ps(){return(ps=Object(d.a)(h.a.mark((function e(t){var n;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={method:"GET",headers:{Accept:"application/json"}},e.next=3,me("/user/self",n,t);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function fs(){Object(i.addReducer)("deleteAuthTokens",(function(e,t){return localStorage.removeItem("authTokens"),ts(),location.reload(),t.deleteUserSelf(),t.resetGlobal(),st.destruct(),st=new nt,{loaded:!0,authTokens:void 0}})),Object(i.addReducer)("initAuthTokens",function(){var e=Object(d.a)(h.a.mark((function e(t,n,s){var r,a,c,i,o;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Re();case 3:return e.next=5,ds(s);case 5:if(403!==(r=e.sent).status){e.next=11;break}return localStorage.removeItem("authTokens"),e.abrupt("return",{loaded:!0,authTokens:void 0});case 11:if(null===(a=JSON.parse(localStorage.getItem("permissions")))||!a.notifications){e.next=17;break}return e.next=15,Xn(s);case 15:e.next=18;break;case 17:ts();case 18:return e.next=20,r.json();case 20:return c=e.sent,i=c.uid,o=c.username,n.setUserSelf(i,o),e.abrupt("return",{loaded:!0,authTokens:s});case 24:e.next=30;break;case 26:return e.prev=26,e.t0=e.catch(0),console.error(e.t0),e.abrupt("return",{loaded:!1});case 30:case"end":return e.stop()}}),e,null,[[0,26]])})));return function(t,n,s){return e.apply(this,arguments)}}()),Object(i.addReducer)("setAuthTokens",function(){var e=Object(d.a)(h.a.mark((function e(t,n,s){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return localStorage.setItem("authTokens",JSON.stringify(s)),e.next=3,Xn(s);case 3:return e.abrupt("return",{loaded:!0,authTokens:s});case 4:case"end":return e.stop()}}),e)})));return function(t,n,s){return e.apply(this,arguments)}}())}var js=function(e){Object(b.a)(n,e);var t=Object(m.a)(n);function n(e){var s;return Object(f.a)(this,n),(s=t.call(this,e)).changeHandler=function(e){var t=e.target.name,n=e.target.value;s.setState(Object(p.a)({},t,n))},s.submitHandler=function(e){e.preventDefault();var t=O()({password:s.state.password,passwordRepeat:s.state.passwordRepeat},{password:{presence:!0,length:{minimum:8,tooShort:"Passwort muss mindestens 8 Zeichen lang sein",maximum:50,tooLong:"Passwort darf h\xf6chstens 50 Zeichen lang sein"}},passwordRepeat:{presence:!0,equality:"password",length:{minimum:8,tooShort:"Passwort muss mindestens 8 Zeichen lang sein",maximum:50,tooLong:"Passwort darf h\xf6chstens 50 Zeichen lang sein"}}});if("undefined"!=typeof t){var n;"undefined"!=typeof t.password?n=t.password[0]:"undefined"!=typeof t.passwordRepeat&&(n="Passw\xf6rter stimmen nicht \xfcberein!"),n=n.replace("Username ","").replace("Password ",""),s.setState({error:!0,errorMessage:n})}else{var r=s.state.password;E(s.props.verificationCode,r).then((function(e){200===e.status?s.setState({error:!1,passwordResetSuccess:!0}):403===e.status?s.setState({error:!0,errorMessage:"Fehler: Dieser Link ist ung\xfcltig!"}):s.setState({error:!0,errorMessage:"ein Fehler ist aufgetreten"})})).catch((function(e){s.setState({error:!0,errorMessage:"ein Fehler ist aufgetreten"})}))}},s.errorMessage=function(){if(s.state.error)return Object(v.jsx)(x,{children:s.state.errorMessage})},s.successMessage=function(){if(s.state.passwordResetSuccess)return Object(v.jsx)(y,{children:"Passwort erfolgreich zur\xfcckgesetzt!"})},s.componentDidMount=function(){T(s.props.verificationCode).then((function(e){200!==e.status&&s.setState({linkValid:!1})})).catch((function(e){s.setState({linkValid:!1})}))},s.state={linkValid:!0,error:!1,errorMessage:"",password:"",passwordRepeat:"",passwordResetSuccess:!1},s}return Object(j.a)(n,[{key:"render",value:function(){return this.state.linkValid?Object(v.jsx)("div",{className:"h-100",style:{display:"flex",overflowY:"auto"},children:Object(v.jsx)("div",{className:"col-sm-12 my-auto",children:Object(v.jsxs)("div",{className:"container border rounded p-3",style:{maxWidth:"800px"},children:[Object(v.jsx)(B,{}),Object(v.jsx)("h1",{children:"neues Passwort eingeben"}),this.errorMessage(),Object(v.jsxs)("form",{onSubmit:this.submitHandler,children:[Object(v.jsxs)("div",{className:"form-group",children:[Object(v.jsx)("label",{htmlFor:"password",children:"Passwort:"}),Object(v.jsx)(w,{name:"password",className:"form-control",placeholder:"Passwort eingeben",onChange:this.changeHandler})]}),Object(v.jsxs)("div",{className:"form-group",children:[Object(v.jsx)("label",{htmlFor:"passwordRepeat",children:"Passwort wiederholen:"}),Object(v.jsx)(w,{name:"passwordRepeat",className:"form-control",placeholder:"Passwort eingeben",onChange:this.changeHandler})]}),this.successMessage(),Object(v.jsx)("input",{type:"submit",className:"btn btn-primary",value:"Passwort zur\xfccksetzen"})]})]})})}):Object(v.jsx)(x,{children:"Ung\xfcltiger Link!"})}}]),n}(i.Component);function bs(){var e=Object(i.useDispatch)();return Object(i.useEffect)((function(){var t=JSON.parse(localStorage.getItem("authTokens"));e.initAuthTokens(t)}),[]),Object(v.jsx)(o.a,{children:Object(v.jsxs)(u.d,{children:[Object(v.jsx)(G,{path:"/chat",component:ls}),Object(v.jsx)(u.b,{exact:!0,path:"/login",component:D}),Object(v.jsx)(u.b,{exact:!0,path:"/register",component:A}),Object(v.jsx)(u.b,{path:"/verifyEmail/:code",render:function(e){return Object(v.jsx)(R,{verificationCode:e.match.params.code})}}),Object(v.jsx)(u.b,{exact:!0,path:"/forgotPassword",component:P}),Object(v.jsx)(u.b,{path:"/resetPassword/:code",render:function(e){return Object(v.jsx)(js,{verificationCode:e.match.params.code})}}),Object(v.jsx)(u.b,{path:"/about",children:Object(v.jsx)(hs,{})}),Object(v.jsx)(u.b,{exact:!0,path:"/",children:Object(v.jsx)(u.a,{to:"/chat"})}),Object(v.jsx)(u.b,{path:"*",children:Object(v.jsx)(ms,{})})]})})}function ms(){var e=Object(u.h)();return Object(v.jsx)("div",{children:Object(v.jsxs)("h3",{children:["No match for ",Object(v.jsx)("code",{children:e.pathname})]})})}Object(i.setGlobal)({loaded:!1,authTokens:void 0,userSelf:{},infoHeaderCenter:Q,ihcData:null,currentChat:{type:"",id:0,chatName:"",newMessages:0,messages:[],isStillMember:!0,blockedBySelf:!1,blockedByOther:!1},tempChat:null,chats:[],newMessages:0}),function(){function e(e){Object(i.setGlobal)({chats:e})}rt.finishedLoading?e(rt.getChatArraySortedByDate()):rt.event.on("chats loaded",e)}(),Object(i.addReducer)("setUserSelf",(function(e,t,n,s){return{userSelf:{uid:n,username:s}}})),Object(i.addReducer)("deleteUserSelf",(function(e,t){return{userSelf:{}}})),Object(i.addReducer)("resetGlobal",(function(e,t){return{infoHeaderCenter:Q,ihcData:null,currentChat:{type:"",id:0,chatName:"",newMessages:0,messages:[],isStillMember:!0,blockedBySelf:!1,blockedByOther:!1},tempChat:null,chats:[],newMessages:0}})),function(){var e=this;function t(e,t){return e.chats.findIndex((function(e){return e.id===t.id&&e.type===t.type}))}Object(i.addReducer)("newMsg",(function(e,n,s,r,a){var c=t(e,s);if(-1!==c){if(function(e,t){var n=e.currentChat;return n.type===t.type&&n.id===t.id}(e,s)){var i=e.chats.splice(0),o=i[c];return o.latestMessage=s.getLatestMessageObject(),o.unreadMessages=0,i.splice(c,1),i.unshift(o),{chats:i,currentChat:Object(k.a)(Object(k.a)({},e.currentChat),{},{messages:e.currentChat.messages.concat(a),newMessages:e.currentChat.newMessages+1})}}var u=e.chats.splice(0),l=u[c];l.latestMessage=s.getLatestMessageObject();var h=e.newMessages;return 0===l.unreadMessages&&h++,l.unreadMessages=r+1,u.splice(c,1),u.unshift(l),{chats:u,newMessages:h}}})),Object(i.addReducer)("updateChat",(function(e,n,s){var r=t(e,s);if(-1!==r){var a=e.chats.splice(0);a.splice(r,1);var c=s.getChatObject();return a.unshift(c),rt.isCurrentChat(s.type,s.id)?{infoHeaderCenter:ee,ihcData:{name:s.chatName,gcid:s.id},chats:a}:{chats:a}}})),Object(i.addReducer)("selectChat",(function(e,n,s){var r=t(e,s);if(-1!==r){var a=e.chats.splice(0),c=a[r],i=e.newMessages;return c.unreadMessages>0&&i--,c.unreadMessages=0,s.unreadMessages=0,a[r]=c,rt.socket.emit("change chat",{type:s.type,id:s.id}),{currentChat:{type:s.type,id:s.id,chatName:s.chatName,messages:s.getMessages(),newMessages:0,isStillMember:"groupChat"!==s.type||s.isStillMember,blockedBySelf:s.isBlockedBySelf(),blockedByOther:s.isBlockedByOther()},chats:a,tempChat:null,newMessages:i}}})),Object(i.addReducer)("selectNoChat",(function(e,t){return rt.socket.emit("change chat",null),{currentChat:{type:"",id:0,chatName:"",messages:[],newMessages:0,isStillMember:!0,blockedBySelf:!1,blockedByOther:!1}}})),Object(i.addReducer)("addLoadedMessages",(function(e,t,n){return{currentChat:Object(k.a)(Object(k.a)({},e.currentChat),{},{messages:n?n.concat(e.currentChat.messages):e.currentChat.messages})}})),Object(i.addReducer)("addChat",(function(e,t,n){var s=e.chats.splice(0),r=n.getChatObject();if(0===s.length)return{chats:[r]};for(var a,c,i=!1,o=0;o<s.length;o++)if(c=r,!(a=s[o]).latestMessage||c.latestMessage&&a.latestMessage.date.getTime()<c.latestMessage.date.getTime()){s.splice(o,0,r),i=!0;break}return i||s.push(r),{chats:s}})),Object(i.addReducer)("removeChat",(function(n,s,r){var a=t(n,r),c=e.state.chats.splice(0);return c.splice(a,1),{chats:c}})),Object(i.addReducer)("showTempChat",(function(e,t){var n=rt.temporaryChat.chatNow;return rt.socket.emit("change chat",null),{tempChat:n.getChatObject(),currentChat:{type:"tempChat",id:0,chatName:"",messages:[],isStillMember:!0,blockedBySelf:!1,blockedByOther:!1}}})),Object(i.addReducer)("updateTempChat",(function(e,t,n){return{tempChat:n.getChatObject(),currentChat:{type:"tempChat",id:0,chatName:"",messages:[],isStillMember:!0,blockedBySelf:!1,blockedByOther:!1}}})),Object(i.addReducer)("hideTempChat",(function(e,t){return{tempChat:null}}))}(),fs(),c.a.render(Object(v.jsx)(r.a.StrictMode,{children:Object(v.jsx)(bs,{})}),document.getElementById("root"))}},[[196,1,2]]]);
//# sourceMappingURL=main.d88f9924.chunk.js.map