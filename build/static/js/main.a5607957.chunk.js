(this.webpackJsonpchat_client=this.webpackJsonpchat_client||[]).push([[0],{138:function(e,t,n){},143:function(e,t,n){},145:function(e,t,n){},146:function(e,t,n){},177:function(e,t,n){},178:function(e,t,n){},179:function(e,t,n){},182:function(e,t,n){},183:function(e,t,n){},184:function(e,t,n){},186:function(e,t,n){},211:function(e,t,n){},212:function(e,t,n){},214:function(e,t,n){},215:function(e,t,n){},216:function(e,t,n){},217:function(e,t,n){},218:function(e,t,n){},219:function(e,t,n){},220:function(e,t,n){},222:function(e,t,n){},223:function(e,t,n){"use strict";n.r(t);var s=n(0),r=n(1),a=n.n(r),c=n(18),i=n.n(c),o=n(9),u=n(10),h=n(14),l=n(38),d=n(4),p=n(5),j=n(6),f=n(7),b=n(56),m=n.n(b),g=function(e){Object(j.a)(n,e);var t=Object(f.a)(n);function n(){return Object(d.a)(this,n),t.apply(this,arguments)}return Object(p.a)(n,[{key:"render",value:function(){return Object(s.jsx)("small",{className:"alert alert-danger p-1 message d-block",children:this.props.children})}}]),n}(r.Component),O=n(19),v=(n(138),function(e){Object(j.a)(n,e);var t=Object(f.a)(n);function n(e){var s;return Object(d.a)(this,n),(s=t.call(this,e)).state={showPassword:!1},s}return Object(p.a)(n,[{key:"render",value:function(){var e=this;return Object(s.jsxs)("div",{className:"psw-group",children:[Object(s.jsx)("i",{className:(this.state.showPassword?"fa-eye-slash":"fa-eye")+" fas psw-toggle-icon",onClick:function(){return e.setState((function(e){return{showPassword:!e.showPassword}}))}}),Object(s.jsx)("input",Object(O.a)({type:this.state.showPassword?"text":"password"},this.props))]})}}]),n}(r.Component)),x=n(3),y=n.n(x),k=n(8),w=function(){var e=Object(k.a)(y.a.mark((function e(t,n){var s,r,a;return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,s={method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({username:t,password:n})},e.next=4,fetch("/auth/login",s);case 4:if(!(r=e.sent).ok){e.next=13;break}return e.next=8,r.json();case 8:return(a=e.sent).success&&(Object(o.getDispatch)().setUserSelf(a.uid,t),Object(o.getDispatch)().setAuthTokens(a.tokens)),e.abrupt("return",a);case 13:return e.abrupt("return",null);case 14:e.next=19;break;case 16:return e.prev=16,e.t0=e.catch(0),e.abrupt("return",null);case 19:case"end":return e.stop()}}),e,null,[[0,16]])})));return function(t,n){return e.apply(this,arguments)}}(),C=function(){var e=Object(k.a)(y.a.mark((function e(t,n){var s,r,a;return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,s={method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({username:t,password:n})},e.next=4,fetch("/auth/register",s);case 4:if(!(r=e.sent).ok){e.next=13;break}return e.next=8,r.json();case 8:return(a=e.sent).success&&(Object(o.getDispatch)().setUserSelf(a.uid,t),Object(o.getDispatch)().setAuthTokens(a.tokens)),e.abrupt("return",a);case 13:return e.abrupt("return",null);case 14:e.next=19;break;case 16:return e.prev=16,e.t0=e.catch(0),e.abrupt("return",null);case 19:case"end":return e.stop()}}),e,null,[[0,16]])})));return function(t,n){return e.apply(this,arguments)}}(),N=function(e){Object(j.a)(n,e);var t=Object(f.a)(n);function n(e){var r;return Object(d.a)(this,n),(r=t.call(this,e)).changeHandler=function(e){var t=e.target.name,n=e.target.value;r.setState(Object(l.a)({},t,n))},r.submitHandler=function(e){e.preventDefault();var t,n,s={username:{presence:!0,length:{minimum:3,tooShort:"has to be at least 3 characters long",maximum:30,tooLong:"can only be 30 characters long"},format:{pattern:new RegExp(/^\w\w*$/),message:"not valid"}},password:{presence:!0,length:{minimum:8,tooShort:"has to be at least 8 characters long",maximum:30,tooLong:"can only be 30 characters long"}}},a=m()({username:r.state.username,password:r.state.password},s);"undefined"!=typeof a?(t="undefined"!=typeof a.username?a.username[0]:"",n="undefined"!=typeof a.password?a.password[0]:"",r.setState({valid:!1,uNameErr:t,pwErr:n})):(r.setState({valid:!0,uNameErr:"",pwErr:""}),w(r.state.username,r.state.password).then((function(e){e.success?r.props.history.push("/chat"):(void 0!==e.username&&r.setState({valid:!1,uNameErr:e.username}),void 0!==e.password&&r.setState({valid:!1,pwErr:e.password}))})))},r.uNameErr=function(){if(""!==r.state.uNameErr)return Object(s.jsx)(g,{children:r.state.uNameErr})},r.pwErr=function(){if(""!==r.state.pwErr)return Object(s.jsx)(g,{children:r.state.pwErr})},r.state={uNameErr:"",username:"",pwErr:"",password:"",valid:!1,redirect:!1},r}return Object(p.a)(n,[{key:"render",value:function(){return Object(s.jsx)("div",{className:"h-100",style:{display:"flex"},children:Object(s.jsx)("div",{className:"col-sm-12 my-auto",children:Object(s.jsxs)("div",{className:"container border rounded p-3",style:{maxWidth:"800px"},children:[Object(s.jsx)("h1",{children:"Login"}),Object(s.jsxs)("form",{onSubmit:this.submitHandler,children:[Object(s.jsxs)("div",{className:"form-group",children:[Object(s.jsx)("label",{htmlFor:"username",children:"Benutzername:"}),this.uNameErr(),Object(s.jsx)("input",{type:"text",name:"username",className:"form-control",placeholder:"Benutzernamen eingeben",onChange:this.changeHandler})]}),Object(s.jsxs)("div",{className:"form-group",children:[Object(s.jsx)("label",{htmlFor:"password",children:"Passwort:"}),this.pwErr(),Object(s.jsx)(v,{name:"password",className:"form-control",placeholder:"Passwort eingeben",onChange:this.changeHandler})]}),Object(s.jsxs)("div",{className:"form-group",children:["haben Sie noch keinen Account? ",Object(s.jsx)(u.b,{to:"/register",children:"Jetzt registrieren"})]}),Object(s.jsx)("input",{type:"submit",className:"btn btn-primary",value:"Login"})]})]})})})}}]),n}(o.Component),S=Object(h.j)(N),T=function(e){Object(j.a)(n,e);var t=Object(f.a)(n);function n(e){var r;return Object(d.a)(this,n),(r=t.call(this,e)).changeHandler=function(e){var t=e.target.name,n=e.target.value;r.setState(Object(l.a)({},t,n))},r.submitHandler=function(e){e.preventDefault();var t,n,s,a={username:{presence:!0,length:{minimum:3,tooShort:"has to be at least 3 characters long",maximum:30,tooLong:"can only be 30 characters long"},format:{pattern:new RegExp(/^\w\w*$/),message:"not valid"}},password:{presence:!0,length:{minimum:8,tooShort:"has to be at least 8 characters long",maximum:30,tooLong:"can only be 30 characters long"}},passwordRepeat:{presence:!0,equality:"password",length:{minimum:8,tooShort:"has to be at least 8 characters long",maximum:30,tooLong:"can only be 30 characters long"}}},c=m()({username:r.state.username,password:r.state.password,passwordRepeat:r.state.pwRepeat},a);"undefined"!=typeof c?(t="undefined"!=typeof c.username?c.username[0]:"",n="undefined"!=typeof c.password?c.password[0]:"",s="undefined"!=typeof c.passwordRepeat?c.passwordRepeat[0]:"",r.setState({valid:!1,uNameErr:t,pwErr:n,pwRepeatErr:s})):(r.setState({valid:!0,uNameErr:"",pwErr:"",pwRepeatErr:""}),C(r.state.username,r.state.password).then((function(e){e.success?r.props.history.push("/chat"):void 0!==e.username&&r.setState({valid:!1,uNameErr:e.username})})))},r.uNameErr=function(){if(""!==r.state.uNameErr)return Object(s.jsx)(g,{children:r.state.uNameErr})},r.pwErr=function(){if(""!==r.state.pwErr)return Object(s.jsx)(g,{children:r.state.pwErr})},r.pwRepeatErr=function(){if(""!==r.state.pwRepeatErr)return Object(s.jsx)(g,{children:r.state.pwRepeatErr})},r.state={uNameErr:"",username:"",pwErr:"",password:"",pwRepeatErr:"",pwRepeat:"",valid:!1,redirect:!1},r}return Object(p.a)(n,[{key:"render",value:function(){return Object(s.jsx)("div",{className:"h-100",style:{display:"flex"},children:Object(s.jsx)("div",{className:"col-sm-12 my-auto",children:Object(s.jsxs)("div",{className:"container border rounded p-3",style:{maxWidth:"800px"},children:[Object(s.jsx)("h1",{children:"Registrieren"}),Object(s.jsxs)("form",{onSubmit:this.submitHandler,children:[Object(s.jsxs)("div",{className:"form-group",children:[Object(s.jsx)("label",{htmlFor:"username",children:"Benutzername:"}),this.uNameErr(),Object(s.jsx)("input",{type:"text",name:"username",className:"form-control",placeholder:"Benutzernamen eingeben",onChange:this.changeHandler})]}),Object(s.jsxs)("div",{className:"form-group",children:[Object(s.jsx)("label",{htmlFor:"password",children:"Passwort:"}),this.pwErr(),Object(s.jsx)(v,{name:"password",className:"form-control",placeholder:"Passwort eingeben",onChange:this.changeHandler})]}),Object(s.jsxs)("div",{className:"form-group",children:[Object(s.jsx)("label",{htmlFor:"password",children:"Passwort wiederholen:"}),this.pwRepeatErr(),Object(s.jsx)(v,{name:"pwRepeat",className:"form-control",placeholder:"Passwort eingeben",onChange:this.changeHandler})]}),Object(s.jsx)("input",{type:"submit",className:"btn btn-primary",value:"Registrieren"})]})]})})})}}]),n}(o.Component),M=Object(h.j)(T),U=n(60),E=n(118);var D=function(e){var t=e.component,n=Object(E.a)(e,["component"]),r=Object(o.useGlobal)(),a=Object(U.a)(r,2),c=a[0];return a[1],Object(s.jsx)(h.b,Object(O.a)(Object(O.a)({},n),{},{render:function(e){return c.loaded?c.authTokens?Object(s.jsx)(t,Object(O.a)({},e)):Object(s.jsx)(h.a,{to:{pathname:"/login",state:{referer:e.location}}}):null}}))},_=992,I=768,A=991,R=767,G=320,L=425,B=function(){return{width:window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,height:window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight}},P=B(),F={width:P.width,height:P.height},z=function(e){Object(j.a)(n,e);var t=Object(f.a)(n);function n(){var e;Object(d.a)(this,n);for(var r=arguments.length,c=new Array(r),i=0;i<r;i++)c[i]=arguments[i];return(e=t.call.apply(t,[this].concat(c))).state=F,e.render=function(){var t=e.props,n=t.children,r=t.displayIn,c=e.state,i=c.width,o=c.height,u=e.shouldRender(r,i,o);return Object(s.jsx)(a.a.Fragment,{children:u?n:null})},e.handleResize=function(){var t=B(),n=t.width,s=t.height;e.setState({width:n,height:s})},e.shouldRender=function(e,t,n){return-1!==e.indexOf("Laptop")&&t>=_||(-1!==e.indexOf("Tablet")&&t<=A&&t>=I||(-1!==e.indexOf("Mobile")&&t<=R||(-1!==e.indexOf("MobilePortrait")&&t<=R&&n>=L||!!(-1!==e.indexOf("MobileLandScape")&&t<=R&&n<=G))))},e}return Object(p.a)(n,[{key:"componentDidMount",value:function(){window.addEventListener("resize",this.handleResize,!1)}},{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this.handleResize,!1)}}]),n}(a.a.PureComponent),H=function(e){Object(j.a)(n,e);var t=Object(f.a)(n);function n(){return Object(d.a)(this,n),t.apply(this,arguments)}return Object(p.a)(n,[{key:"componentDidMount",value:function(){"function"===typeof this.props.didMount&&this.props.didMount()}},{key:"componentDidUpdate",value:function(e,t,n){"function"===typeof this.props.didUpdate&&this.props.didUpdate()}},{key:"render",value:function(){return this.props.children?this.props.children:null}}]),n}(r.Component),V=(n(143),0),J=1,W=2,Y=function(e){Object(j.a)(n,e);var t=Object(f.a)(n);function n(){return Object(d.a)(this,n),t.apply(this,arguments)}return Object(p.a)(n,[{key:"render",value:function(){var e=this,t=this.props.location.pathname;return Object(s.jsxs)(H,{children:[Object(s.jsx)(z,{displayIn:["Mobile"],children:Object(s.jsxs)("div",{className:"float-left left",children:[Object(s.jsx)("i",{id:"btnBackToChatList",className:"fas fa-arrow-left fa-2x d-block d-md-none",onClick:function(){e.props.history.goBack()}}),e.global.newMessages>0?Object(s.jsx)("div",{className:"btnBack-number",children:e.global.newMessages}):null]})}),function(){switch(e.global.infoHeaderCenter){case J:return Object(s.jsxs)($,{children:[Object(s.jsx)("h3",{id:"chat-info-name",children:e.global.ihcData.name}),Object(s.jsx)(u.b,{to:t+"/userInfo/"+e.global.ihcData.uid,children:Object(s.jsx)("i",{className:"fas fa-info-circle fa-2x","data-toggle":"tooltip",title:"chat info"})})]});case W:return Object(s.jsxs)($,{children:[Object(s.jsx)("h3",{id:"chat-info-name",children:e.global.ihcData.name}),Object(s.jsx)(u.b,{to:"/chat/groupInfo/"+e.global.ihcData.gcid,children:Object(s.jsx)("i",{className:"fas fa-info-circle fa-2x","data-toggle":"tooltip",title:"chat info"})})]});default:return Object(s.jsx)(z,{displayIn:["Laptop","Tablet"],children:Object(s.jsx)("h3",{className:"pt-2 pl-2",children:"chat"})})}}()]})}}]),n}(o.Component),q=Object(h.j)(Y);function $(e){return Object(s.jsx)("div",{id:"chat-info",className:"center pt-2",children:e.children})}var K=n(115),Q=(n(144),n(145),function(e){Object(j.a)(n,e);var t=Object(f.a)(n);function n(e){var s;return Object(d.a)(this,n),(s=t.call(this,e)).clickCheckBox=function(e){s.state.checkBoxClicked?e.stopPropagation():setTimeout((function(){s.setState((function(e){return{checkBoxClicked:!0}}))}),20)},s.clickDocument=function(e){s.state.checkBoxClicked&&s.changeChecked(e)},s.changeChecked=function(e){s.setState((function(e){return{checkBoxClicked:!e.checkBoxClicked}}))},s.logout=function(){s.dispatch.deleteAuthTokens()},s.state={checkBoxClicked:!1},s}return Object(p.a)(n,[{key:"render",value:function(){var e=this.props.location.pathname;return Object(s.jsxs)("div",{className:"c-header",children:[Object(s.jsx)(q,{}),Object(s.jsxs)("div",{id:"top-right",className:"right",onClick:this.clickCheckBox,children:[Object(s.jsx)("div",{className:"right-l"}),Object(s.jsx)("input",{type:"checkbox",id:"btnControlTopRight",className:"btnControl",checked:this.state.checkBoxClicked,onChange:this.changeChecked}),Object(s.jsx)("label",{htmlFor:"btnControlTopRight",children:Object(s.jsxs)("div",{className:"right-c",children:[Object(s.jsx)("div",{className:"d-only-when-small",children:Object(s.jsx)("i",{id:"user-info",className:"fas fa-user fa-2x user-icon","data-toggle":"tooltip",title:"Benutzer-Info"})}),Object(s.jsxs)("div",{className:"d-only-when-big top-2right",children:[Object(s.jsx)(u.b,{to:e+"/userInfo/"+this.global.userSelf.uid,children:Object(s.jsx)(X,{text:"Benutzer-Info",children:Object(s.jsx)("h4",{id:"username",className:"p-2 username",children:this.global.userSelf.username})})}),Object(s.jsxs)("div",{className:"float-right",children:[Object(s.jsx)(u.b,{to:e+"/settings",children:Object(s.jsx)(X,{text:"Einstellungen",children:Object(s.jsx)("i",{className:"fas fa-user-cog fa-2x"})})}),"\xa0",Object(s.jsx)(X,{text:"logout",children:Object(s.jsx)("i",{id:"user-logout",className:"fas fa-sign-out-alt fa-2x logout",onClick:this.logout})})]})]})]})})]})]})}},{key:"componentDidMount",value:function(){document.addEventListener("click",this.clickDocument,!1)}},{key:"componentWillUnmount",value:function(){document.removeEventListener("click",this.clickDocument,!1)}}]),n}(o.Component));function X(e){return Object(s.jsx)(K.a,{placement:"bottom",trigger:["hover"],overlay:Object(s.jsx)("span",{children:e.text}),children:e.children})}var Z=Object(h.j)(Q),ee=(n(146),function(e){Object(j.a)(n,e);var t=Object(f.a)(n);function n(){var e;Object(d.a)(this,n);for(var s=arguments.length,r=new Array(s),a=0;a<s;a++)r[a]=arguments[a];return(e=t.call.apply(t,[this].concat(r))).searchChanged=function(t){e.props.onSearch(t.target.value)},e}return Object(p.a)(n,[{key:"render",value:function(){var e=this.props.location.pathname;return Object(s.jsx)("div",{className:"chatSearchBox",children:Object(s.jsxs)("div",{className:"chat-select-form",children:[Object(s.jsx)("input",{type:"text",name:"chat-search",className:"chat-search",placeholder:"Chat suchen",onChange:this.searchChanged}),Object(s.jsx)(u.b,{to:e+"/newChat",children:Object(s.jsx)("button",{id:"btn-newChat",className:"btn-newChat",children:Object(s.jsx)("i",{className:"fas fa-plus fa-lg"})})})]})})}}]),n}(r.Component)),te=Object(h.j)(ee),ne=n(109),se=n.n(ne),re={names:{aqua:"#00ffff",black:"#000000",blue:"#0000ff",brown:"#a52a2a",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgrey:"#a9a9a9",darkgreen:"#006400",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkviolet:"#9400d3",fuchsia:"#ff00ff",gold:"#ffd700",green:"#008000",indigo:"#4b0082",khaki:"#f0e68c",lightblue:"#add8e6",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightpink:"#ffb6c1",lime:"#00ff00",magenta:"#ff00ff",maroon:"#800000",navy:"#000080",olive:"#808000",orange:"#ffa500",pink:"#ffc0cb",purple:"#800080",violet:"#800080",red:"#ff0000",silver:"#c0c0c0"},random:function(){var e,t=0;for(var n in this.names)Math.random()<1/++t&&(e=n);return e}},ae=re,ce=n(117),ie=function(e){Object(j.a)(n,e);var t=Object(f.a)(n);function n(){return Object(d.a)(this,n),t.apply(this,arguments)}return Object(p.a)(n,[{key:"getIndex",value:function(e){for(var t=0,n=this.length-1;t<=n;){var s=Math.floor((t+n)/2);if(this[s].key===e)return s;this[s].key<e?t=s+1:n=s-1}return-1}},{key:"getNearestKey",value:function(e){var t;for(++e;-1===(t=this.getIndex(--e));)if(0===e)return-1;return t}},{key:"get",value:function(e){var t=this.getIndex(e);if(-1!==t)return this[t].value}},{key:"add",value:function(e,t){-1===this.getIndex(e)&&this.splice(this.getNearestKey(e)+1,0,{key:e,value:t})}},{key:"remove",value:function(e){var t=this.getIndex(e);-1!==t&&this.splice(t,1)}}]),n}(Object(ce.a)(Array));function oe(e,t,n){return ue.apply(this,arguments)}function ue(){return(ue=Object(k.a)(y.a.mark((function e(t,n,s){var r,a,c;return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=s||Object(o.getGlobal)().authTokens,a=Object(O.a)(Object(O.a)({},n),{},{method:n.method,headers:Object(O.a)(Object(O.a)({},n.headers),{},{Authorization:r})}),e.next=4,fetch(t,a);case 4:if(401!==(c=e.sent).status){e.next=8;break}throw Object(o.getDispatch)().deleteAuthTokens(),new Error("jwt expired");case 8:return e.abrupt("return",c);case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function he(){return le.apply(this,arguments)}function le(){return(le=Object(k.a)(y.a.mark((function e(){var t;return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={method:"GET",headers:{Accept:"application/json"}},e.next=3,oe("/chats",t);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function de(e){return pe.apply(this,arguments)}function pe(){return(pe=Object(k.a)(y.a.mark((function e(t){var n;return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={method:"PUT",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(t)},e.next=3,oe("/user/chat",n);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function je(e){return fe.apply(this,arguments)}function fe(){return(fe=Object(k.a)(y.a.mark((function e(t){var n;return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={method:"GET",headers:{Accept:"application/json"}},e.next=3,oe("/user/"+t,n);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function be(e){return me.apply(this,arguments)}function me(){return(me=Object(k.a)(y.a.mark((function e(t){var n;return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(t)},e.next=3,oe("/message/load",n);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var ge=0,Oe=1,ve=2,xe=3,ye=4,ke=5,we=6;function Ce(){return(Ce=Object(k.a)(y.a.mark((function e(t){var n,s,r;return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(-1===Ye.users.getIndex(t)){e.next=10;break}if(0===Ye.users.get(t).normalChat){e.next=5;break}return e.abrupt("return",ge);case 5:return n=Ye.users.get(t),Ye.temporaryChat.createNew(t,n.username),e.abrupt("return",ve);case 8:e.next=40;break;case 10:if(!Ye.temporaryChat.doesExist(t)){e.next=14;break}return e.abrupt("return",ve);case 14:return e.prev=14,e.next=17,je(t);case 17:if(!(s=e.sent).ok){e.next=34;break}return e.next=21,s.json();case 21:if(!(r=e.sent).userExists||r.blocked){e.next=27;break}return Ye.temporaryChat.createNew(t,r.username),e.abrupt("return",ve);case 27:if(r.userExists){e.next=31;break}return e.abrupt("return",xe);case 31:return e.abrupt("return",ye);case 32:e.next=35;break;case 34:return e.abrupt("return",we);case 35:e.next=40;break;case 37:return e.prev=37,e.t0=e.catch(14),e.abrupt("return",we);case 40:case"end":return e.stop()}}),e,null,[[14,37]])})))).apply(this,arguments)}var Ne=function(){function e(t,n){Object(d.a)(this,e),this._normalChat=0,this._groupChats=new ie,this.uid=t,this.username=n,this.color=ae.random()}return Object(p.a)(e,[{key:"addGroupChat",value:function(e){this.groupChats.add(e,e)}},{key:"removeGroupChat",value:function(e){this.groupChats.remove(e)}},{key:"uid",get:function(){return this._uid},set:function(e){this._uid=e}},{key:"username",get:function(){return this._username},set:function(e){this._username=e}},{key:"color",get:function(){return this._color},set:function(e){this._color=e}},{key:"normalChat",get:function(){return this._normalChat},set:function(e){this._normalChat=e}},{key:"groupChats",get:function(){return this._groupChats},set:function(e){this._groupChats=e}}]),e}(),Se={};function Te(){return Me.apply(this,arguments)}function Me(){return(Me=Object(k.a)(y.a.mark((function e(){var t,n;return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={method:"GET",headers:{Accept:"application/json"}},e.next=3,fetch("/data.json",t);case 3:if(!(n=e.sent).ok){e.next=10;break}return e.next=7,n.json();case 7:Se=e.sent,e.next=11;break;case 10:throw new Error;case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ue(e){var t=e.msg;return Object(s.jsxs)("div",{className:(t.bySelf?"self ":"other ")+"msg-container",children:[t.userTop?Object(s.jsx)("div",{className:"w-100",children:Object(s.jsx)("strong",{className:"header",children:Object(s.jsx)(Ie,{user:t.userTop})})}):null,Object(s.jsx)("div",{className:"content",children:Object(s.jsx)("p",{children:t.content.text})}),Object(s.jsx)("div",{className:"date-outer",children:Object(s.jsx)("div",{className:"date",children:t.mDateString})})]})}function Ee(e){var t=e.msg;return Object(s.jsxs)("div",{className:(t.bySelf?"self ":"other ")+"msg-container",children:[Object(s.jsx)(De,{msg:t}),Object(s.jsx)("div",{className:"date-outer",children:Object(s.jsx)("div",{className:"date",children:t.mDateString})})]})}function De(e){var t=e.msg;return Object(s.jsx)(H,{children:Le(t,!0)})}n(177);function _e(e){var t=e.msg;switch(t.type){case Se.messageTypes.normalMessage:return Object(s.jsx)(Ue,{msg:t});case Se.messageTypes.statusMessage:return Object(s.jsx)(Ee,{msg:t});default:return Object(s.jsx)("span",{})}}function Ie(e){return Object(s.jsx)("span",{style:{color:ae.names[e.user.color]},children:e.user.username})}var Ae=0,Re=1,Ge=["den chat erstellt","hinzugef\xfcgt","entfernt","dem chat beigetreten","den chat verlassen","zum Admin gemacht","nicht mehr Admin"];function Le(e,t){return function(){var t=e.userTop,s=e.content.passiveUsers;switch(e.content.type){case Se.statusMessageTypes.chatCreated:return n(t,Ae,s,Se.statusMessageTypes.chatCreated);case Se.statusMessageTypes.usersAdded:return n(t,Ae,s,Se.statusMessageTypes.usersAdded);case Se.statusMessageTypes.usersRemoved:return n(t,Ae,s,Se.statusMessageTypes.usersRemoved);case Se.statusMessageTypes.usersJoined:return n(t,Re,[],Se.statusMessageTypes.usersJoined);case Se.statusMessageTypes.usersLeft:return n(t,Ae,[],Se.statusMessageTypes.usersLeft);case Se.statusMessageTypes.usersMadeAdmin:return n(t,Ae,s,Se.statusMessageTypes.usersMadeAdmin);case Se.statusMessageTypes.usersRemovedAdmin:return n(t,Re,[],Se.statusMessageTypes.usersRemovedAdmin)}}();function n(n,r,a,c){function i(){switch(r){case Ae:return e.bySelf?" hast ":" hat ";case Re:return" ist"}}function o(){if(a.length<1)return"";if(1===a.length){var e=Ye.users.get(a[0]);return e?t?Object(s.jsx)(Ie,{user:e}):e.username:"1 Benutzer"}return a.length+" Benutzer"}function u(){return" "+Ge[c]}return t?Object(s.jsxs)("span",{children:[Object(s.jsx)(Ie,{user:e.userTop}),i(),o(),u()]}):e.userTop.username+i()+o()+u()}}var Be=function(){function e(t,n,s){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new Date(Date.now()),a=arguments.length>4?arguments[4]:void 0,c=arguments.length>5?arguments[5]:void 0;Object(d.a)(this,e),this.mid=t,this.uid=n,this.date=r,this.chat=s,this.type=a,this.content=c}return Object(p.a)(e,[{key:"getMessageObject",value:function(e){var t={mDateString:this.getMessageViewDateString(),dateString:this.getDateString(),date:this.date,bySelf:this.uid===Ye.userSelf.uid,type:this.type,content:this.content};return e&&(t.userTop=this.getUserTop()),t}},{key:"getUserTop",value:function(){if(this.isBySelf())return{uid:this.uid,username:"Du",color:Ye.userSelf.color};var e=Ye.users.get(this.uid);return{uid:this.uid,username:e.username,color:e.color}}},{key:"isBySelf",value:function(){return this.uid===Ye.userSelf.uid}},{key:"getChatViewDateString",value:function(){return this.isDateToday()?"heute "+this.getTimeString():this.isDateYesterday()?"gestern":this.getDateString()}},{key:"getChatViewMsgString",value:function(){switch(this.type){case Se.messageTypes.normalMessage:var e=this.content.text;return e.length>18&&(e=e.substr(0,18)+"..."),this.uid===Ye.userSelf.uid?"Du: ".concat(e):"normalchat"===this.chat.type?this.content.text:"".concat(Ye.users.get(this.uid).username,": ").concat(e);case Se.messageTypes.statusMessage:return Le(this.getMessageObject(!0),!1)}}},{key:"getMessageViewDateString",value:function(){return this.isDateToday()?this.getTimeString():this.isDateYesterday()?"gestern "+this.getTimeString():this.getDateString()+" "+this.getTimeString()}},{key:"isDateToday",value:function(){var e=new Date(Date.now());return this.date.getDate()===e.getDate()&&this.date.getMonth()===e.getMonth()&&this.date.getFullYear()===e.getFullYear()}},{key:"isDateYesterday",value:function(){var e=new Date(Date.now());return this.date.getDate()===e.getDate()-1&&this.date.getMonth()===e.getMonth()&&this.date.getFullYear()===e.getFullYear()}},{key:"getDateString",value:function(){var e,t=this.date.getDate();e=t<10?"0"+t:t;var n,s=this.date.getMonth();n=s+1<10?"0"+(s+1):s+1;var r=this.date.getFullYear();return"".concat(e,".").concat(n,".").concat(r)}},{key:"getTimeString",value:function(){var e,t=this.date.getHours();e=t<10?"0"+t:t;var n,s=this.date.getMinutes();return n=s<10?"0"+s:s,"".concat(e,":").concat(n)}},{key:"isDifferentDay",value:function(e){return this.date.getDay()!==e.getDay()||this.date.getMonth()!==e.getMonth()||this.date.getFullYear()!==e.getFullYear()}},{key:"mid",get:function(){return this._mid},set:function(e){this._mid=e}},{key:"uid",get:function(){return this._uid},set:function(e){this._uid=e}},{key:"date",get:function(){return this._date},set:function(e){this._date=e}},{key:"chat",get:function(){return this._chat},set:function(e){this._chat=e}},{key:"type",get:function(){return this._type},set:function(e){this._type=e}},{key:"content",get:function(){return this._content},set:function(e){this._content=e}}]),e}(),Pe=function(){function e(){Object(d.a)(this,e),this.events=new Map}return Object(p.a)(e,[{key:"on",value:function(e,t){this.events.has(e)?this.events.get(e).push(t):this.events.set(e,[t])}},{key:"rm",value:function(e,t){if(this.events.has(e))for(var n=this.events.get(e),s=0;s<n.length;s++)n[s]===t&&n.splice(s,1)}},{key:"trigger",value:function(e){if(this.events.has(e)){for(var t=arguments.length,n=new Array(t>1?t-1:0),s=1;s<t;s++)n[s-1]=arguments[s];for(var r=0;r<this.events.get(e).length;r++){var a;(a=this.events.get(e))[r].apply(a,n)}}}},{key:"events",get:function(){return this._events},set:function(e){this._events=e}}]),e}(),Fe=function(){function e(t,n,s){Object(d.a)(this,e),this._messages=new ie,this._event=new Pe,this._unreadMessages=0,this._reachedTopMessages=!1,this.type=t,this.id=n,this.chatName=s}return Object(p.a)(e,[{key:"initFirstMessage",value:function(e){e.empty||this.messages.add(e.mid,new Be(e.mid,e.uid,this,new Date(e.date),e.type,e.content))}},{key:"loadMessages",value:function(){var e=Object(k.a)(y.a.mark((function e(t){var n,s,r,a,c,i,o,u,h,l=this;return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.reachedTopMessages){e.next=16;break}return n=function(){var e=l.getLastMessage();return null!==e?e.mid:-1},e.next=4,be({chatType:this.type,chatId:this.id,lastMsgId:n(),num:t});case 4:if(!(s=e.sent).ok){e.next=15;break}return e.next=8,s.json();case 8:for(r=e.sent,this.reachedTopMessages="reached top"===r.status,a=r.messages,c=new Array(a.length),i=this.showUserInfoMessage(),o=a.length-1;o>=0;o--)u=a[o],h=new Be(u.mid,u.uid,this,new Date(u.date),u.type,u.content),this.messages.add(u.mid,h),c[o]=h.getMessageObject(i);return e.abrupt("return",c);case 15:throw new Error;case 16:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getLastMessage",value:function(){return 0!==this.messages.length?this.messages[0].value:null}},{key:"getFirstMessage",value:function(){return 0!==this.messages.length?this.messages[this.messages.length-1].value:null}},{key:"getMessages",value:function(){for(var e=this.showUserInfoMessage(),t=new Array(this.messages.length),n=0;n<this.messages.length;n++){var s=this.messages[n].value;t[n]=s.getMessageObject(e)}return t}},{key:"addMessage",value:function(e,t,n,s){var r=new Be(t,e,this,new Date(Date.now()),n,s);this.messages.add(t,r),Object(o.getDispatch)().newMsg(this,this.unreadMessages,r.getMessageObject(this.showUserInfoMessage()))}},{key:"showUserInfoMessage",value:function(){return"groupChat"===this.type}},{key:"getChatObject",value:function(){return{type:this.type,id:this.id,chatName:this.chatName,latestMessage:this.getLatestMessageObject(),unreadMessages:this.unreadMessages}}},{key:"getLatestMessageObject",value:function(){if(0===this.messages.length)return null;var e=this.getFirstMessage();return{msgString:e.getChatViewMsgString(),dateString:e.getChatViewDateString(),date:e.date}}},{key:"type",get:function(){return this._type},set:function(e){this._type=e}},{key:"id",get:function(){return this._id},set:function(e){this._id=e}},{key:"messages",get:function(){return this._messages},set:function(e){this._messages=e}},{key:"chatName",get:function(){return this._chatName},set:function(e){this._chatName=e}},{key:"event",get:function(){return this._event},set:function(e){this._event=e}},{key:"unreadMessages",get:function(){return this._unreadMessages},set:function(e){this._unreadMessages=e}},{key:"reachedTopMessages",get:function(){return this._reachedTopMessages},set:function(e){this._reachedTopMessages=e}}]),e}(),ze=function(e){Object(j.a)(n,e);var t=Object(f.a)(n);function n(e,s,r){var a,c=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return Object(d.a)(this,n),(a=t.call(this,"normalChat",e,s))._isTyping=!1,a.otherUser=r,a.unreadMessages=c,a}return Object(p.a)(n,[{key:"getUsersTyping",value:function(){if(this.isTyping){var e=Ye.users.get(this.otherUser);return[{uid:e.uid,username:e.username}]}return[]}},{key:"getLatestUserTyping",value:function(){if(this.isTyping){var e=Ye.users.get(this.otherUser);return{uid:e.uid,username:e.username}}return null}},{key:"startedTyping",value:function(e){e===this.otherUser&&(this.isTyping=!0,this.event.trigger("typeState changed"))}},{key:"stoppedTyping",value:function(e){e===this.otherUser&&(this.isTyping=!1,this.event.trigger("typeState changed"))}},{key:"otherUser",get:function(){return this._otherUser},set:function(e){this._otherUser=e}},{key:"isTyping",get:function(){return this._isTyping},set:function(e){this._isTyping=e}}]),n}(Fe),He=function(e){Object(j.a)(n,e);var t=Object(f.a)(n);function n(e,s,r){var a,c=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return Object(d.a)(this,n),(a=t.call(this,"groupChat",e,s))._users=[],a._usersTyping=[],a.users=r,a.unreadMessages=c,a}return Object(p.a)(n,[{key:"getUsersTyping",value:function(){if(this.usersTyping.length>0){for(var e=[],t=0;t<this.usersTyping.length;t++){var n=Ye.users.get(this.usersTyping[t]);e.push({uid:n.uid,username:n.username})}return e}return[]}},{key:"getLatestUserTyping",value:function(){if(this.usersTyping.length>0){var e=Ye.users.get(this.usersTyping[this.usersTyping.length-1]);return{uid:e.uid,username:e.username}}return null}},{key:"startedTyping",value:function(e){this.isMember(e)&&(this.isTyping(e)||(this.usersTyping.push(e),this.event.trigger("typeState changed")))}},{key:"stoppedTyping",value:function(e){this.isMember(e)&&this.isTyping(e)&&(this.usersTyping.splice(this.getIndexOfTyping(e),1),this.event.trigger("typeState changed"))}},{key:"isMember",value:function(e){return e!==Ye.userSelf.uid&&this.users.find((function(t){return t===e}))}},{key:"isTyping",value:function(e){return this.usersTyping.find((function(t){return t===e}))}},{key:"getIndexOfTyping",value:function(e){return this.usersTyping.findIndex((function(t){return t===e}))}},{key:"users",get:function(){return this._users},set:function(e){this._users=e}},{key:"usersTyping",get:function(){return this._usersTyping},set:function(e){this._usersTyping=e}}]),n}(Fe),Ve=function(){function e(){Object(d.a)(this,e),this._isShown=!1}return Object(p.a)(e,[{key:"createNew",value:function(e,t){this.chatNow=new ze(0,t,e)}},{key:"doesExist",value:function(e){return void 0!==this.chatNow&&this.chatNow.otherUser===e}},{key:"show",value:function(){this.isShown=!0,Object(o.getDispatch)().showTempChat(this.chatNow)}},{key:"update",value:function(){Object(o.getDispatch)().updateTempChat(this.chatNow)}},{key:"hide",value:function(){this.isShown=!1,Object(o.getDispatch)().hideTempChat()}},{key:"createNewNormalChat",value:function(){var e=Object(k.a)(y.a.mark((function e(t){var n,s,r,a,c,i,u;return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.chatNow.otherUser,s=this.chatNow.chatName,e.next=4,de({uid:n,username:s,message:{type:Se.messageTypes.normalMessage,content:{text:t,mentions:[],media:[]}}});case 4:if(!(r=e.sent).ok){e.next=20;break}return e.next=8,r.json();case 8:return a=e.sent,-1===Ye.users.getIndex(n)&&Ye.users.add(n,new Ne(n,s)),c=Ye.users.get(n),i=new ze(a.ncid,s,n),c.normalChat=i.id,Ye.chats.normal.add(a.ncid,i),u=new Be(a.mid,Ye.userSelf.uid,i,new Date(Date.now()),Se.messageTypes.normalMessage,{text:t,mentions:[],media:[]}),i.messages.add(u.mid,u),Object(o.getDispatch)().addChat(i),Object(o.getDispatch)().selectChat(i),this.hide(),e.abrupt("return",!0);case 20:return e.abrupt("return",!1);case 21:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"isShown",get:function(){return this._isShown},set:function(e){this._isShown=e}},{key:"chatNow",get:function(){return this._chatNow},set:function(e){this._chatNow=e}}]),e}(),Je=function(){function e(){Object(d.a)(this,e),this._userSelf={uid:0,username:""},this._users=new ie,this._chats={normal:new ie,group:new ie},this._event=new Pe,this._finishedLoading=!1,this._temporaryChat=new Ve,this._initCalled=!1}return Object(p.a)(e,[{key:"destruct",value:function(){this.socket&&(this.socket.removeAllListeners(),this.socket.disconnect()),this.initCalled=!1}},{key:"init",value:function(){var e=Object(k.a)(y.a.mark((function e(){var t,n,s,r=this;return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=Object(o.getGlobal)().userSelf,n=t.uid,s=t.username,this.userSelf=new Ne(n,s),this.userInfo={uid:n,username:s},this.initCalled=!0,this.userSelf=new Ne(n,s),this.userInfo={uid:n,username:s},this.socket=se.a.connect("/",{secure:!0}),this.socket.emit("auth",Object(o.getGlobal)().authTokens),this.socket.on("initialized",(function(){r.initChats()})),this.socket.on("chat message",(function(e){var t=r.getChat(e.chat.type,e.chat.id);if(null!==t){var n=r.isCurrentChat(t.type,t.id);t.addMessage(e.uid,e.mid,e.type,e.content),t.hasNewMsg=!n,t.unreadMessages++,r.event.trigger("new message",e.chat.type,e.chat.id)}})),this.socket.on("started typing",(function(e){r.getChat(e.chat.type,e.chat.id).startedTyping(e.uid)})),this.socket.on("stopped typing",(function(e){r.getChat(e.chat.type,e.chat.id).stoppedTyping(e.uid)})),this.socket.on("users-noChat",(function(e){We.event.trigger("users-noChat",e)})),this.socket.on("new chat",(function(e){r.addNewChat(e)})),this.socket.on("disconnect",(function(){setTimeout((function(){alert("Verbindung verloren! Seite wird neu geladen"),location.reload()}),1e3)}));case 15:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"initChats",value:function(){var e=Object(k.a)(y.a.mark((function e(){var t,n,s;return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,he();case 2:if(200!==(t=e.sent).status){e.next=8;break}return e.next=6,t.json();case 6:for(n=e.sent,s=0;s<n.length;s++)"normalChat"===n[s].type?this.addNewNormalChat(n[s]):"groupChat"===n[s].type&&this.addNewGroupChat(n[s]);case 8:this.finishedLoading=!0,this.event.trigger("chats loaded",this.getChatArraySortedByDate());case 10:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getChatArraySortedByDate",value:function(){function e(e){var t=e.latestMessage;return null!==t?t.date.getTime():new Date(0).getTime()}function t(t,n){for(var s=n,r=n+1;r<t.length;r++)e(t[s])<e(t[r])&&(s=r);return s}function n(e,t,n){var s=e[t];e[t]=e[n],e[n]=s}function s(e){for(var s=function(e){for(var t=new Array(e.length),n=0;n<e.length;n++){var s=e[n].value;t[n]=s.getChatObject()}return t}(e),r=0;r<s.length-1;r++){n(s,r,t(s,r))}return s}return function(t,n){for(var s=new Array(t.length+n.length),r=0,a=0,c=0;c<s.length;c++)a<n.length?r<t.length&&e(t[r])>e(n[a])?(s[c]=t[r],r++):(s[c]=n[a],a++):(s[c]=t[r],r++);return s}(s(this.chats.normal),s(this.chats.group))}},{key:"isCurrentChat",value:function(e,t){var n=Object(o.getGlobal)().currentChat;return n.type===e&&n.id===t}},{key:"getChat",value:function(e,t){return"normalChat"===e?this.chats.normal.get(t):"tempChat"===e?this.temporaryChat.chatNow:"groupChat"===e?this.chats.group.get(t):void 0}},{key:"addNewChat",value:function(e){var t;"normalChat"===e.type?t=this.addNewNormalChat(e):"groupChat"===e.type&&(t=this.addNewGroupChat(e)),t.unreadMessages=1,Object(o.getDispatch)().addChat(t)}},{key:"addNewNormalChat",value:function(e){var t;-1===this.users.getIndex(e.members[0].uid)?(t=new Ne(e.members[0].uid,e.members[0].username),this.users.add(t.uid,t)):t=this.users.get(e.members[0].uid);var n=new ze(e.id,e.chatName,t.uid,e.unreadMessages);return t.normalChat=n.id,n.initFirstMessage(e.firstMessage),this.chats.normal.add(e.id,n),n}},{key:"addNewGroupChat",value:function(e){for(var t=[],n=0;n<e.members.length;n++){var s=e.members[n],r=void 0;-1===this.users.getIndex(s.uid)?(r=new Ne(s.uid,s.username),this.users.add(r.uid,r)):r=this.users.get(s.uid),t.push(r.uid),r.addGroupChat(e.id)}var a=new He(e.id,e.chatName,t,e.unreadMessages);return a.initFirstMessage(e.firstMessage),this.chats.group.add(e.id,a),a}},{key:"socket",get:function(){return this._socket},set:function(e){this._socket=e}},{key:"userSelf",get:function(){return this._userSelf},set:function(e){this._userSelf=e}},{key:"users",get:function(){return this._users},set:function(e){this._users=e}},{key:"chats",get:function(){return this._chats},set:function(e){this._chats=e}},{key:"event",get:function(){return this._event},set:function(e){this._event=e}},{key:"finishedLoading",get:function(){return this._finishedLoading},set:function(e){this._finishedLoading=e}},{key:"temporaryChat",get:function(){return this._temporaryChat},set:function(e){this._temporaryChat=e}},{key:"initCalled",get:function(){return this._initCalled},set:function(e){this._initCalled=e}}]),e}(),We=new Je;var Ye=We,qe=function(e){Object(j.a)(n,e);var t=Object(f.a)(n);function n(e){var s;return Object(d.a)(this,n),(s=t.call(this,e)).isSelected=function(){return s.props.id===s.global.currentChat.id&&s.props.type===s.global.currentChat.type},s.typeStateChanged=function(){var e="",t=Ye.getChat(s.props.type,s.props.id).getLatestUserTyping();null!==t&&(e=t.username+" schreibt..."),s.setState({typeMsg:e})},s.state={lastMsg:void 0,typeMsg:""},s}return Object(p.a)(n,[{key:"render",value:function(){var e=this,t=function(){return e.props.latestMessage?Object(s.jsx)("span",{children:e.props.latestMessage.msgString}):Object(s.jsx)("span",{children:"Noch keine Nachrichten vorhanden"})},n=function(){return e.props.latestMessage?Object(s.jsx)("div",{className:"lastMsg-date",children:e.props.latestMessage.dateString}):null};return Object(s.jsx)("li",{className:"chat-item"+(this.isSelected()?" selected ":""),children:Object(s.jsxs)(u.b,{to:"normalChat"===e.props.type?"/chat/user/"+Ye.getChat("normalChat",e.props.id).otherUser:"groupChat"===e.props.type?"/chat/group/"+e.props.id:"tempChat"===e.props.type?"/chat/user/"+Ye.temporaryChat.chatNow.otherUser:void 0,children:[Object(s.jsxs)("div",{className:"w-100",children:[Object(s.jsx)("strong",{children:this.props.name}),0===e.props.unreadMessages?null:Object(s.jsx)("div",{className:"newMsg-number",children:e.props.unreadMessages})]}),""===e.state.typeMsg?Object(s.jsxs)("div",{className:"w-100 lastMsg",children:[t(),n()]}):Object(s.jsx)("div",{className:"w-100 typeMsg",children:e.state.typeMsg})]})})}},{key:"componentDidMount",value:function(){Ye.getChat(this.props.type,this.props.id).event.on("typeState changed",this.typeStateChanged)}},{key:"componentDidUpdate",value:function(e,t,n){e.type===this.props.type&&e.id===this.props.id||(Ye.getChat(e.type,e.id).event.rm("typeState changed",this.typeStateChanged),Ye.getChat(this.props.type,this.props.id).event.on("typeState changed",this.typeStateChanged),this.setState({typeMsg:""}))}},{key:"componentWillUnmount",value:function(){Ye.getChat(this.props.type,this.props.id).event.rm("typeState changed",this.typeStateChanged)}}]),n}(o.Component),$e=(n(178),function(e){Object(j.a)(n,e);var t=Object(f.a)(n);function n(e){var s;return Object(d.a)(this,n),(s=t.call(this,e)).state={searchValue:""},s}return Object(p.a)(n,[{key:"render",value:function(){var e=this,t=0;return Object(s.jsxs)(H,{children:[Object(s.jsx)(te,{onSearch:function(t){e.setState({searchValue:t})}}),Object(s.jsxs)("ul",{className:"chat-list",children:[e.global.tempChat?Object(s.jsx)(qe,{id:0,type:"tempChat",name:e.global.tempChat.chatName,unreadMessages:0,latestMessage:null},-1):null,this.global.chats.map((function(n,r){return n.chatName.includes(e.state.searchValue)?(t++,Object(s.jsx)(qe,{id:n.id,type:n.type,name:n.chatName,unreadMessages:n.unreadMessages,latestMessage:n.latestMessage},r)):null}))]}),0===t?Object(s.jsx)("span",{children:"Nichts gefunden"}):null]})}}]),n}(o.Component));n(179);function Ke(e){return Object(s.jsx)("div",{className:"loader-init",children:Object(s.jsx)("div",{className:"col-sm-12 my-auto",children:Object(s.jsxs)("div",{className:"init-container border rounded",children:[Object(s.jsx)("div",{className:"spinner-border text-secondary",style:{width:"15rem",height:"15rem",borderWidth:"0.5rem"},role:"status",children:Object(s.jsx)("span",{className:"sr-only",children:"Loading..."})}),Object(s.jsx)("div",{className:"loader-text",children:e.msg})]})})})}var Qe=n(55),Xe=(n(180),n(114));function Ze(e){return et.apply(this,arguments)}function et(){return(et=Object(k.a)(y.a.mark((function e(t){var n;return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={method:"GET",headers:{Accept:"application/json"}},e.next=3,oe("/group/"+t+"/",n);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function tt(e){return nt.apply(this,arguments)}function nt(){return(nt=Object(k.a)(y.a.mark((function e(t){var n;return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={method:"PUT",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(t)},e.next=3,oe("/message",n);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}n(182);var st=function(e){Object(j.a)(n,e);var t=Object(f.a)(n);function n(e){var s;return Object(d.a)(this,n),(s=t.call(this,e))._userTyping=!1,s._typeEventEmitted=!1,s.onTyping=function(e){s.setState({message:e.target.value}),s.handleTypeMessage()},s.handleTypeMessage=function(){s.isTempChat||(s.userTyping&&clearTimeout(s.typeTimeout),s.userTyping=!0,s.typeEventEmitted||(s.typeEventEmitted=!0,Ye.socket.emit("started typing")),s.typeTimeout=setTimeout((function(){s.userTyping=!1,s.typeEventEmitted&&(s.typeEventEmitted=!1,Ye.socket.emit("stopped typing"))}),1e3))},s.onSubmit=function(e){if(e.preventDefault(),""!==s.state.message){var t=s.state.message;if(s.setState({message:""}),s.isTempChat){var n=s.props.location.pathname;Ye.temporaryChat.createNewNormalChat(t).then((function(e){e&&(s.props.history.replace("/chat"),s.props.history.replace(n))}))}else s.sendMessage(t).then((function(e){Ye.getChat(s.props.chatType,s.props.chatId).addMessage(Ye.userSelf.uid,e,Se.messageTypes.normalMessage,{text:t,mentions:[],media:[]})})).catch((function(e){}))}},s.sendMessage=function(){var e=Object(k.a)(y.a.mark((function e(t){var n,s;return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,tt({type:Se.messageTypes.normalMessage,content:{text:t,mentions:[],media:[]}});case 2:if(!(n=e.sent).ok){e.next=8;break}return e.next=6,n.json();case 6:return s=e.sent,e.abrupt("return",s.mid);case 8:return e.abrupt("return",new Error);case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),s.onEmojiInput=function(e){s.setState({message:s.state.message+e.native}),s.handleTypeMessage()},s.toggleEmoji=function(e){s.setState((function(e){return{showEmoji:!e.showEmoji}}))},s.state={message:"",showEmoji:!1},s}return Object(p.a)(n,[{key:"render",value:function(){return Object(s.jsxs)(H,{children:[Object(s.jsxs)("form",{onSubmit:this.onSubmit,className:"msg-form",children:[Object(s.jsxs)("div",{className:"message-input",children:[Object(s.jsx)("input",{autoComplete:"off",placeholder:"Nachricht:",value:this.state.message,onChange:this.onTyping}),Object(s.jsx)("i",{className:"far fa-smile fa-2x emoji-toggle",onClick:this.toggleEmoji})]}),Object(s.jsx)("button",{className:"btn-submit",type:"submit",children:Object(s.jsx)("i",{className:"far fa-paper-plane fa-2x","data-toggle":"tooltip",title:"send message"})})]}),this.state.showEmoji?Object(s.jsx)("div",{style:{position:"absolute",bottom:"60px",right:"50px",width:"350px",height:"425px"},children:Object(s.jsx)(Xe.a,{onSelect:this.onEmojiInput})}):null]})}},{key:"componentDidMount",value:function(){this.isTempChat="tempChat"===this.props.chatType}},{key:"componentDidUpdate",value:function(e,t,n){this.isTempChat="tempChat"===this.props.chatType}},{key:"userTyping",get:function(){return this._userTyping},set:function(e){this._userTyping=e}},{key:"typeEventEmitted",get:function(){return this._typeEventEmitted},set:function(e){this._typeEventEmitted=e}},{key:"typeTimeout",get:function(){return this._typeTimeout},set:function(e){this._typeTimeout=e}},{key:"isTempChat",get:function(){return this._isTempChat},set:function(e){this._isTempChat=e}}]),n}(r.Component),rt=Object(h.j)(st),at=(n(183),function(e){Object(j.a)(n,e);var t=Object(f.a)(n);function n(e){var s;return Object(d.a)(this,n),(s=t.call(this,e))._isMounted=!1,s.scrollHandler=function(e){s.setState({scrollToBottom:s.getScrollToBottom()}),0===s.messagesNode.scrollTop&&s.loadMessages()},s.setScrollToBottom=function(e){s.messagesNode.scrollTop=s.messagesNode.scrollHeight-s.messagesNode.offsetHeight-e},s.getScrollToBottom=function(){return s.messagesNode.scrollHeight-s.messagesNode.offsetHeight-s.messagesNode.scrollTop},s.assignMessagesRef=function(e){s.messages=e},s.loadMessages=function(){var e=Ye.getChat(s.global.currentChat.type,s.global.currentChat.id);e.reachedTopMessages||s.setState({msgLoading:!0}),e.loadMessages(10).then((function(e){s.dispatch.addLoadedMessages(e),s.setState((function(e){return{msgLoading:!1}})),s.setScrollToBottom(s.state.scrollToBottom)})).catch((function(e){return s.setState({msgLoading:!1})}))},s.chatChanged=function(){0===s.messagesNode.scrollTop&&s.loadMessages()},s.assignMessagesRef=s.assignMessagesRef.bind(Object(Qe.a)(s)),s.state={msgLoading:!1,scrollToBottom:0,messages:[],typeMessages:[]},s}return Object(p.a)(n,[{key:"componentDidMount",value:function(){this.messagesNode=i.a.findDOMNode(this.messages),this.chatChanged(),this.isMounted=!0}},{key:"componentDidUpdate",value:function(e,t,n){e.chatType===this.props.chatType&&e.chatId===this.props.chatId||(this.setScrollToBottom(0),this.chatChanged()),0===this.state.scrollToBottom&&(this.setScrollToBottom(0),this.global.currentChat.newMessages>0&&this.setGlobal((function(e){return{currentChat:Object(O.a)(Object(O.a)({},e.currentChat),{},{newMessages:0})}})))}},{key:"render",value:function(){var e=this,t=new Date(0),n=function(e){return n=e.date,r=t,n.getDay()!==r.getDay()||n.getMonth()!==r.getMonth()||n.getFullYear()!==r.getFullYear()?(t=e.date,Object(s.jsx)("div",{className:"date-container",children:Object(s.jsx)("div",{children:e.dateString})})):(t=e.date,null);var n,r};return Object(s.jsxs)("div",{className:"chat-container",children:[Object(s.jsxs)("div",{className:"messages",onScroll:this.scrollHandler,ref:this.assignMessagesRef,children:[e.state.msgLoading?Object(s.jsx)("div",{className:"messageLoader-top",children:Object(s.jsx)("div",{className:"spinner-border text-secondary",role:"status",children:Object(s.jsx)("span",{className:"sr-only",children:"Loading..."})})}):null,this.global.currentChat.messages.map((function(e,t){return Object(s.jsxs)("div",{children:[n(e),Object(s.jsx)(_e,{msg:e})]},t)})),0===e.global.currentChat.messages.length?Object(s.jsx)("div",{className:"alert alert-primary",role:"alert",children:"Noch keine Nachrichten vorhanden"}):null,e.isMounted&&e.getScrollToBottom()>10?Object(s.jsxs)("div",{id:"messages-bottom",className:"messages-bottom",onClick:function(){e.setState({scrollToBottom:0})},children:[Object(s.jsx)("div",{id:"btnToBottom",className:"chevron-down",children:Object(s.jsx)("i",{className:"fas fa-chevron-down fa-2x"})}),e.global.currentChat.newMessages>0?Object(s.jsx)("div",{id:"scroll-down-number",className:"number",children:e.global.currentChat.newMessages}):null]}):null]}),Object(s.jsx)(rt,{chatType:this.props.chatType,chatId:this.props.chatId})]})}},{key:"componentWillUnmount",value:function(){this.isMounted=!1}},{key:"isMounted",get:function(){return this._isMounted},set:function(e){this._isMounted=e}},{key:"messages",get:function(){return this._messages},set:function(e){this._messages=e}},{key:"messagesNode",get:function(){return this._messagesNode},set:function(e){this._messagesNode=e}}]),n}(o.Component)),ct=function(e){Object(j.a)(n,e);var t=Object(f.a)(n);function n(){return Object(d.a)(this,n),t.apply(this,arguments)}return Object(p.a)(n,[{key:"render",value:function(){return Object(s.jsxs)("div",{className:"chat-container",children:[Object(s.jsx)("div",{className:"messages",children:Object(s.jsx)("div",{className:"alert alert-primary",role:"alert",children:"Noch keine Nachrichten vorhanden"})}),Object(s.jsx)(rt,{chatType:"tempChat",chatId:0})]})}},{key:"componentDidMount",value:function(){Ye.temporaryChat.show()}},{key:"componentDidUpdate",value:function(e,t,n){e.uid!==this.props.uid&&Ye.temporaryChat.update()}},{key:"componentWillUnmount",value:function(){Ye.temporaryChat.hide()}}]),n}(r.Component);function it(){return Object(s.jsx)("div",{children:Object(s.jsx)("h2",{children:"ung\xfcltige Addresse"})})}function ot(){return Object(s.jsx)("div",{children:Object(s.jsx)("h2",{children:"Du kannst dir selbst nicht schreiben"})})}function ut(){return Object(s.jsx)("div",{children:Object(s.jsx)("h2",{children:"Dieser User hat dich blockiert"})})}function ht(){return Object(s.jsx)("div",{children:Object(s.jsx)("h2",{children:"Dieser User existiert nicht"})})}function lt(){return Object(s.jsx)("div",{children:Object(s.jsx)("h2",{children:"Du bist nicht Mitglied in diesem chat jetzt beitreten"})})}function dt(){return Object(s.jsx)("div",{children:Object(s.jsx)("h2",{children:"Du bist nicht dazu berechtigt diesen chat anzusehen"})})}function pt(){return Object(s.jsx)("div",{children:Object(s.jsx)("h2",{children:"Dieser Chat existiert nicht"})})}function jt(){return Object(s.jsx)("div",{children:Object(s.jsx)("h2",{children:"Fehler"})})}var ft=function(e){Object(j.a)(n,e);var t=Object(f.a)(n);function n(e){var s;return Object(d.a)(this,n),(s=t.call(this,e)).userChanged=function(){var e=parseInt(s.props.uid);if(s.global.userSelf.uid===e)s.setState({error:ke,loaded:!0});else{var t=function(){(function(e){return Ce.apply(this,arguments)})(e).then((function(t){t===ge?(s.setState({error:t}),s.setGlobal({infoHeaderCenter:J,ihcData:{name:Ye.users.get(e).username,uid:e}}).then(),s.selectNormalChat(e)):t===ve?(s.setState({error:t}),s.setGlobal({infoHeaderCenter:J,ihcData:{name:Ye.temporaryChat.chatNow.chatName,uid:e}}).then(),s.selectTempChat()):s.setState({error:we}),s.setState({loaded:!0})})).catch((function(e){return s.setState({error:we})}))};Ye.finishedLoading?t():Ye.event.on("chats loaded",(function(){t()})),s.setState({uid:parseInt(s.props.uid)})}},s.state={uid:0,loaded:!1,error:ge},s}return Object(p.a)(n,[{key:"render",value:function(){var e=this;return Object(s.jsxs)("div",{className:"h-100",children:[function(){if(!e.state.loaded)return Object(s.jsx)(Ke,{msg:"Chat wird geladen"})}(),e.state.error===Oe?Object(s.jsx)(it,{}):e.state.error===ke?Object(s.jsx)(ot,{}):e.state.loaded?e.state.error===ge?Object(s.jsx)(at,{chatType:e.global.currentChat.type,chatId:e.global.currentChat.id}):e.state.error===ve?Object(s.jsx)(ct,{uid:e.state.uid}):e.state.error===ye?Object(s.jsx)(ut,{}):Object(s.jsx)(ht,{}):void 0]})}},{key:"componentDidMount",value:function(){this.userChanged()}},{key:"componentDidUpdate",value:function(e,t,n){e.uid!==this.props.uid&&(isNaN(this.props.uid)?this.setState({error:Oe}):this.userChanged())}},{key:"selectTempChat",value:function(){this.dispatch.showTempChat()}},{key:"selectNormalChat",value:function(e){if(-1===Ye.users.getIndex(e))this.setState({error:xe});else{var t=Ye.users.get(e).normalChat,n=Ye.getChat("normalChat",t);this.dispatch.selectChat(n)}}},{key:"componentWillUnmount",value:function(){this.setGlobal({infoHeaderCenter:V,ihcData:null}).then()}}]),n}(o.Component),bt=(n(184),function(e){Object(j.a)(n,e);var t=Object(f.a)(n);function n(){return Object(d.a)(this,n),t.apply(this,arguments)}return Object(p.a)(n,[{key:"render",value:function(){var e=this;return Object(s.jsx)("div",{className:"modal-outer",onClick:function(){e.props.history.goBack()},children:Object(s.jsx)("div",{className:"h-100",style:{display:"flex"},children:Object(s.jsxs)("div",{className:"modal-inner",onClick:function(e){e.stopPropagation()},children:[Object(s.jsx)("div",{className:"btn-close",onClick:function(){e.props.history.goBack()},children:"\xd7"}),this.props.children]})})})}}]),n}(r.Component)),mt=Object(h.j)(bt);function gt(e){return Object(s.jsx)("div",{className:"m-header",children:e.children})}function Ot(e){return Object(s.jsx)("div",{className:"m-main",children:e.children})}var vt=n(116),xt=function(e){Object(j.a)(n,e);var t=Object(f.a)(n);function n(){var e;Object(d.a)(this,n);for(var s=arguments.length,r=new Array(s),a=0;a<s;a++)r[a]=arguments[a];return(e=t.call.apply(t,[this].concat(r))).clicked=function(t){e.props.isSelected?e.props.deselectUser(e.props.index):e.props.selectUser(e.props.index)},e}return Object(p.a)(n,[{key:"render",value:function(){return Object(s.jsxs)("li",{onClick:this.clicked,children:[Object(s.jsx)("div",{className:"username",children:this.props.username}),Object(s.jsx)("div",{className:"user-select fa-lg"+(this.props.isSelected?" selected":""),children:Object(s.jsx)("i",{className:"fas fa-check"})})]},this.props.index)}}]),n}(r.Component),yt=n(58),kt=n.n(yt),wt=0,Ct=1,Nt=function(e){Object(j.a)(n,e);var t=Object(f.a)(n);function n(e){var s;return Object(d.a)(this,n),(s=t.call(this,e)).lastRequest={},s.searchChanged=function(e){s.setState({searchValue:e.target.value,searchResult:[],hasMore:!0})},s.loadUsers=Object(k.a)(y.a.mark((function e(){var t,n,r;return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=s.state.searchValue,n=s.state.searchResult.length,s.lastRequest.searchValue===t&&s.lastRequest.length===n){e.next=14;break}return s.lastRequest={searchValue:t,length:n},e.prev=4,e.next=7,s.props.loadUsers(t,n);case 7:0===(r=e.sent).length?s.setState({hasMore:!1,error:wt}):s.setState((function(e){return{searchResult:e.searchResult.concat(r),error:wt}})),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(4),s.setState({error:Ct});case 14:case"end":return e.stop()}}),e,null,[[4,11]])}))),s.selectUser=function(e){var t=s.state.searchResult[e];s.props.selectUser(t.uid,t.username)},s.deselectUser=function(e){var t=s.state.searchResult[e];s.props.deselectUser(t.uid)},s.state={searchValue:"",searchResult:[],error:wt,hasMore:!0},s}return Object(p.a)(n,[{key:"render",value:function(){var e=this;return Object(s.jsxs)(H,{children:[Object(s.jsx)("form",{className:"form-group",style:{width:"90%",maxWidth:"650px"},children:Object(s.jsx)("input",{type:"text",className:"form-control p-2 m-2",placeholder:"Benutzer suchen",value:this.state.searchValue,onChange:this.searchChanged})}),Object(s.jsx)("div",{className:"selectUsers",ref:function(t){return e.scrollParentRef=t},children:Object(s.jsx)(kt.a,{pageStart:0,loadMore:this.loadUsers,hasMore:this.state.hasMore,loader:Object(s.jsx)("div",{className:"loader",children:Object(s.jsx)("div",{className:"spinner-border text-secondary",role:"status",children:Object(s.jsx)("span",{className:"sr-only",children:"Loading..."})})},-1),useWindow:!1,getScrollParent:function(){return e.scrollParentRef},children:Object(s.jsxs)("ul",{className:"selectUsers",children:[this.state.searchResult.map((function(t,n){return Object(s.jsx)(xt,{index:n,uid:t.uid,username:t.username,selectUser:e.selectUser,deselectUser:e.deselectUser,isSelected:e.props.isUserSelected(t.uid)},n)})),0===this.state.searchResult.length?Object(s.jsx)("div",{className:"nothingFound",children:"Nichts gefunden!"},-1):null]})})})]})}}]),n}(r.Component),St=(n(186),function(e){Object(j.a)(n,e);var t=Object(f.a)(n);function n(e){var s;return Object(d.a)(this,n),(s=t.call(this,e)).selectUser=function(e,t){s.setState((function(n){return{selectedUsers:n.selectedUsers.concat({uid:e,username:t})}}))},s.deselectUser=function(e){s.setState((function(t){var n=Object(vt.a)(t.selectedUsers),s=n.findIndex((function(t){return t.uid===e}));return n.splice(s,1),{selectedUsers:n}}))},s.deselectIndex=function(e){s.deselectUser(s.state.selectedUsers[e].uid)},s.isUserSelected=function(e){return s.state.selectedUsers.find((function(t){return t.uid===e}))},s.btnNextClicked=function(e){s.props.onNext(s.state.selectedUsers)},s.state={selectedUsers:[],showOnlySelected:!1},s}return Object(p.a)(n,[{key:"render",value:function(){var e=this;return 0===this.state.selectedUsers.length&&this.state.showOnlySelected&&this.setState({showOnlySelected:!1}),Object(s.jsxs)(H,{children:[Object(s.jsx)("div",{className:"select-users",children:0===e.state.selectedUsers.length?Object(s.jsx)("h4",{children:"Noch niemand ausgew\xe4hlt"}):Object(s.jsxs)("h4",{className:"w-100",children:[Object(s.jsxs)("span",{className:"selected-num"+(e.state.showOnlySelected?" selected":""),onClick:function(t){e.setState((function(e){return{showOnlySelected:!e.showOnlySelected}}))},children:[e.state.selectedUsers.length,"\xa0Benutzer"]}),"\xa0ausgew\xe4hlt",Object(s.jsx)("i",{className:"fas fa-arrow-right fa-lg float-right btn-next",onClick:e.btnNextClicked})]})}),this.state.showOnlySelected?Object(s.jsx)("div",{className:"selectUsers",children:Object(s.jsx)("ul",{className:"selectUsers only-selected",children:this.state.selectedUsers.map((function(t,n){return Object(s.jsx)(xt,{index:n,uid:t.uid,username:t.username,selectUser:function(){},deselectUser:e.deselectIndex,isSelected:!0},n)}))})}):Object(s.jsx)(Nt,{selectUser:this.selectUser,deselectUser:this.deselectUser,isUserSelected:this.isUserSelected,loadUsers:this.props.loadUsers})]})}}]),n}(r.Component)),Tt=function(){var e=Object(k.a)(y.a.mark((function e(t,n){var s,r;return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s={method:"PUT",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({users:n})},e.next=3,oe("/group/"+t+"/members",s);case 3:if(!(r=e.sent).ok){e.next=10;break}return e.next=7,r.json();case 7:return e.abrupt("return",e.sent);case 10:throw new Error("Error adding members");case 11:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),Mt=function(){var e=Object(k.a)(y.a.mark((function e(t,n){var s,r;return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s={method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(n)},e.next=3,oe("/user/notInGroup/"+t,s);case 3:if(!(r=e.sent).ok){e.next=10;break}return e.next=7,r.json();case 7:return e.abrupt("return",e.sent);case 10:throw new Error("Error fetching users");case 11:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),Ut=function(){var e=Object(k.a)(y.a.mark((function e(t){var n,s;return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={method:"POST",headers:{Accept:"application/json"}},e.next=3,oe("/group/"+t+"/leave",n);case 3:if(!(s=e.sent).ok){e.next=12;break}return e.next=7,s.json();case 7:if(!e.sent.error){e.next=10;break}throw new Error("Error leaving chat");case 10:e.next=13;break;case 12:throw new Error("Error leaving chat");case 13:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Et=function(){var e=Object(k.a)(y.a.mark((function e(t){var n,s;return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={method:"POST",headers:{Accept:"application/json"}},e.next=3,oe("/group/"+t+"/removeAdmin",n);case 3:if(!(s=e.sent).ok){e.next=12;break}return e.next=7,s.json();case 7:if(!e.sent.error){e.next=10;break}throw new Error("Error removing admin");case 10:e.next=13;break;case 12:throw new Error("Error removing admin");case 13:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();function Dt(e){var t=Object(h.g)(),n=function(){var n=Object(k.a)(y.a.mark((function n(s){return y.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,Tt(e.gcid,s);case 3:t.goBack(),n.next=8;break;case 6:n.prev=6,n.t0=n.catch(0);case 8:case"end":return n.stop()}}),n,null,[[0,6]])})));return function(e){return n.apply(this,arguments)}}(),r=function(){var t=Object(k.a)(y.a.mark((function t(n,s){return y.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Mt(e.gcid,{search:n,limit:10,start:s});case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}();return Object(s.jsxs)(H,{children:[Object(s.jsx)(gt,{children:Object(s.jsx)("h2",{children:"Benutzer hinzuf\xfcgen"})}),Object(s.jsx)(Ot,{children:Object(s.jsx)("div",{className:"addMembers",children:Object(s.jsx)(St,{onNext:n,loadUsers:r})})})]})}var _t=n(46),It=function(e){Object(j.a)(n,e);var t=Object(f.a)(n);function n(){var e;Object(d.a)(this,n);for(var s=arguments.length,r=new Array(s),a=0;a<s;a++)r[a]=arguments[a];return(e=t.call.apply(t,[this].concat(r))).isSelfAdmin=function(){return e.props.memberSelf.isAdmin},e.removeMemberFromChat=Object(k.a)(y.a.mark((function t(){var n;return y.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e.isSelfAdmin()){t.next=5;break}return n={method:"DELETE",headers:{Accept:"application/json"}},t.next=4,oe("/group/"+e.props.gcid+"/member/"+e.props.member.uid,n);case 4:t.sent;case 5:case"end":return t.stop()}}),t)}))),e.makeMemberAdmin=Object(k.a)(y.a.mark((function t(){var n;return y.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e.isSelfAdmin()){t.next=5;break}return n={method:"POST",headers:{Accept:"application/json"}},t.next=4,oe("/group/"+e.props.gcid+"/member/"+e.props.member.uid+"/giveAdmin",n);case 4:t.sent;case 5:case"end":return t.stop()}}),t)}))),e.removeMemberAdmin=Object(k.a)(y.a.mark((function t(){var n;return y.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e.isSelfAdmin()){t.next=5;break}return n={method:"POST",headers:{Accept:"application/json"}},t.next=4,oe("/group/"+e.props.gcid+"/member/"+e.props.member.uid+"/removeAdmin",n);case 4:t.sent;case 5:case"end":return t.stop()}}),t)}))),e}return Object(p.a)(n,[{key:"isMemberSelf",value:function(){return this.props.member.uid===this.global.userSelf.uid}},{key:"render",value:function(){var e=this.props.location.pathname;return Object(s.jsxs)("ul",{className:"userOptions",children:[Object(s.jsx)("li",{children:Object(s.jsxs)(u.b,{to:e+"/userInfo/"+this.props.member.uid,children:["zeige ",this.props.member.username," an"]})},0),Object(s.jsx)("li",{children:Object(s.jsxs)(u.b,{to:"/chat/user/"+this.props.member.uid,children:["Nachricht an ",this.props.member.username]})},1),this.isSelfAdmin()&&!this.isMemberSelf()?Object(s.jsxs)(H,{children:[Object(s.jsx)("li",{className:"noLink",onClick:this.removeMemberFromChat,children:"aus chat entfernen"},2),this.props.member.isAdmin?Object(s.jsx)("li",{className:"noLink",onClick:this.removeMemberAdmin,children:"admin status entfernen"},3):Object(s.jsx)("li",{className:"noLink",onClick:this.makeMemberAdmin,children:"zu admin machen"},4)]}):null]})}}]),n}(o.Component),At=Object(h.j)(It);function Rt(e){var t=Object(h.h)().pathname;return Object(s.jsxs)("ul",{className:"chatOptions",children:[e.memberSelf.isAdmin?Object(s.jsxs)(H,{children:[Object(s.jsx)("li",{className:"addUsers",children:Object(s.jsx)(u.b,{to:t+"/addUsers",children:"Benutzer hinzuf\xfcgen"})},0),Object(s.jsx)("li",{className:"removeSelfAdmin noLink",onClick:function(){Et(e.gcid).then((function(){})).catch((function(e){console.log(e)}))},children:"admin status entfernen"},1)]}):null,Object(s.jsx)("li",{className:"leaveChat noLink",onClick:function(){Ut(e.gcid).then((function(){})).catch((function(e){console.log(e)}))},children:"Chat verlassen"},2)]})}var Gt=n(110),Lt=n.n(Gt),Bt=function(e){Object(j.a)(n,e);var t=Object(f.a)(n);function n(e){var s;return Object(d.a)(this,n),(s=t.call(this,e)).handleEdit=function(){var e=Object(k.a)(y.a.mark((function e(t){var n;return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.target.value,s.setState({isEditing:!1,value:n}),e.next=4,s.props.onSubmit(n);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),s.editPressed=function(){s.setState({isEditing:!0})},s.state={isEditing:!1,value:s.props.value},s}return Object(p.a)(n,[{key:"render",value:function(){return Object(s.jsxs)("div",{className:this.props.class,children:[Object(s.jsx)(Lt.a,{name:this.props.name,value:this.state.value,isEditing:this.state.isEditing,changeCallback:this.handleEdit,optClass:"input"}),Object(s.jsx)("i",{className:"fas fa-edit edit",onClick:this.editPressed})]})}}]),n}(r.Component),Pt=function(e){Object(j.a)(n,e);var t=Object(f.a)(n);function n(){var e;Object(d.a)(this,n);for(var s=arguments.length,r=new Array(s),a=0;a<s;a++)r[a]=arguments[a];return(e=t.call.apply(t,[this].concat(r))).onSubmit=function(){var t=Object(k.a)(y.a.mark((function t(n){var s;return y.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return s={method:"PUT",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({description:n})},t.next=3,oe("/group/"+e.props.gcid+"/description",s);case 3:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),e}return Object(p.a)(n,[{key:"render",value:function(){return Object(s.jsx)(Bt,{class:"description",name:"editDescription",value:this.props.description,onSubmit:this.onSubmit})}}]),n}(r.Component),Ft=function(e){Object(j.a)(n,e);var t=Object(f.a)(n);function n(){var e;Object(d.a)(this,n);for(var s=arguments.length,r=new Array(s),a=0;a<s;a++)r[a]=arguments[a];return(e=t.call.apply(t,[this].concat(r))).onSubmit=function(){var t=Object(k.a)(y.a.mark((function t(n){var s;return y.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return s={method:"PUT",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({chatName:n})},t.next=3,oe("/group/"+e.props.gcid+"/chatName",s);case 3:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),e}return Object(p.a)(n,[{key:"render",value:function(){return Object(s.jsx)(Bt,{class:"chatName",name:"editChatName",value:this.props.chatName,onSubmit:this.onSubmit})}}]),n}(r.Component),zt=(n(211),function(e){Object(j.a)(n,e);var t=Object(f.a)(n);function n(e){var s;return Object(d.a)(this,n),(s=t.call(this,e)).state={error:!1,data:null},s}return Object(p.a)(n,[{key:"render",value:function(){var e=this;if(this.state.error)return Object(s.jsx)("div",{className:"alert alert-danger",role:"alert",children:"Ein Fehler ist aufgetreten!"});var t=Ye.userSelf.uid;return Object(s.jsxs)("div",{className:"groupChatInfo",children:[this.props.data.memberSelf.isAdmin?Object(s.jsx)("h1",{children:Object(s.jsx)(Ft,{gcid:this.props.gcid,chatName:this.props.data.chatName})}):Object(s.jsx)("div",{className:"chatName",children:Object(s.jsx)("h1",{children:this.props.data.chatName})}),this.props.data.memberSelf.isAdmin?Object(s.jsx)(Pt,{gcid:this.props.gcid,description:this.props.data.description}):Object(s.jsx)("div",{className:"description",children:this.props.data.description}),Object(s.jsx)(_t.a,{trigger:["click"],overlay:Object(s.jsx)(Rt,{gcid:this.props.gcid,memberSelf:this.props.data.memberSelf}),children:Object(s.jsx)("i",{className:"fas fa-ellipsis-v fa-lg chat-options-btn fa-2x",role:"button"})}),Object(s.jsxs)("h4",{children:[this.props.data.members.length,"\xa0Mitglieder:"]}),Object(s.jsx)("ul",{className:"userList",children:this.props.data.members.map((function(n,r){return Object(s.jsx)("li",{children:Object(s.jsxs)("div",{className:"userItem",children:[t===n.uid?Object(s.jsx)("span",{children:"Du"}):n.username,Object(s.jsxs)("div",{className:"right",children:[n.isAdmin?Object(s.jsx)("span",{className:"user-admin",children:"Admin\xa0\xa0"}):null,Object(s.jsx)(_t.a,{trigger:["click"],overlay:Object(s.jsx)(At,{gcid:e.props.gcid,memberSelf:e.props.data.memberSelf,member:n}),animation:"slide-up",alignPoint:!0,children:Object(s.jsx)("i",{className:"fas fa-ellipsis-v fa-lg",role:"button"})})]})]})},r)}))})]})}}]),n}(r.Component)),Ht=Object(h.j)(zt);function Vt(e){var t=Object(h.i)().path,n=Object(s.jsx)(Ht,{gcid:e.gcid,data:e.data});return Object(s.jsxs)(H,{children:[Object(s.jsx)(z,{displayIn:["Mobile"],children:Object(s.jsxs)(h.d,{children:[Object(s.jsx)(h.b,{path:"".concat(t,"/addUsers"),children:Object(s.jsx)(Dt,{gcid:e.gcid})}),Object(s.jsx)(h.b,{path:"*",children:n})]})}),Object(s.jsxs)(z,{displayIn:["Laptop","Tablet"],children:[Object(s.jsx)(h.d,{children:Object(s.jsx)(h.b,{path:"".concat(t,"/addUsers"),children:Object(s.jsx)(mt,{children:Object(s.jsx)(Dt,{gcid:e.gcid})})})}),n]})]})}var Jt=0,Wt=1,Yt=2,qt=3,$t=4,Kt=5,Qt=0,Xt=1,Zt=function(e){Object(j.a)(n,e);var t=Object(f.a)(n);function n(e){var s;return Object(d.a)(this,n),(s=t.call(this,e)).loadGroupChatInfo=function(){var e=Object(k.a)(y.a.mark((function e(t){var n,r;return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Ze(s.props.gcid);case 3:if(403!==(n=e.sent).status){e.next=8;break}return e.abrupt("return",$t);case 8:if(404!==n.status){e.next=12;break}return e.abrupt("return",Yt);case 12:if(!n.ok){e.next=29;break}return e.next=15,n.json();case 15:if(r=e.sent,s.setState({chatData:r}),!r.error){e.next=25;break}if("not part of chat"!==r.error){e.next=22;break}return e.abrupt("return",qt);case 22:return e.abrupt("return",Kt);case 23:e.next=27;break;case 25:if(-1===Ye.chats.group.getIndex(t)){e.next=27;break}return e.abrupt("return",Jt);case 27:e.next=30;break;case 29:return e.abrupt("return",Kt);case 30:e.next=35;break;case 32:return e.prev=32,e.t0=e.catch(0),e.abrupt("return",Kt);case 35:case"end":return e.stop()}}),e,null,[[0,32]])})));return function(t){return e.apply(this,arguments)}}(),s.chatChanged=function(){if(isNaN(s.props.gcid))s.setState({error:Wt,loaded:!0});else{var e=function(){var e=parseInt(s.props.gcid);s.loadGroupChatInfo(e).then((function(t){t===Jt?(s.selectGroupChat(e),s.setState({loaded:!0,error:Jt,gcid:e}),s.setGlobal({infoHeaderCenter:W,ihcData:{name:Ye.chats.group.get(e).chatName,gcid:e}}).then()):s.setState({loaded:!0,error:t})})).catch()};Ye.finishedLoading?e():Ye.event.on("chats loaded",(function(){e()}))}},s.state={gcid:0,loaded:!1,chatData:null,error:Jt},s}return Object(p.a)(n,[{key:"selectGroupChat",value:function(e){if(-1===Ye.chats.group.getIndex(e))this.setState({error:Yt});else{var t=Ye.chats.group.get(e);this.dispatch.selectChat(t)}}},{key:"componentDidMount",value:function(){this.chatChanged()}},{key:"componentDidUpdate",value:function(e,t,n){e.gcid!==this.props.gcid&&this.chatChanged()}},{key:"componentWillUnmount",value:function(){this.setGlobal({infoHeaderCenter:V,ihcData:null}).then()}},{key:"render",value:function(){var e=this;return Object(s.jsxs)("div",{className:"h-100",children:[function(){if(!e.state.loaded)return Object(s.jsx)(Ke,{msg:"Chat wird geladen"})}(),function(){if(e.state.error===Wt)return Object(s.jsx)(it,{});if(e.state.loaded)switch(e.state.error){case Jt:switch(e.props.tab){case Qt:return Object(s.jsx)(at,{chatType:e.global.currentChat.type,chatId:e.global.currentChat.id});case Xt:return Object(s.jsx)(Vt,{gcid:e.state.gcid,data:e.state.chatData});default:return null}case qt:return Object(s.jsx)(lt,{});case $t:return Object(s.jsx)(dt,{});case Yt:return Object(s.jsx)(pt,{});case Kt:return Object(s.jsx)(jt,{});default:return null}}()]})}}]),n}(o.Component),en=function(e){Object(j.a)(n,e);var t=Object(f.a)(n);function n(){var e;Object(d.a)(this,n);for(var s=arguments.length,r=new Array(s),a=0;a<s;a++)r[a]=arguments[a];return(e=t.call.apply(t,[this].concat(r))).elementClicked=function(t){Ye.temporaryChat.createNew(e.props.uid,e.props.username)},e}return Object(p.a)(n,[{key:"render",value:function(){return Object(s.jsx)("li",{children:Object(s.jsx)(u.b,{to:"/chat/user/"+this.props.uid,onClick:this.elementClicked,replace:!0,children:this.props.username})})}}]),n}(r.Component),tn=Object(h.j)(en),nn=(n(212),0),sn=1,rn=function(e){Object(j.a)(n,e);var t=Object(f.a)(n);function n(e){var s;return Object(d.a)(this,n),(s=t.call(this,e)).lastRequest={},s.searchChanged=function(e){s.setState({searchValue:e,searchResult:[],hasMore:!0})},s.loadChats=Object(k.a)(y.a.mark((function e(){var t,n,r,a;return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=s.state.searchValue,n=s.state.searchResult.length,s.lastRequest.searchValue===t&&s.lastRequest.length===n){e.next=22;break}return s.lastRequest={searchValue:t,length:n},e.prev=4,e.next=7,s.props.loadChats(t,n);case 7:if(!(r=e.sent).ok){e.next=16;break}return e.next=11,r.json();case 11:0===(a=e.sent).length?s.setState({hasMore:!1}):s.setState((function(e){return{searchResult:e.searchResult.concat(a)}})),s.setState({error:nn}),e.next=17;break;case 16:s.setState({error:sn});case 17:e.next=22;break;case 19:e.prev=19,e.t0=e.catch(4),s.setState({error:sn});case 22:case"end":return e.stop()}}),e,null,[[4,19]])}))),s.state={error:nn,showOptions:!1,searchValue:"",searchResult:[],hasMore:!0},s}return Object(p.a)(n,[{key:"componentDidUpdate",value:function(e,t,n){this.props.showSearchBar||this.props.searchValue!==e.searchValue&&this.searchChanged(this.props.searchValue)}},{key:"render",value:function(){var e=this;return this.state.error===sn?Object(s.jsx)("div",{className:"alert alert-danger",role:"alert",children:"Ein Fehler ist aufgetreten!"},0):Object(s.jsxs)(H,{children:[this.props.showSearchBar?Object(s.jsx)("div",{className:"user-top",children:Object(s.jsx)("div",{className:"searchUser",children:Object(s.jsx)("input",{type:"text",name:"newChat-searchUser",className:"form-control",placeholder:"Benutzer suchen",onChange:function(t){e.searchChanged()}})})}):null,Object(s.jsx)("div",{className:"selectChat",ref:function(t){return e.scrollParentRef=t},children:Object(s.jsx)(kt.a,{pageStart:0,loadMore:this.loadChats,hasMore:this.state.hasMore,loader:Object(s.jsx)("div",{className:"loader",children:Object(s.jsx)("div",{className:"spinner-border text-secondary",role:"status",children:Object(s.jsx)("span",{className:"sr-only",children:"Loading..."})})},-1),useWindow:!1,getScrollParent:function(){return e.scrollParentRef},children:Object(s.jsxs)("ul",{className:"selectChat",children:[this.state.searchResult.map((function(t,n){return Object(s.jsx)(tn,{uid:t.uid,username:t.username,hide:e.props.hide},n)})),0===this.state.searchResult.length?Object(s.jsx)("div",{className:"nothingFound",children:"Nichts gefunden!"},-1):null]})})})]})}}]),n}(r.Component);n(213),n(214);function an(e){return cn.apply(this,arguments)}function cn(){return(cn=Object(k.a)(y.a.mark((function e(t){var n;return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(t)},e.next=3,oe("/user/noChat",n);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function on(e){return un.apply(this,arguments)}function un(){return(un=Object(k.a)(y.a.mark((function e(t){var n;return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={method:"PUT",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(t)},e.next=3,oe("/group/",n);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function hn(e){return ln.apply(this,arguments)}function ln(){return(ln=Object(k.a)(y.a.mark((function e(t){var n,s;return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(t)},e.next=3,oe("/user/",n);case 3:if(!(s=e.sent).ok){e.next=10;break}return e.next=7,s.json();case 7:return e.abrupt("return",e.sent);case 10:throw new Error("Error fetching users");case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var dn=0,pn=function(e){Object(j.a)(n,e);var t=Object(f.a)(n);function n(e){var s;return Object(d.a)(this,n),(s=t.call(this,e)).newGroupClick=function(e){e.stopPropagation(),s.props.setCurrentTab(vn.newGroup)},s.joinGroupClick=function(e){e.stopPropagation(),s.props.setCurrentTab(vn.chooseGroup)},s.searchChanged=function(e){var t=e.target.value;s.setState({searchValue:t,searchValid:!0})},s.loadChats=function(){var e=Object(k.a)(y.a.mark((function e(t,n){return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,an({search:t,limit:10,start:n});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),s.state={error:dn,searchValue:""},s}return Object(p.a)(n,[{key:"render",value:function(){var e=Object(s.jsx)("div",{className:"options",children:Object(s.jsxs)("ul",{children:[Object(s.jsx)("li",{onClick:this.newGroupClick,children:"neue Gruppe"}),Object(s.jsx)("li",{onClick:this.joinGroupClick,children:"einer Gruppe beitreten"})]})});return Object(s.jsxs)(H,{children:[Object(s.jsxs)("div",{className:"user-top",children:[Object(s.jsx)("div",{className:"searchUser",children:Object(s.jsx)("input",{type:"text",name:"newChat-searchUser",className:"form-control",placeholder:"Benutzer suchen",onChange:this.searchChanged})}),Object(s.jsx)("div",{className:"user-more",children:Object(s.jsx)(_t.a,{trigger:["click"],overlay:e,animation:"slide-up",alignPoint:!0,children:Object(s.jsx)("i",{className:"fas fa-ellipsis-h fa-2x",role:"button"})})})]}),Object(s.jsx)(rn,{showSearchBar:!1,searchValue:this.state.searchValue,loadChats:this.loadChats})]})}}]),n}(r.Component),jn=(n(215),n.p+"static/media/placeholder.3c40b139.png"),fn=function(e){Object(j.a)(n,e);var t=Object(f.a)(n);function n(e){var s;return Object(d.a)(this,n),(s=t.call(this,e)).groupNameChanged=function(e){s.setState({groupName:e.target.value})},s.descriptionChanged=function(e){s.setState({description:e.target.value})},s.isPublicChanged=function(){s.setState((function(e){return{isPublic:!e.isPublic}}))},s.formSubmitted=function(e){e.preventDefault(),""!==s.state.groupName&&s.props.submitGroup({name:s.state.groupName,description:s.state.description,isPublic:s.state.isPublic})},s.state={groupName:"",description:"",isPublic:!1},s}return Object(p.a)(n,[{key:"render",value:function(){return Object(s.jsx)("div",{className:"groupInfoForm",children:Object(s.jsxs)("form",{onSubmit:this.formSubmitted,children:[Object(s.jsx)("img",{style:{display:"none"},id:"groupImgInput1",src:jn,alt:"Placeholder"}),Object(s.jsxs)("div",{className:"form-group",children:[Object(s.jsx)("label",{htmlFor:"exampleFormControlInput1",children:"Gruppenname"}),Object(s.jsx)("input",{type:"text",name:"groupName",className:"form-control",id:"input-groupName",placeholder:"Gruppenname",value:this.state.name,onChange:this.groupNameChanged,minLength:1})]}),Object(s.jsxs)("div",{className:"form-group",children:[Object(s.jsx)("label",{htmlFor:"description1",children:"Beschreibung"}),Object(s.jsx)("textarea",{className:"form-control",id:"description1",rows:"3",value:this.state.description,onChange:this.descriptionChanged})]}),Object(s.jsx)("div",{className:"form-group",children:Object(s.jsxs)("label",{className:"check-container",children:["\xf6ffentlicher chat",Object(s.jsx)("input",{type:"checkbox",checked:this.state.isPublic,onChange:this.isPublicChanged}),Object(s.jsx)("span",{className:"checkmark",children:Object(s.jsx)("i",{className:"fas fa-check"})})]})}),Object(s.jsx)("div",{className:"form-group",children:Object(s.jsx)("button",{type:"submit",className:"float-right btn btn-primary m-3",children:"Gruppe erstellen"})})]})})}}]),n}(r.Component),bn=0,mn=1,gn=function(e){Object(j.a)(n,e);var t=Object(f.a)(n);function n(e){var s;return Object(d.a)(this,n),(s=t.call(this,e)).showEnterChatInfo=function(e){s.setState({currentTab:mn,selectedUsers:e})},s.submitGroup=function(e){for(var t=new Array(s.state.selectedUsers.length),n=0;n<s.state.selectedUsers.length;n++)t[n]={uid:s.state.selectedUsers[n].uid,username:s.state.selectedUsers[n].username,isAdmin:!1};s.createGroupChat(e,t).then((function(e){}))},s.createGroupChat=function(){var e=Object(k.a)(y.a.mark((function e(t,n){return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,on({data:t,users:n});case 3:e.sent.ok&&s.props.history.goBack(),e.next=9;break;case 7:e.prev=7,e.t0=e.catch(0);case 9:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,n){return e.apply(this,arguments)}}(),s.loadUsers=function(){var e=Object(k.a)(y.a.mark((function e(t,n){return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,hn({search:t,limit:10,start:n});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),s.state={currentTab:bn,selectedUsers:[]},s}return Object(p.a)(n,[{key:"render",value:function(){switch(this.state.currentTab){case bn:return Object(s.jsx)(St,{onNext:this.showEnterChatInfo,loadUsers:this.loadUsers});case mn:return Object(s.jsx)(fn,{submitGroup:this.submitGroup});default:return null}}}]),n}(r.Component),On=Object(h.j)(gn),vn=(n(216),{chooseUser:0,newGroup:1,chooseGroup:2}),xn=function(e){Object(j.a)(n,e);var t=Object(f.a)(n);function n(e){var s;return Object(d.a)(this,n),(s=t.call(this,e)).setCurrentTab=function(e){s.setState({currentTab:e})},s.state={currentTab:vn.chooseUser},s}return Object(p.a)(n,[{key:"render",value:function(){var e=this;return Object(s.jsxs)(H,{children:[Object(s.jsx)(gt,{children:Object(s.jsx)("h1",{children:function(){switch(e.state.currentTab){case vn.chooseUser:return"Neuer Chat";case vn.newGroup:return"Neue Gruppe";case vn.chooseGroup:return"Gruppe ausw\xe4hlen";default:return"Neuer Chat"}}()})}),Object(s.jsx)(Ot,{children:Object(s.jsx)("div",{className:"newChat",children:function(){switch(e.state.currentTab){case vn.chooseUser:return Object(s.jsx)(pn,{setCurrentTab:e.setCurrentTab,hide:e.props.hide});case vn.newGroup:return Object(s.jsx)(On,{});case vn.chooseGroup:return Object(s.jsx)("div",{children:Object(s.jsx)("h4",{children:"chooseGroup"})});default:return Object(s.jsx)(pn,{setCurrentTab:e.setCurrentTab,hide:e.props.hide})}}()})})]})}}]),n}(r.Component),yn=function(){var e=Object(k.a)(y.a.mark((function e(t){var n,s;return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={method:"GET",headers:{Accept:"application/json"}},e.next=3,oe("/user/"+t,n);case 3:if(!(s=e.sent).ok){e.next=10;break}return e.next=7,s.json();case 7:return e.abrupt("return",e.sent);case 10:throw new Error("Error fetching UserInfo");case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),kn=0,wn=1,Cn=2,Nn=3,Sn=4,Tn=5,Mn=function(e){Object(j.a)(n,e);var t=Object(f.a)(n);function n(e){var s;return Object(d.a)(this,n),(s=t.call(this,e)).setUser=Object(k.a)(y.a.mark((function e(){var t,n;return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!isNaN(s.props.uid)){e.next=4;break}s.setState({error:Cn}),e.next=16;break;case 4:return t=parseInt(s.props.uid),s.setState({uid:t,error:kn,loaded:!1}),e.prev=6,e.next=9,yn(t);case 9:(n=e.sent).uidSelf===t?s.setState({error:wn,loaded:!0}):n.userExists?n.blocked?s.setState({error:Sn,loaded:!0}):s.setState({userInfo:n,loaded:!0}):s.setState({error:Nn,loaded:!0}),e.next=16;break;case 13:e.prev=13,e.t0=e.catch(6),s.setState({error:Tn,loaded:!0});case 16:case"end":return e.stop()}}),e,null,[[6,13]])}))),s.state={uid:0,loaded:!1,error:kn,userInfo:null},s}return Object(p.a)(n,[{key:"render",value:function(){return this.state.loaded?this.state.error===wn?Object(s.jsxs)(H,{children:[Object(s.jsx)(gt,{children:Object(s.jsx)("h1",{children:"Du"})}),Object(s.jsx)(Ot,{children:"xx"})]}):this.state.error!==kn?Object(s.jsx)("div",{children:"Error!"}):Object(s.jsxs)(H,{children:[Object(s.jsx)(gt,{children:Object(s.jsxs)("h1",{children:[this.state.userInfo.username,"\xa0",Object(s.jsx)(u.b,{to:"/chat/user/"+this.state.uid,children:Object(s.jsx)("i",{className:"far fa-comment-alt"})})]})}),Object(s.jsx)(Ot,{children:Object(s.jsx)("h2",{children:"Gruppen"})})]}):null}},{key:"componentDidMount",value:function(){var e=Object(k.a)(y.a.mark((function e(){return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.setUser();case 3:e.next=8;break;case 5:e.prev=5,e.t0=e.catch(0),this.setState({error:4,loaded:!0});case 8:case"end":return e.stop()}}),e,this,[[0,5]])})));return function(){return e.apply(this,arguments)}}()},{key:"componentDidUpdate",value:function(){var e=Object(k.a)(y.a.mark((function e(t,n,s){return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,t.uid===this.props.uid){e.next=4;break}return e.next=4,this.setUser();case 4:e.next=9;break;case 6:e.prev=6,e.t0=e.catch(0),this.setState({error:4,loaded:!0});case 9:case"end":return e.stop()}}),e,this,[[0,6]])})));return function(t,n,s){return e.apply(this,arguments)}}()}]),n}(r.Component),Un=(n(217),function(e){Object(j.a)(n,e);var t=Object(f.a)(n);function n(){return Object(d.a)(this,n),t.apply(this,arguments)}return Object(p.a)(n,[{key:"render",value:function(){return Object(s.jsxs)(H,{children:[Object(s.jsx)(gt,{children:Object(s.jsx)("h1",{children:"Einstellungen"})}),Object(s.jsx)(Ot,{children:Object(s.jsxs)("div",{className:"settings",children:["to be implemented",Object(s.jsx)("div",{className:"about",children:Object(s.jsx)(u.b,{to:"/about",children:"\xfcber diese Seite"})})]})})]})}}]),n}(r.Component));function En(e){var t=Object(h.i)().path;return Object(s.jsxs)(h.d,{children:[Object(s.jsxs)(h.b,{path:"".concat(t,"/newChat"),children:[e.children,Object(s.jsx)(mt,{children:Object(s.jsx)(xn,{})})]}),Object(s.jsx)(h.b,{path:"".concat(t,"/userInfo/:uidInfo"),render:function(t){return Object(s.jsxs)(H,{children:[e.children,Object(s.jsx)(mt,{children:Object(s.jsx)(Mn,{uid:t.match.params.uidInfo})})]})}}),Object(s.jsxs)(h.b,{path:"".concat(t,"/settings"),children:[e.children,Object(s.jsx)(mt,{children:Object(s.jsx)(Un,{})})]}),Object(s.jsx)(h.b,{path:"*",children:e.children})]})}function Dn(e){var t=Object(h.i)().path;return Object(s.jsxs)("div",{className:"main-container",children:[Object(s.jsx)("div",{className:"mc-left",children:Object(s.jsx)($e,{})}),Object(s.jsx)("div",{className:"mc-right",children:Object(s.jsxs)(h.d,{children:[Object(s.jsx)(h.b,{path:"".concat(t,"/user/:uid"),render:function(e){return Object(s.jsx)(En,{children:Object(s.jsx)(ft,{uid:e.match.params.uid})})}}),Object(s.jsx)(h.b,{path:"".concat(t,"/group/:gcid"),render:function(e){return Object(s.jsx)(En,{children:Object(s.jsx)(Zt,{gcid:e.match.params.gcid,tab:Qt})})}}),Object(s.jsx)(h.b,{path:"".concat(t,"/groupInfo/:gcid"),render:function(e){return Object(s.jsx)(En,{children:Object(s.jsx)(Zt,{gcid:e.match.params.gcid,tab:Xt})})}}),Object(s.jsx)(h.b,{path:t,children:Object(s.jsx)(En,{children:Object(s.jsx)("h1",{children:"noch kein chat ausgew\xe4hlt"})})})]})})]})}n(218);var _n=function(e){Object(j.a)(n,e);var t=Object(f.a)(n);function n(e){var s;return Object(d.a)(this,n),(s=t.call(this,e)).typeStateChanged=function(){var e=Ye.getChat(s.props.chatType,s.props.chatId);s.setState({usersTyping:e.getUsersTyping()})},s.state={usersTyping:[]},s}return Object(p.a)(n,[{key:"render",value:function(){return Object(s.jsx)("div",{className:"typeMsg-container",children:this.state.usersTyping.map((function(e,t){return Object(s.jsx)("div",{className:"typeMsg",children:e.username+" schreibt..."},t)}))})}},{key:"componentDidMount",value:function(){Ye.getChat(this.props.chatType,this.props.chatId).event.on("typeState changed",this.typeStateChanged)}},{key:"componentDidUpdate",value:function(e,t,n){e.chatType===this.props.chatType&&e.chatId===this.props.chatId||(Ye.getChat(e.chatType,e.chatId).event.rm("typeState changed",this.typeStateChanged),Ye.getChat(this.props.chatType,this.props.chatId).event.on("typeState changed",this.typeStateChanged))}},{key:"componentWillUnmount",value:function(){Ye.getChat(this.props.chatType,this.props.chatId).event.rm("typeState changed",this.typeStateChanged)}}]),n}(r.Component);function In(e){var t=Object(h.i)().path;return Object(s.jsxs)(h.d,{children:[Object(s.jsx)(h.b,{path:"".concat(t,"/newChat"),children:Object(s.jsx)(xn,{})}),Object(s.jsx)(h.b,{path:"".concat(t,"/userInfo/:uidInfo"),render:function(e){return Object(s.jsx)(Mn,{uid:e.match.params.uidInfo})}}),Object(s.jsx)(h.b,{path:"".concat(t,"/settings"),children:Object(s.jsx)(Un,{})}),Object(s.jsx)(h.b,{path:"*",children:e.children})]})}function An(e){var t=Object(h.i)().path,n=Object(o.useGlobal)(),r=Object(U.a)(n,2),a=r[0],c=(r[1],function(){return""!==a.currentChat.type&&0!==a.currentChat.id?Object(s.jsx)(_n,{chatType:a.currentChat.type,chatId:a.currentChat.id}):null});return Object(s.jsx)("div",{className:"main-container",children:Object(s.jsxs)(h.d,{children:[Object(s.jsx)(h.b,{path:"".concat(t,"/user/:uid"),render:function(e){return Object(s.jsxs)(In,{children:[Object(s.jsx)(ft,{uid:e.match.params.uid}),c()]})}}),Object(s.jsx)(h.b,{path:"".concat(t,"/group/:gcid"),render:function(e){return Object(s.jsxs)(In,{children:[Object(s.jsx)(Zt,{gcid:e.match.params.gcid,tab:Qt}),c()]})}}),Object(s.jsx)(h.b,{path:"".concat(t,"/groupInfo/:gcid"),render:function(e){return Object(s.jsx)(In,{children:Object(s.jsx)(Zt,{gcid:e.match.params.gcid,tab:Xt})})}}),Object(s.jsx)(h.b,{path:t,children:Object(s.jsx)(In,{children:Object(s.jsx)("div",{className:"chat-list-outer-small",children:Object(s.jsx)($e,{})})})}),Object(s.jsx)(h.b,{path:"*",children:Object(s.jsx)("h3",{children:"Not found!"})})]})})}n(219);var Rn=function(e){Object(j.a)(n,e);var t=Object(f.a)(n);function n(e){var s;return Object(d.a)(this,n),(s=t.call(this,e)).state={modal:0,modalInfo:null,notifications:0},s}return Object(p.a)(n,[{key:"componentDidMount",value:function(){Ye.initCalled||Ye.init().then((function(e){}))}},{key:"render",value:function(){return Object(s.jsxs)("div",{className:"h-100",children:[Object(s.jsx)(Z,{}),Object(s.jsx)(z,{displayIn:["Mobile"],children:Object(s.jsx)(An,{})}),Object(s.jsx)(z,{displayIn:["Laptop","Tablet"],children:Object(s.jsx)(Dn,{})})]})}}]),n}(r.Component);n(220);function Gn(){return Object(s.jsxs)("div",{className:"about",children:[Object(s.jsx)("h2",{children:"\xdcber diese Seite"}),Object(s.jsx)("h4",{children:"Erstellt von:"}),"Stefan Schlaghuber",Object(s.jsx)("br",{}),"2002 Gro\xdfmugl",Object(s.jsx)("br",{}),"stefan.schlaghuber@gmail.com",Object(s.jsx)("br",{})]})}n(221),n(222);function Ln(e){return Bn.apply(this,arguments)}function Bn(){return(Bn=Object(k.a)(y.a.mark((function e(t){var n;return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={method:"GET",headers:{Accept:"application/json"}},e.next=3,oe("/user/self",n,t);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Pn(){Object(o.addReducer)("deleteAuthTokens",(function(e,t){return localStorage.removeItem("authTokens"),location.reload(),t.deleteUserSelf(),t.resetGlobal(),We.destruct(),We=new Je,{loaded:!0,authTokens:void 0}})),Object(o.addReducer)("initAuthTokens",function(){var e=Object(k.a)(y.a.mark((function e(t,n,s){var r,a,c,i;return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Te();case 3:return e.next=5,Ln(s);case 5:if(403!==(r=e.sent).status){e.next=11;break}return localStorage.removeItem("authTokens"),e.abrupt("return",{loaded:!0,authTokens:void 0});case 11:return e.next=13,r.json();case 13:return a=e.sent,c=a.uid,i=a.username,n.setUserSelf(c,i),e.abrupt("return",{loaded:!0,authTokens:s});case 17:e.next=23;break;case 19:return e.prev=19,e.t0=e.catch(0),console.error(e.t0),e.abrupt("return",{loaded:!1});case 23:case"end":return e.stop()}}),e,null,[[0,19]])})));return function(t,n,s){return e.apply(this,arguments)}}()),Object(o.addReducer)("setAuthTokens",(function(e,t,n){return localStorage.setItem("authTokens",JSON.stringify(n)),{loaded:!0,authTokens:n}}))}function Fn(){var e=Object(o.useDispatch)();return Object(o.useEffect)((function(){var t=JSON.parse(localStorage.getItem("authTokens"));e.initAuthTokens(t)}),[]),Object(s.jsx)(u.a,{children:Object(s.jsxs)(h.d,{children:[Object(s.jsx)(D,{path:"/chat",component:Rn}),Object(s.jsx)(h.b,{exact:!0,path:"/login",component:S}),Object(s.jsx)(h.b,{exact:!0,path:"/register",component:M}),Object(s.jsx)(h.b,{path:"/about",children:Object(s.jsx)(Gn,{})}),Object(s.jsx)(h.b,{exact:!0,path:"/",children:Object(s.jsx)(h.a,{to:"/chat"})}),Object(s.jsx)(h.b,{path:"*",children:Object(s.jsx)(zn,{})})]})})}function zn(){var e=Object(h.h)();return Object(s.jsx)("div",{children:Object(s.jsxs)("h3",{children:["No match for ",Object(s.jsx)("code",{children:e.pathname})]})})}Object(o.setGlobal)({loaded:!1,authTokens:void 0,userSelf:{},infoHeaderCenter:V,ihcData:null,currentChat:{type:"",id:0,newMessages:0,messages:[]},tempChat:null,chats:[],newMessages:0}),function(){function e(e){Object(o.setGlobal)({chats:e})}Ye.finishedLoading?e(Ye.getChatArraySortedByDate()):Ye.event.on("chats loaded",e)}(),Object(o.addReducer)("setUserSelf",(function(e,t,n,s){return{userSelf:{uid:n,username:s}}})),Object(o.addReducer)("deleteUserSelf",(function(e,t){return{userSelf:{}}})),Object(o.addReducer)("resetGlobal",(function(e,t){return{infoHeaderCenter:V,ihcData:null,currentChat:{type:"",id:0,newMessages:0,messages:[]},tempChat:null,chats:[],newMessages:0}})),function(){var e=this;function t(e,t){return e.chats.findIndex((function(e){return e.id===t.id&&e.type===t.type}))}Object(o.addReducer)("newMsg",(function(e,n,s,r,a){var c=t(e,s);if(-1!==c){if(function(e,t){var n=e.currentChat;return n.type===t.type&&n.id===t.id}(e,s)){var i=e.chats.splice(0),o=i[c];return o.latestMessage=s.getLatestMessageObject(),o.unreadMessages=0,i.splice(c,1),i.unshift(o),{chats:i,currentChat:Object(O.a)(Object(O.a)({},e.currentChat),{},{messages:e.currentChat.messages.concat(a),newMessages:e.currentChat.newMessages+1})}}var u=e.chats.splice(0),h=u[c];h.latestMessage=s.getLatestMessageObject();var l=e.newMessages;return 0===h.unreadMessages&&l++,h.unreadMessages=r+1,u.splice(c,1),u.unshift(h),{chats:u,newMessages:l}}})),Object(o.addReducer)("selectChat",(function(e,n,s){var r=t(e,s);if(-1!==r){var a=e.chats.splice(0),c=a[r],i=e.newMessages;return c.unreadMessages>0&&i--,c.unreadMessages=0,a[r]=c,Ye.socket.emit("change chat",{type:s.type,id:s.id}),{currentChat:{type:s.type,id:s.id,messages:s.getMessages(),newMessages:0},chats:a,tempChat:null,newMessages:i}}})),Object(o.addReducer)("selectNoChat",(function(e,t){return Ye.socket.emit("change chat",null),{currentChat:{type:"",id:0,messages:[]}}})),Object(o.addReducer)("addLoadedMessages",(function(e,t,n){return{currentChat:Object(O.a)(Object(O.a)({},e.currentChat),{},{messages:n?n.concat(e.currentChat.messages):e.currentChat.messages})}})),Object(o.addReducer)("addChat",(function(e,t,n){var s,r,a=e.chats.splice(0),c=n.getChatObject();if(0===a.length)return{chats:[c]};for(var i=0;i<a.length;i++)if(r=c,!(s=a[i]).latestMessage||r.latestMessage&&s.latestMessage.date.getTime()<r.latestMessage.date.getTime()){a.splice(i,0,c);break}return{chats:a}})),Object(o.addReducer)("removeChat",(function(n,s,r){var a=t(n,r),c=e.state.chats.splice(0);return c.splice(a,1),{chats:c}})),Object(o.addReducer)("showTempChat",(function(e,t){var n=Ye.temporaryChat.chatNow;return Ye.socket.emit("change chat",null),{tempChat:n.getChatObject(),currentChat:{type:"tempChat",id:0,messages:[]}}})),Object(o.addReducer)("updateTempChat",(function(e,t,n){return{tempChat:n.getChatObject(),currentChat:{type:"tempChat",id:0,messages:[]}}})),Object(o.addReducer)("hideTempChat",(function(e,t){return{tempChat:null}}))}(),Pn();Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(Object(s.jsx)(a.a.StrictMode,{children:Object(s.jsx)(Fn,{})}),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[223,1,2]]]);
//# sourceMappingURL=main.a5607957.chunk.js.map