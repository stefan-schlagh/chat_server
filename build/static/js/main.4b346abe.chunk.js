(this.webpackJsonpchat_client=this.webpackJsonpchat_client||[]).push([[0],{143:function(e,t){},149:function(e,t,a){"use strict";a.r(t);var n,s,r=a(0),i=a.n(r),c=a(21),o=a.n(c),u=a(9),l=a(22),h=a(37),d=a(2),m=a(3),p=a(4),f=a(5),g=a(40),v=a.n(g),y=function(e){Object(p.a)(a,e);var t=Object(f.a)(a);function a(){return Object(d.a)(this,a),t.apply(this,arguments)}return Object(m.a)(a,[{key:"render",value:function(){return i.a.createElement("small",{className:"alert alert-danger p-1 message d-block"},this.props.children)}}]),a}(r.Component),b=a(7),E=a.n(b),k=a(10),w=!1;function C(e){w=e}function N(){return S.apply(this,arguments)}function S(){return(S=Object(k.a)(E.a.mark((function e(){var t,a,r;return E.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t={method:"GET",headers:{Accept:"application/json"}},e.next=4,fetch("/user/self",t);case 4:if(403===(a=e.sent).status&&(w=!1),!a.ok){e.next=16;break}return e.next=9,a.json();case 9:return r=e.sent,w=!0,s=r.uid,n=r.username,e.abrupt("return",w);case 16:return e.abrupt("return",!1);case 17:e.next=22;break;case 19:return e.prev=19,e.t0=e.catch(0),e.abrupt("return",!1);case 22:case"end":return e.stop()}}),e,null,[[0,19]])})))).apply(this,arguments)}function O(){return(O=Object(k.a)(E.a.mark((function e(t,a){var n,s,r;return E.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n={method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({username:t,password:a})},e.next=4,fetch("/auth/login",n);case 4:if(!(s=e.sent).ok){e.next=16;break}return e.next=8,s.json();case 8:if(!(r=e.sent).success){e.next=13;break}return w=!0,e.next=13,N();case 13:return e.abrupt("return",r);case 16:return e.abrupt("return",null);case 17:e.next=22;break;case 19:return e.prev=19,e.t0=e.catch(0),e.abrupt("return",null);case 22:case"end":return e.stop()}}),e,null,[[0,19]])})))).apply(this,arguments)}function j(){return(j=Object(k.a)(E.a.mark((function e(t,a){var n,s,r;return E.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n={method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({username:t,password:a})},e.next=4,fetch("/auth/register",n);case 4:if(!(s=e.sent).ok){e.next=16;break}return e.next=8,s.json();case 8:if(!(r=e.sent).success){e.next=13;break}return w=!0,e.next=13,N();case 13:return e.abrupt("return",r);case 16:return e.abrupt("return",null);case 17:e.next=22;break;case 19:return e.prev=19,e.t0=e.catch(0),e.abrupt("return",null);case 22:case"end":return e.stop()}}),e,null,[[0,19]])})))).apply(this,arguments)}function T(){return(T=Object(k.a)(E.a.mark((function e(){var t,a,n;return E.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t={method:"GET",headers:{Accept:"application/json"}},e.next=4,fetch("/auth/logout",t);case 4:if(!(a=e.sent).ok){e.next=12;break}return e.next=8,a.json();case 8:return n=e.sent,e.abrupt("return",n.success);case 12:return e.abrupt("return",!1);case 13:e.next=18;break;case 15:return e.prev=15,e.t0=e.catch(0),e.abrupt("return",!1);case 18:case"end":return e.stop()}}),e,null,[[0,15]])})))).apply(this,arguments)}var x=a(19),M=a.n(x);function _(){M.a.fn.extend({pwToggle:function(){this.prepend(M()("<i>").addClass("fas fa-eye-slash psw-toggle-icon").css({position:"absolute",right:"20px",top:"11px",color:"#666",cursor:"pointer",width:"16px",height:"16px"}).hover((function(){M()(this).css("color","#666")}),(function(){M()(this).css("color","#000")}))),this.css({position:"relative"});var e=this.get(0).children[0],t=this.get(0).children[1];e.addEventListener("click",(function(){"password"===t.type?(e.classList.remove("fa-eye-slash"),e.classList.add("fa-eye"),t.type="text"):(e.classList.remove("fa-eye"),e.classList.add("fa-eye-slash"),t.type="password")}))}})}var U=function(e){Object(p.a)(a,e);var t=Object(f.a)(a);function a(e){var n;return Object(d.a)(this,a),(n=t.call(this,e)).changeHandler=function(e){var t=e.target.name,a=e.target.value;n.setState(Object(h.a)({},t,a))},n.submitHandler=function(e){e.preventDefault();var t,a,s={username:{presence:!0,length:{minimum:3,tooShort:"has to be at least 3 characters long",maximum:30,tooLong:"can only be 30 characters long"},format:{pattern:new RegExp(/^\w\w*$/),message:"not valid"}},password:{presence:!0,length:{minimum:8,tooShort:"has to be at least 8 characters long",maximum:30,tooLong:"can only be 30 characters long"}}},r=v()({username:n.state.username,password:n.state.password},s);"undefined"!=typeof r?(t="undefined"!=typeof r.username?r.username[0]:"",a="undefined"!=typeof r.password?r.password[0]:"",n.setState({valid:!1,uNameErr:t,pwErr:a})):(n.setState({valid:!0,uNameErr:"",pwErr:""}),function(e,t){return O.apply(this,arguments)}(n.state.username,n.state.password).then((function(e){e.success?n.setState({valid:!0,redirect:!0}):(void 0!==e.username&&n.setState({valid:!1,uNameErr:e.username}),void 0!==e.password&&n.setState({valid:!1,pwErr:e.password}))})))},n.uNameErr=function(){if(""!==n.state.uNameErr)return i.a.createElement(y,null,n.state.uNameErr)},n.pwErr=function(){if(""!==n.state.pwErr)return i.a.createElement(y,null,n.state.pwErr)},n.state={uNameErr:"",username:"",pwErr:"",password:"",valid:!1,redirect:!1},_(),n}return Object(m.a)(a,[{key:"render",value:function(){return this.state.redirect?(C(!0),location.reload(),i.a.createElement("div",null,i.a.createElement("div",null,"redirect"),i.a.createElement(l.a,{to:"/chat"}))):i.a.createElement("div",{className:"h-100",style:{display:"flex"}},i.a.createElement("div",{className:"col-sm-12 my-auto"},i.a.createElement("div",{className:"container border rounded p-3",style:{maxWidth:"800px"}},i.a.createElement("h1",null,"Login"),i.a.createElement("form",{onSubmit:this.submitHandler},i.a.createElement("div",{className:"form-group"},i.a.createElement("label",{htmlFor:"username"},"Benutzername:"),this.uNameErr(),i.a.createElement("input",{type:"text",name:"username",className:"form-control",placeholder:"Benutzernamen eingeben",onChange:this.changeHandler})),i.a.createElement("div",{className:"form-group"},i.a.createElement("label",{htmlFor:"password"},"Passwort:"),this.pwErr(),i.a.createElement("div",{id:"psw-group"},i.a.createElement("input",{type:"password",name:"password",className:"form-control",placeholder:"Passwort eingeben",onChange:this.changeHandler}))),i.a.createElement("div",{className:"form-group"},"haben Sie noch keinen Account? ",i.a.createElement(u.b,{to:"/register"},"Jetzt registrieren")),i.a.createElement("input",{type:"submit",className:"btn btn-primary",value:"Login"})))))}},{key:"componentDidMount",value:function(){M()("#psw-group").pwToggle()}}]),a}(r.Component),D=function(e){Object(p.a)(a,e);var t=Object(f.a)(a);function a(e){var n;return Object(d.a)(this,a),(n=t.call(this,e)).changeHandler=function(e){var t=e.target.name,a=e.target.value;n.setState(Object(h.a)({},t,a))},n.submitHandler=function(e){e.preventDefault();var t,a,s,r={username:{presence:!0,length:{minimum:3,tooShort:"has to be at least 3 characters long",maximum:30,tooLong:"can only be 30 characters long"},format:{pattern:new RegExp(/^\w\w*$/),message:"not valid"}},password:{presence:!0,length:{minimum:8,tooShort:"has to be at least 8 characters long",maximum:30,tooLong:"can only be 30 characters long"}},passwordRepeat:{presence:!0,equality:"password",length:{minimum:8,tooShort:"has to be at least 8 characters long",maximum:30,tooLong:"can only be 30 characters long"}}},i=v()({username:n.state.username,password:n.state.password,passwordRepeat:n.state.pwRepeat},r);"undefined"!=typeof i?(t="undefined"!=typeof i.username?i.username[0]:"",a="undefined"!=typeof i.password?i.password[0]:"",s="undefined"!=typeof i.passwordRepeat?i.passwordRepeat[0]:"",n.setState({valid:!1,uNameErr:t,pwErr:a,pwRepeatErr:s})):(n.setState({valid:!0,uNameErr:"",pwErr:"",pwRepeatErr:""}),function(e,t){return j.apply(this,arguments)}(n.state.username,n.state.password).then((function(e){e.success?n.setState({valid:!0,redirect:!0}):void 0!==e.username&&n.setState({valid:!1,uNameErr:e.username}),console.log(e)})))},n.uNameErr=function(){if(""!==n.state.uNameErr)return i.a.createElement(y,null,n.state.uNameErr)},n.pwErr=function(){if(""!==n.state.pwErr)return i.a.createElement(y,null,n.state.pwErr)},n.pwRepeatErr=function(){if(""!==n.state.pwRepeatErr)return i.a.createElement(y,null,n.state.pwRepeatErr)},n.state={uNameErr:"",username:"",pwErr:"",password:"",pwRepeatErr:"",pwRepeat:"",valid:!1,redirect:!1},_(),n}return Object(m.a)(a,[{key:"render",value:function(){return this.state.redirect?(C(!0),console.log("redirect"),location.reload(),i.a.createElement("div",null,i.a.createElement("div",null,"redirect"),i.a.createElement(l.a,{to:"/chat"}))):i.a.createElement("div",{className:"h-100",style:{display:"flex"}},i.a.createElement("div",{className:"col-sm-12 my-auto"},i.a.createElement("div",{className:"container border rounded p-3",style:{maxWidth:"800px"}},i.a.createElement("h1",null,"Registrieren"),i.a.createElement("form",{onSubmit:this.submitHandler},i.a.createElement("div",{className:"form-group"},i.a.createElement("label",{htmlFor:"username"},"Benutzername:"),this.uNameErr(),i.a.createElement("input",{type:"text",name:"username",className:"form-control",placeholder:"Benutzernamen eingeben",onChange:this.changeHandler})),i.a.createElement("div",{className:"form-group"},i.a.createElement("label",{htmlFor:"password"},"Passwort:"),this.pwErr(),i.a.createElement("div",{id:"psw-group"},i.a.createElement("input",{type:"password",name:"password",className:"form-control",placeholder:"Passwort eingeben",onChange:this.changeHandler}))),i.a.createElement("div",{className:"form-group"},i.a.createElement("label",{htmlFor:"password"},"Passwort wiederholen:"),this.pwRepeatErr(),i.a.createElement("div",{id:"psw-group-repeat"},i.a.createElement("input",{type:"password",name:"pwRepeat",className:"form-control",placeholder:"Passwort eingeben",onChange:this.changeHandler}))),i.a.createElement("input",{type:"submit",className:"btn btn-primary",value:"Registrieren"})))))}},{key:"componentDidMount",value:function(){M()("#psw-group-repeat, #psw-group").pwToggle()}}]),a}(r.Component),I=(a(99),a(6)),L=a.n(I),B=992,R=768,A=991,G=767,H=320,P=425,V=function(){return{width:window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,height:window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight}},W=V(),z={width:W.width,height:W.height},F=function(e){Object(p.a)(a,e);var t=Object(f.a)(a);function a(){var e;Object(d.a)(this,a);for(var n=arguments.length,s=new Array(n),r=0;r<n;r++)s[r]=arguments[r];return(e=t.call.apply(t,[this].concat(s))).state=z,e.render=function(){var t=e.props,a=t.children,n=t.displayIn,s=e.state,r=s.width,c=s.height,o=e.shouldRender(n,r,c);return i.a.createElement(i.a.Fragment,null,o?a:null)},e.handleResize=function(){var t=V(),a=t.width,n=t.height;e.setState({width:a,height:n})},e.shouldRender=function(e,t,a){return-1!==e.indexOf("Laptop")&&t>=B||(-1!==e.indexOf("Tablet")&&t<=A&&t>=R||(-1!==e.indexOf("Mobile")&&t<=G||(-1!==e.indexOf("MobilePortrait")&&t<=G&&a>=P||!!(-1!==e.indexOf("MobileLandScape")&&t<=G&&a<=H))))},e}return Object(m.a)(a,[{key:"componentDidMount",value:function(){window.addEventListener("resize",this.handleResize,!1)}},{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this.handleResize,!1)}}]),a}(i.a.PureComponent),Y=0,q=1,J=2;Object(I.setGlobal)({infoHeaderCenter:Y,data:null}).then();var $=function(e){Object(p.a)(a,e);var t=Object(f.a)(a);function a(){return Object(d.a)(this,a),t.apply(this,arguments)}return Object(m.a)(a,[{key:"render",value:function(){var e=this,t=this.props.location.pathname;return L.a.createElement("div",null,L.a.createElement(F,{displayIn:["Mobile"]},L.a.createElement("div",{className:"float-left top-left"},L.a.createElement("i",{id:"btnBackToChatList",className:"fas fa-arrow-left fa-2x d-block d-md-none",onClick:function(){e.props.history.goBack()}}),e.props.newMessages>0?L.a.createElement("div",{className:"btnBack-number"},e.props.newMessages):null)),function(){switch(e.global.infoHeaderCenter){case q:return L.a.createElement("div",{id:"chat-info",className:"chat-info float-left top-center pt-2"},L.a.createElement("h3",{id:"chat-info-name"},e.global.ihcData.name),L.a.createElement(u.b,{to:t+"/userInfo/"+e.global.ihcData.uid},L.a.createElement("i",{className:"fas fa-info-circle fa-2x","data-toggle":"tooltip",title:"chat info"})));case J:return L.a.createElement("div",{id:"chat-info",className:"chat-info float-left top-center pt-2"},L.a.createElement("h3",{id:"chat-info-name"},e.global.ihcData.name),L.a.createElement(u.b,{to:"/chat/groupInfo/"+e.global.ihcData.gcid},L.a.createElement("i",{className:"fas fa-info-circle fa-2x","data-toggle":"tooltip",title:"chat info"})));default:return L.a.createElement(F,{displayIn:["Laptop","Tablet"]},L.a.createElement("h3",{className:"pt-2 pl-2"},"chat"))}}())}}]),a}(I.Component),K=Object(l.j)($),Z=a(84),Q=a.n(Z),X={names:{aqua:"#00ffff",black:"#000000",blue:"#0000ff",brown:"#a52a2a",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgrey:"#a9a9a9",darkgreen:"#006400",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkviolet:"#9400d3",fuchsia:"#ff00ff",gold:"#ffd700",green:"#008000",indigo:"#4b0082",khaki:"#f0e68c",lightblue:"#add8e6",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightpink:"#ffb6c1",lime:"#00ff00",magenta:"#ff00ff",maroon:"#800000",navy:"#000080",olive:"#808000",orange:"#ffa500",pink:"#ffc0cb",purple:"#800080",violet:"#800080",red:"#ff0000",silver:"#c0c0c0"},random:function(){var e,t=0;for(var a in this.names)Math.random()<1/++t&&(e=a);return e}},ee=X,te=a(87),ae=function(e){Object(p.a)(a,e);var t=Object(f.a)(a);function a(){return Object(d.a)(this,a),t.apply(this,arguments)}return Object(m.a)(a,[{key:"getIndex",value:function(e){for(var t=0,a=this.length-1;t<=a;){var n=Math.floor((t+a)/2);if(this[n].key===e)return n;this[n].key<e?t=n+1:a=n-1}return-1}},{key:"getNearestKey",value:function(e){var t;for(++e;-1===(t=this.getIndex(--e));)if(0===e)return-1;return t}},{key:"get",value:function(e){var t=this.getIndex(e);if(-1!==t)return this[t].value}},{key:"add",value:function(e,t){-1===this.getIndex(e)&&this.splice(this.getNearestKey(e)+1,0,{key:e,value:t})}},{key:"remove",value:function(e){var t=this.getIndex(e);-1!==t&&this.splice(t,1)}}]),a}(Object(te.a)(Array));var ne=function(){function e(t,a,n){Object(d.a)(this,e),this._normalChat=0,this._groupChats=new ae,this.uid=t,this.username=a,this.color=ee.random(),this.online=n}return Object(m.a)(e,[{key:"addGroupChat",value:function(e){this.groupChats.add(e,e)}},{key:"removeGroupChat",value:function(e){this.groupChats.remove(e)}},{key:"uid",get:function(){return this._uid},set:function(e){this._uid=e}},{key:"username",get:function(){return this._username},set:function(e){this._username=e}},{key:"color",get:function(){return this._color},set:function(e){this._color=e}},{key:"online",get:function(){return this._online},set:function(e){this._online=e}},{key:"normalChat",get:function(){return this._normalChat},set:function(e){this._normalChat=e}},{key:"groupChats",get:function(){return this._groupChats},set:function(e){this._groupChats=e}}]),e}(),se=function(){function e(t,a,n,s){var r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new Date(Date.now());Object(d.a)(this,e),this.mid=t,this.content=a,this.uid=n,this.date=r,this.chat=s}return Object(m.a)(e,[{key:"getChatViewDateString",value:function(){return this.isDateToday()?"heute "+this.getTimeString():this.isDateYesterday()?"gestern":this.getDateString()}},{key:"getChatViewMsgString",value:function(){var e=this.content;return e.length>18&&(e=e.substr(0,18)+"..."),this.uid===he.userSelf.uid?"Du: ".concat(e):"normalchat"===this.chat.type?this.content:"".concat(he.users.get(this.uid).username,": ").concat(e)}},{key:"getMessageViewDateString",value:function(){return this.isDateToday()?this.getTimeString():this.isDateYesterday()?"gestern "+this.getTimeString():this.getDateString()+" "+this.getTimeString()}},{key:"isDateToday",value:function(){var e=new Date(Date.now());return this.date.getDate()===e.getDate()&&this.date.getMonth()===e.getMonth()&&this.date.getFullYear()===e.getFullYear()}},{key:"isDateYesterday",value:function(){var e=new Date(Date.now());return this.date.getDate()===e.getDate()-1&&this.date.getMonth()===e.getMonth()&&this.date.getFullYear()===e.getFullYear()}},{key:"getDateString",value:function(){var e,t=this.date.getDate();e=t<10?"0"+t:t;var a,n=this.date.getMonth();a=n+1<10?"0"+(n+1):n+1;var s=this.date.getFullYear();return"".concat(e,".").concat(a,".").concat(s)}},{key:"getTimeString",value:function(){var e,t=this.date.getHours();e=t<10?"0"+t:t;var a,n=this.date.getMinutes();return a=n<10?"0"+n:n,"".concat(e,":").concat(a)}},{key:"isDifferentDay",value:function(e){return this.date.getDay()!==e.getDay()||this.date.getMonth()!==e.getMonth()||this.date.getFullYear()!==e.getFullYear()}},{key:"mid",get:function(){return this._mid},set:function(e){this._mid=e}},{key:"content",get:function(){return this._content},set:function(e){this._content=e}},{key:"uid",get:function(){return this._uid},set:function(e){this._uid=e}},{key:"date",get:function(){return this._date},set:function(e){this._date=e}},{key:"chat",get:function(){return this._chat},set:function(e){this._chat=e}}]),e}(),re=function(){function e(){Object(d.a)(this,e),this.events=new Map}return Object(m.a)(e,[{key:"on",value:function(e,t){this.events.has(e)?this.events.get(e).push(t):this.events.set(e,[t])}},{key:"rm",value:function(e,t){if(this.events.has(e))for(var a=this.events.get(e),n=0;n<a.length;n++)a[n]===t&&a.splice(n,1)}},{key:"trigger",value:function(e){if(this.events.has(e)){for(var t=arguments.length,a=new Array(t>1?t-1:0),n=1;n<t;n++)a[n-1]=arguments[n];for(var s=0;s<this.events.get(e).length;s++){var r;(r=this.events.get(e))[s].apply(r,a)}}}},{key:"events",get:function(){return this._events},set:function(e){this._events=e}}]),e}(),ie=function(){function e(t,a,n){Object(d.a)(this,e),this._messages=new ae,this._event=new re,this._hasNewMsg=!1,this._unreadMessages=0,this.type=t,this.id=a,this.chatName=n}return Object(m.a)(e,[{key:"loadMessages",value:function(e){var t=this;he.socket.emit("load messages",{chatType:this.type,chatId:this.id,lastMsgId:function(){var e=t.getLastMessage();return null!==e?e.mid:-1}(),num:e})}},{key:"addLoadedMessages",value:function(e){this.reachedTop="reached top"===e.status;for(var t=e.messages,a=t.length-1;a>=0;a--){var n=t[a];this.messages.add(n.mid,new se(n.mid,n.content,n.uid,this,new Date(n.date)))}this.event.trigger("messages loaded")}},{key:"getLastMessage",value:function(){return 0!==this.messages.length?this.messages[0].value:null}},{key:"getFirstMessage",value:function(){return 0!==this.messages.length?this.messages[this.messages.length-1].value:null}},{key:"addMessage",value:function(e,t,a){this.messages.add(a,new se(a,t,e,this,new Date(Date.now()))),this.event.trigger("new message",e)}},{key:"isSelfPart",get:function(){return this._isSelfPart},set:function(e){this._isSelfPart=e}},{key:"type",get:function(){return this._type},set:function(e){this._type=e}},{key:"id",get:function(){return this._id},set:function(e){this._id=e}},{key:"messages",get:function(){return this._messages},set:function(e){this._messages=e}},{key:"chatName",get:function(){return this._chatName},set:function(e){this._chatName=e}},{key:"event",get:function(){return this._event},set:function(e){this._event=e}},{key:"hasNewMsg",get:function(){return this._hasNewMsg},set:function(e){this._hasNewMsg=e}},{key:"unreadMessages",get:function(){return this._unreadMessages},set:function(e){this._unreadMessages=e}}]),e}(),ce=function(e){Object(p.a)(a,e);var t=Object(f.a)(a);function a(e,n,s){var r;return Object(d.a)(this,a),(r=t.call(this,"normalChat",e,n))._isTyping=!1,r.otherUser=s,r}return Object(m.a)(a,[{key:"getUsersTyping",value:function(){if(this.isTyping){var e=he.users.get(this.otherUser);return[{uid:e.uid,username:e.username}]}return[]}},{key:"getLatestUserTyping",value:function(){if(this.isTyping){var e=he.users.get(this.otherUser);return{uid:e.uid,username:e.username}}return null}},{key:"startedTyping",value:function(e){e===this.otherUser&&(this.isTyping=!0,this.event.trigger("typeState changed"))}},{key:"stoppedTyping",value:function(e){e===this.otherUser&&(this.isTyping=!1,this.event.trigger("typeState changed"))}},{key:"otherUser",get:function(){return this._otherUser},set:function(e){this._otherUser=e}},{key:"isTyping",get:function(){return this._isTyping},set:function(e){this._isTyping=e}}]),a}(ie),oe=function(e){Object(p.a)(a,e);var t=Object(f.a)(a);function a(e,n,s){var r;return Object(d.a)(this,a),(r=t.call(this,"groupChat",e,n))._users=[],r._usersTyping=[],r.users=s,r}return Object(m.a)(a,[{key:"getUsersTyping",value:function(){if(this.usersTyping.length>0){for(var e=[],t=0;t<this.usersTyping.length;t++){var a=he.users.get(this.usersTyping[t]);e.push({uid:a.uid,username:a.username})}return e}return[]}},{key:"getLatestUserTyping",value:function(){if(this.usersTyping.length>0){var e=he.users.get(this.usersTyping[this.usersTyping.length-1]);return{uid:e.uid,username:e.username}}return null}},{key:"startedTyping",value:function(e){this.isMember(e)&&(this.isTyping(e)||(this.usersTyping.push(e),this.event.trigger("typeState changed")))}},{key:"stoppedTyping",value:function(e){this.isMember(e)&&this.isTyping(e)&&(this.usersTyping.splice(this.getIndexOfTyping(e),1),this.event.trigger("typeState changed"))}},{key:"isMember",value:function(e){return e!==he.userSelf.uid&&this.users.find((function(t){return t===e}))}},{key:"isTyping",value:function(e){return this.usersTyping.find((function(t){return t===e}))}},{key:"getIndexOfTyping",value:function(e){return this.usersTyping.findIndex((function(t){return t===e}))}},{key:"users",get:function(){return this._users},set:function(e){this._users=e}},{key:"usersTyping",get:function(){return this._usersTyping},set:function(e){this._usersTyping=e}}]),a}(ie),ue=function(){function e(){Object(d.a)(this,e),this._isShown=!1}return Object(m.a)(e,[{key:"createNew",value:function(e,t){this.chatNow=new ce(0,t,e)}},{key:"requestUser",value:function(){var e=Object(k.a)(E.a.mark((function e(t){var a=this;return E.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){he.socket.emit("getUserInfo",t,(function(n,s){s?e({userExists:!1,isUserSaved:!1,chatExists:!1,isUserBlocked:!1,tempChat:!1}):n.userExists&&!n.blocked?(a.createNew(t,n.username),e({userExists:!0,isUserSaved:!1,chatExists:!1,isUserBlocked:!1,tempChat:!0})):e({userExists:n.userExists,isUserSaved:!1,chatExists:!1,isUserBlocked:n.blocked,tempChat:!1})}))})));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"doesExist",value:function(e){return void 0!==this.chatNow&&this.chatNow.otherUser===e}},{key:"show",value:function(){this.isShown=!0,he.event.trigger("tempChat shown")}},{key:"update",value:function(){he.event.trigger("tempChat updated")}},{key:"hide",value:function(){this.isShown=!1,he.event.trigger("tempChat hidden")}},{key:"createNewNormalChat",value:function(){var e=Object(k.a)(E.a.mark((function e(t){var a=this;return E.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){var s=a.chatNow.otherUser,r=a.chatNow.chatName;he.socket.emit("new normalChat",{uid:s,username:r,message:t},(function(n){-1===he.users.getIndex(s)&&he.users.add(s,new ne(s,r,n.online));var i=he.users.get(s);i.online=n.online;var c=new ce(n.ncid,r,s);i.normalChat=c.id,he.chats.normal.add(n.ncid,c),c.messages.add(n.mid,new se(n.mid,t,he.userSelf.uid,c,new Date(Date.now()))),he.event.trigger("new chat",c),he.setCurrentChat(c),a.hide(),e(!0)}))})));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"isShown",get:function(){return this._isShown},set:function(e){this._isShown=e}},{key:"chatNow",get:function(){return this._chatNow},set:function(e){this._chatNow=e}}]),e}(),le=new(function(){function e(){Object(d.a)(this,e),this._users=new ae,this._chats={normal:new ae,group:new ae},this._event=new re,this._finishedLoading=!1,this._currentChat={type:"",id:0},this._temporaryChat=new ue,this._initCalled=!1,this.userSelf=new ne(s,n),this.userInfo={uid:s,username:n}}return Object(m.a)(e,[{key:"init",value:function(){var e=Object(k.a)(E.a.mark((function e(){var t,a,r,i=this;return E.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.initCalled=!0,this.userSelf=new ne(s,n),this.userInfo={uid:s,username:n},t={method:"GET",headers:{Accept:"text/plain"}},e.next=6,fetch("/IP",t);case 6:if(a=e.sent,r="",!a.ok){e.next=12;break}return e.next=11,a.text();case 11:r=e.sent;case 12:this.socket=Q()("http://"+r+":3002"),this.socket.emit("auth",s,n),this.socket.on("all chats",(function(e){i.initChats(e)})),this.socket.on("messages",(function(e){var t=i.getChat(e.chatType,e.chatId);void 0!==t&&t.addLoadedMessages(e)})),this.socket.on("chat message",(function(e){var t=i.getChat(e.type,e.id);if(null!==t){var a=i.isCurrentChat(t.type,t.id);t.addMessage(e.uid,e.content,e.mid),t.hasNewMsg=!a,t.unreadMessages++,i.event.trigger("new message",e.type,e.id)}})),this.socket.on("started typing",(function(e){i.getChat(e.type,e.id).startedTyping(e.uid)})),this.socket.on("stopped typing",(function(e){i.getChat(e.type,e.id).stoppedTyping(e.uid)})),this.socket.on("users-noChat",(function(e){le.event.trigger("users-noChat",e)})),this.socket.on("new chat",(function(e){i.addNewChat(e)})),this.socket.on("disconnect",(function(){setTimeout((function(){alert("Verbindung verloren! Seite wird neu geladen"),location.reload()}),1e3)}));case 22:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"initChats",value:function(e){for(var t=0;t<e.length;t++)"normalChat"===e[t].type?this.addNewNormalChat(e[t]):"groupChat"===e[t].type&&this.addNewGroupChat(e[t]);this.finishedLoading=!0,this.event.trigger("chats loaded",this.getChatArraySortedByDate())}},{key:"getChatArraySortedByDate",value:function(){var e=function(e){var t=e.lastMessage;return null!==t?t.date.getTime():new Date(0).getTime()},t=function(t,a){for(var n=a,s=a+1;s<t.length;s++)e(t[n])<e(t[s])&&(n=s);return n},a=function(e,t,a){var n=e[t];e[t]=e[a],e[a]=n},n=function(e){for(var n=function(e){for(var t=new Array(e.length),a=0;a<e.length;a++){var n=e[a].value,s=void 0;if(0===n.messages.length)s=null;else s={date:n.messages[n.messages.length-1].value.date};t[a]={type:n.type,id:n.id,chatName:n.chatName,lastMessage:s}}return t}(e),s=0;s<n.length-1;s++){var r=t(n,s);a(n,s,r)}return n};return function(t,a){for(var n=new Array(t.length+a.length),s=0,r=0,i=0;i<n.length;i++)r<a.length?s<t.length&&e(t[s])>e(a[r])?(n[i]=t[s],s++):(n[i]=a[r],r++):(n[i]=t[s],s++);return n}(n(this.chats.normal),n(this.chats.group))}},{key:"getChat",value:function(e,t){return"normalChat"===e?this.chats.normal.get(t):"tempChat"===e?this.temporaryChat.chatNow:"groupChat"===e?this.chats.group.get(t):void 0}},{key:"isCurrentChat",value:function(e,t){return this.currentChat.type===e&&this.currentChat.id===t}},{key:"userExists",value:function(){var e=Object(k.a)(E.a.mark((function e(t){var a;return E.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(-1===this.users.getIndex(t)){e.next=10;break}if(0===this.users.get(t).normalChat){e.next=5;break}return e.abrupt("return",{userExists:!0,isUserSaved:!0,chatExists:!0,isUserBlocked:!1,tempChat:!1});case 5:return a=this.users.get(t),this.temporaryChat.createNew(t,a.username),e.abrupt("return",{userExists:!0,isUserSaved:!0,chatExists:!1,isUserBlocked:!1,tempChat:!1});case 8:e.next=17;break;case 10:if(!this.temporaryChat.doesExist(t)){e.next=14;break}return e.abrupt("return",{userExists:!0,isUserSaved:!1,chatExists:!1,isUserBlocked:!1,tempChat:!0});case 14:return e.next=16,this.temporaryChat.requestUser(t);case 16:return e.abrupt("return",e.sent);case 17:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"setCurrentChat",value:function(e){if(null===e)""===this.currentChat.type&&0===this.currentChat.id||(this.currentChat={type:"",id:0},this.event.trigger("currentChat changed",null));else if("tempChat"===e.type&&"tempChat"!==this.currentChat.type)this.currentChat={type:"tempChat",id:0},this.socket.emit("change chat",null),this.event.trigger("currentChat changed",e);else if(""!==e.type&&0!==e.id&&(this.currentChat.type!==e.type||this.currentChat.id!==e.id)){var t=this.getChat(e.type,e.id);t.hasNewMsg=!1,t.unreadMessages=0,this.currentChat=e,this.socket.emit("change chat",{type:this.currentChat.type,id:this.currentChat.id}),this.event.trigger("currentChat changed",e)}}},{key:"getNumberNewMessages",value:function(){for(var e=0,t=0;t<this.chats.normal.length;t++)this.chats.normal[t].value.hasNewMsg&&e++;for(var a=0;a<this.chats.group.length;a++)this.chats.group[a].value.hasNewMsg&&e++;return e}},{key:"addNewChat",value:function(e){var t;"normalChat"===e.type?t=this.addNewNormalChat(e):"groupChat"===e.type&&(t=this.addNewGroupChat(e)),t.unreadMessages=1,le.event.trigger("new chat",t)}},{key:"addNewNormalChat",value:function(e){var t;-1===this.users.getIndex(e.members[0].uid)?(t=new ne(e.members[0].uid,e.members[0].username,e.members[0].online),this.users.add(t.uid,t)):t=this.users.get(e.members[0].uid);var a=new ce(e.id,e.chatName,t.uid);t.normalChat=a.id;var n=e.firstMessage;return n.empty||a.messages.add(n.mid,new se(n.mid,n.content,n.uid,a,new Date(n.date))),this.chats.normal.add(e.id,a),a}},{key:"addNewGroupChat",value:function(e){for(var t=[],a=0;a<e.members.length;a++){var n=e.members[a],s=void 0;-1===this.users.getIndex(n.uid)?(s=new ne(n.uid,n.username,n.online),this.users.add(s.uid,s)):s=this.users.get(n.uid),t.push(s.uid),s.addGroupChat(e.id)}var r=new oe(e.id,e.chatName,t),i=e.firstMessage;return i.empty||r.messages.add(i.mid,new se(i.mid,i.content,i.uid,r,new Date(i.date))),this.chats.group.add(e.id,r),r}},{key:"socket",get:function(){return this._socket},set:function(e){this._socket=e}},{key:"userSelf",get:function(){return this._userSelf},set:function(e){this._userSelf=e}},{key:"users",get:function(){return this._users},set:function(e){this._users=e}},{key:"chats",get:function(){return this._chats},set:function(e){this._chats=e}},{key:"event",get:function(){return this._event},set:function(e){this._event=e}},{key:"finishedLoading",get:function(){return this._finishedLoading},set:function(e){this._finishedLoading=e}},{key:"currentChat",get:function(){return this._currentChat},set:function(e){this._currentChat=e}},{key:"temporaryChat",get:function(){return this._temporaryChat},set:function(e){this._temporaryChat=e}},{key:"initCalled",get:function(){return this._initCalled},set:function(e){this._initCalled=e}}]),e}()),he=le,de=function(e){Object(p.a)(a,e);var t=Object(f.a)(a);function a(e){var s;return Object(d.a)(this,a),(s=t.call(this,e)).clickCheckBox=function(e){s.state.checkBoxClicked?e.stopPropagation():setTimeout((function(){s.setState((function(e){return{checkBoxClicked:!0}}))}),20)},s.clickDocument=function(e){s.state.checkBoxClicked&&s.changeChecked(e)},s.changeChecked=function(e){s.setState((function(e){return{checkBoxClicked:!e.checkBoxClicked}}))},s.state={username:n,checkBoxClicked:!1},s}return Object(m.a)(a,[{key:"render",value:function(){var e=this.props.location.pathname;return i.a.createElement("div",{className:"container-top"},i.a.createElement(K,{newMessages:this.props.headerLeft.newMessages}),i.a.createElement("div",{id:"top-right",className:"top-right",onClick:this.clickCheckBox},i.a.createElement("div",{className:"top-right-left"}),i.a.createElement("input",{type:"checkbox",id:"btnControlTopRight",checked:this.state.checkBoxClicked,onChange:this.changeChecked}),i.a.createElement("label",{className:"button-top-right",htmlFor:"btnControlTopRight"},i.a.createElement("div",{className:"top-right-center"},i.a.createElement("div",{className:"d-only-when-small"},i.a.createElement("i",{id:"user-info",className:"fas fa-user fa-2x user-icon","data-toggle":"tooltip",title:"Benutzer-Info"})),i.a.createElement("div",{className:"d-only-when-big top-2right"},i.a.createElement(u.b,{to:e+"/userInfo/"+he.userSelf.uid},i.a.createElement("h4",{id:"username",className:"p-2 username","data-toggle":"tooltip",title:"Benutzer-Info"},this.state.username)),i.a.createElement("div",{className:"float-right"},i.a.createElement(u.b,{to:e+"/settings"},i.a.createElement("i",{className:"fas fa-user-cog fa-2x","data-toggle":"tooltip",title:"Einstellungen"})),"\xa0",i.a.createElement("i",{id:"user-logout",className:"fas fa-sign-out-alt fa-2x logout","data-toggle":"tooltip",title:"logout",onClick:this.props.logout})))))))}},{key:"componentDidMount",value:function(){M()('[data-toggle="tooltip"]').tooltip(),document.addEventListener("click",this.clickDocument,!1)}},{key:"componentWillUnmount",value:function(){document.removeEventListener("click",this.clickDocument,!1)}}]),a}(r.Component),me=Object(l.j)(de),pe=function(e){Object(p.a)(a,e);var t=Object(f.a)(a);function a(){var e;Object(d.a)(this,a);for(var n=arguments.length,s=new Array(n),r=0;r<n;r++)s[r]=arguments[r];return(e=t.call.apply(t,[this].concat(s))).searchChanged=function(t){e.props.onSearch(t.target.value)},e}return Object(m.a)(a,[{key:"render",value:function(){var e=this.props.location.pathname;return i.a.createElement("div",{className:"chat-container-top border rounded mb-2"},i.a.createElement("div",{className:"chat-select-form"},i.a.createElement("input",{type:"text",name:"chat-search",className:"chat-search",placeholder:"Chat suchen",onChange:this.searchChanged}),i.a.createElement(u.b,{to:e+"/newChat"},i.a.createElement("button",{id:"btn-newChat",className:"btn-newChat"},i.a.createElement("i",{className:"fas fa-plus fa-lg"})))))}}]),a}(r.Component),fe=Object(l.j)(pe),ge=function(e){Object(p.a)(a,e);var t=Object(f.a)(a);function a(e){var n;return Object(d.a)(this,a),(n=t.call(this,e)).isSelected=function(){return n.props.id===he.currentChat.id&&n.props.type===he.currentChat.type},n.typeStateChanged=function(){var e="",t=he.getChat(n.props.type,n.props.id).getLatestUserTyping();null!==t&&(e=t.username+" schreibt..."),n.setState({typeMsg:e})},n.newMessage=function(e){n.isSelected()||n.setState((function(e){return{unreadMessages:e.unreadMessages+1}})),n.props.toTop(n.props._key_)},n.state={unreadMessages:0,lastMsg:void 0,typeMsg:""},n}return Object(m.a)(a,[{key:"render",value:function(){var e=this,t=he.getChat(this.props.type,this.props.id).getFirstMessage(),a=function(){return t?i.a.createElement("span",null,t.getChatViewMsgString()):i.a.createElement("span",null,"Noch keine Nachrichten vorhanden")},n=function(){return t?i.a.createElement("div",{className:"lastMsg-date"},t.getChatViewDateString()):null};return i.a.createElement("li",{key:this.props._key_,className:"list-group-item p-1"+(this.isSelected()?" selected ":"")},i.a.createElement(u.b,{to:"normalChat"===e.props.type?"/chat/user/"+he.getChat("normalChat",e.props.id).otherUser:"groupChat"===e.props.type?"/chat/group/"+e.props.id:"tempChat"===e.props.type?"/chat/user/"+he.temporaryChat.chatNow.otherUser:void 0},i.a.createElement("div",{className:"w-100"},i.a.createElement("strong",null,this.props.name),0===e.state.unreadMessages?null:i.a.createElement("div",{className:"newMsg-number"},e.state.unreadMessages)),""===e.state.typeMsg?i.a.createElement("div",{className:"w-100 lastMsg"},a(),n()):i.a.createElement("div",{className:"w-100 typeMsg"},e.state.typeMsg)))}},{key:"componentDidMount",value:function(){var e=he.getChat(this.props.type,this.props.id);this.setState({unreadMessages:e.unreadMessages}),e.event.on("new message",this.newMessage),e.event.on("typeState changed",this.typeStateChanged)}},{key:"componentDidUpdate",value:function(e,t,a){if(this.isSelected()&&0!==this.state.unreadMessages&&this.setState({unreadMessages:0}),e.type!==this.props.type||e.id!==this.props.id){var n=he.getChat(e.type,e.id);n.event.rm("new message",this.newMessage),n.event.rm("typeState changed",this.typeStateChanged);var s=he.getChat(this.props.type,this.props.id);s.event.on("new message",this.newMessage),s.event.on("typeState changed",this.typeStateChanged),this.setState({typeMsg:"",unreadMessages:s.unreadMessages})}}},{key:"componentWillUnmount",value:function(){var e=he.getChat(this.props.type,this.props.id);e.event.rm("new message",this.newMessage),e.event.rm("typeState changed",this.typeStateChanged)}}]),a}(r.Component),ve=function(e){Object(p.a)(a,e);var t=Object(f.a)(a);function a(e){var n;return Object(d.a)(this,a),(n=t.call(this,e)).chatItemToTop=function(e){var t=n.state.chats.splice(0),a=t[e];t.splice(e,1),t.unshift(a),n.setState({chats:t})},n.newChat=function(e){var t={type:e.type,id:e.id,chatName:e.chatName,lastMessage:{date:e.date}};n.setState((function(e){return{chats:[t].concat(e.chats)}}))},n.tempChatShown=function(){var e=he.temporaryChat.chatNow;n.setState({showTempChat:!0,tempChatName:e.chatName})},n.tempChatUpdated=function(){var e=he.temporaryChat.chatNow;n.setState({showTempChat:!0,tempChatName:e.chatName})},n.tempChatHidden=function(){console.log("hidden"),n.setState({showTempChat:!1,tempChatName:""})},n.chatsLoaded=function(e){n.setState({chats:e})},n.state={chats:[],searchValue:"",showTempChat:!1,tempChatName:""},n}return Object(m.a)(a,[{key:"componentDidMount",value:function(){he.temporaryChat.isShown&&this.setState({showTempChat:!0}),he.event.on("tempChat shown",this.tempChatShown),he.event.on("tempChat updated",this.tempChatUpdated),he.event.on("tempChat hidden",this.tempChatHidden),he.event.on("new chat",this.newChat),he.finishedLoading?this.setState({chats:he.getChatArraySortedByDate()}):he.event.on("chats loaded",this.chatsLoaded)}},{key:"render",value:function(){var e=this,t=this.props.paddingTop||"1rem",a=0;return i.a.createElement("div",{style:{paddingTop:t,height:"100%"}},i.a.createElement("div",{className:"chat-container m-2"},i.a.createElement(fe,{onSearch:function(t){e.setState({searchValue:t})},setHomeState:this.props.setHomeState}),i.a.createElement("ul",{className:"chat-list list-group pb-5",style:{height:"calc (100% - 80px"}},e.state.showTempChat?i.a.createElement(ge,{key:-1,_key_:-1,id:0,type:"tempChat",name:e.state.tempChatName,toTop:function(){}}):null,this.state.chats.map((function(t,n){return t.chatName.includes(e.state.searchValue)?(a++,i.a.createElement(ge,{key:n,_key_:n,id:t.id,type:t.type,name:t.chatName,toTop:e.chatItemToTop})):null}))),0===a?i.a.createElement("span",null,"Nichts gefunden"):null))}},{key:"componentWillUnmount",value:function(){he.event.rm("tempChat shown",this.tempChatShown),he.event.rm("tempChat updated",this.tempChatUpdated),he.event.rm("tempChat hidden",this.tempChatHidden),he.event.rm("new chat",this.newChat),he.event.rm("chats loaded",this.chatsLoaded)}}]),a}(r.Component);function ye(e){return i.a.createElement("div",{className:"loader-init"},i.a.createElement("div",{className:"col-sm-12 my-auto"},i.a.createElement("div",{className:"init-container border rounded"},i.a.createElement("div",{className:"spinner-border text-secondary",style:{width:"15rem",height:"15rem",borderWidth:"0.5rem"},role:"status"},i.a.createElement("span",{className:"sr-only"},"Loading...")),i.a.createElement("div",{className:"loader-text"},e.msg))))}var be=a(39),Ee=(a(146),a(85)),ke=function(e){Object(p.a)(a,e);var t=Object(f.a)(a);function a(e){var n;return Object(d.a)(this,a),(n=t.call(this,e))._userTyping=!1,n._typeEventEmitted=!1,n.onTyping=function(e){n.setState({message:e.target.value}),n.handleTypeMessage()},n.handleTypeMessage=function(){n.isTempChat||(n.userTyping&&clearTimeout(n.typeTimeout),n.userTyping=!0,n.typeEventEmitted||(n.typeEventEmitted=!0,he.socket.emit("started typing")),n.typeTimeout=setTimeout((function(){n.userTyping=!1,n.typeEventEmitted&&(n.typeEventEmitted=!1,he.socket.emit("stopped typing"))}),1e3))},n.onSubmit=function(e){if(e.preventDefault(),""!==n.state.message){var t=n.state.message;if(n.setState({message:""}),n.isTempChat){var a=n.props.location.pathname;he.temporaryChat.createNewNormalChat(t).then((function(e){e&&(n.props.history.replace("/chat"),n.props.history.replace(a))}))}else he.socket.emit("chat message",t,(function(e){he.getChat(n.props.chatType,n.props.chatId).addMessage(he.userSelf.uid,t,e)}))}},n.onEmojiInput=function(e){n.setState({message:n.state.message+e.native}),n.handleTypeMessage()},n.toggleEmoji=function(e){n.setState((function(e){return{showEmoji:!e.showEmoji}}))},n.state={message:"",showEmoji:!1},n}return Object(m.a)(a,[{key:"render",value:function(){return i.a.createElement("div",null,i.a.createElement("form",{onSubmit:this.onSubmit,className:"msg-form"},i.a.createElement("div",{className:"message-input"},i.a.createElement("input",{autoComplete:"off",placeholder:"Nachricht:",value:this.state.message,onChange:this.onTyping}),i.a.createElement("i",{className:"far fa-smile fa-2x emoji-toggle",onClick:this.toggleEmoji})),i.a.createElement("button",{className:"btn-submit",type:"submit"},i.a.createElement("i",{className:"far fa-paper-plane fa-2x","data-toggle":"tooltip",title:"send message"}))),this.state.showEmoji?i.a.createElement("div",{style:{position:"absolute",bottom:"60px",right:"50px",width:"350px",height:"425px"}},i.a.createElement(Ee.a,{onSelect:this.onEmojiInput})):null)}},{key:"componentDidMount",value:function(){this.isTempChat="tempChat"===this.props.chatType}},{key:"componentDidUpdate",value:function(e,t,a){this.isTempChat="tempChat"===this.props.chatType}},{key:"userTyping",get:function(){return this._userTyping},set:function(e){this._userTyping=e}},{key:"typeEventEmitted",get:function(){return this._typeEventEmitted},set:function(e){this._typeEventEmitted=e}},{key:"typeTimeout",get:function(){return this._typeTimeout},set:function(e){this._typeTimeout=e}},{key:"isTempChat",get:function(){return this._isTempChat},set:function(e){this._isTempChat=e}}]),a}(r.Component),we=Object(l.j)(ke),Ce=function(e){Object(p.a)(a,e);var t=Object(f.a)(a);function a(){return Object(d.a)(this,a),t.apply(this,arguments)}return Object(m.a)(a,[{key:"render",value:function(){var e=this.props.msg,t=function(){return e.uid===he.userSelf.uid},a=t()?he.userSelf:he.users.get(e.uid);return i.a.createElement("div",{className:"p-2 border rounded "+(t()?"float-right ":"float-left ")+"msg-container-other msg-container"},"groupChat"===he.currentChat.type?i.a.createElement("div",{className:"w-100"},i.a.createElement("strong",{className:"msg-container-header"},i.a.createElement("span",{style:{color:ee.names[a.color]}},t()?"Du":a.username))):null,i.a.createElement("div",{className:"w-100 msg-container-content"},i.a.createElement("p",{className:"mb-0"},e.content)),i.a.createElement("div",{className:"w-100 msg-date-outer"},i.a.createElement("div",{className:"msg-date"},e.getMessageViewDateString())))}}]),a}(r.Component),Ne=function(e){Object(p.a)(a,e);var t=Object(f.a)(a);function a(e){var n;return Object(d.a)(this,a),(n=t.call(this,e))._isMounted=!1,n.scrollHandler=function(e){n.setState({scrollToBottom:n.getScrollToBottom()}),0===n.messagesNode.scrollTop&&n.loadMessages()},n.setScrollToBottom=function(e){n.messagesNode.scrollTop=n.messagesNode.scrollHeight-n.messagesNode.offsetHeight-e},n.getScrollToBottom=function(){return n.messagesNode.scrollHeight-n.messagesNode.offsetHeight-n.messagesNode.scrollTop},n.assignMessagesRef=function(e){n.messages=e},n.loadMessages=function(){n.setState({msgLoading:!0}),he.getChat(n.props.chatType,n.props.chatId).loadMessages(10)},n.messagesLoaded=function(){n.setState({msgLoading:!1}),n.setScrollToBottom(n.state.scrollToBottom)},n.newMessage=function(e){0===n.getScrollToBottom()?n.setState({newMessages:0}):e===he.userSelf.uid?n.setState({scrollToBottom:0,newMessages:0}):n.setState((function(e){return{newMessages:e.newMessages+1}}))},n.assignMessagesRef=n.assignMessagesRef.bind(Object(be.a)(n)),n.state={msgLoading:!1,scrollToBottom:0,newMessages:0,typeMessages:[]},n}return Object(m.a)(a,[{key:"componentDidMount",value:function(){this.messagesNode=o.a.findDOMNode(this.messages),0===this.messagesNode.scrollTop&&this.loadMessages();var e=he.getChat(this.props.chatType,this.props.chatId);e.event.on("messages loaded",this.messagesLoaded),e.event.on("new message",this.newMessage),this.isMounted=!0}},{key:"componentDidUpdate",value:function(e,t,a){if(e.chatType!==this.props.chatType||e.chatId!==this.props.chatId){var n=he.getChat(e.chatType,e.chatId);n.event.rm("messages loaded",this.messagesLoaded),n.event.rm("new message",this.newMessage);var s=he.getChat(this.props.chatType,this.props.chatId);s.event.on("messages loaded",this.messagesLoaded),s.event.on("new message",this.newMessage),this.setScrollToBottom(0),0===this.messagesNode.scrollTop&&this.loadMessages()}0===this.state.scrollToBottom&&this.setScrollToBottom(0)}},{key:"render",value:function(){var e=this,t=he.getChat(this.props.chatType,this.props.chatId),a=new Date(0);return i.a.createElement("div",{className:"chat-container"},i.a.createElement("div",{className:"messages",onScroll:this.scrollHandler,ref:this.assignMessagesRef},e.state.msgLoading?i.a.createElement("div",{className:"messageLoader-top"},i.a.createElement("div",{className:"spinner-border text-secondary",role:"status"},i.a.createElement("span",{className:"sr-only"},"Loading..."))):null,t.messages.map((function(e,t){return i.a.createElement("div",{key:t},function(e){return e.isDifferentDay(a)?(a=e.date,i.a.createElement("div",{className:"date-container"},i.a.createElement("div",null,e.getDateString()))):(a=e.date,null)}(e.value),i.a.createElement(Ce,{msg:e.value}))})),0===t.messages.length?i.a.createElement("div",{className:"alert alert-primary",role:"alert"},"Noch keine Nachrichten vorhanden"):null,e.isMounted&&e.getScrollToBottom()>10?i.a.createElement("div",{id:"messages-bottom",className:"messages-bottom",onClick:function(){e.setState({scrollToBottom:0,newMessages:0})}},i.a.createElement("div",{id:"btnToBottom",className:"chevron-down"},i.a.createElement("i",{className:"fas fa-chevron-down fa-2x"})),e.state.newMessages>0?i.a.createElement("div",{id:"scroll-down-number",className:"number"},e.state.newMessages):null):null),i.a.createElement(we,{chatType:this.props.chatType,chatId:this.props.chatId}))}},{key:"componentWillUnmount",value:function(){this.isMounted=!1;var e=he.getChat(this.props.chatType,this.props.chatId);e.event.rm("messages loaded",this.messagesLoaded),e.event.rm("new message",this.newMessage)}},{key:"isMounted",get:function(){return this._isMounted},set:function(e){this._isMounted=e}},{key:"messages",get:function(){return this._messages},set:function(e){this._messages=e}},{key:"messagesNode",get:function(){return this._messagesNode},set:function(e){this._messagesNode=e}}]),a}(r.Component),Se=function(e){Object(p.a)(a,e);var t=Object(f.a)(a);function a(){return Object(d.a)(this,a),t.apply(this,arguments)}return Object(m.a)(a,[{key:"render",value:function(){return i.a.createElement("div",{className:"chat-container"},i.a.createElement("div",{className:"messages"},i.a.createElement("div",{className:"alert alert-primary",role:"alert"},"Noch keine Nachrichten vorhanden")),i.a.createElement(we,{chatType:"tempChat",chatId:0}))}},{key:"componentDidMount",value:function(){he.temporaryChat.show()}},{key:"componentDidUpdate",value:function(e,t,a){he.temporaryChat.update()}},{key:"componentWillUnmount",value:function(){he.temporaryChat.hide()}}]),a}(r.Component),Oe=0,je=1,Te=2,xe=3,Me=4,_e=5,Ue=function(e){Object(p.a)(a,e);var t=Object(f.a)(a);function a(e){var n;return Object(d.a)(this,a),(n=t.call(this,e)).userChanged=function(){var e=parseInt(n.props.uid);if(he.userSelf.uid===e)n.setState({error:_e,loaded:!0});else{var t=function(){he.userExists(e).then((function(t){t.userExists?t.isUserBlocked?n.setState({error:Me}):t.chatExists?(n.setState({error:Oe}),n.setGlobal({infoHeaderCenter:q,ihcData:{name:he.users.get(e).username,uid:e}}).then(),a(!1)):(n.setState({error:Te}),n.setGlobal({infoHeaderCenter:q,ihcData:{name:he.temporaryChat.chatNow.chatName,uid:e}}).then(),a(!0)):n.setState({error:xe}),n.setState({loaded:!0})}))},a=function(t){t?he.setCurrentChat({type:"tempChat",id:0}):-1===he.users.getIndex(e)?he.setCurrentChat(null):he.setCurrentChat({type:"normalChat",id:he.users.get(e).normalChat})};he.finishedLoading?t():he.event.on("chats loaded",(function(){t()})),n.setState({uid:parseInt(n.props.uid)})}},n.state={uid:0,loaded:!1,error:Oe},n}return Object(m.a)(a,[{key:"render",value:function(){var e=this;return L.a.createElement("div",{className:"h-100"},function(){if(!e.state.loaded)return L.a.createElement(ye,{msg:"Chat wird geladen"})}(),e.state.error===je?L.a.createElement("div",null,L.a.createElement("h2",null,"ung\xfcltige Addresse")):e.state.error===_e?L.a.createElement("div",null,L.a.createElement("h2",null,"Du kannst dir selbst nicht schreiben")):e.state.loaded?e.state.error===Oe?L.a.createElement(Ne,{chatType:he.currentChat.type,chatId:he.currentChat.id}):e.state.error===Te?L.a.createElement(Se,null):e.state.error===Me?L.a.createElement("div",null,L.a.createElement("h2",null,"Dieser User hat dich blockiert")):L.a.createElement("div",null,L.a.createElement("h2",null,"Dieser User existiert nicht")):void 0)}},{key:"componentDidMount",value:function(){this.userChanged()}},{key:"componentDidUpdate",value:function(e,t,a){e.uid!==this.props.uid&&(isNaN(this.props.uid)?this.setState({error:je}):this.userChanged())}},{key:"componentWillUnmount",value:function(){this.setGlobal({infoHeaderCenter:Y,ihcData:null}).then()}}]),a}(I.Component),De=function(e){Object(p.a)(a,e);var t=Object(f.a)(a);function a(){return Object(d.a)(this,a),t.apply(this,arguments)}return Object(m.a)(a,[{key:"componentDidMount",value:function(){"function"===typeof this.props.didMount&&this.props.didMount()}},{key:"componentDidUpdate",value:function(e,t,a){"function"===typeof this.props.didUpdate&&this.props.didUpdate()}},{key:"render",value:function(){return this.props.children?this.props.children:null}}]),a}(r.Component),Ie=function(e){Object(p.a)(a,e);var t=Object(f.a)(a);function a(e){var n;return Object(d.a)(this,a),(n=t.call(this,e)).loadChatInfo=function(){(function(){var e=Object(k.a)(E.a.mark((function e(){var t,a,s;return E.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={method:"GET",headers:{Accept:"application/json"}},e.next=3,fetch("/group/"+n.props.gcid+"/",t);case 3:if(!(a=e.sent).ok){e.next=10;break}return e.next=7,a.json();case 7:s=e.sent,n.setState({data:s}),console.log(s);case 10:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}})()().then((function(e){n.setState({loaded:!0,error:!1})})).catch((function(e){n.setState({loaded:!0,error:!0})}))},n.state={error:!1,loaded:!1,data:null},n}return Object(m.a)(a,[{key:"componentDidMount",value:function(){this.loadChatInfo()}},{key:"componentDidUpdate",value:function(e,t,a){e.gcid!==this.props.gcid&&this.loadChatInfo()}},{key:"render",value:function(){var e=this.props.location.pathname;if(this.state.error)return i.a.createElement("div",{className:"alert alert-danger",role:"alert"},"Ein Fehler ist aufgetreten!");if(!this.state.loaded)return i.a.createElement(ye,{msg:"info wird geladen"});var t=he.userSelf.uid;return i.a.createElement("div",{className:"groupChatInfo"},i.a.createElement("h1",null,this.state.data.name),i.a.createElement("h4",null,this.state.data.users.length," Mitglieder:"),i.a.createElement("ul",{className:"userList"},this.state.data.users.map((function(a,n){return i.a.createElement("li",{key:n},i.a.createElement(u.b,{to:e+"/userInfo/"+a.uid},t===a.uid?i.a.createElement("span",null,"Du"):a.username,1===a.isAdmin?i.a.createElement("div",{className:"user-admin"},"Admin"):null))}))))}}]),a}(r.Component),Le=Object(l.j)(Ie),Be=0,Re=1,Ae=2,Ge=3,He=4,Pe=0,Ve=1,We=function(e){Object(p.a)(a,e);var t=Object(f.a)(a);function a(e){var n;return Object(d.a)(this,a),(n=t.call(this,e)).groupChatExists=function(){var e=Object(k.a)(E.a.mark((function e(t){return E.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(-1===he.chats.group.getIndex(t)){e.next=4;break}return e.abrupt("return",Be);case 4:return e.abrupt("return",Ae);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),n.chatChanged=function(){if(isNaN(n.props.gcid))n.setState({error:Re,loaded:!0});else{var e=function(){var e=parseInt(n.props.gcid),t=function(){-1===he.chats.group.getIndex(e)?he.setCurrentChat(null):he.setCurrentChat({type:"groupChat",id:e})};n.groupChatExists(e).then((function(a){a===Be?(t(),n.setState({loaded:!0,error:Be,gcid:e}),n.setGlobal({infoHeaderCenter:J,ihcData:{name:he.chats.group.get(e).chatName,gcid:e}}).then()):(t(),n.setState({loaded:!0,error:a}))})).catch()};he.finishedLoading?e():he.event.on("chats loaded",(function(){e()}))}},n.state={gcid:0,loaded:!1,error:Be},n}return Object(m.a)(a,[{key:"componentDidMount",value:function(){this.chatChanged()}},{key:"componentDidUpdate",value:function(e,t,a){e.gcid!==this.props.gcid&&this.chatChanged()}},{key:"componentWillUnmount",value:function(){this.setGlobal({infoHeaderCenter:Y,ihcData:null}).then()}},{key:"render",value:function(){var e=this;return L.a.createElement("div",{className:"h-100"},function(){if(!e.state.loaded)return L.a.createElement(ye,{msg:"Chat wird geladen"})}(),function(){if(e.state.error===Re)return L.a.createElement("div",null,L.a.createElement("h2",null,"ung\xfcltige Addresse"));if(e.state.loaded)switch(e.state.error){case Be:switch(e.props.tab){case Pe:return L.a.createElement(Ne,{chatType:he.currentChat.type,chatId:he.currentChat.id});case Ve:return L.a.createElement(Le,{gcid:e.state.gcid});default:return null}case Ge:return L.a.createElement("div",null,L.a.createElement("h2",null,"Du bist nicht Mitglied in diesem chat jetzt beitreten"));case He:return L.a.createElement("div",null,L.a.createElement("h2",null,"Du bist nicht dazu berechtigt diesen chat anzusehen"));case Ae:return L.a.createElement("div",null,L.a.createElement("h2",null,"Dieser Chat existiert nicht"));default:return null}}())}}]),a}(I.Component),ze=function(e){Object(p.a)(a,e);var t=Object(f.a)(a);function a(){return Object(d.a)(this,a),t.apply(this,arguments)}return Object(m.a)(a,[{key:"render",value:function(){var e=this;return i.a.createElement("div",{className:"modal-outer",onClick:function(){e.props.history.goBack()}},i.a.createElement("div",{className:"h-100",style:{display:"flex"}},i.a.createElement("div",{className:"modal-inner",onClick:function(e){e.stopPropagation()}},i.a.createElement("div",{className:"modal-btn-close",onClick:function(){e.props.history.goBack()}},"\xd7"),this.props.children)))}}]),a}(r.Component),Fe=Object(l.j)(ze),Ye=function(e){Object(p.a)(a,e);var t=Object(f.a)(a);function a(){var e;Object(d.a)(this,a);for(var n=arguments.length,s=new Array(n),r=0;r<n;r++)s[r]=arguments[r];return(e=t.call.apply(t,[this].concat(s))).elementClicked=function(t){he.temporaryChat.createNew(e.props.uid,e.props.username)},e}return Object(m.a)(a,[{key:"render",value:function(){return i.a.createElement("li",{className:"list-group-item"},i.a.createElement(u.b,{to:"/chat/user/"+this.props.uid,onClick:this.elementClicked,replace:!0},this.props.username))}}]),a}(r.Component),qe=Object(l.j)(Ye),Je=0,$e=1,Ke=function(e){Object(p.a)(a,e);var t=Object(f.a)(a);function a(e){var n;return Object(d.a)(this,a),(n=t.call(this,e))._numAlreadyLoaded=0,n.showOptions=function(e){clearTimeout(n.clickedOutsideTimer),n.setState({showOptions:!0})},n.clickedOutsideOptions=function(){n.clickedOutsideTimer=setTimeout(n.hideOptions,100)},n.hideOptions=function(){n.setState({showOptions:!1})},n.newGroupClick=function(e){clearTimeout(n.clickedOutsideTimer),n.props.setCurrentTab(ot.newGroup)},n.joinGroupClick=function(e){clearTimeout(n.clickedOutsideTimer),n.props.setCurrentTab(ot.chooseGroup)},n.searchChanged=function(e){var t=e.target.value;n.setState({searchValue:t,searchValid:!0}),n.numAlreadyLoaded=0,n.reachedBottom=!1,n.requestSearchResult(t).then((function(e){}))},n.requestSearchResult=function(){var e=Object(k.a)(E.a.mark((function e(t){var a,s,r,i;return E.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,a={method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({search:t,limit:10,start:n.numAlreadyLoaded})},e.next=4,fetch("/user/noChat",a);case 4:if(!(s=e.sent).ok){e.next=13;break}return e.next=8,s.json();case 8:0===(r=e.sent).length&&0===n.numAlreadyLoaded?n.setState({searchResult:[]}):0===r.length?n.reachedBottom=!0:(i=n.getScrollToBottom(),0===n.numAlreadyLoaded?n.setState({searchResult:r}):n.setState((function(e){return{searchResult:e.searchResult.concat(r)}})),n.numAlreadyLoaded+=r.length,0===i&&n.requestSearchResult(t)),n.setState({error:Je}),e.next=14;break;case 13:n.setState({error:$e});case 14:e.next=19;break;case 16:e.prev=16,e.t0=e.catch(0),n.setState({error:$e});case 19:case"end":return e.stop()}}),e,null,[[0,16]])})));return function(t){return e.apply(this,arguments)}}(),n.assignListRef=function(e){n.listRef=e},n.setScrollToBottom=function(e){n.listNode.scrollTop=n.listNode.scrollHeight-n.listNode.offsetHeight-e},n.getScrollToBottom=function(){return null!==n.listNode?n.listNode.scrollHeight-n.listNode.offsetHeight-n.listNode.scrollTop:0},n.state={error:Je,showOptions:!1,searchValue:"",searchValid:!0,searchResult:[],showLoaderBottom:!1},n}return Object(m.a)(a,[{key:"render",value:function(){var e=this;return i.a.createElement("div",{className:"modal-main"},i.a.createElement("div",{className:"user-results"},i.a.createElement("div",{className:"newChat-user-top"},i.a.createElement("div",{className:"newChat-searchUser"},i.a.createElement("input",{type:"text",name:"newChat-searchUser",className:"form-control",placeholder:"Benutzer suchen",onChange:this.searchChanged})),i.a.createElement("div",{className:"newChat-user-more"},i.a.createElement("i",{className:"fas fa-ellipsis-h fa-2x",onClick:this.showOptions}),e.state.showOptions?i.a.createElement("div",{className:"options"},i.a.createElement("ul",{className:"list-group",ref:e.assignListRef},i.a.createElement("li",{className:"list-group-item",onClick:e.newGroupClick},"neue Gruppe"),i.a.createElement("li",{className:"list-group-item",onClick:e.joinGroupClick},"einer Gruppe beitreten"))):null)),e.state.error===$e?i.a.createElement("div",{className:"alert alert-danger",role:"alert"},"Ein Fehler ist aufgetreten!"):e.state.searchValid?e.state.searchResult.length>0?i.a.createElement(De,null,i.a.createElement("h5",null,"Ergebnisse:"),i.a.createElement("ul",{className:"list-user list-group result-list"},e.state.searchResult.map((function(t,a){return i.a.createElement(qe,{key:a,uid:t.uid,username:t.username,hide:e.props.hide})})))):i.a.createElement("ul",{className:"list-user result-list"},i.a.createElement("div",{className:"alert alert-warning",role:"alert"},"Nichts gefunden!")):i.a.createElement("div",{className:"alert alert-danger",role:"alert"},"Ihre Suche enth\xe4lt ung\xfcltige Zeichen!")))}},{key:"componentDidMount",value:function(){this.listNode=o.a.findDOMNode(this.listRef),document.body.addEventListener("click",this.clickedOutsideOptions),this.numAlreadyLoaded=0,this.reachedBottom=!1,this.requestSearchResult("").then((function(e){}))}},{key:"componentDidUpdate",value:function(e,t,a){this.listNode=o.a.findDOMNode(this.listRef)}},{key:"componentWillUnmount",value:function(){clearTimeout(this.clickedOutsideTimer),document.body.removeEventListener("click",this.clickedOutsideOptions)}},{key:"clickedOutsideTimer",get:function(){return this._clickedOutsideTimer},set:function(e){this._clickedOutsideTimer=e}},{key:"numAlreadyLoaded",get:function(){return this._numAlreadyLoaded},set:function(e){this._numAlreadyLoaded=e}},{key:"reachedBottom",get:function(){return this._reachedBottom},set:function(e){this._reachedBottom=e}},{key:"listRef",get:function(){return this._listRef},set:function(e){this._listRef=e}},{key:"listNode",get:function(){return this._listNode},set:function(e){this._listNode=e}}]),a}(r.Component),Ze=a(86),Qe=function(e){Object(p.a)(a,e);var t=Object(f.a)(a);function a(){var e;Object(d.a)(this,a);for(var n=arguments.length,s=new Array(n),r=0;r<n;r++)s[r]=arguments[r];return(e=t.call.apply(t,[this].concat(s))).clicked=function(t){e.props.isSelected?e.props.deselectUser(e.props.index):e.props.selectUser(e.props.index)},e}return Object(m.a)(a,[{key:"render",value:function(){return i.a.createElement("li",{key:this.props.index,className:"list-group-item p-2",onClick:this.clicked},this.props.username,i.a.createElement("div",{className:"user-select fa-lg"+(this.props.isSelected?" selected":"")},i.a.createElement("i",{className:"fas fa-check"})))}}]),a}(r.Component),Xe=0,et=1,tt=function(e){Object(p.a)(a,e);var t=Object(f.a)(a);function a(e){var n;return Object(d.a)(this,a),(n=t.call(this,e))._numAlreadyLoaded=0,n._reachedBottom=!1,n.refreshSearch=function(){n.numAlreadyLoaded=0,n.loadUsers().then((function(e){}))},n.searchChanged=function(e){n.setState({searchValue:e.target.value}),n.refreshSearch()},n.loadUsers=Object(k.a)(E.a.mark((function e(){var t,a,s,r;return E.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t={method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({search:n.state.searchValue,limit:10,start:n.numAlreadyLoaded})},e.next=4,fetch("/user/",t);case 4:if(!(a=e.sent).ok){e.next=13;break}return e.next=8,a.json();case 8:0===(s=e.sent).length&&0===n.numAlreadyLoaded?n.setState({searchResult:[]}):0===s.length?n.reachedBottom=!0:(r=n.getScrollToBottom(),0===n.numAlreadyLoaded?n.setState({searchResult:s}):n.setState((function(e){return{searchResult:e.searchResult.concat(s)}})),n.numAlreadyLoaded+=s.length,0===r&&n.loadUsers(n.props.searchValue)),n.setState({error:Xe}),e.next=14;break;case 13:n.setState({error:et});case 14:e.next=19;break;case 16:e.prev=16,e.t0=e.catch(0),n.setState({error:et});case 19:case"end":return e.stop()}}),e,null,[[0,16]])}))),n.selectUser=function(e){var t=n.state.searchResult[e];n.props.selectUser(t.uid,t.username)},n.deselectUser=function(e){var t=n.state.searchResult[e];n.props.deselectUser(t.uid)},n.assignListRef=function(e){n.listRef=e},n.setScrollToBottom=function(e){n.listNode.scrollTop=n.listNode.scrollHeight-n.listNode.offsetHeight-e},n.getScrollToBottom=function(){return null!==n.listNode?n.listNode.scrollHeight-n.listNode.offsetHeight-n.listNode.scrollTop:0},n.state={searchValue:"",searchResult:[],showLoaderBottom:!1,error:Xe},n}return Object(m.a)(a,[{key:"render",value:function(){var e=this;return i.a.createElement(De,null,i.a.createElement("form",{className:"form-group",style:{width:"90%",maxWidth:"650px"}},i.a.createElement("input",{type:"text",className:"form-control p-2 m-2",placeholder:"Benutzer suchen",value:this.state.searchValue,onChange:this.searchChanged})),i.a.createElement("ul",{className:"list-group result-list",ref:this.assignListRef},this.state.searchResult.length>0?this.state.searchResult.map((function(t,a){return i.a.createElement(Qe,{key:a,index:a,uid:t.uid,username:t.username,selectUser:e.selectUser,deselectUser:e.deselectUser,isSelected:e.props.isUserSelected(t.uid)})})):i.a.createElement("div",{className:"alert alert-warning",role:"alert"},"Nichts gefunden!")))}},{key:"componentDidMount",value:function(){this.listNode=o.a.findDOMNode(this.listRef),this.refreshSearch()}},{key:"componentDidUpdate",value:function(e,t,a){this.listNode=o.a.findDOMNode(this.listRef),this.props.searchValue!==e.searchValue&&this.refreshSearch()}},{key:"componentWillUnmount",value:function(){}},{key:"numAlreadyLoaded",get:function(){return this._numAlreadyLoaded},set:function(e){this._numAlreadyLoaded=e}},{key:"reachedBottom",get:function(){return this._reachedBottom},set:function(e){this._reachedBottom=e}},{key:"listRef",get:function(){return this._listRef},set:function(e){this._listRef=e}},{key:"listNode",get:function(){return this._listNode},set:function(e){this._listNode=e}}]),a}(r.Component),at=function(e){Object(p.a)(a,e);var t=Object(f.a)(a);function a(e){var n;return Object(d.a)(this,a),(n=t.call(this,e)).selectUser=function(e,t){n.setState((function(a){return{selectedUsers:a.selectedUsers.concat({uid:e,username:t})}}))},n.deselectUser=function(e){n.setState((function(t){var a=Object(Ze.a)(t.selectedUsers),n=a.findIndex((function(t){return t.uid===e}));return a.splice(n,1),{selectedUsers:a}}))},n.deselectIndex=function(e){n.deselectUser(n.state.selectedUsers[e].uid)},n.isUserSelected=function(e){return n.state.selectedUsers.find((function(t){return t.uid===e}))},n.btnNextClicked=function(e){n.props.onNext(n.state.selectedUsers)},n.state={selectedUsers:[],showOnlySelected:!1},n}return Object(m.a)(a,[{key:"render",value:function(){var e=this;return 0===this.state.selectedUsers.length&&this.state.showOnlySelected&&this.setState({showOnlySelected:!1}),i.a.createElement("div",{className:"user-results"},i.a.createElement("div",{className:"select-users"},0===e.state.selectedUsers.length?i.a.createElement("h4",null,"Noch niemand ausgew\xe4hlt"):i.a.createElement("h4",{className:"w-100"},i.a.createElement("span",{className:"selected-num"+(e.state.showOnlySelected?" selected":""),onClick:function(t){e.setState((function(e){return{showOnlySelected:!e.showOnlySelected}}))}},e.state.selectedUsers.length,"\xa0Benutzer"),"\xa0ausgew\xe4hlt",i.a.createElement("i",{className:"fas fa-arrow-right fa-lg float-right btn-next",onClick:e.btnNextClicked}))),this.state.showOnlySelected?i.a.createElement("ul",{className:"list-group"},this.state.selectedUsers.map((function(t,a){return i.a.createElement(Qe,{key:a,index:a,uid:t.uid,username:t.username,selectUser:function(){},deselectUser:e.deselectIndex,isSelected:!0})}))):i.a.createElement(tt,{selectUser:this.selectUser,deselectUser:this.deselectUser,isUserSelected:this.isUserSelected}))}}]),a}(r.Component),nt=function(e){Object(p.a)(a,e);var t=Object(f.a)(a);function a(e){var n;return Object(d.a)(this,a),(n=t.call(this,e)).groupNameChanged=function(e){n.setState({groupName:e.target.value})},n.formSubmitted=function(e){e.preventDefault(),n.props.submitGroup({name:n.state.groupName,description:"",isPublic:!1})},n.state={groupName:""},n}return Object(m.a)(a,[{key:"render",value:function(){return i.a.createElement("div",{className:"user-results"},i.a.createElement("form",{className:"form-group p-3",onSubmit:this.formSubmitted},i.a.createElement("h4",null,"Gruppennamen eingeben"),i.a.createElement("input",{type:"text",id:"input-groupName",name:"groupName",className:"form-control",placeholder:"Gruppenname",onChange:this.groupNameChanged}),i.a.createElement("div",null,i.a.createElement("button",{type:"submit",className:"float-right btn btn-primary m-3"},"Gruppe erstellen"))))}}]),a}(r.Component),st=0,rt=1,it=function(e){Object(p.a)(a,e);var t=Object(f.a)(a);function a(e){var n;return Object(d.a)(this,a),(n=t.call(this,e)).showEnterChatInfo=function(e){n.setState({currentTab:rt,selectedUsers:e})},n.submitGroup=function(e){for(var t=new Array(n.state.selectedUsers.length),a=0;a<n.state.selectedUsers.length;a++)t[a]={uid:n.state.selectedUsers[a].uid,username:n.state.selectedUsers[a].username,isAdmin:!1};n.createGroupChat(e,t).then((function(e){}))},n.createGroupChat=function(){var e=Object(k.a)(E.a.mark((function e(t,a){var s;return E.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,s={method:"PUT",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({data:t,users:a})},e.next=4,fetch("/group/",s);case 4:e.sent.ok&&n.props.history.goBack(),e.next=10;break;case 8:e.prev=8,e.t0=e.catch(0);case 10:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(t,a){return e.apply(this,arguments)}}(),n.state={currentTab:st,selectedUsers:[]},n}return Object(m.a)(a,[{key:"render",value:function(){switch(this.state.currentTab){case st:return i.a.createElement(at,{onNext:this.showEnterChatInfo});case rt:return i.a.createElement(nt,{submitGroup:this.submitGroup});default:return null}}}]),a}(r.Component),ct=Object(l.j)(it),ot={chooseUser:0,newGroup:1,chooseGroup:2},ut=function(e){Object(p.a)(a,e);var t=Object(f.a)(a);function a(e){var n;return Object(d.a)(this,a),(n=t.call(this,e)).setCurrentTab=function(e){n.setState({currentTab:e})},n.state={currentTab:ot.chooseUser},n}return Object(m.a)(a,[{key:"render",value:function(){var e=this;return i.a.createElement(De,null,i.a.createElement("div",{className:"modal-header-b"},i.a.createElement("h1",null,function(){switch(e.state.currentTab){case ot.chooseUser:return"Neuer Chat";case ot.newGroup:return"Neue Gruppe";case ot.chooseGroup:return"Gruppe ausw\xe4hlen";default:return"Neuer Chat"}}())),function(){switch(e.state.currentTab){case ot.chooseUser:return i.a.createElement(Ke,{setCurrentTab:e.setCurrentTab,hide:e.props.hide});case ot.newGroup:return i.a.createElement(ct,null);case ot.chooseGroup:return i.a.createElement("div",null,i.a.createElement("h4",null,"chooseGroup"));default:return i.a.createElement(Ke,{setCurrentTab:e.setCurrentTab,hide:e.props.hide})}}())}}]),a}(r.Component),lt=0,ht=1,dt=2,mt=function(e){Object(p.a)(a,e);var t=Object(f.a)(a);function a(e){var n;return Object(d.a)(this,a),(n=t.call(this,e)).setUser=function(){if(isNaN(n.props.uid))n.setState({error:dt});else if(he.userSelf.uid===parseInt(n.props.uid))n.setState({error:ht,loaded:!0});else{var e=parseInt(n.props.uid);n.setState({uid:e,error:lt,loaded:!1}),n.fetchUser(e).then().catch()}},n.state={uid:0,loaded:!1,error:lt,userInfo:null},n}return Object(m.a)(a,[{key:"render",value:function(){return this.state.loaded?this.state.error===ht?i.a.createElement("div",{className:"modal-header-b"},i.a.createElement("h1",null,"Du")):i.a.createElement("div",null,i.a.createElement("div",{className:"modal-header-b"},i.a.createElement("h1",null,this.state.userInfo.username,"\xa0",i.a.createElement(u.b,{to:"/chat/user/"+this.state.uid},i.a.createElement("i",{className:"far fa-comment-alt"})))),i.a.createElement("h2",null,"Gruppen")):null}},{key:"fetchUser",value:function(){var e=Object(k.a)(E.a.mark((function e(t){var a,n,s;return E.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a={method:"GET",headers:{Accept:"application/json"}},e.next=3,fetch("/user/"+t,a);case 3:if(!(n=e.sent).ok){e.next=12;break}return e.next=7,n.json();case 7:return s=e.sent,this.setState({userInfo:s,loaded:!0}),e.abrupt("return",s);case 12:return e.abrupt("return",null);case 13:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"componentDidMount",value:function(){this.setUser()}},{key:"componentDidUpdate",value:function(e,t,a){e.uid!==this.props.uid&&this.setUser()}},{key:"componentWillUnmount",value:function(){}}]),a}(r.Component);function pt(e){var t=Object(l.i)().path;return i.a.createElement(l.d,null,i.a.createElement(l.b,{path:"".concat(t,"/newChat")},e.children,i.a.createElement(Fe,null,i.a.createElement(ut,null))),i.a.createElement(l.b,{path:"".concat(t,"/userInfo/:uidInfo"),render:function(t){return i.a.createElement(De,null,e.children,i.a.createElement(Fe,null,i.a.createElement(mt,{uid:t.match.params.uidInfo})))}}),i.a.createElement(l.b,{path:"".concat(t,"/settings")},e.children,i.a.createElement(Fe,null,i.a.createElement("h3",null,"settings"))),i.a.createElement(l.b,{path:"*"},e.children))}function ft(e){var t=Object(l.i)(),a=t.path;t.url,Object(l.h)();return Object(r.useEffect)((function(){0!==e.newMessages&&e.setParentState({newMessages:0})})),i.a.createElement("div",{className:"row w-100 justify-content-end row-height"},i.a.createElement("div",{className:"col-md-5 col-lg-4 col-xl-3 d-none d-md-block pr-3 pl-0 h-100"},i.a.createElement(ve,{setHomeState:e.setParentState})),i.a.createElement("div",{className:"col-md-7 col-lg-8 col-xl-9 col-overflow",style:{padding:"0"}},i.a.createElement(l.d,null,i.a.createElement(l.b,{path:"".concat(a,"/user/:uid"),render:function(e){return i.a.createElement(pt,null,i.a.createElement(Ue,{uid:e.match.params.uid}))}}),i.a.createElement(l.b,{path:"".concat(a,"/group/:gcid"),render:function(e){return i.a.createElement(pt,null,i.a.createElement(We,{gcid:e.match.params.gcid,tab:Pe}))}}),i.a.createElement(l.b,{path:"".concat(a,"/groupInfo/:gcid"),render:function(e){return i.a.createElement(pt,null,i.a.createElement(We,{gcid:e.match.params.gcid,tab:Ve}))}}),i.a.createElement(l.b,{path:a},i.a.createElement(pt,null,i.a.createElement("h1",null,"noch kein chat ausgew\xe4hlt"))))))}var gt=function(e){Object(p.a)(a,e);var t=Object(f.a)(a);function a(e){var n;return Object(d.a)(this,a),(n=t.call(this,e)).typeStateChanged=function(){var e=he.getChat(n.props.chatType,n.props.chatId);n.setState({usersTyping:e.getUsersTyping()})},n.state={usersTyping:[]},n}return Object(m.a)(a,[{key:"render",value:function(){return i.a.createElement("div",{className:"typeMsg-container"},this.state.usersTyping.map((function(e,t){return i.a.createElement("div",{key:t,className:"typeMsg"},e.username+" schreibt...")})))}},{key:"componentDidMount",value:function(){he.getChat(this.props.chatType,this.props.chatId).event.on("typeState changed",this.typeStateChanged)}},{key:"componentDidUpdate",value:function(e,t,a){e.chatType===this.props.chatType&&e.chatId===this.props.chatId||(he.getChat(e.chatType,e.chatId).event.rm("typeState changed",this.typeStateChanged),he.getChat(this.props.chatType,this.props.chatId).event.on("typeState changed",this.typeStateChanged))}},{key:"componentWillUnmount",value:function(){he.getChat(this.props.chatType,this.props.chatId).event.rm("typeState changed",this.typeStateChanged)}}]),a}(r.Component);function vt(e){var t=Object(l.i)().path;return i.a.createElement(l.d,null,i.a.createElement(l.b,{path:"".concat(t,"/newChat")},i.a.createElement(ut,null)),i.a.createElement(l.b,{path:"".concat(t,"/userInfo/:uidInfo"),render:function(e){return i.a.createElement(mt,{uid:e.match.params.uidInfo})}}),i.a.createElement(l.b,{path:"".concat(t,"/settings")},i.a.createElement("h3",null,"settings")),i.a.createElement(l.b,{path:"*"},e.children))}function yt(e){var t=Object(l.i)().path,a=function(){return""!==e.currentChat.type&&0!==e.currentChat.id?i.a.createElement(gt,{chatType:e.currentChat.type,chatId:e.currentChat.id}):null};return i.a.createElement("div",{className:"row-height position-relative"},i.a.createElement(l.d,null,i.a.createElement(l.b,{path:"".concat(t,"/user/:uid"),render:function(e){return i.a.createElement(vt,null,i.a.createElement(Ue,{uid:e.match.params.uid}),a())}}),i.a.createElement(l.b,{path:"".concat(t,"/group/:gcid"),render:function(e){return i.a.createElement(vt,null,i.a.createElement(We,{gcid:e.match.params.gcid,tab:Pe}),a())}}),i.a.createElement(l.b,{path:"".concat(t,"/groupInfo/:gcid"),render:function(e){return i.a.createElement(vt,null,i.a.createElement(We,{gcid:e.match.params.gcid,tab:Ve}))}}),i.a.createElement(l.b,{path:t},i.a.createElement(vt,null,i.a.createElement(ve,{paddingTop:"20px",setHomeState:e.setParentState}))),i.a.createElement(l.b,{path:"*"},i.a.createElement("h3",null,"Not found!"))))}var bt=function(e){Object(p.a)(a,e);var t=Object(f.a)(a);function a(e){var n;return Object(d.a)(this,a),(n=t.call(this,e)).currentChatChanged=function(e){null===e?n.setState({currentChat:{type:"",id:0}}):n.setState({currentChat:{type:e.type,id:e.id},newMessages:he.getNumberNewMessages()})},n.logout=function(){(function(){return T.apply(this,arguments)})().then((function(){location.reload()}))},n.newMsg=function(){n.setState((function(e){return{newMessages:he.getNumberNewMessages()}}))},n.state={currentChat:{type:"",id:0},modal:0,modalInfo:null,newMessages:0,notifications:0},he.initCalled||he.init().then((function(e){})),n}return Object(m.a)(a,[{key:"componentDidMount",value:function(){he.event.on("currentChat changed",this.currentChatChanged),he.event.on("new message",this.newMsg)}},{key:"render",value:function(){var e=this.setState.bind(this);return i.a.createElement("div",{className:"h-100"},i.a.createElement(me,{logout:this.logout,headerLeft:{newMessages:this.state.newMessages}}),i.a.createElement(F,{displayIn:["Mobile"]},i.a.createElement(yt,{currentChat:this.state.currentChat,setParentState:e})),i.a.createElement(F,{displayIn:["Laptop","Tablet"]},i.a.createElement(ft,{newMessages:this.state.newMessages,setParentState:e})))}},{key:"componentWillUnmount",value:function(){he.event.rm("currentChat changed",this.currentChatChanged),he.event.rm("new message",this.newMsg)}}]),a}(r.Component);a(148);function Et(){return i.a.createElement(u.a,null,i.a.createElement("div",{className:"h-100"},i.a.createElement("div",{className:"h-100"},i.a.createElement(l.d,null,i.a.createElement(l.b,{path:"/chat"},wt("chat")),i.a.createElement(l.b,{exact:!0,path:"/login"},w?i.a.createElement(l.a,{to:{pathname:"/chat"}}):i.a.createElement(U,null)),i.a.createElement(l.b,{exact:!0,path:"/register"},w?i.a.createElement(l.a,{to:{pathname:"/chat"}}):i.a.createElement(D,null)),i.a.createElement(l.b,{exact:!0,path:"/"},wt("/")),i.a.createElement(l.b,{path:"*"},i.a.createElement(kt,null))))))}function kt(){var e=Object(l.g)();return i.a.createElement("div",null,i.a.createElement("h3",null,"No match for ",i.a.createElement("code",null,e.pathname)))}function wt(e){return w?"chat"===e?i.a.createElement(bt,null):i.a.createElement(l.a,{to:{pathname:"/chat"}}):i.a.createElement(l.a,{to:{pathname:"/login"}})}Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));N().then((function(e){o.a.render(i.a.createElement(i.a.StrictMode,null,i.a.createElement(Et,null)),document.getElementById("root"))})),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))},88:function(e,t,a){e.exports=a(149)}},[[88,1,2]]]);
//# sourceMappingURL=main.4b346abe.chunk.js.map